insert into news_article_basic(article_id, user_id, channel_id, title, cover, status)values(1, 1, 1, '主流浏览器图片反防盗链方法总结 前言 问题 解决方案 参考资料', '{"type":0, "images":[]}', 2);
insert into news_article_content(article_id, content) values(1,'<h1 id="&#x524D;&#x8A00;">前言</h1>\n<p>还记得之前写的那个无聊的<a href="https://github.com/mythsman/hexo-douban" target="_blank" rel="noopener">插件</a>，前一段时间由于豆瓣读书增加了防盗链策略使得我们无法直接引用他们的图片，使得我这个小插件无法工作。本以为是一个很简单的问题，但是没想到这个小问题硬是让我改了五六遍才改好，可以说是非常的蠢了。总结一下自己犯傻的原因，还是由于自己懒得去深入研究，谷歌百度了问题就直接把方案拿来用了，浅尝辄止人云亦云，解决了表面的问题而没有深入的总结。当然，从另外一个方面讲，我也是初步领会到了前端程序员面对要兼容各种浏览器的需求时头有多大了。</p>\n<h1 id="&#x95EE;&#x9898;">问题</h1>\n<p>问题很简单，就是我希望在自己的页面里用<code><img src="xxxx"/></code>来引用其他网站的一张图片，但是他的网站设置了防盗链的策略，会在后台判断请求的<code>Referrer</code>属性是不是来自于一个非本域名的网站，如果来源不是本域名就返回<code>403 forbidden</code>。我的目的就是用最方便的方法使得我的页面能够不受他的防盗链策略的影响。</p>\n<h1 id="&#x89E3;&#x51B3;&#x65B9;&#x6848;">解决方案</h1>\n<h2 id="&#x540E;&#x53F0;&#x9884;&#x4E0B;&#x8F7D;">后台预下载</h2>\n<p>预下载是最直观的一种方法，既然不能直接引用，那我就先后台下载下来，然后将图片链接到下载后的图片即可。这个方法还是比较稳妥的，图片下载下来就是自己的了，不会再受人限制。不过这总有种侵犯知识产权的感觉，而且每张图片都要后台先下载，逻辑处理起来还是有点麻烦的；而且对于那种纯静态页面，没有后台程序供我们发挥，这也就无法实现了。</p>\n<h2 id="&#x7B2C;&#x4E09;&#x65B9;&#x4EE3;&#x7406;">第三方代理</h2>\n<p>第三方代理其实算是后台与下载的升级版，其实就是将下载图片的这个过程交给第三方的网站。一个非常好用的代理是<a href="https://images.weserv.nl/" target="_blank" rel="noopener">images.weserv.nl</a>，我们可以直接将自己需要“盗链”的图片写在请求中即可。我们甚至可以指定一些简单的图片处理参数，让代理帮我们处理。<br/>\n比如我想盗链<code>https://foo.com/foo.jpg</code>，并且将图片宽度设置成100，我们就可以直接这样引用:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4b2e7e1c4b491707163" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\n&lt;img src="https://images.weserv.nl/?url=foo.com/foo.jpg&amp;w=100" /&gt;</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4b2e7e1c4b491707163-1">1</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4b2e7e1c4b491707163-1"><span class="crayon-o">&lt;</span><span class="crayon-e">img </span><span class="crayon-v">src</span><span class="crayon-o">=</span><span class="crayon-s">"https://images.weserv.nl/?url=foo.com/foo.jpg&amp;w=100"</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-o">&gt;</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0004 seconds] -->&#13;\n<p>这还是很方便的，不过美中不足的是这个国外的网站在国内的访问速度似乎有点慢，有时候甚至还会被墙，这就有点尴尬了。</p>\n<h2 id="&#x5220;&#x9664;Header&#x4E2D;&#x7684;Referrer">删除Header中的Referrer</h2>\n<p>相比上面两种折腾的方法，如果能直接修改Referrer，那不就省了很多事了么。但是事实上这里的配置还是有挺多坑的，方法也有很多种，一不小心就会跟我一样踩了一遍又一遍。</p>\n<h3 id="&#x6DFB;&#x52A0;meta&#x6807;&#x7B7E;">添加meta标签</h3>\n<p>一种方法是给页面添加一个meta标签，在meta标签里指定referrer的值，比如<code/>。网上可以查到各种奇奇怪怪的值，其实我总结了来源于两个地方。<br/>\n一个是来自<a href="https://wiki.whatwg.org/wiki/Meta_referrer" target="_blank" rel="noopener">whatwg</a>的标准。他给meta标签的referrer属性定义了四个值：<code>never,always,origin,default</code>。如果需要关闭referrer，就将referrer的值设置成”never”。这个标准还是比较老的，而且在他的主页上也明确写了”This document is obsolete.”。不过据我调研，或许正是由于这个标准比较老，反而导致绝大多数浏览器对他的支持都很好，因祸得福蛤蛤。<br/>\n另外一个是来自<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/meta" target="_blank" rel="noopener">MDN</a>的标准。他给meta标签的referrer属性定义了五个值，如果要关闭referrer，就将它的值设置成<code>no-referrer</code>。<br/>\n不过我们需要注意的是，meta标签添加的位置也很重要，有的浏览器能够识别非head标签中的meta标签，有的就不行。在实际使用的时候还要小心，这一点下文会有一个更具体的比较。</p>\n<h3 id="&#x6DFB;&#x52A0;ReferrerPolicy&#x5C5E;&#x6027;">添加ReferrerPolicy属性</h3>\n<p>添加meta标签相当于对文档中的所有链接都取消了referrer，而ReferrerPolicy则更精确的指定了某一个资源的referrer策略。关于这个策略的定义可以参照<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Referrer-Policy" target="_blank" rel="noopener">MDN</a>。比如我想只对某一个图片取消referrer，如下编写即可:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4b2e7e1c5a187565566" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\n&lt;img src="xxxx.jpg"  referrerPolicy="no-referrer" /&gt;</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4b2e7e1c5a187565566-1">1</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4b2e7e1c5a187565566-1"><span class="crayon-o">&lt;</span><span class="crayon-e">img </span><span class="crayon-v">src</span><span class="crayon-o">=</span><span class="crayon-s">"xxxx.jpg"</span><span class="crayon-h">\xa0\xa0</span><span class="crayon-v">referrerPolicy</span><span class="crayon-o">=</span><span class="crayon-s">"no-referrer"</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-o">&gt;</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0005 seconds] -->&#13;\n<p/>\n<h3 id="&#x6D4F;&#x89C8;&#x5668;&#x652F;&#x6301;&#x5BF9;&#x6BD4;">浏览器支持对比</h3>\n<p>上面我们讲了两种取消referrer头信息的方法，但其实这却对应了<strong>五种</strong>写法，我们来看下面的对比表：</p>\n<table>\n<thead>\n<tr>\n<th>–</th>\n<th>NOTHING</th>\n<th>META IN HEAD REFERRER=NEVER</th>\n<th>META IN HEAD REFERRER=NO-REFERRER</th>\n<th>META REFERRER=NEVER</th>\n<th>META REFERRER=NO-REFERRER</th>\n<th>IMG REFERRERPOLICY=NO-REFERRER</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Chrome</td>\n<td>N</td>\n<td>Y</td>\n<td>Y</td>\n<td>Y</td>\n<td>Y</td>\n<td>Y</td>\n</tr>\n<tr>\n<td>Firefox</td>\n<td>N</td>\n<td>Y</td>\n<td>Y</td>\n<td>N</td>\n<td>N</td>\n<td>Y</td>\n</tr>\n<tr>\n<td>Edge/IE</td>\n<td>N</td>\n<td>Y</td>\n<td>N</td>\n<td>Y</td>\n<td>N</td>\n<td>N</td>\n</tr>\n</tbody>\n</table>\n<p>可以看出Chrome浏览器对各种写法都支持的最好，棒棒哒；Firefox支持所有标准的写法，但是不支持没有写在head标签中的meta标签；Edge/IE则不支持MDN里定义的”no-referrer”配置项，果然是个古董。。。</p>\n<p>总的来说，保证最佳效果的最简单的写法就是添加一个meta标签<code/>，这样就不用考虑浏览器的差别了，虽然这种写法并不被官方推荐(主要还是要迁就IE这个古董，放弃了理论上更为正确的标准)。</p>\n<h1 id="&#x53C2;&#x8003;&#x8D44;&#x6599;">参考资料</h1>\n<p><a href="https://wiki.whatwg.org/wiki/Meta_referrer" target="_blank" rel="noopener">whatwg</a><br/>\n<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/meta" target="_blank" rel="noopener">MDN</a><br/>\n<a href="http://www.freebuf.com/news/57497.html" target="_blank" rel="noopener">使用Referer Meta标签控制referer</a></p>\n<div/>\n&#13;\n        <script language="javascript"> &#13;\nvar randomNum = Math.round(Math.random()*1);&#13;\nvar innerHTML=new Array(2);&#13;\ninnerHTML[0]="如果有人让你推荐前端技术书，请让他看这个列表 -&gt;《&lt;a target=\'_blank\' href=\'http://web.jobbole.com/86734/\'&gt;经典前端技术书籍&lt;/a&gt;》";&#13;\ninnerHTML[1]="如果有人让你推荐前端技术书，请让他看这个列表 -&gt;《&lt;a target=\'_blank\' href=\'http://web.jobbole.com/86734/\'&gt;经典前端技术书籍&lt;/a&gt;》";&#13;\nvar widgetHTML="&lt;div id=\'single-page-inner-widget\'&gt;"+innerHTML[randomNum]+"&lt;/div&gt;";&#13;\ndocument.write(widgetHTML);&#13;\n</script>&#13;\n        &#13;\n        \n     \n\n\n\n&#13;\n        <!-- BEGIN #author-bio -->&#13;\n&#13;\n&#13;\n<!-- END #author-bio -->&#13;');
insert into news_article_basic(article_id, user_id, channel_id, title, cover, status)values(2, 1, 1, 'SVG 图像入门教程', '{"type":0, "images":[]}', 2);
insert into news_article_content(article_id, content) values(2,'<h2>一、概述</h2>\n<p>SVG 是一种基于 XML 语法的图像格式，全称是可缩放矢量图（Scalable Vector Graphics）。其他图像格式都是基于像素处理的，SVG 则是属于对图像的形状描述，所以它本质上是文本文件，体积较小，且不管放大多少倍都不会失真。</p>\n<p><img src="http://wx1.sinaimg.cn/mw690/63918611gy1fu14a832euj20b40b4aa1.jpg"/></p>\n<p>SVG 文件可以直接插入网页，成为 DOM 的一部分，然后用 JavaScript 和 CSS 进行操作。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4b3d544be3869576094" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\n&lt;!DOCTYPE html&gt;&#13;\n&lt;html&gt;&#13;\n&lt;head&gt;&lt;/head&gt;&#13;\n&lt;body&gt;&#13;\n&lt;svg&#13;\n  id="mysvg"&#13;\n  xmlns="http://www.w3.org/2000/svg"&#13;\n  viewBox="0 0 800 600"&#13;\n  preserveAspectRatio="xMidYMid meet"&#13;\n&gt;&#13;\n  &lt;circle id="mycircle" cx="400" cy="300" r="50" /&gt;&#13;\n&lt;svg&gt;&#13;\n&lt;/body&gt;&#13;\n&lt;/html&gt;</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4b3d544be3869576094-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544be3869576094-2">2</div><div class="crayon-num" data-line="crayon-5be4b3d544be3869576094-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544be3869576094-4">4</div><div class="crayon-num" data-line="crayon-5be4b3d544be3869576094-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544be3869576094-6">6</div><div class="crayon-num" data-line="crayon-5be4b3d544be3869576094-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544be3869576094-8">8</div><div class="crayon-num" data-line="crayon-5be4b3d544be3869576094-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544be3869576094-10">10</div><div class="crayon-num" data-line="crayon-5be4b3d544be3869576094-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544be3869576094-12">12</div><div class="crayon-num" data-line="crayon-5be4b3d544be3869576094-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544be3869576094-14">14</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4b3d544be3869576094-1"><span class="crayon-o">&lt;</span><span class="crayon-o">!</span><span class="crayon-e">DOCTYPE </span><span class="crayon-v">html</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544be3869576094-2"><span class="crayon-o">&lt;</span><span class="crayon-v">html</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5be4b3d544be3869576094-3"><span class="crayon-o">&lt;</span><span class="crayon-v">head</span><span class="crayon-o">&gt;</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">head</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544be3869576094-4"><span class="crayon-o">&lt;</span><span class="crayon-v">body</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5be4b3d544be3869576094-5"><span class="crayon-o">&lt;</span><span class="crayon-e">svg</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544be3869576094-6"><span class="crayon-e">\xa0\xa0</span><span class="crayon-v">id</span><span class="crayon-o">=</span><span class="crayon-s">"mysvg"</span></div><div class="crayon-line" id="crayon-5be4b3d544be3869576094-7"><span class="crayon-h">\xa0\xa0</span><span class="crayon-v">xmlns</span><span class="crayon-o">=</span><span class="crayon-s">"http://www.w3.org/2000/svg"</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544be3869576094-8"><span class="crayon-h">\xa0\xa0</span><span class="crayon-v">viewBox</span><span class="crayon-o">=</span><span class="crayon-s">"0 0 800 600"</span></div><div class="crayon-line" id="crayon-5be4b3d544be3869576094-9"><span class="crayon-h">\xa0\xa0</span><span class="crayon-v">preserveAspectRatio</span><span class="crayon-o">=</span><span class="crayon-s">"xMidYMid meet"</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544be3869576094-10"><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5be4b3d544be3869576094-11"><span class="crayon-h">\xa0\xa0</span><span class="crayon-o">&lt;</span><span class="crayon-e">circle </span><span class="crayon-v">id</span><span class="crayon-o">=</span><span class="crayon-s">"mycircle"</span><span class="crayon-h"> </span><span class="crayon-v">cx</span><span class="crayon-o">=</span><span class="crayon-s">"400"</span><span class="crayon-h"> </span><span class="crayon-v">cy</span><span class="crayon-o">=</span><span class="crayon-s">"300"</span><span class="crayon-h"> </span><span class="crayon-v">r</span><span class="crayon-o">=</span><span class="crayon-s">"50"</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544be3869576094-12"><span class="crayon-o">&lt;</span><span class="crayon-v">svg</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5be4b3d544be3869576094-13"><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">body</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544be3869576094-14"><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">html</span><span class="crayon-o">&gt;</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0016 seconds] -->&#13;\n<p>上面是 SVG 代码直接插入网页的例子。</p>\n<p>SVG 代码也可以写在一个独立文件中，然后用<code>&lt;img&gt;</code>、<code>&lt;object&gt;</code>、<code>&lt;embed&gt;</code>、<code>&lt;iframe&gt;</code>等标签插入网页。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4b3d544bed930800617" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\n&lt;img src="circle.svg"&gt;&#13;\n&lt;object id="object" data="circle.svg" type="image/svg+xml"&gt;&lt;/object&gt;&#13;\n&lt;embed id="embed" src="icon.svg" type="image/svg+xml"&gt;&#13;\n&lt;iframe id="iframe" src="icon.svg"&gt;&lt;/iframe&gt;</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4b3d544bed930800617-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544bed930800617-2">2</div><div class="crayon-num" data-line="crayon-5be4b3d544bed930800617-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544bed930800617-4">4</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4b3d544bed930800617-1"><span class="crayon-o">&lt;</span><span class="crayon-e">img </span><span class="crayon-v">src</span><span class="crayon-o">=</span><span class="crayon-s">"circle.svg"</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544bed930800617-2"><span class="crayon-o">&lt;</span><span class="crayon-t">object</span><span class="crayon-h"> </span><span class="crayon-v">id</span><span class="crayon-o">=</span><span class="crayon-s">"object"</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-o">=</span><span class="crayon-s">"circle.svg"</span><span class="crayon-h"> </span><span class="crayon-v">type</span><span class="crayon-o">=</span><span class="crayon-s">"image/svg+xml"</span><span class="crayon-o">&gt;</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-t">object</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5be4b3d544bed930800617-3"><span class="crayon-o">&lt;</span><span class="crayon-e">embed </span><span class="crayon-v">id</span><span class="crayon-o">=</span><span class="crayon-s">"embed"</span><span class="crayon-h"> </span><span class="crayon-v">src</span><span class="crayon-o">=</span><span class="crayon-s">"icon.svg"</span><span class="crayon-h"> </span><span class="crayon-v">type</span><span class="crayon-o">=</span><span class="crayon-s">"image/svg+xml"</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544bed930800617-4"><span class="crayon-o">&lt;</span><span class="crayon-e">iframe </span><span class="crayon-v">id</span><span class="crayon-o">=</span><span class="crayon-s">"iframe"</span><span class="crayon-h"> </span><span class="crayon-v">src</span><span class="crayon-o">=</span><span class="crayon-s">"icon.svg"</span><span class="crayon-o">&gt;</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">iframe</span><span class="crayon-o">&gt;</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0012 seconds] -->&#13;\n<p>CSS 也可以使用 SVG 文件。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4b3d544bf1973265027" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div><span class="crayon-language">CSS</span></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\n.logo {&#13;\n  background: url(icon.svg);&#13;\n}</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4b3d544bf1973265027-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544bf1973265027-2">2</div><div class="crayon-num" data-line="crayon-5be4b3d544bf1973265027-3">3</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4b3d544bf1973265027-1"><span class="crayon-k ">.logo </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544bf1973265027-2"><span class="crayon-h">\xa0\xa0</span><span class="crayon-e ">background</span><span class="crayon-sy">:</span><span class="crayon-h"> </span><span class="crayon-i ">url</span><span class="crayon-sy">(</span><span class="crayon-i ">icon.svg</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5be4b3d544bf1973265027-3"><span class="crayon-sy">}</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0005 seconds] -->&#13;\n<p>SVG 文件还可以转为 BASE64 编码，然后作为 Data URI 写入网页。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4b3d544bf4042487346" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\n&lt;img src="data:image/svg+xml;base64,[data]"&gt;</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4b3d544bf4042487346-1">1</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4b3d544bf4042487346-1"><span class="crayon-o">&lt;</span><span class="crayon-e">img </span><span class="crayon-v">src</span><span class="crayon-o">=</span><span class="crayon-s">"data:image/svg+xml;base64,[data]"</span><span class="crayon-o">&gt;</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0004 seconds] -->&#13;\n<p/>\n<h2>二、语法</h2>\n<h3>2.1<code>&lt;svg&gt;</code>标签</h3>\n<p>SVG 代码都放在顶层标签&lt;svg&gt;<code/>之中。下面是一个例子。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4b3d544bf8707199429" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\n&lt;svg width="100%" height="100%"&gt;&#13;\n  &lt;circle id="mycircle" cx="50" cy="50" r="50" /&gt;&#13;\n&lt;/svg&gt;</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4b3d544bf8707199429-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544bf8707199429-2">2</div><div class="crayon-num" data-line="crayon-5be4b3d544bf8707199429-3">3</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4b3d544bf8707199429-1"><span class="crayon-o">&lt;</span><span class="crayon-e">svg </span><span class="crayon-v">width</span><span class="crayon-o">=</span><span class="crayon-s">"100%"</span><span class="crayon-h"> </span><span class="crayon-v">height</span><span class="crayon-o">=</span><span class="crayon-s">"100%"</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544bf8707199429-2"><span class="crayon-h">\xa0\xa0</span><span class="crayon-o">&lt;</span><span class="crayon-e">circle </span><span class="crayon-v">id</span><span class="crayon-o">=</span><span class="crayon-s">"mycircle"</span><span class="crayon-h"> </span><span class="crayon-v">cx</span><span class="crayon-o">=</span><span class="crayon-s">"50"</span><span class="crayon-h"> </span><span class="crayon-v">cy</span><span class="crayon-o">=</span><span class="crayon-s">"50"</span><span class="crayon-h"> </span><span class="crayon-v">r</span><span class="crayon-o">=</span><span class="crayon-s">"50"</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5be4b3d544bf8707199429-3"><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">svg</span><span class="crayon-o">&gt;</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0009 seconds] -->&#13;\n<p><code>&lt;svg&gt;的<code>width</code>属性和<code>height</code>属性，指定了 SVG 图像在 HTML 元素中所占据的宽度和高度。除了相对单位，也可以采用绝对单位（单位：像素）。如果不指定这两个属性，SVG 图像默认大小是300像素（宽） x 150像素（高）。</code></p>\n<p>如果只想展示 SVG 图像的一部分，就要指定<code>viewBox</code>属性。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4b3d544bfb880978643" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\n&lt;svg width="100" height="100" viewBox="50 50 50 50"&gt;&#13;\n  &lt;circle id="mycircle" cx="50" cy="50" r="50" /&gt;&#13;\n&lt;/svg&gt;</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4b3d544bfb880978643-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544bfb880978643-2">2</div><div class="crayon-num" data-line="crayon-5be4b3d544bfb880978643-3">3</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4b3d544bfb880978643-1"><span class="crayon-o">&lt;</span><span class="crayon-e">svg </span><span class="crayon-v">width</span><span class="crayon-o">=</span><span class="crayon-s">"100"</span><span class="crayon-h"> </span><span class="crayon-v">height</span><span class="crayon-o">=</span><span class="crayon-s">"100"</span><span class="crayon-h"> </span><span class="crayon-v">viewBox</span><span class="crayon-o">=</span><span class="crayon-s">"50 50 50 50"</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544bfb880978643-2"><span class="crayon-h">\xa0\xa0</span><span class="crayon-o">&lt;</span><span class="crayon-e">circle </span><span class="crayon-v">id</span><span class="crayon-o">=</span><span class="crayon-s">"mycircle"</span><span class="crayon-h"> </span><span class="crayon-v">cx</span><span class="crayon-o">=</span><span class="crayon-s">"50"</span><span class="crayon-h"> </span><span class="crayon-v">cy</span><span class="crayon-o">=</span><span class="crayon-s">"50"</span><span class="crayon-h"> </span><span class="crayon-v">r</span><span class="crayon-o">=</span><span class="crayon-s">"50"</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5be4b3d544bfb880978643-3"><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">svg</span><span class="crayon-o">&gt;</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0010 seconds] -->&#13;\n<p><code>&lt;viewBox&gt;</code>属性的值有四个数字，分别是左上角的横坐标和纵坐标、视口的宽度和高度。上面代码中，SVG 图像是100像素宽 x 100像素高，<code>viewBox</code>属性指定视口从<code>(50, 50)</code>这个点开始。所以，实际看到的是右下角的四分之一圆。</p>\n<p>注意，视口必须适配所在的空间。上面代码中，视口的大小是 50 x 50，由于 SVG 图像的大小是 100 x 100，所以视口会放大去适配 SVG 图像的大小，即放大了四倍。</p>\n<p>如果不指定<code>width</code>属性和<code>height</code>属性，只指定<code>viewBox</code>属性，则相当于只给定 SVG 图像的长宽比。这时，SVG 图像的默认大小将等于所在的 HTML 元素的大小。</p>\n<h3>2.2\xa0<code>&lt;circle&gt;</code>标签</h3>\n<p><code>&lt;circle&gt;</code>标签代表圆形。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4b3d544bfe660686685" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\n&lt;svg width="300" height="180"&gt;&#13;\n  &lt;circle cx="30"  cy="50" r="25" /&gt;&#13;\n  &lt;circle cx="90"  cy="50" r="25" class="red" /&gt;&#13;\n  &lt;circle cx="150" cy="50" r="25" class="fancy" /&gt;&#13;\n&lt;/svg&gt;</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4b3d544bfe660686685-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544bfe660686685-2">2</div><div class="crayon-num" data-line="crayon-5be4b3d544bfe660686685-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544bfe660686685-4">4</div><div class="crayon-num" data-line="crayon-5be4b3d544bfe660686685-5">5</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4b3d544bfe660686685-1"><span class="crayon-o">&lt;</span><span class="crayon-e">svg </span><span class="crayon-v">width</span><span class="crayon-o">=</span><span class="crayon-s">"300"</span><span class="crayon-h"> </span><span class="crayon-v">height</span><span class="crayon-o">=</span><span class="crayon-s">"180"</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544bfe660686685-2"><span class="crayon-h">\xa0\xa0</span><span class="crayon-o">&lt;</span><span class="crayon-e">circle </span><span class="crayon-v">cx</span><span class="crayon-o">=</span><span class="crayon-s">"30"</span><span class="crayon-h">\xa0\xa0</span><span class="crayon-v">cy</span><span class="crayon-o">=</span><span class="crayon-s">"50"</span><span class="crayon-h"> </span><span class="crayon-v">r</span><span class="crayon-o">=</span><span class="crayon-s">"25"</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5be4b3d544bfe660686685-3"><span class="crayon-h">\xa0\xa0</span><span class="crayon-o">&lt;</span><span class="crayon-e">circle </span><span class="crayon-v">cx</span><span class="crayon-o">=</span><span class="crayon-s">"90"</span><span class="crayon-h">\xa0\xa0</span><span class="crayon-v">cy</span><span class="crayon-o">=</span><span class="crayon-s">"50"</span><span class="crayon-h"> </span><span class="crayon-v">r</span><span class="crayon-o">=</span><span class="crayon-s">"25"</span><span class="crayon-h"> </span><span class="crayon-t">class</span><span class="crayon-o">=</span><span class="crayon-s">"red"</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544bfe660686685-4"><span class="crayon-h">\xa0\xa0</span><span class="crayon-o">&lt;</span><span class="crayon-e">circle </span><span class="crayon-v">cx</span><span class="crayon-o">=</span><span class="crayon-s">"150"</span><span class="crayon-h"> </span><span class="crayon-v">cy</span><span class="crayon-o">=</span><span class="crayon-s">"50"</span><span class="crayon-h"> </span><span class="crayon-v">r</span><span class="crayon-o">=</span><span class="crayon-s">"25"</span><span class="crayon-h"> </span><span class="crayon-t">class</span><span class="crayon-o">=</span><span class="crayon-s">"fancy"</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5be4b3d544bfe660686685-5"><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">svg</span><span class="crayon-o">&gt;</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0016 seconds] -->&#13;\n<p>上面的代码定义了三个圆。<code>&lt;circle&gt;</code>标签的<code>cx</code>、<code>cy</code>、<code>r</code>属性分别为横坐标、纵坐标和半径，单位为像素。坐标都是相对于<code>&lt;svg&gt;</code>画布的左上角原点。</p>\n<p><code>class</code>属性用来指定对应的 CSS 类。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4b3d544c02306088151" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div><span class="crayon-language">CSS</span></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\n.red {&#13;\n  fill: red;&#13;\n}&#13;\n&#13;\n.fancy {&#13;\n  fill: none;&#13;\n  stroke: black;&#13;\n  stroke-width: 3pt;&#13;\n}</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4b3d544c02306088151-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544c02306088151-2">2</div><div class="crayon-num" data-line="crayon-5be4b3d544c02306088151-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544c02306088151-4">4</div><div class="crayon-num" data-line="crayon-5be4b3d544c02306088151-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544c02306088151-6">6</div><div class="crayon-num" data-line="crayon-5be4b3d544c02306088151-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544c02306088151-8">8</div><div class="crayon-num" data-line="crayon-5be4b3d544c02306088151-9">9</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4b3d544c02306088151-1"><span class="crayon-k ">.red </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544c02306088151-2"><span class="crayon-h">\xa0\xa0</span><span class="crayon-e ">fill</span><span class="crayon-sy">:</span><span class="crayon-h"> </span><span class="crayon-i ">red</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5be4b3d544c02306088151-3"><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544c02306088151-4">\xa0</div><div class="crayon-line" id="crayon-5be4b3d544c02306088151-5"><span class="crayon-k ">.fancy </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544c02306088151-6"><span class="crayon-h">\xa0\xa0</span><span class="crayon-e ">fill</span><span class="crayon-sy">:</span><span class="crayon-h"> </span><span class="crayon-i ">none</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5be4b3d544c02306088151-7"><span class="crayon-h">\xa0\xa0</span><span class="crayon-e ">stroke</span><span class="crayon-sy">:</span><span class="crayon-h"> </span><span class="crayon-i ">black</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544c02306088151-8"><span class="crayon-h">\xa0\xa0</span><span class="crayon-e ">stroke-width</span><span class="crayon-sy">:</span><span class="crayon-h"> </span><span class="crayon-i ">3pt</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5be4b3d544c02306088151-9"><span class="crayon-sy">}</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0008 seconds] -->&#13;\n<p>SVG 的 CSS 属性与网页元素有所不同。</p>\n<ul>\n<li>fill：填充色</li>\n<li>stroke：描边色</li>\n<li>stroke-width：边框宽度</li>\n</ul>\n<h3>2.3\xa0<code>&lt;line&gt;</code>标签</h3>\n<p><code>&lt;line&gt;</code>标签用来绘制直线。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4b3d544c05747722205" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\n&lt;svg width="300" height="180"&gt;&#13;\n  &lt;line x1="0" y1="0" x2="200" y2="0" style="stroke:rgb(0,0,0);stroke-width:5" /&gt;&#13;\n&lt;/svg&gt;</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4b3d544c05747722205-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544c05747722205-2">2</div><div class="crayon-num" data-line="crayon-5be4b3d544c05747722205-3">3</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4b3d544c05747722205-1"><span class="crayon-o">&lt;</span><span class="crayon-e">svg </span><span class="crayon-v">width</span><span class="crayon-o">=</span><span class="crayon-s">"300"</span><span class="crayon-h"> </span><span class="crayon-v">height</span><span class="crayon-o">=</span><span class="crayon-s">"180"</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544c05747722205-2"><span class="crayon-h">\xa0\xa0</span><span class="crayon-o">&lt;</span><span class="crayon-e">line </span><span class="crayon-v">x1</span><span class="crayon-o">=</span><span class="crayon-s">"0"</span><span class="crayon-h"> </span><span class="crayon-v">y1</span><span class="crayon-o">=</span><span class="crayon-s">"0"</span><span class="crayon-h"> </span><span class="crayon-v">x2</span><span class="crayon-o">=</span><span class="crayon-s">"200"</span><span class="crayon-h"> </span><span class="crayon-v">y2</span><span class="crayon-o">=</span><span class="crayon-s">"0"</span><span class="crayon-h"> </span><span class="crayon-v">style</span><span class="crayon-o">=</span><span class="crayon-s">"stroke:rgb(0,0,0);stroke-width:5"</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5be4b3d544c05747722205-3"><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">svg</span><span class="crayon-o">&gt;</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0010 seconds] -->&#13;\n<p>上面代码中，&lt;line&gt;<code/>标签的<code>x1</code>属性和<code>y1</code>属性，表示线段起点的横坐标和纵坐标；<code>x2</code>属性和<code>y2</code>属性，表示线段终点的横坐标和纵坐标；<code>style</code>属性表示线段的样式。</p>\n<h3>2.4\xa0<code>&lt;polyline&gt;</code>标签</h3>\n<p><code>&lt;polyline&gt;</code>标签用于绘制一根折线。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4b3d544c08590439829" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\n&lt;svg width="300" height="180"&gt;&#13;\n  &lt;polyline points="3,3 30,28 3,53" fill="none" stroke="black" /&gt;&#13;\n&lt;/svg&gt;</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4b3d544c08590439829-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544c08590439829-2">2</div><div class="crayon-num" data-line="crayon-5be4b3d544c08590439829-3">3</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4b3d544c08590439829-1"><span class="crayon-o">&lt;</span><span class="crayon-e">svg </span><span class="crayon-v">width</span><span class="crayon-o">=</span><span class="crayon-s">"300"</span><span class="crayon-h"> </span><span class="crayon-v">height</span><span class="crayon-o">=</span><span class="crayon-s">"180"</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544c08590439829-2"><span class="crayon-h">\xa0\xa0</span><span class="crayon-o">&lt;</span><span class="crayon-e">polyline </span><span class="crayon-v">points</span><span class="crayon-o">=</span><span class="crayon-s">"3,3 30,28 3,53"</span><span class="crayon-h"> </span><span class="crayon-v">fill</span><span class="crayon-o">=</span><span class="crayon-s">"none"</span><span class="crayon-h"> </span><span class="crayon-v">stroke</span><span class="crayon-o">=</span><span class="crayon-s">"black"</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5be4b3d544c08590439829-3"><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">svg</span><span class="crayon-o">&gt;</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0009 seconds] -->&#13;\n<p><code/><code>&lt;polyline&gt;</code>的<code>points</code>属性指定了每个端点的坐标，横坐标与纵坐标之间与逗号分隔，点与点之间用空格分隔。</p>\n<h3/>\n<p><!-- /div --></p>\n<h3>2.5 <code>&lt;rect&gt;</code>标签</h3>\n<p><code>&lt;rect&gt;</code>标签用于绘制矩形。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4b3d544c0b317643570" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\n&lt;svg width="300" height="180"&gt;&#13;\n  &lt;rect x="0" y="0" height="100" width="200" style="stroke: #70d5dd; fill: #dd524b" /&gt;&#13;\n&lt;/svg&gt;</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4b3d544c0b317643570-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544c0b317643570-2">2</div><div class="crayon-num" data-line="crayon-5be4b3d544c0b317643570-3">3</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4b3d544c0b317643570-1"><span class="crayon-o">&lt;</span><span class="crayon-e">svg </span><span class="crayon-v">width</span><span class="crayon-o">=</span><span class="crayon-s">"300"</span><span class="crayon-h"> </span><span class="crayon-v">height</span><span class="crayon-o">=</span><span class="crayon-s">"180"</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544c0b317643570-2"><span class="crayon-h">\xa0\xa0</span><span class="crayon-o">&lt;</span><span class="crayon-i">rect</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-o">=</span><span class="crayon-s">"0"</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-o">=</span><span class="crayon-s">"0"</span><span class="crayon-h"> </span><span class="crayon-v">height</span><span class="crayon-o">=</span><span class="crayon-s">"100"</span><span class="crayon-h"> </span><span class="crayon-v">width</span><span class="crayon-o">=</span><span class="crayon-s">"200"</span><span class="crayon-h"> </span><span class="crayon-v">style</span><span class="crayon-o">=</span><span class="crayon-s">"stroke: #70d5dd; fill: #dd524b"</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5be4b3d544c0b317643570-3"><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">svg</span><span class="crayon-o">&gt;</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0011 seconds] -->&#13;\n<p><code>&lt;rect&gt;</code>的<code>x</code>属性和<code>y</code>属性，指定了矩形左上角端点的横坐标和纵坐标；<code>width</code>属性和<code>height</code>属性指定了矩形的宽度和高度（单位像素）。</p>\n<h3>2.6 <code>&lt;ellipse&gt;</code>标签</h3>\n<p><code>&lt;ellipse&gt;</code>标签用于绘制椭圆。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4b3d544c0f123972498" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\n&lt;svg width="300" height="180"&gt;&#13;\n  &lt;ellipse cx="60" cy="60" ry="40" rx="20" stroke="black" stroke-width="5" fill="silver"/&gt;&#13;\n&lt;/svg&gt;</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4b3d544c0f123972498-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544c0f123972498-2">2</div><div class="crayon-num" data-line="crayon-5be4b3d544c0f123972498-3">3</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4b3d544c0f123972498-1"><span class="crayon-o">&lt;</span><span class="crayon-e">svg </span><span class="crayon-v">width</span><span class="crayon-o">=</span><span class="crayon-s">"300"</span><span class="crayon-h"> </span><span class="crayon-v">height</span><span class="crayon-o">=</span><span class="crayon-s">"180"</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544c0f123972498-2"><span class="crayon-h">\xa0\xa0</span><span class="crayon-o">&lt;</span><span class="crayon-e">ellipse </span><span class="crayon-v">cx</span><span class="crayon-o">=</span><span class="crayon-s">"60"</span><span class="crayon-h"> </span><span class="crayon-v">cy</span><span class="crayon-o">=</span><span class="crayon-s">"60"</span><span class="crayon-h"> </span><span class="crayon-v">ry</span><span class="crayon-o">=</span><span class="crayon-s">"40"</span><span class="crayon-h"> </span><span class="crayon-v">rx</span><span class="crayon-o">=</span><span class="crayon-s">"20"</span><span class="crayon-h"> </span><span class="crayon-v">stroke</span><span class="crayon-o">=</span><span class="crayon-s">"black"</span><span class="crayon-h"> </span><span class="crayon-v">stroke</span><span class="crayon-o">-</span><span class="crayon-v">width</span><span class="crayon-o">=</span><span class="crayon-s">"5"</span><span class="crayon-h"> </span><span class="crayon-v">fill</span><span class="crayon-o">=</span><span class="crayon-s">"silver"</span><span class="crayon-o">/</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5be4b3d544c0f123972498-3"><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">svg</span><span class="crayon-o">&gt;</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0012 seconds] -->&#13;\n<p><code>&lt;ellipse&gt;</code>的<code>cx</code>属性和<code>cy</code>属性，指定了椭圆中心的横坐标和纵坐标（单位像素）；<code>rx</code>属性和<code>ry</code>属性，指定了椭圆横向轴和纵向轴的半径（单位像素）。</p>\n<h3>2.7 <code>&lt;polygon&gt;</code>标签</h3>\n<p><code>&lt;polygon&gt;</code>标签用于绘制多边形。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4b3d544c12587914047" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\n&lt;svg width="300" height="180"&gt;&#13;\n  &lt;polygon fill="green" stroke="orange" stroke-width="1" points="0,0 100,0 100,100 0,100 0,0"/&gt;&#13;\n&lt;/svg&gt;</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4b3d544c12587914047-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544c12587914047-2">2</div><div class="crayon-num" data-line="crayon-5be4b3d544c12587914047-3">3</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4b3d544c12587914047-1"><span class="crayon-o">&lt;</span><span class="crayon-e">svg </span><span class="crayon-v">width</span><span class="crayon-o">=</span><span class="crayon-s">"300"</span><span class="crayon-h"> </span><span class="crayon-v">height</span><span class="crayon-o">=</span><span class="crayon-s">"180"</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544c12587914047-2"><span class="crayon-h">\xa0\xa0</span><span class="crayon-o">&lt;</span><span class="crayon-e">polygon </span><span class="crayon-v">fill</span><span class="crayon-o">=</span><span class="crayon-s">"green"</span><span class="crayon-h"> </span><span class="crayon-v">stroke</span><span class="crayon-o">=</span><span class="crayon-s">"orange"</span><span class="crayon-h"> </span><span class="crayon-v">stroke</span><span class="crayon-o">-</span><span class="crayon-v">width</span><span class="crayon-o">=</span><span class="crayon-s">"1"</span><span class="crayon-h"> </span><span class="crayon-v">points</span><span class="crayon-o">=</span><span class="crayon-s">"0,0 100,0 100,100 0,100 0,0"</span><span class="crayon-o">/</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5be4b3d544c12587914047-3"><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">svg</span><span class="crayon-o">&gt;</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0009 seconds] -->&#13;\n<p><code>&lt;polygon&gt;</code>的<code>points</code>属性指定了每个端点的坐标，横坐标与纵坐标之间与逗号分隔，点与点之间用空格分隔。</p>\n<h3>2.8 <code>&lt;path&gt;</code>标签</h3>\n<p><code>&lt;path&gt;</code>标签用于制路径。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4b3d544c15833160748" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\n&lt;svg width="300" height="180"&gt;&#13;\n&lt;path d="&#13;\n  M 18,3&#13;\n  L 46,3&#13;\n  L 46,40&#13;\n  L 61,40&#13;\n  L 32,68&#13;\n  L 3,40&#13;\n  L 18,40&#13;\n  Z&#13;\n"&gt;&lt;/path&gt;&#13;\n&lt;/svg&gt;</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4b3d544c15833160748-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544c15833160748-2">2</div><div class="crayon-num" data-line="crayon-5be4b3d544c15833160748-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544c15833160748-4">4</div><div class="crayon-num" data-line="crayon-5be4b3d544c15833160748-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544c15833160748-6">6</div><div class="crayon-num" data-line="crayon-5be4b3d544c15833160748-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544c15833160748-8">8</div><div class="crayon-num" data-line="crayon-5be4b3d544c15833160748-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544c15833160748-10">10</div><div class="crayon-num" data-line="crayon-5be4b3d544c15833160748-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544c15833160748-12">12</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4b3d544c15833160748-1"><span class="crayon-o">&lt;</span><span class="crayon-e">svg </span><span class="crayon-v">width</span><span class="crayon-o">=</span><span class="crayon-s">"300"</span><span class="crayon-h"> </span><span class="crayon-v">height</span><span class="crayon-o">=</span><span class="crayon-s">"180"</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544c15833160748-2"><span class="crayon-o">&lt;</span><span class="crayon-i">path</span><span class="crayon-h"> </span><span class="crayon-v">d</span><span class="crayon-o">=</span><span class="crayon-s">"</span></div><div class="crayon-line" id="crayon-5be4b3d544c15833160748-3"><span class="crayon-s">\xa0\xa0M 18,3</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544c15833160748-4"><span class="crayon-s">\xa0\xa0L 46,3</span></div><div class="crayon-line" id="crayon-5be4b3d544c15833160748-5"><span class="crayon-s">\xa0\xa0L 46,40</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544c15833160748-6"><span class="crayon-s">\xa0\xa0L 61,40</span></div><div class="crayon-line" id="crayon-5be4b3d544c15833160748-7"><span class="crayon-s">\xa0\xa0L 32,68</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544c15833160748-8"><span class="crayon-s">\xa0\xa0L 3,40</span></div><div class="crayon-line" id="crayon-5be4b3d544c15833160748-9"><span class="crayon-s">\xa0\xa0L 18,40</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544c15833160748-10"><span class="crayon-s">\xa0\xa0Z</span></div><div class="crayon-line" id="crayon-5be4b3d544c15833160748-11"><span class="crayon-s">"</span><span class="crayon-o">&gt;</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">path</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544c15833160748-12"><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">svg</span><span class="crayon-o">&gt;</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0015 seconds] -->&#13;\n<p><code>&lt;path&gt;</code>的<code>d</code>属性表示绘制顺序，它的值是一个长字符串，每个字母表示一个绘制动作，后面跟着坐标。</p>\n<ul>\n<li>M：移动到（moveto）</li>\n<li>L：画直线到（lineto）</li>\n<li>Z：闭合路径</li>\n</ul>\n<h3>2.9 <code>&lt;text&gt;</code>标签</h3>\n<p><code>&lt;text&gt;</code>标签用于绘制文本。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4b3d544c18424935132" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\n&lt;svg width="300" height="180"&gt;&#13;\n  &lt;text x="50" y="25"&gt;Hello World&lt;/text&gt;&#13;\n&lt;/svg&gt;</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4b3d544c18424935132-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544c18424935132-2">2</div><div class="crayon-num" data-line="crayon-5be4b3d544c18424935132-3">3</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4b3d544c18424935132-1"><span class="crayon-o">&lt;</span><span class="crayon-e">svg </span><span class="crayon-v">width</span><span class="crayon-o">=</span><span class="crayon-s">"300"</span><span class="crayon-h"> </span><span class="crayon-v">height</span><span class="crayon-o">=</span><span class="crayon-s">"180"</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544c18424935132-2"><span class="crayon-h">\xa0\xa0</span><span class="crayon-o">&lt;</span><span class="crayon-i">text</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-o">=</span><span class="crayon-s">"50"</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-o">=</span><span class="crayon-s">"25"</span><span class="crayon-o">&gt;</span><span class="crayon-e">Hello </span><span class="crayon-v">World</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">text</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5be4b3d544c18424935132-3"><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">svg</span><span class="crayon-o">&gt;</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0009 seconds] -->&#13;\n<p><code>&lt;text&gt;</code>的<code>x</code>属性和<code>y</code>属性，表示文本区块基线（baseline）起点的横坐标和纵坐标。文字的样式可以用<code>class</code>或<code>style</code>属性指定。</p>\n<h3>2.10 <code>&lt;use&gt;</code>标签</h3>\n<p><code>&lt;use&gt;</code>标签用于复制一个形状。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4b3d544c1c767121823" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\n&lt;svg viewBox="0 0 30 10" xmlns="http://www.w3.org/2000/svg"&gt;&#13;\n  &lt;circle id="myCircle" cx="5" cy="5" r="4"/&gt;&#13;\n&#13;\n  &lt;use href="#myCircle" x="10" y="0" fill="blue" /&gt;&#13;\n  &lt;use href="#myCircle" x="20" y="0" fill="white" stroke="blue" /&gt;&#13;\n&lt;/svg&gt;</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4b3d544c1c767121823-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544c1c767121823-2">2</div><div class="crayon-num" data-line="crayon-5be4b3d544c1c767121823-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544c1c767121823-4">4</div><div class="crayon-num" data-line="crayon-5be4b3d544c1c767121823-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544c1c767121823-6">6</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4b3d544c1c767121823-1"><span class="crayon-o">&lt;</span><span class="crayon-e">svg </span><span class="crayon-v">viewBox</span><span class="crayon-o">=</span><span class="crayon-s">"0 0 30 10"</span><span class="crayon-h"> </span><span class="crayon-v">xmlns</span><span class="crayon-o">=</span><span class="crayon-s">"http://www.w3.org/2000/svg"</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544c1c767121823-2"><span class="crayon-h">\xa0\xa0</span><span class="crayon-o">&lt;</span><span class="crayon-e">circle </span><span class="crayon-v">id</span><span class="crayon-o">=</span><span class="crayon-s">"myCircle"</span><span class="crayon-h"> </span><span class="crayon-v">cx</span><span class="crayon-o">=</span><span class="crayon-s">"5"</span><span class="crayon-h"> </span><span class="crayon-v">cy</span><span class="crayon-o">=</span><span class="crayon-s">"5"</span><span class="crayon-h"> </span><span class="crayon-v">r</span><span class="crayon-o">=</span><span class="crayon-s">"4"</span><span class="crayon-o">/</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5be4b3d544c1c767121823-3">\xa0</div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544c1c767121823-4"><span class="crayon-h">\xa0\xa0</span><span class="crayon-o">&lt;</span><span class="crayon-st">use</span><span class="crayon-h"> </span><span class="crayon-v">href</span><span class="crayon-o">=</span><span class="crayon-s">"#myCircle"</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-o">=</span><span class="crayon-s">"10"</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-o">=</span><span class="crayon-s">"0"</span><span class="crayon-h"> </span><span class="crayon-v">fill</span><span class="crayon-o">=</span><span class="crayon-s">"blue"</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5be4b3d544c1c767121823-5"><span class="crayon-h">\xa0\xa0</span><span class="crayon-o">&lt;</span><span class="crayon-st">use</span><span class="crayon-h"> </span><span class="crayon-v">href</span><span class="crayon-o">=</span><span class="crayon-s">"#myCircle"</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-o">=</span><span class="crayon-s">"20"</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-o">=</span><span class="crayon-s">"0"</span><span class="crayon-h"> </span><span class="crayon-v">fill</span><span class="crayon-o">=</span><span class="crayon-s">"white"</span><span class="crayon-h"> </span><span class="crayon-v">stroke</span><span class="crayon-o">=</span><span class="crayon-s">"blue"</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544c1c767121823-6"><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">svg</span><span class="crayon-o">&gt;</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0019 seconds] -->&#13;\n<p><code>&lt;use&gt;</code>的<code>href</code>属性指定所要复制的节点，<code>x</code>属性和<code>y</code>属性是<code>&lt;use&gt;</code>左上角的坐标。另外，还可以指定<code>width</code>和<code>height</code>坐标。</p>\n<h3>2.11 <code>&lt;g&gt;</code>标签</h3>\n<p><code>&lt;g&gt;</code>标签用于将多个形状组成一个组（group），方便复用。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4b3d544c1f498125097" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\n&lt;svg width="300" height="100"&gt;&#13;\n  &lt;g id="myCircle"&gt;&#13;\n    &lt;text x="25" y="20"&gt;圆形&lt;/text&gt;&#13;\n    &lt;circle cx="50" cy="50" r="20"/&gt;&#13;\n  &lt;/g&gt;&#13;\n&#13;\n  &lt;use href="#myCircle" x="100" y="0" fill="blue" /&gt;&#13;\n  &lt;use href="#myCircle" x="200" y="0" fill="white" stroke="blue" /&gt;&#13;\n&lt;/svg&gt;</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4b3d544c1f498125097-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544c1f498125097-2">2</div><div class="crayon-num" data-line="crayon-5be4b3d544c1f498125097-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544c1f498125097-4">4</div><div class="crayon-num" data-line="crayon-5be4b3d544c1f498125097-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544c1f498125097-6">6</div><div class="crayon-num" data-line="crayon-5be4b3d544c1f498125097-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544c1f498125097-8">8</div><div class="crayon-num" data-line="crayon-5be4b3d544c1f498125097-9">9</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4b3d544c1f498125097-1"><span class="crayon-o">&lt;</span><span class="crayon-e">svg </span><span class="crayon-v">width</span><span class="crayon-o">=</span><span class="crayon-s">"300"</span><span class="crayon-h"> </span><span class="crayon-v">height</span><span class="crayon-o">=</span><span class="crayon-s">"100"</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544c1f498125097-2"><span class="crayon-h">\xa0\xa0</span><span class="crayon-o">&lt;</span><span class="crayon-i">g</span><span class="crayon-h"> </span><span class="crayon-v">id</span><span class="crayon-o">=</span><span class="crayon-s">"myCircle"</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5be4b3d544c1f498125097-3"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-o">&lt;</span><span class="crayon-i">text</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-o">=</span><span class="crayon-s">"25"</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-o">=</span><span class="crayon-s">"20"</span><span class="crayon-o">&gt;</span>圆形<span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">text</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544c1f498125097-4"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-o">&lt;</span><span class="crayon-e">circle </span><span class="crayon-v">cx</span><span class="crayon-o">=</span><span class="crayon-s">"50"</span><span class="crayon-h"> </span><span class="crayon-v">cy</span><span class="crayon-o">=</span><span class="crayon-s">"50"</span><span class="crayon-h"> </span><span class="crayon-v">r</span><span class="crayon-o">=</span><span class="crayon-s">"20"</span><span class="crayon-o">/</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5be4b3d544c1f498125097-5"><span class="crayon-h">\xa0\xa0</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">g</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544c1f498125097-6">\xa0</div><div class="crayon-line" id="crayon-5be4b3d544c1f498125097-7"><span class="crayon-h">\xa0\xa0</span><span class="crayon-o">&lt;</span><span class="crayon-st">use</span><span class="crayon-h"> </span><span class="crayon-v">href</span><span class="crayon-o">=</span><span class="crayon-s">"#myCircle"</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-o">=</span><span class="crayon-s">"100"</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-o">=</span><span class="crayon-s">"0"</span><span class="crayon-h"> </span><span class="crayon-v">fill</span><span class="crayon-o">=</span><span class="crayon-s">"blue"</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544c1f498125097-8"><span class="crayon-h">\xa0\xa0</span><span class="crayon-o">&lt;</span><span class="crayon-st">use</span><span class="crayon-h"> </span><span class="crayon-v">href</span><span class="crayon-o">=</span><span class="crayon-s">"#myCircle"</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-o">=</span><span class="crayon-s">"200"</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-o">=</span><span class="crayon-s">"0"</span><span class="crayon-h"> </span><span class="crayon-v">fill</span><span class="crayon-o">=</span><span class="crayon-s">"white"</span><span class="crayon-h"> </span><span class="crayon-v">stroke</span><span class="crayon-o">=</span><span class="crayon-s">"blue"</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5be4b3d544c1f498125097-9"><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">svg</span><span class="crayon-o">&gt;</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0023 seconds] -->&#13;\n<p/>\n<h3>2.12 <code>&lt;defs&gt;</code>标签</h3>\n<p><code>&lt;defs&gt;</code>标签用于自定义形状，它内部的代码不会显示，仅供引用。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4b3d544c22366801575" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\n&lt;svg width="300" height="100"&gt;&#13;\n  &lt;defs&gt;&#13;\n    &lt;g id="myCircle"&gt;&#13;\n      &lt;text x="25" y="20"&gt;圆形&lt;/text&gt;&#13;\n      &lt;circle cx="50" cy="50" r="20"/&gt;&#13;\n    &lt;/g&gt;&#13;\n  &lt;/defs&gt;&#13;\n&#13;\n  &lt;use href="#myCircle" x="0" y="0" /&gt;&#13;\n  &lt;use href="#myCircle" x="100" y="0" fill="blue" /&gt;&#13;\n  &lt;use href="#myCircle" x="200" y="0" fill="white" stroke="blue" /&gt;&#13;\n&lt;/svg&gt;</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4b3d544c22366801575-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544c22366801575-2">2</div><div class="crayon-num" data-line="crayon-5be4b3d544c22366801575-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544c22366801575-4">4</div><div class="crayon-num" data-line="crayon-5be4b3d544c22366801575-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544c22366801575-6">6</div><div class="crayon-num" data-line="crayon-5be4b3d544c22366801575-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544c22366801575-8">8</div><div class="crayon-num" data-line="crayon-5be4b3d544c22366801575-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544c22366801575-10">10</div><div class="crayon-num" data-line="crayon-5be4b3d544c22366801575-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544c22366801575-12">12</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4b3d544c22366801575-1"><span class="crayon-o">&lt;</span><span class="crayon-e">svg </span><span class="crayon-v">width</span><span class="crayon-o">=</span><span class="crayon-s">"300"</span><span class="crayon-h"> </span><span class="crayon-v">height</span><span class="crayon-o">=</span><span class="crayon-s">"100"</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544c22366801575-2"><span class="crayon-h">\xa0\xa0</span><span class="crayon-o">&lt;</span><span class="crayon-v">defs</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5be4b3d544c22366801575-3"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-o">&lt;</span><span class="crayon-i">g</span><span class="crayon-h"> </span><span class="crayon-v">id</span><span class="crayon-o">=</span><span class="crayon-s">"myCircle"</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544c22366801575-4"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-o">&lt;</span><span class="crayon-i">text</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-o">=</span><span class="crayon-s">"25"</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-o">=</span><span class="crayon-s">"20"</span><span class="crayon-o">&gt;</span>圆形<span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">text</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5be4b3d544c22366801575-5"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-o">&lt;</span><span class="crayon-e">circle </span><span class="crayon-v">cx</span><span class="crayon-o">=</span><span class="crayon-s">"50"</span><span class="crayon-h"> </span><span class="crayon-v">cy</span><span class="crayon-o">=</span><span class="crayon-s">"50"</span><span class="crayon-h"> </span><span class="crayon-v">r</span><span class="crayon-o">=</span><span class="crayon-s">"20"</span><span class="crayon-o">/</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544c22366801575-6"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">g</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5be4b3d544c22366801575-7"><span class="crayon-h">\xa0\xa0</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">defs</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544c22366801575-8">\xa0</div><div class="crayon-line" id="crayon-5be4b3d544c22366801575-9"><span class="crayon-h">\xa0\xa0</span><span class="crayon-o">&lt;</span><span class="crayon-st">use</span><span class="crayon-h"> </span><span class="crayon-v">href</span><span class="crayon-o">=</span><span class="crayon-s">"#myCircle"</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-o">=</span><span class="crayon-s">"0"</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-o">=</span><span class="crayon-s">"0"</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544c22366801575-10"><span class="crayon-h">\xa0\xa0</span><span class="crayon-o">&lt;</span><span class="crayon-st">use</span><span class="crayon-h"> </span><span class="crayon-v">href</span><span class="crayon-o">=</span><span class="crayon-s">"#myCircle"</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-o">=</span><span class="crayon-s">"100"</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-o">=</span><span class="crayon-s">"0"</span><span class="crayon-h"> </span><span class="crayon-v">fill</span><span class="crayon-o">=</span><span class="crayon-s">"blue"</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5be4b3d544c22366801575-11"><span class="crayon-h">\xa0\xa0</span><span class="crayon-o">&lt;</span><span class="crayon-st">use</span><span class="crayon-h"> </span><span class="crayon-v">href</span><span class="crayon-o">=</span><span class="crayon-s">"#myCircle"</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-o">=</span><span class="crayon-s">"200"</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-o">=</span><span class="crayon-s">"0"</span><span class="crayon-h"> </span><span class="crayon-v">fill</span><span class="crayon-o">=</span><span class="crayon-s">"white"</span><span class="crayon-h"> </span><span class="crayon-v">stroke</span><span class="crayon-o">=</span><span class="crayon-s">"blue"</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544c22366801575-12"><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">svg</span><span class="crayon-o">&gt;</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0028 seconds] -->&#13;\n<p/>\n<h3>2.13 <code>&lt;pattern&gt;</code>标签</h3>\n<p><code>&lt;pattern&gt;</code>标签用于自定义一个形状，该形状可以被引用来平铺一个区域。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4b3d544c25658219807" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div><span class="crayon-language">JavaScript</span></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\n&lt;svg width="500" height="500"&gt;&#13;\n  &lt;defs&gt;&#13;\n    &lt;pattern id="dots" x="0" y="0" width="100" height="100" patternUnits="userSpaceOnUse"&gt;&#13;\n      &lt;circle fill="#bee9e8" cx="50" cy="50" r="35" /&gt;&#13;\n    &lt;/pattern&gt;&#13;\n  &lt;/defs&gt;&#13;\n  &lt;rect x="0" y="0" width="100%" height="100%" fill="url(#dots)" /&gt;&#13;\n&lt;/svg&gt;</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4b3d544c25658219807-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544c25658219807-2">2</div><div class="crayon-num" data-line="crayon-5be4b3d544c25658219807-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544c25658219807-4">4</div><div class="crayon-num" data-line="crayon-5be4b3d544c25658219807-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544c25658219807-6">6</div><div class="crayon-num" data-line="crayon-5be4b3d544c25658219807-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544c25658219807-8">8</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4b3d544c25658219807-1"><span class="crayon-o">&lt;</span><span class="crayon-e">svg </span><span class="crayon-e ">width</span><span class="crayon-o">=</span><span class="crayon-s">"500"</span><span class="crayon-h"> </span><span class="crayon-e ">height</span><span class="crayon-o">=</span><span class="crayon-s">"500"</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544c25658219807-2"><span class="crayon-h">\xa0\xa0</span><span class="crayon-o">&lt;</span><span class="crayon-v">defs</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5be4b3d544c25658219807-3"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-o">&lt;</span><span class="crayon-e">pattern </span><span class="crayon-e ">id</span><span class="crayon-o">=</span><span class="crayon-s">"dots"</span><span class="crayon-h"> </span><span class="crayon-e ">x</span><span class="crayon-o">=</span><span class="crayon-s">"0"</span><span class="crayon-h"> </span><span class="crayon-e ">y</span><span class="crayon-o">=</span><span class="crayon-s">"0"</span><span class="crayon-h"> </span><span class="crayon-e ">width</span><span class="crayon-o">=</span><span class="crayon-s">"100"</span><span class="crayon-h"> </span><span class="crayon-e ">height</span><span class="crayon-o">=</span><span class="crayon-s">"100"</span><span class="crayon-h"> </span><span class="crayon-e ">patternUnits</span><span class="crayon-o">=</span><span class="crayon-s">"userSpaceOnUse"</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544c25658219807-4"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-o">&lt;</span><span class="crayon-e">circle </span><span class="crayon-e ">fill</span><span class="crayon-o">=</span><span class="crayon-s">"#bee9e8"</span><span class="crayon-h"> </span><span class="crayon-e ">cx</span><span class="crayon-o">=</span><span class="crayon-s">"50"</span><span class="crayon-h"> </span><span class="crayon-e ">cy</span><span class="crayon-o">=</span><span class="crayon-s">"50"</span><span class="crayon-h"> </span><span class="crayon-e ">r</span><span class="crayon-o">=</span><span class="crayon-s">"35"</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5be4b3d544c25658219807-5"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">pattern</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544c25658219807-6"><span class="crayon-h">\xa0\xa0</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">defs</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5be4b3d544c25658219807-7"><span class="crayon-h">\xa0\xa0</span><span class="crayon-o">&lt;</span><span class="crayon-i">rect</span><span class="crayon-h"> </span><span class="crayon-e ">x</span><span class="crayon-o">=</span><span class="crayon-s">"0"</span><span class="crayon-h"> </span><span class="crayon-e ">y</span><span class="crayon-o">=</span><span class="crayon-s">"0"</span><span class="crayon-h"> </span><span class="crayon-e ">width</span><span class="crayon-o">=</span><span class="crayon-s">"100%"</span><span class="crayon-h"> </span><span class="crayon-e ">height</span><span class="crayon-o">=</span><span class="crayon-s">"100%"</span><span class="crayon-h"> </span><span class="crayon-e ">fill</span><span class="crayon-o">=</span><span class="crayon-s">"url(#dots)"</span><span class="crayon-h"> </span><span class="crayon-c ">/&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544c25658219807-8"><span class="crayon-c ">&lt;/s</span><span class="crayon-v">vg</span><span class="crayon-o">&gt;</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0023 seconds] -->&#13;\n<p>上面代码中，<code>&lt;pattern&gt;</code>标签将一个圆形定义为<code>dots</code>模式。<code>patternUnits="userSpaceOnUse"</code>表示<code>&lt;pattern&gt;</code>的宽度和长度是实际的像素值。然后，指定这个模式去填充下面的矩形。</p>\n<h3>2.14 <code>&lt;image&gt;</code>标签</h3>\n<p><code>&lt;image&gt;</code>标签用于插入图片文件。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4b3d544c29373158066" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\n&lt;svg viewBox="0 0 100 100" width="100" height="100"&gt;&#13;\n  &lt;image xlink:href="path/to/image.jpg"&#13;\n    width="50%" height="50%"/&gt;&#13;\n&lt;/svg&gt;</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4b3d544c29373158066-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544c29373158066-2">2</div><div class="crayon-num" data-line="crayon-5be4b3d544c29373158066-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544c29373158066-4">4</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4b3d544c29373158066-1"><span class="crayon-o">&lt;</span><span class="crayon-e">svg </span><span class="crayon-v">viewBox</span><span class="crayon-o">=</span><span class="crayon-s">"0 0 100 100"</span><span class="crayon-h"> </span><span class="crayon-v">width</span><span class="crayon-o">=</span><span class="crayon-s">"100"</span><span class="crayon-h"> </span><span class="crayon-v">height</span><span class="crayon-o">=</span><span class="crayon-s">"100"</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544c29373158066-2"><span class="crayon-h">\xa0\xa0</span><span class="crayon-o">&lt;</span><span class="crayon-e">image </span><span class="crayon-v">xlink</span><span class="crayon-o">:</span><span class="crayon-v">href</span><span class="crayon-o">=</span><span class="crayon-s">"path/to/image.jpg"</span></div><div class="crayon-line" id="crayon-5be4b3d544c29373158066-3"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-v">width</span><span class="crayon-o">=</span><span class="crayon-s">"50%"</span><span class="crayon-h"> </span><span class="crayon-v">height</span><span class="crayon-o">=</span><span class="crayon-s">"50%"</span><span class="crayon-o">/</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544c29373158066-4"><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">svg</span><span class="crayon-o">&gt;</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0010 seconds] -->&#13;\n<p>上面代码中，<code>&lt;image&gt;</code>的<code>xlink:href</code>属性表示图像的来源。</p>\n<h3>2.15 <code>&lt;animate&gt;</code>标签</h3>\n<p><code>&lt;animate&gt;</code>标签用于产生动画效果。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4b3d544c2c224160887" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\n&lt;svg width="500px" height="500px"&gt;&#13;\n  &lt;rect x="0" y="0" width="100" height="100" fill="#feac5e"&gt;&#13;\n    &lt;animate attributeName="x" from="0" to="500" dur="2s" repeatCount="indefinite" /&gt;&#13;\n  &lt;/rect&gt;&#13;\n&lt;/svg&gt;</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4b3d544c2c224160887-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544c2c224160887-2">2</div><div class="crayon-num" data-line="crayon-5be4b3d544c2c224160887-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544c2c224160887-4">4</div><div class="crayon-num" data-line="crayon-5be4b3d544c2c224160887-5">5</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4b3d544c2c224160887-1"><span class="crayon-o">&lt;</span><span class="crayon-e">svg </span><span class="crayon-v">width</span><span class="crayon-o">=</span><span class="crayon-s">"500px"</span><span class="crayon-h"> </span><span class="crayon-v">height</span><span class="crayon-o">=</span><span class="crayon-s">"500px"</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544c2c224160887-2"><span class="crayon-h">\xa0\xa0</span><span class="crayon-o">&lt;</span><span class="crayon-i">rect</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-o">=</span><span class="crayon-s">"0"</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-o">=</span><span class="crayon-s">"0"</span><span class="crayon-h"> </span><span class="crayon-v">width</span><span class="crayon-o">=</span><span class="crayon-s">"100"</span><span class="crayon-h"> </span><span class="crayon-v">height</span><span class="crayon-o">=</span><span class="crayon-s">"100"</span><span class="crayon-h"> </span><span class="crayon-v">fill</span><span class="crayon-o">=</span><span class="crayon-s">"#feac5e"</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5be4b3d544c2c224160887-3"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-o">&lt;</span><span class="crayon-e">animate </span><span class="crayon-v">attributeName</span><span class="crayon-o">=</span><span class="crayon-s">"x"</span><span class="crayon-h"> </span><span class="crayon-v">from</span><span class="crayon-o">=</span><span class="crayon-s">"0"</span><span class="crayon-h"> </span><span class="crayon-st">to</span><span class="crayon-o">=</span><span class="crayon-s">"500"</span><span class="crayon-h"> </span><span class="crayon-v">dur</span><span class="crayon-o">=</span><span class="crayon-s">"2s"</span><span class="crayon-h"> </span><span class="crayon-v">repeatCount</span><span class="crayon-o">=</span><span class="crayon-s">"indefinite"</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544c2c224160887-4"><span class="crayon-h">\xa0\xa0</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">rect</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5be4b3d544c2c224160887-5"><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">svg</span><span class="crayon-o">&gt;</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0016 seconds] -->&#13;\n<p>上面代码中，矩形会不断移动，产生动画效果。</p>\n<p><code>&lt;animate&gt;</code>的属性含义如下。</p>\n<ul>\n<li>attributeName：发生动画效果的属性名。</li>\n<li>from：单次动画的初始值。</li>\n<li>to：单次动画的结束值。</li>\n<li>dur：单次动画的持续时间。</li>\n<li>repeatCount：动画的循环模式。</li>\n</ul>\n<p>可以在多个属性上面定义动画。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4b3d544c2f716520233" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\n&lt;animate attributeName="x" from="0" to="500" dur="2s" repeatCount="indefinite" /&gt;&#13;\n&lt;animate attributeName="width" to="500" dur="2s" repeatCount="indefinite" /&gt;</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4b3d544c2f716520233-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544c2f716520233-2">2</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4b3d544c2f716520233-1"><span class="crayon-o">&lt;</span><span class="crayon-e">animate </span><span class="crayon-v">attributeName</span><span class="crayon-o">=</span><span class="crayon-s">"x"</span><span class="crayon-h"> </span><span class="crayon-v">from</span><span class="crayon-o">=</span><span class="crayon-s">"0"</span><span class="crayon-h"> </span><span class="crayon-st">to</span><span class="crayon-o">=</span><span class="crayon-s">"500"</span><span class="crayon-h"> </span><span class="crayon-v">dur</span><span class="crayon-o">=</span><span class="crayon-s">"2s"</span><span class="crayon-h"> </span><span class="crayon-v">repeatCount</span><span class="crayon-o">=</span><span class="crayon-s">"indefinite"</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544c2f716520233-2"><span class="crayon-o">&lt;</span><span class="crayon-e">animate </span><span class="crayon-v">attributeName</span><span class="crayon-o">=</span><span class="crayon-s">"width"</span><span class="crayon-h"> </span><span class="crayon-st">to</span><span class="crayon-o">=</span><span class="crayon-s">"500"</span><span class="crayon-h"> </span><span class="crayon-v">dur</span><span class="crayon-o">=</span><span class="crayon-s">"2s"</span><span class="crayon-h"> </span><span class="crayon-v">repeatCount</span><span class="crayon-o">=</span><span class="crayon-s">"indefinite"</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-o">&gt;</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0011 seconds] -->&#13;\n<p/>\n<h3>2.16 <code>&lt;animateTransform&gt;</code>标签</h3>\n<p><code>&lt;animate&gt;</code>标签对 CSS 的<code>transform</code>属性不起作用，如果需要变形，就要使用<code>&lt;animateTransform&gt;</code>标签。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4b3d544c32392096577" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\n&lt;svg width="500px" height="500px"&gt;&#13;\n  &lt;rect x="250" y="250" width="50" height="50" fill="#4bc0c8"&gt;&#13;\n    &lt;animateTransform attributeName="transform" type="rotate" begin="0s" dur="10s" from="0 200 200" to="360 400 400" repeatCount="indefinite" /&gt;&#13;\n  &lt;/rect&gt;&#13;\n&lt;/svg&gt;</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4b3d544c32392096577-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544c32392096577-2">2</div><div class="crayon-num" data-line="crayon-5be4b3d544c32392096577-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544c32392096577-4">4</div><div class="crayon-num" data-line="crayon-5be4b3d544c32392096577-5">5</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4b3d544c32392096577-1"><span class="crayon-o">&lt;</span><span class="crayon-e">svg </span><span class="crayon-v">width</span><span class="crayon-o">=</span><span class="crayon-s">"500px"</span><span class="crayon-h"> </span><span class="crayon-v">height</span><span class="crayon-o">=</span><span class="crayon-s">"500px"</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544c32392096577-2"><span class="crayon-h">\xa0\xa0</span><span class="crayon-o">&lt;</span><span class="crayon-i">rect</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-o">=</span><span class="crayon-s">"250"</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-o">=</span><span class="crayon-s">"250"</span><span class="crayon-h"> </span><span class="crayon-v">width</span><span class="crayon-o">=</span><span class="crayon-s">"50"</span><span class="crayon-h"> </span><span class="crayon-v">height</span><span class="crayon-o">=</span><span class="crayon-s">"50"</span><span class="crayon-h"> </span><span class="crayon-v">fill</span><span class="crayon-o">=</span><span class="crayon-s">"#4bc0c8"</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5be4b3d544c32392096577-3"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-o">&lt;</span><span class="crayon-e">animateTransform </span><span class="crayon-v">attributeName</span><span class="crayon-o">=</span><span class="crayon-s">"transform"</span><span class="crayon-h"> </span><span class="crayon-v">type</span><span class="crayon-o">=</span><span class="crayon-s">"rotate"</span><span class="crayon-h"> </span><span class="crayon-v">begin</span><span class="crayon-o">=</span><span class="crayon-s">"0s"</span><span class="crayon-h"> </span><span class="crayon-v">dur</span><span class="crayon-o">=</span><span class="crayon-s">"10s"</span><span class="crayon-h"> </span><span class="crayon-v">from</span><span class="crayon-o">=</span><span class="crayon-s">"0 200 200"</span><span class="crayon-h"> </span><span class="crayon-st">to</span><span class="crayon-o">=</span><span class="crayon-s">"360 400 400"</span><span class="crayon-h"> </span><span class="crayon-v">repeatCount</span><span class="crayon-o">=</span><span class="crayon-s">"indefinite"</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544c32392096577-4"><span class="crayon-h">\xa0\xa0</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">rect</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5be4b3d544c32392096577-5"><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">svg</span><span class="crayon-o">&gt;</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0017 seconds] -->&#13;\n<p>上面代码中，<code>&lt;animateTransform&gt;</code>的效果为旋转（<code>rotate</code>），这时<code>from</code>和<code>to</code>属性值有三个数字，第一个数字是角度值，第二个值和第三个值是旋转中心的坐标。<code>from="0 200 200"</code>表示开始时，角度为0，围绕<code>(200, 200)</code>开始旋转；<code>to="360 400 400"</code>表示结束时，角度为360，围绕<code>(400, 400)</code>旋转。</p>\n<h2>三、JavaScript 操作</h2>\n<h3>3.1 DOM 操作</h3>\n<p>如果 SVG 代码直接写在 HTML 网页之中，它就成为网页 DOM 的一部分，可以直接用 DOM 操作。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4b3d544c36782322442" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\n&lt;svg&#13;\n  id="mysvg"&#13;\n  xmlns="http://www.w3.org/2000/svg"&#13;\n  viewBox="0 0 800 600"&#13;\n  preserveAspectRatio="xMidYMid meet"&#13;\n&gt;&#13;\n  &lt;circle id="mycircle" cx="400" cy="300" r="50" /&gt;&#13;\n&lt;svg&gt;</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4b3d544c36782322442-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544c36782322442-2">2</div><div class="crayon-num" data-line="crayon-5be4b3d544c36782322442-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544c36782322442-4">4</div><div class="crayon-num" data-line="crayon-5be4b3d544c36782322442-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544c36782322442-6">6</div><div class="crayon-num" data-line="crayon-5be4b3d544c36782322442-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544c36782322442-8">8</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4b3d544c36782322442-1"><span class="crayon-o">&lt;</span><span class="crayon-e">svg</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544c36782322442-2"><span class="crayon-e">\xa0\xa0</span><span class="crayon-v">id</span><span class="crayon-o">=</span><span class="crayon-s">"mysvg"</span></div><div class="crayon-line" id="crayon-5be4b3d544c36782322442-3"><span class="crayon-h">\xa0\xa0</span><span class="crayon-v">xmlns</span><span class="crayon-o">=</span><span class="crayon-s">"http://www.w3.org/2000/svg"</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544c36782322442-4"><span class="crayon-h">\xa0\xa0</span><span class="crayon-v">viewBox</span><span class="crayon-o">=</span><span class="crayon-s">"0 0 800 600"</span></div><div class="crayon-line" id="crayon-5be4b3d544c36782322442-5"><span class="crayon-h">\xa0\xa0</span><span class="crayon-v">preserveAspectRatio</span><span class="crayon-o">=</span><span class="crayon-s">"xMidYMid meet"</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544c36782322442-6"><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5be4b3d544c36782322442-7"><span class="crayon-h">\xa0\xa0</span><span class="crayon-o">&lt;</span><span class="crayon-e">circle </span><span class="crayon-v">id</span><span class="crayon-o">=</span><span class="crayon-s">"mycircle"</span><span class="crayon-h"> </span><span class="crayon-v">cx</span><span class="crayon-o">=</span><span class="crayon-s">"400"</span><span class="crayon-h"> </span><span class="crayon-v">cy</span><span class="crayon-o">=</span><span class="crayon-s">"300"</span><span class="crayon-h"> </span><span class="crayon-v">r</span><span class="crayon-o">=</span><span class="crayon-s">"50"</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544c36782322442-8"><span class="crayon-o">&lt;</span><span class="crayon-v">svg</span><span class="crayon-o">&gt;</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0011 seconds] -->&#13;\n<p>上面代码插入网页之后，就可以用 CSS 定制样式。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4b3d544c39982824014" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div><span class="crayon-language">CSS</span></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\ncircle {&#13;\n  stroke-width: 5;&#13;\n  stroke: #f00;&#13;\n  fill: #ff0;&#13;\n}&#13;\n&#13;\ncircle:hover {&#13;\n  stroke: #090;&#13;\n  fill: #fff;&#13;\n}</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4b3d544c39982824014-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544c39982824014-2">2</div><div class="crayon-num" data-line="crayon-5be4b3d544c39982824014-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544c39982824014-4">4</div><div class="crayon-num" data-line="crayon-5be4b3d544c39982824014-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544c39982824014-6">6</div><div class="crayon-num" data-line="crayon-5be4b3d544c39982824014-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544c39982824014-8">8</div><div class="crayon-num" data-line="crayon-5be4b3d544c39982824014-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544c39982824014-10">10</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4b3d544c39982824014-1"><span class="crayon-k ">circle </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544c39982824014-2"><span class="crayon-h">\xa0\xa0</span><span class="crayon-e ">stroke-width</span><span class="crayon-sy">:</span><span class="crayon-h"> </span><span class="crayon-i ">5</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5be4b3d544c39982824014-3"><span class="crayon-h">\xa0\xa0</span><span class="crayon-e ">stroke</span><span class="crayon-sy">:</span><span class="crayon-h"> </span><span class="crayon-i ">#f00</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544c39982824014-4"><span class="crayon-h">\xa0\xa0</span><span class="crayon-e ">fill</span><span class="crayon-sy">:</span><span class="crayon-h"> </span><span class="crayon-i ">#ff0</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5be4b3d544c39982824014-5"><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544c39982824014-6">\xa0</div><div class="crayon-line" id="crayon-5be4b3d544c39982824014-7"><span class="crayon-k ">circle:hover </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544c39982824014-8"><span class="crayon-h">\xa0\xa0</span><span class="crayon-e ">stroke</span><span class="crayon-sy">:</span><span class="crayon-h"> </span><span class="crayon-i ">#090</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5be4b3d544c39982824014-9"><span class="crayon-h">\xa0\xa0</span><span class="crayon-e ">fill</span><span class="crayon-sy">:</span><span class="crayon-h"> </span><span class="crayon-i ">#fff</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544c39982824014-10"><span class="crayon-sy">}</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0009 seconds] -->&#13;\n<p>然后，可以用 JavaScript 代码操作 SVG。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4b3d544c3c824412135" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\nvar mycircle = document.getElementById(\'mycircle\');&#13;\n&#13;\nmycircle.addEventListener(\'click\', function(e) {&#13;\n  console.log(\'circle clicked - enlarging\');&#13;\n  mycircle.setAttribute(\'r\', 60);&#13;\n}, false);</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4b3d544c3c824412135-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544c3c824412135-2">2</div><div class="crayon-num" data-line="crayon-5be4b3d544c3c824412135-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544c3c824412135-4">4</div><div class="crayon-num" data-line="crayon-5be4b3d544c3c824412135-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544c3c824412135-6">6</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4b3d544c3c824412135-1"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">mycircle</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">document</span><span class="crayon-sy">.</span><span class="crayon-e">getElementById</span><span class="crayon-sy">(</span><span class="crayon-s">\'mycircle\'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544c3c824412135-2">\xa0</div><div class="crayon-line" id="crayon-5be4b3d544c3c824412135-3"><span class="crayon-v">mycircle</span><span class="crayon-sy">.</span><span class="crayon-e">addEventListener</span><span class="crayon-sy">(</span><span class="crayon-s">\'click\'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-sy">(</span><span class="crayon-v">e</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544c3c824412135-4"><span class="crayon-h">\xa0\xa0</span><span class="crayon-v">console</span><span class="crayon-sy">.</span><span class="crayon-e">log</span><span class="crayon-sy">(</span><span class="crayon-s">\'circle clicked - enlarging\'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5be4b3d544c3c824412135-5"><span class="crayon-h">\xa0\xa0</span><span class="crayon-v">mycircle</span><span class="crayon-sy">.</span><span class="crayon-e">setAttribute</span><span class="crayon-sy">(</span><span class="crayon-s">\'r\'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">60</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544c3c824412135-6"><span class="crayon-sy">}</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">false</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0013 seconds] -->&#13;\n<p>上面代码指定，如果点击图形，就改写<code>circle</code>元素的<code>r</code>属性。</p>\n<h3>3.2 获取 SVG DOM</h3>\n<p>使用<code>&lt;object&gt;</code>、<code>&lt;iframe&gt;</code>、<code>&lt;embed&gt;</code>标签插入 SVG 文件，可以获取 SVG DOM。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4b3d544c3f673026687" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\nvar svgObject = document.getElementById(\'object\').contentDocument;&#13;\nvar svgIframe = document.getElementById(\'iframe\').contentDocument;&#13;\nvar svgEmbed = document.getElementById(\'embed\').getSVGDocument();</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4b3d544c3f673026687-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544c3f673026687-2">2</div><div class="crayon-num" data-line="crayon-5be4b3d544c3f673026687-3">3</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4b3d544c3f673026687-1"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">svgObject</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">document</span><span class="crayon-sy">.</span><span class="crayon-e">getElementById</span><span class="crayon-sy">(</span><span class="crayon-s">\'object\'</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-v">contentDocument</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544c3f673026687-2"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">svgIframe</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">document</span><span class="crayon-sy">.</span><span class="crayon-e">getElementById</span><span class="crayon-sy">(</span><span class="crayon-s">\'iframe\'</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-v">contentDocument</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5be4b3d544c3f673026687-3"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">svgEmbed</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">document</span><span class="crayon-sy">.</span><span class="crayon-e">getElementById</span><span class="crayon-sy">(</span><span class="crayon-s">\'embed\'</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">getSVGDocument</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0012 seconds] -->&#13;\n<p>注意，如果使用<code>&lt;img&gt;</code>标签插入 SVG 文件，就无法获取 SVG DOM。</p>\n<h3>3.3 读取 SVG 源码</h3>\n<p>由于 SVG 文件就是一段 XML 文本，因此可以通过读取 XML 代码的方式，读取 SVG 源码。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4b3d544c43906704755" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\n&lt;div id="svg-container"&gt;&#13;\n  &lt;svg&#13;\n    xmlns="http://www.w3.org/2000/svg"&#13;\n    xmlns:xlink="http://www.w3.org/1999/xlink"&#13;\n    xml:space="preserve" width="500" height="440"&#13;\n  &gt;&#13;\n    &lt;!-- svg code --&gt;&#13;\n  &lt;/svg&gt;&#13;\n&lt;/div&gt;</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4b3d544c43906704755-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544c43906704755-2">2</div><div class="crayon-num" data-line="crayon-5be4b3d544c43906704755-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544c43906704755-4">4</div><div class="crayon-num" data-line="crayon-5be4b3d544c43906704755-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544c43906704755-6">6</div><div class="crayon-num" data-line="crayon-5be4b3d544c43906704755-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544c43906704755-8">8</div><div class="crayon-num" data-line="crayon-5be4b3d544c43906704755-9">9</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4b3d544c43906704755-1"><span class="crayon-o">&lt;</span><span class="crayon-e">div </span><span class="crayon-v">id</span><span class="crayon-o">=</span><span class="crayon-s">"svg-container"</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544c43906704755-2"><span class="crayon-h">\xa0\xa0</span><span class="crayon-o">&lt;</span><span class="crayon-e">svg</span></div><div class="crayon-line" id="crayon-5be4b3d544c43906704755-3"><span class="crayon-e">\xa0\xa0\xa0\xa0</span><span class="crayon-v">xmlns</span><span class="crayon-o">=</span><span class="crayon-s">"http://www.w3.org/2000/svg"</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544c43906704755-4"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-v">xmlns</span><span class="crayon-o">:</span><span class="crayon-v">xlink</span><span class="crayon-o">=</span><span class="crayon-s">"http://www.w3.org/1999/xlink"</span></div><div class="crayon-line" id="crayon-5be4b3d544c43906704755-5"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-v">xml</span><span class="crayon-o">:</span><span class="crayon-v">space</span><span class="crayon-o">=</span><span class="crayon-s">"preserve"</span><span class="crayon-h"> </span><span class="crayon-v">width</span><span class="crayon-o">=</span><span class="crayon-s">"500"</span><span class="crayon-h"> </span><span class="crayon-v">height</span><span class="crayon-o">=</span><span class="crayon-s">"440"</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544c43906704755-6"><span class="crayon-h">\xa0\xa0</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5be4b3d544c43906704755-7"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-o">&lt;</span><span class="crayon-o">!</span><span class="crayon-o">--</span><span class="crayon-h"> </span><span class="crayon-e">svg </span><span class="crayon-v">code</span><span class="crayon-h"> </span><span class="crayon-o">--</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544c43906704755-8"><span class="crayon-h">\xa0\xa0</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">svg</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5be4b3d544c43906704755-9"><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">div</span><span class="crayon-o">&gt;</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0013 seconds] -->&#13;\n<p>使用<code>XMLSerializer</code>实例的<code>serializeToString()</code>方法，获取 SVG 元素的代码。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4b3d544c46611588295" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\nvar svgString = new XMLSerializer()&#13;\n  .serializeToString(document.querySelector(\'svg\'));</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4b3d544c46611588295-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544c46611588295-2">2</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4b3d544c46611588295-1"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">svgString</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">XMLSerializer</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544c46611588295-2"><span class="crayon-h">\xa0\xa0</span><span class="crayon-sy">.</span><span class="crayon-e">serializeToString</span><span class="crayon-sy">(</span><span class="crayon-v">document</span><span class="crayon-sy">.</span><span class="crayon-e">querySelector</span><span class="crayon-sy">(</span><span class="crayon-s">\'svg\'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0008 seconds] -->&#13;\n<p/>\n<h3>3.4 SVG 图像转为 Canvas 图像</h3>\n<p>首先，需要新建一个<code>Image</code>对象，将 SVG 图像指定到该<code>Image</code>对象的<code>src</code>属性。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4b3d544c49956589468" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div><span class="crayon-language">JavaScript</span></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\nvar img = new Image();&#13;\nvar svg = new Blob([svgString], {type: "image/svg+xml;charset=utf-8"});&#13;\n&#13;\nvar DOMURL = self.URL || self.webkitURL || self;&#13;\nvar url = DOMURL.createObjectURL(svg);&#13;\n&#13;\nimg.src = url;</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4b3d544c49956589468-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544c49956589468-2">2</div><div class="crayon-num" data-line="crayon-5be4b3d544c49956589468-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544c49956589468-4">4</div><div class="crayon-num" data-line="crayon-5be4b3d544c49956589468-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544c49956589468-6">6</div><div class="crayon-num" data-line="crayon-5be4b3d544c49956589468-7">7</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4b3d544c49956589468-1"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">img</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-r">Image</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544c49956589468-2"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">svg</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">Blob</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">svgString</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-v">type</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">"image/svg+xml;charset=utf-8"</span><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5be4b3d544c49956589468-3">\xa0</div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544c49956589468-4"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">DOMURL</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">URL</span><span class="crayon-h"> </span><span class="crayon-o">||</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">webkitURL</span><span class="crayon-h"> </span><span class="crayon-o">||</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5be4b3d544c49956589468-5"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">url</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">DOMURL</span><span class="crayon-sy">.</span><span class="crayon-e">createObjectURL</span><span class="crayon-sy">(</span><span class="crayon-v">svg</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544c49956589468-6">\xa0</div><div class="crayon-line" id="crayon-5be4b3d544c49956589468-7"><span class="crayon-v">img</span><span class="crayon-sy">.</span><span class="crayon-v">src</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">url</span><span class="crayon-sy">;</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0019 seconds] -->&#13;\n<p>然后，当图像加载完成后，再将它绘制到<code>&lt;canvas&gt;</code>元素。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4b3d544c4c963565537" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div><span class="crayon-language">JavaScript</span></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\nimg.onload = function () {&#13;\n  var canvas = document.getElementById(\'canvas\');&#13;\n  var ctx = canvas.getContext(\'2d\');&#13;\n  ctx.drawImage(img, 0, 0);&#13;\n};</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4b3d544c4c963565537-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544c4c963565537-2">2</div><div class="crayon-num" data-line="crayon-5be4b3d544c4c963565537-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544c4c963565537-4">4</div><div class="crayon-num" data-line="crayon-5be4b3d544c4c963565537-5">5</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4b3d544c4c963565537-1"><span class="crayon-v">img</span><span class="crayon-sy">.</span><span class="crayon-v">onload</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544c4c963565537-2"><span class="crayon-h">\xa0\xa0</span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">canvas</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">document</span><span class="crayon-sy">.</span><span class="crayon-e">getElementById</span><span class="crayon-sy">(</span><span class="crayon-s">\'canvas\'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5be4b3d544c4c963565537-3"><span class="crayon-h">\xa0\xa0</span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">ctx</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">canvas</span><span class="crayon-sy">.</span><span class="crayon-e">getContext</span><span class="crayon-sy">(</span><span class="crayon-s">\'2d\'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544c4c963565537-4"><span class="crayon-h">\xa0\xa0</span><span class="crayon-v">ctx</span><span class="crayon-sy">.</span><span class="crayon-e">drawImage</span><span class="crayon-sy">(</span><span class="crayon-v">img</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5be4b3d544c4c963565537-5"><span class="crayon-sy">}</span><span class="crayon-sy">;</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0015 seconds] -->&#13;\n<p/>\n<h2>四、实例：折线图</h2>\n<p>下面将一张数据表格画成折线图。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4b3d544c4f851528001" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\nDate |Amount&#13;\n-----|------&#13;\n2014-01-01 | $10&#13;\n2014-02-01 | $20&#13;\n2014-03-01 | $40&#13;\n2014-04-01 | $80</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4b3d544c4f851528001-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544c4f851528001-2">2</div><div class="crayon-num" data-line="crayon-5be4b3d544c4f851528001-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544c4f851528001-4">4</div><div class="crayon-num" data-line="crayon-5be4b3d544c4f851528001-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544c4f851528001-6">6</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4b3d544c4f851528001-1"><span class="crayon-v">Date</span><span class="crayon-h"> </span><span class="crayon-o">|</span><span class="crayon-v">Amount</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544c4f851528001-2"><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">-</span><span class="crayon-o">|</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span></div><div class="crayon-line" id="crayon-5be4b3d544c4f851528001-3"><span class="crayon-cn">2014</span><span class="crayon-o">-</span><span class="crayon-cn">01</span><span class="crayon-o">-</span><span class="crayon-cn">01</span><span class="crayon-h"> </span><span class="crayon-o">|</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-cn">10</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544c4f851528001-4"><span class="crayon-cn">2014</span><span class="crayon-o">-</span><span class="crayon-cn">02</span><span class="crayon-o">-</span><span class="crayon-cn">01</span><span class="crayon-h"> </span><span class="crayon-o">|</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-cn">20</span></div><div class="crayon-line" id="crayon-5be4b3d544c4f851528001-5"><span class="crayon-cn">2014</span><span class="crayon-o">-</span><span class="crayon-cn">03</span><span class="crayon-o">-</span><span class="crayon-cn">01</span><span class="crayon-h"> </span><span class="crayon-o">|</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-cn">40</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544c4f851528001-6"><span class="crayon-cn">2014</span><span class="crayon-o">-</span><span class="crayon-cn">04</span><span class="crayon-o">-</span><span class="crayon-cn">01</span><span class="crayon-h"> </span><span class="crayon-o">|</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-cn">80</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0013 seconds] -->&#13;\n<p>上面的图形，可以画成一个坐标系，<code>Date</code>作为横轴，<code>Amount</code>作为纵轴，四行数据画成一个数据点。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4b3d544c52884811653" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\n&lt;svg width="350" height="160"&gt;&#13;\n  &lt;g class="layer" transform="translate(60,10)"&gt;&#13;\n    &lt;circle r="5" cx="0"   cy="105" /&gt;&#13;\n    &lt;circle r="5" cx="90"  cy="90"  /&gt;&#13;\n    &lt;circle r="5" cx="180" cy="60"  /&gt;&#13;\n    &lt;circle r="5" cx="270" cy="0"   /&gt;&#13;\n&#13;\n    &lt;g class="y axis"&gt;&#13;\n      &lt;line x1="0" y1="0" x2="0" y2="120" /&gt;&#13;\n      &lt;text x="-40" y="105" dy="5"&gt;$10&lt;/text&gt;&#13;\n      &lt;text x="-40" y="0"   dy="5"&gt;$80&lt;/text&gt;&#13;\n    &lt;/g&gt;&#13;\n    &lt;g class="x axis" transform="translate(0, 120)"&gt;&#13;\n      &lt;line x1="0" y1="0" x2="270" y2="0" /&gt;&#13;\n      &lt;text x="-30"   y="20"&gt;January 2014&lt;/text&gt;&#13;\n      &lt;text x="240" y="20"&gt;April&lt;/text&gt;&#13;\n    &lt;/g&gt;&#13;\n  &lt;/g&gt;&#13;\n&lt;/svg&gt;</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4b3d544c52884811653-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544c52884811653-2">2</div><div class="crayon-num" data-line="crayon-5be4b3d544c52884811653-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544c52884811653-4">4</div><div class="crayon-num" data-line="crayon-5be4b3d544c52884811653-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544c52884811653-6">6</div><div class="crayon-num" data-line="crayon-5be4b3d544c52884811653-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544c52884811653-8">8</div><div class="crayon-num" data-line="crayon-5be4b3d544c52884811653-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544c52884811653-10">10</div><div class="crayon-num" data-line="crayon-5be4b3d544c52884811653-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544c52884811653-12">12</div><div class="crayon-num" data-line="crayon-5be4b3d544c52884811653-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544c52884811653-14">14</div><div class="crayon-num" data-line="crayon-5be4b3d544c52884811653-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544c52884811653-16">16</div><div class="crayon-num" data-line="crayon-5be4b3d544c52884811653-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b3d544c52884811653-18">18</div><div class="crayon-num" data-line="crayon-5be4b3d544c52884811653-19">19</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4b3d544c52884811653-1"><span class="crayon-o">&lt;</span><span class="crayon-e">svg </span><span class="crayon-v">width</span><span class="crayon-o">=</span><span class="crayon-s">"350"</span><span class="crayon-h"> </span><span class="crayon-v">height</span><span class="crayon-o">=</span><span class="crayon-s">"160"</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544c52884811653-2"><span class="crayon-h">\xa0\xa0</span><span class="crayon-o">&lt;</span><span class="crayon-i">g</span><span class="crayon-h"> </span><span class="crayon-t">class</span><span class="crayon-o">=</span><span class="crayon-s">"layer"</span><span class="crayon-h"> </span><span class="crayon-v">transform</span><span class="crayon-o">=</span><span class="crayon-s">"translate(60,10)"</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5be4b3d544c52884811653-3"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-o">&lt;</span><span class="crayon-i">circle</span><span class="crayon-h"> </span><span class="crayon-v">r</span><span class="crayon-o">=</span><span class="crayon-s">"5"</span><span class="crayon-h"> </span><span class="crayon-v">cx</span><span class="crayon-o">=</span><span class="crayon-s">"0"</span><span class="crayon-h">\xa0\xa0 </span><span class="crayon-v">cy</span><span class="crayon-o">=</span><span class="crayon-s">"105"</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544c52884811653-4"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-o">&lt;</span><span class="crayon-i">circle</span><span class="crayon-h"> </span><span class="crayon-v">r</span><span class="crayon-o">=</span><span class="crayon-s">"5"</span><span class="crayon-h"> </span><span class="crayon-v">cx</span><span class="crayon-o">=</span><span class="crayon-s">"90"</span><span class="crayon-h">\xa0\xa0</span><span class="crayon-v">cy</span><span class="crayon-o">=</span><span class="crayon-s">"90"</span><span class="crayon-h">\xa0\xa0</span><span class="crayon-o">/</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5be4b3d544c52884811653-5"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-o">&lt;</span><span class="crayon-i">circle</span><span class="crayon-h"> </span><span class="crayon-v">r</span><span class="crayon-o">=</span><span class="crayon-s">"5"</span><span class="crayon-h"> </span><span class="crayon-v">cx</span><span class="crayon-o">=</span><span class="crayon-s">"180"</span><span class="crayon-h"> </span><span class="crayon-v">cy</span><span class="crayon-o">=</span><span class="crayon-s">"60"</span><span class="crayon-h">\xa0\xa0</span><span class="crayon-o">/</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544c52884811653-6"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-o">&lt;</span><span class="crayon-i">circle</span><span class="crayon-h"> </span><span class="crayon-v">r</span><span class="crayon-o">=</span><span class="crayon-s">"5"</span><span class="crayon-h"> </span><span class="crayon-v">cx</span><span class="crayon-o">=</span><span class="crayon-s">"270"</span><span class="crayon-h"> </span><span class="crayon-v">cy</span><span class="crayon-o">=</span><span class="crayon-s">"0"</span><span class="crayon-h">\xa0\xa0 </span><span class="crayon-o">/</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5be4b3d544c52884811653-7">\xa0</div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544c52884811653-8"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-o">&lt;</span><span class="crayon-i">g</span><span class="crayon-h"> </span><span class="crayon-t">class</span><span class="crayon-o">=</span><span class="crayon-s">"y axis"</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5be4b3d544c52884811653-9"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-o">&lt;</span><span class="crayon-e">line </span><span class="crayon-v">x1</span><span class="crayon-o">=</span><span class="crayon-s">"0"</span><span class="crayon-h"> </span><span class="crayon-v">y1</span><span class="crayon-o">=</span><span class="crayon-s">"0"</span><span class="crayon-h"> </span><span class="crayon-v">x2</span><span class="crayon-o">=</span><span class="crayon-s">"0"</span><span class="crayon-h"> </span><span class="crayon-v">y2</span><span class="crayon-o">=</span><span class="crayon-s">"120"</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544c52884811653-10"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-o">&lt;</span><span class="crayon-i">text</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-o">=</span><span class="crayon-s">"-40"</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-o">=</span><span class="crayon-s">"105"</span><span class="crayon-h"> </span><span class="crayon-v">dy</span><span class="crayon-o">=</span><span class="crayon-s">"5"</span><span class="crayon-o">&gt;</span><span class="crayon-sy">$</span><span class="crayon-cn">10</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">text</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5be4b3d544c52884811653-11"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-o">&lt;</span><span class="crayon-i">text</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-o">=</span><span class="crayon-s">"-40"</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-o">=</span><span class="crayon-s">"0"</span><span class="crayon-h">\xa0\xa0 </span><span class="crayon-v">dy</span><span class="crayon-o">=</span><span class="crayon-s">"5"</span><span class="crayon-o">&gt;</span><span class="crayon-sy">$</span><span class="crayon-cn">80</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">text</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544c52884811653-12"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">g</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5be4b3d544c52884811653-13"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-o">&lt;</span><span class="crayon-i">g</span><span class="crayon-h"> </span><span class="crayon-t">class</span><span class="crayon-o">=</span><span class="crayon-s">"x axis"</span><span class="crayon-h"> </span><span class="crayon-v">transform</span><span class="crayon-o">=</span><span class="crayon-s">"translate(0, 120)"</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544c52884811653-14"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-o">&lt;</span><span class="crayon-e">line </span><span class="crayon-v">x1</span><span class="crayon-o">=</span><span class="crayon-s">"0"</span><span class="crayon-h"> </span><span class="crayon-v">y1</span><span class="crayon-o">=</span><span class="crayon-s">"0"</span><span class="crayon-h"> </span><span class="crayon-v">x2</span><span class="crayon-o">=</span><span class="crayon-s">"270"</span><span class="crayon-h"> </span><span class="crayon-v">y2</span><span class="crayon-o">=</span><span class="crayon-s">"0"</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5be4b3d544c52884811653-15"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-o">&lt;</span><span class="crayon-i">text</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-o">=</span><span class="crayon-s">"-30"</span><span class="crayon-h">\xa0\xa0 </span><span class="crayon-v">y</span><span class="crayon-o">=</span><span class="crayon-s">"20"</span><span class="crayon-o">&gt;</span><span class="crayon-i">January</span><span class="crayon-h"> </span><span class="crayon-cn">2014</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">text</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544c52884811653-16"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-o">&lt;</span><span class="crayon-i">text</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-o">=</span><span class="crayon-s">"240"</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-o">=</span><span class="crayon-s">"20"</span><span class="crayon-o">&gt;</span><span class="crayon-v">April</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">text</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5be4b3d544c52884811653-17"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">g</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b3d544c52884811653-18"><span class="crayon-h">\xa0\xa0</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">g</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5be4b3d544c52884811653-19"><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">svg</span><span class="crayon-o">&gt;</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0054 seconds] -->&#13;\n<p/>\n<h2>五、参考链接</h2>\n<ul>\n<li>Jon McPartland, <a href="http://bigbitecreative.com/introduction-svg-animation/" target="_blank">An introduction to SVG animation</a></li>\n<li>Alexander Goedde, <a href="http://tavendo.com/blog/post/super-vector-graphics/" target="_blank">SVG – Super Vector Graphics</a></li>\n<li>Joseph Wegner, <a href="http://flippinawesome.org/2014/02/03/learning-svg/" target="_blank">Learning SVG</a></li>\n<li>biovisualize, <a href="http://bl.ocks.org/biovisualize/8187844" target="_blank">Direct svg to canvas to png conversion</a></li>\n<li>Tyler Sticka, <a href="https://cloudfour.com/thinks/cropping-image-thumbnails-with-svg/" target="_blank">Cropping Image Thumbnails with SVG</a></li>\n<li>Adi Purdila, <a href="https://webdesign.tutsplus.com/tutorials/how-to-create-a-loader-icon-with-svg-animations--cms-31542" target="_blank">How to Create a Loader Icon With SVG Animations</a></li>\n</ul>\n<p>（完）</p>\n&#13;\n        <script language="javascript"> &#13;\nvar randomNum = Math.round(Math.random()*1);&#13;\nvar innerHTML=new Array(2);&#13;\ninnerHTML[0]="如果有人让你推荐前端技术书，请让他看这个列表 -&gt;《&lt;a target=\'_blank\' href=\'http://web.jobbole.com/86734/\'&gt;经典前端技术书籍&lt;/a&gt;》";&#13;\ninnerHTML[1]="如果有人让你推荐前端技术书，请让他看这个列表 -&gt;《&lt;a target=\'_blank\' href=\'http://web.jobbole.com/86734/\'&gt;经典前端技术书籍&lt;/a&gt;》";&#13;\nvar widgetHTML="&lt;div id=\'single-page-inner-widget\'&gt;"+innerHTML[randomNum]+"&lt;/div&gt;";&#13;\ndocument.write(widgetHTML);&#13;\n</script>&#13;\n        &#13;\n        \n     \n\n\n\n&#13;\n        <!-- BEGIN #author-bio -->&#13;\n&#13;\n&#13;\n<!-- END #author-bio -->&#13;');
insert into news_article_basic(article_id, user_id, channel_id, title, cover, status)values(3, 1, 1, '基于 HTML5 Canvas 的交互式地铁线路图', '{"type":0, "images":[]}', 2);
insert into news_article_content(article_id, content) values(3,'<div>\n<p>\xa0前言</p>\n<p>前两天在 echarts 上寻找灵感的时候，看到了很多有关地图类似的例子，地图定位等等，但是好像就是没有地铁线路图，就自己花了一些时间捣鼓出来了这个交互式地铁线路图的 Demo，地铁线路上的点是在网上随便下载了一个，这篇文章记录自己的一些收获（毕竟我还是个菜鸟）以及代码的实现，希望能够帮到一些朋友。当然，如果有什么意见的可以直接跟我说，大家一起交流才会进步。</p>\n<h4>效果图</h4>\n<p><img src="http://wx1.sinaimg.cn/mw690/63918611gy1fpiyf8c5blj21f10qr48s.jpg"/></p>\n<p><a href="http://www.hightopo.com/demo/subway/index.html" target="_blank" rel="nofollow">http://www.hightopo.com/demo/subway/index.html</a></p>\n<p>地图稍微内容有点多，要全部展示，字显得有点小了，但是没关系，可以按照需求放大缩小，字体和绘制的内容并不会失真，毕竟都是用矢量绘制的~</p>\n<h4>界面生成</h4>\n<p>底层的 div 是通过 ht.graph.GraphView 组件生成的，然后就可以利用 HT for Web 提供好的方法，调用 canvas 画笔随便绘制就好，先来看看怎么生成底层 div：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4b301a5520154904505" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\nvar dm = new ht.DataModel();//数据容器&#13;\nvar gv = new ht.graph.GraphView(dm);//拓扑组件&#13;\ngv.addToDOM();//将拓扑图组件添加进body中</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4b301a5520154904505-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a5520154904505-2">2</div><div class="crayon-num" data-line="crayon-5be4b301a5520154904505-3">3</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4b301a5520154904505-1"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">dm</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-v">ht</span><span class="crayon-sy">.</span><span class="crayon-e">DataModel</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-c">//数据容器</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a5520154904505-2"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">gv</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-v">ht</span><span class="crayon-sy">.</span><span class="crayon-v">graph</span><span class="crayon-sy">.</span><span class="crayon-e">GraphView</span><span class="crayon-sy">(</span><span class="crayon-v">dm</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-c">//拓扑组件</span></div><div class="crayon-line" id="crayon-5be4b301a5520154904505-3"><span class="crayon-v">gv</span><span class="crayon-sy">.</span><span class="crayon-e">addToDOM</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-c">//将拓扑图组件添加进body中</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0026 seconds] -->&#13;\n<p>addToDOM 函数声明如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4b301a5528736988142" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\naddToDOM = function(){   &#13;\n    var self = this,&#13;\n        view = self.getView(),   &#13;\n        style = view.style;&#13;\n    document.body.appendChild(view); //将组件底层div添加到body中           &#13;\n    style.left = \'0\';//默认组件是绝对定位，所以要设置位置&#13;\n    style.right = \'0\';&#13;\n    style.top = \'0\';&#13;\n    style.bottom = \'0\';      &#13;\n    window.addEventListener(\'resize\', function () { self.iv(); }, false); //窗口变化事件           &#13;\n}</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4b301a5528736988142-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a5528736988142-2">2</div><div class="crayon-num" data-line="crayon-5be4b301a5528736988142-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a5528736988142-4">4</div><div class="crayon-num" data-line="crayon-5be4b301a5528736988142-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a5528736988142-6">6</div><div class="crayon-num" data-line="crayon-5be4b301a5528736988142-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a5528736988142-8">8</div><div class="crayon-num" data-line="crayon-5be4b301a5528736988142-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a5528736988142-10">10</div><div class="crayon-num" data-line="crayon-5be4b301a5528736988142-11">11</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4b301a5528736988142-1"><span class="crayon-v">addToDOM</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">{</span><span class="crayon-h">\xa0\xa0 </span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a5528736988142-2"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">this</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5be4b301a5528736988142-3"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-v">view</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">getView</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h">\xa0\xa0 </span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a5528736988142-4"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-v">style</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">view</span><span class="crayon-sy">.</span><span class="crayon-v">style</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5be4b301a5528736988142-5"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-v">document</span><span class="crayon-sy">.</span><span class="crayon-v">body</span><span class="crayon-sy">.</span><span class="crayon-e">appendChild</span><span class="crayon-sy">(</span><span class="crayon-v">view</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">//将组件底层div添加到body中\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0 </span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a5528736988142-6"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-v">style</span><span class="crayon-sy">.</span><span class="crayon-v">left</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">\'0\'</span><span class="crayon-sy">;</span><span class="crayon-c">//默认组件是绝对定位，所以要设置位置</span></div><div class="crayon-line" id="crayon-5be4b301a5528736988142-7"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-v">style</span><span class="crayon-sy">.</span><span class="crayon-v">right</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">\'0\'</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a5528736988142-8"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-v">style</span><span class="crayon-sy">.</span><span class="crayon-v">top</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">\'0\'</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5be4b301a5528736988142-9"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-v">style</span><span class="crayon-sy">.</span><span class="crayon-v">bottom</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">\'0\'</span><span class="crayon-sy">;</span><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a5528736988142-10"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-v">window</span><span class="crayon-sy">.</span><span class="crayon-e">addEventListener</span><span class="crayon-sy">(</span><span class="crayon-s">\'resize\'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">iv</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-sy">}</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">false</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">//窗口变化事件\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0 </span></div><div class="crayon-line" id="crayon-5be4b301a5528736988142-11"><span class="crayon-sy">}</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0025 seconds] -->&#13;\n<p>现在我就可以在这个 div 上乱涂乱画了~首先我获取下载好的地铁线路图上的点，我将它们放在 subway.js 中，这个 js 文件全部都是下载的内容，我没有做其他的改动，主要是将这些点根据线路来分分配添加到数组中，比如：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4b301a552c517626562" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\nmark_Point13 = [];//线路 数组内包含线路的起点和终点坐标以及这条线路的名称&#13;\nt_Point13 = [];//换成站点 数组内包含线路中的换乘站点坐标以及换成站点名称&#13;\nn_Point13 = [];//小站点 数组内包含线路中的小站点坐标以及小站点名称&#13;\nmark_Point13.push({ name: \'十三号线\', value: [113.4973,23.1095]}); &#13;\nmark_Point13.push({ name: \'十三号线\', value: [113.4155,23.1080]}); &#13;\nt_Point13.push({ name: \'鱼珠\', value: [113.41548,23.10547]}); &#13;\nn_Point13.push({ name: \'裕丰围\', value: [113.41548,23.10004]});</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4b301a552c517626562-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a552c517626562-2">2</div><div class="crayon-num" data-line="crayon-5be4b301a552c517626562-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a552c517626562-4">4</div><div class="crayon-num" data-line="crayon-5be4b301a552c517626562-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a552c517626562-6">6</div><div class="crayon-num" data-line="crayon-5be4b301a552c517626562-7">7</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4b301a552c517626562-1"><span class="crayon-v">mark_Point13</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span><span class="crayon-c">//线路 数组内包含线路的起点和终点坐标以及这条线路的名称</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a552c517626562-2"><span class="crayon-v">t_Point13</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span><span class="crayon-c">//换成站点 数组内包含线路中的换乘站点坐标以及换成站点名称</span></div><div class="crayon-line" id="crayon-5be4b301a552c517626562-3"><span class="crayon-v">n_Point13</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span><span class="crayon-c">//小站点 数组内包含线路中的小站点坐标以及小站点名称</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a552c517626562-4"><span class="crayon-v">mark_Point13</span><span class="crayon-sy">.</span><span class="crayon-e">push</span><span class="crayon-sy">(</span><span class="crayon-sy">{</span><span class="crayon-h"> </span><span class="crayon-v">name</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">\'十三号线\'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">value</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">113.4973</span><span class="crayon-sy">,</span><span class="crayon-cn">23.1095</span><span class="crayon-sy">]</span><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-5be4b301a552c517626562-5"><span class="crayon-v">mark_Point13</span><span class="crayon-sy">.</span><span class="crayon-e">push</span><span class="crayon-sy">(</span><span class="crayon-sy">{</span><span class="crayon-h"> </span><span class="crayon-v">name</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">\'十三号线\'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">value</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">113.4155</span><span class="crayon-sy">,</span><span class="crayon-cn">23.1080</span><span class="crayon-sy">]</span><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a552c517626562-6"><span class="crayon-v">t_Point13</span><span class="crayon-sy">.</span><span class="crayon-e">push</span><span class="crayon-sy">(</span><span class="crayon-sy">{</span><span class="crayon-h"> </span><span class="crayon-v">name</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">\'鱼珠\'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">value</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">113.41548</span><span class="crayon-sy">,</span><span class="crayon-cn">23.10547</span><span class="crayon-sy">]</span><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-5be4b301a552c517626562-7"><span class="crayon-v">n_Point13</span><span class="crayon-sy">.</span><span class="crayon-e">push</span><span class="crayon-sy">(</span><span class="crayon-sy">{</span><span class="crayon-h"> </span><span class="crayon-v">name</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">\'裕丰围\'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">value</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">113.41548</span><span class="crayon-sy">,</span><span class="crayon-cn">23.10004</span><span class="crayon-sy">]</span><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0025 seconds] -->&#13;\n<p>接下来来描绘地铁线路，我声明了一个数组 lineNum，用来装 js 中所有的地铁线路的编号，以及一个 color 数组，用来装所有的地铁线的颜色，这些颜色的 index 与 lineNum 中地铁线编号的 index 是一一对应的：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4b301a5531676212283" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\nvar lineNum = [\'1\', \'2\', \'3\', \'30\', \'4\', \'5\', \'6\', \'7\', \'8\', \'9\', \'13\', \'14\', \'32\', \'18\', \'21\', \'22\', \'60\', \'68\'];&#13;\nvar color = [\'#f1cd44\', \'#0060a1\', \'#ed9b4f\', \'#ed9b4f\', \'#007e3a\', \'#cb0447\', \'#7a1a57\', \'#18472c\', \'#008193\', \'#83c39e\', \'#8a8c29\', \'#82352b\', \'#82352b\', \'#09a1e0\', \'#8a8c29\', \'#82352b\', \'#b6d300\', \'#09a1e0\'];</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4b301a5531676212283-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a5531676212283-2">2</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4b301a5531676212283-1"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">lineNum</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-s">\'1\'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">\'2\'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">\'3\'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">\'30\'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">\'4\'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">\'5\'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">\'6\'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">\'7\'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">\'8\'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">\'9\'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">\'13\'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">\'14\'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">\'32\'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">\'18\'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">\'21\'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">\'22\'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">\'60\'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">\'68\'</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a5531676212283-2"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">color</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-s">\'#f1cd44\'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">\'#0060a1\'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">\'#ed9b4f\'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">\'#ed9b4f\'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">\'#007e3a\'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">\'#cb0447\'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">\'#7a1a57\'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">\'#18472c\'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">\'#008193\'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">\'#83c39e\'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">\'#8a8c29\'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">\'#82352b\'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">\'#82352b\'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">\'#09a1e0\'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">\'#8a8c29\'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">\'#82352b\'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">\'#b6d300\'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">\'#09a1e0\'</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0023 seconds] -->&#13;\n<p>接着遍历 lineNum，将 lineNum 中的元素和颜色传到 createLine 函数中，根据这两个参数来绘制地铁线路以及配色，毕竟 js 文件中的命名方式也是有规律的，哪一条线路，则命名后面一定会加上对应的数字，所以我们只需要将字符串与这个编号结合即可获得 js 中对应的数组了：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4b301a5534534007223" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\nlet lineName = \'Line\' + num;&#13;\nlet line = window[lineName];</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4b301a5534534007223-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a5534534007223-2">2</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4b301a5534534007223-1"><span class="crayon-e">let </span><span class="crayon-v">lineName</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">\'Line\'</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">num</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a5534534007223-2"><span class="crayon-e">let </span><span class="crayon-v">line</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">window</span><span class="crayon-sy">[</span><span class="crayon-v">lineName</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0007 seconds] -->&#13;\n<p>createLine 的定义也非常简单，我的代码设置了不少的样式，所以看起来有点多。创建一个 ht.Polyline 管线，我们可以通过 polyline.addPoint() 函数向这个变量中添加具体的点，通过 setSegments 可以设置点的连接方式。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4b301a5538782167728" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\nfunction createLine(num, color) {//绘制地图线&#13;\n    var polyline = new ht.Polyline();//多边形 管线&#13;\n    polyline.setTag(num);//设置节点tag标签，作为唯一标示&#13;\n    &#13;\n    if(num === \'68\') polyline.setToolTip(\'A P M\');//设置提示信息 &#13;\n    else if(num === \'60\') polyline.setToolTip(\'G F\'); &#13;\n    else polyline.setToolTip(\'Line\' + num);&#13;\n&#13;\n    if(color) {&#13;\n        polyline.s({//s 为 setStyle 的简写，设置样式&#13;\n            \'shape.border.width\': 0.4,//设置多边形的边框宽度&#13;\n            \'shape.border.color\': color,//设置多边形的边框颜色&#13;\n            \'select.width\': 0.2,//设置选中节点的边框宽度&#13;\n            \'select.color\': color//设置选中节点的边框颜色&#13;\n        });&#13;\n    }&#13;\n&#13;\n    let lineName = \'Line\' + num;&#13;\n    let line = window[lineName];&#13;\n    for(let i = 0; i &lt; line.length; i++) {&#13;\n        for(let j = 0; j &lt; line[i].coords.length; j++) {&#13;\n            polyline.addPoint({x: line[i].coords[j][0]*300, y: -line[i].coords[j][1]*300});&#13;\n            if(num === \'68\'){//APM线（有两条，但是点是在同一个数组中的）&#13;\n                if(i === 0 &amp;&amp; j === 0) {&#13;\n                    polyline.setSegments([1]);&#13;\n                }&#13;\n                else if(i === 1 &amp;&amp; j === 0) {&#13;\n                    polyline.getSegments().push(1);&#13;\n                }&#13;\n                else {&#13;\n                    polyline.getSegments().push(2);&#13;\n                }&#13;\n            }    &#13;\n        }&#13;\n    }&#13;\n&#13;\n    polyline.setLayer(\'0\');//将线设置在下层，点设置在上层“top”&#13;\n    dm.add(polyline);//将管线添加进数据容器中储存，不然这个管线属于“游离”状态，是不会显示在拓扑图上的&#13;\n    return polyline;&#13;\n}</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4b301a5538782167728-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a5538782167728-2">2</div><div class="crayon-num" data-line="crayon-5be4b301a5538782167728-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a5538782167728-4">4</div><div class="crayon-num" data-line="crayon-5be4b301a5538782167728-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a5538782167728-6">6</div><div class="crayon-num" data-line="crayon-5be4b301a5538782167728-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a5538782167728-8">8</div><div class="crayon-num" data-line="crayon-5be4b301a5538782167728-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a5538782167728-10">10</div><div class="crayon-num" data-line="crayon-5be4b301a5538782167728-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a5538782167728-12">12</div><div class="crayon-num" data-line="crayon-5be4b301a5538782167728-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a5538782167728-14">14</div><div class="crayon-num" data-line="crayon-5be4b301a5538782167728-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a5538782167728-16">16</div><div class="crayon-num" data-line="crayon-5be4b301a5538782167728-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a5538782167728-18">18</div><div class="crayon-num" data-line="crayon-5be4b301a5538782167728-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a5538782167728-20">20</div><div class="crayon-num" data-line="crayon-5be4b301a5538782167728-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a5538782167728-22">22</div><div class="crayon-num" data-line="crayon-5be4b301a5538782167728-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a5538782167728-24">24</div><div class="crayon-num" data-line="crayon-5be4b301a5538782167728-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a5538782167728-26">26</div><div class="crayon-num" data-line="crayon-5be4b301a5538782167728-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a5538782167728-28">28</div><div class="crayon-num" data-line="crayon-5be4b301a5538782167728-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a5538782167728-30">30</div><div class="crayon-num" data-line="crayon-5be4b301a5538782167728-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a5538782167728-32">32</div><div class="crayon-num" data-line="crayon-5be4b301a5538782167728-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a5538782167728-34">34</div><div class="crayon-num" data-line="crayon-5be4b301a5538782167728-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a5538782167728-36">36</div><div class="crayon-num" data-line="crayon-5be4b301a5538782167728-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a5538782167728-38">38</div><div class="crayon-num" data-line="crayon-5be4b301a5538782167728-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a5538782167728-40">40</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4b301a5538782167728-1"><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-e">createLine</span><span class="crayon-sy">(</span><span class="crayon-v">num</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">color</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-c">//绘制地图线</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a5538782167728-2"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">polyline</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-v">ht</span><span class="crayon-sy">.</span><span class="crayon-e">Polyline</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-c">//多边形 管线</span></div><div class="crayon-line" id="crayon-5be4b301a5538782167728-3"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-v">polyline</span><span class="crayon-sy">.</span><span class="crayon-e">setTag</span><span class="crayon-sy">(</span><span class="crayon-v">num</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-c">//设置节点tag标签，作为唯一标示</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a5538782167728-4"><span class="crayon-h">\xa0\xa0\xa0\xa0</span></div><div class="crayon-line" id="crayon-5be4b301a5538782167728-5"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-v">num</span><span class="crayon-h"> </span><span class="crayon-o">===</span><span class="crayon-h"> </span><span class="crayon-s">\'68\'</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-v">polyline</span><span class="crayon-sy">.</span><span class="crayon-e">setToolTip</span><span class="crayon-sy">(</span><span class="crayon-s">\'A P M\'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-c">//设置提示信息 </span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a5538782167728-6"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-v">num</span><span class="crayon-h"> </span><span class="crayon-o">===</span><span class="crayon-h"> </span><span class="crayon-s">\'60\'</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-v">polyline</span><span class="crayon-sy">.</span><span class="crayon-e">setToolTip</span><span class="crayon-sy">(</span><span class="crayon-s">\'G F\'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-5be4b301a5538782167728-7"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-v">polyline</span><span class="crayon-sy">.</span><span class="crayon-e">setToolTip</span><span class="crayon-sy">(</span><span class="crayon-s">\'Line\'</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">num</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a5538782167728-8">\xa0</div><div class="crayon-line" id="crayon-5be4b301a5538782167728-9"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-v">color</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a5538782167728-10"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-v">polyline</span><span class="crayon-sy">.</span><span class="crayon-e">s</span><span class="crayon-sy">(</span><span class="crayon-sy">{</span><span class="crayon-c">//s 为 setStyle 的简写，设置样式</span></div><div class="crayon-line" id="crayon-5be4b301a5538782167728-11"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-s">\'shape.border.width\'</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">0.4</span><span class="crayon-sy">,</span><span class="crayon-c">//设置多边形的边框宽度</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a5538782167728-12"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-s">\'shape.border.color\'</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">color</span><span class="crayon-sy">,</span><span class="crayon-c">//设置多边形的边框颜色</span></div><div class="crayon-line" id="crayon-5be4b301a5538782167728-13"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-s">\'select.width\'</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">0.2</span><span class="crayon-sy">,</span><span class="crayon-c">//设置选中节点的边框宽度</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a5538782167728-14"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-s">\'select.color\'</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">color</span><span class="crayon-c">//设置选中节点的边框颜色</span></div><div class="crayon-line" id="crayon-5be4b301a5538782167728-15"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a5538782167728-16"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5be4b301a5538782167728-17">\xa0</div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a5538782167728-18"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-e">let </span><span class="crayon-v">lineName</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">\'Line\'</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">num</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5be4b301a5538782167728-19"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-e">let </span><span class="crayon-v">line</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">window</span><span class="crayon-sy">[</span><span class="crayon-v">lineName</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a5538782167728-20"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-st">for</span><span class="crayon-sy">(</span><span class="crayon-i">let</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-h"> </span><span class="crayon-v">line</span><span class="crayon-sy">.</span><span class="crayon-v">length</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-o">++</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5be4b301a5538782167728-21"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-st">for</span><span class="crayon-sy">(</span><span class="crayon-i">let</span><span class="crayon-h"> </span><span class="crayon-v">j</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-v">j</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-h"> </span><span class="crayon-v">line</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-v">coords</span><span class="crayon-sy">.</span><span class="crayon-v">length</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-v">j</span><span class="crayon-o">++</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a5538782167728-22"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-v">polyline</span><span class="crayon-sy">.</span><span class="crayon-e">addPoint</span><span class="crayon-sy">(</span><span class="crayon-sy">{</span><span class="crayon-v">x</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">line</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-v">coords</span><span class="crayon-sy">[</span><span class="crayon-v">j</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-o">*</span><span class="crayon-cn">300</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-v">line</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-v">coords</span><span class="crayon-sy">[</span><span class="crayon-v">j</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-o">*</span><span class="crayon-cn">300</span><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5be4b301a5538782167728-23"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-v">num</span><span class="crayon-h"> </span><span class="crayon-o">===</span><span class="crayon-h"> </span><span class="crayon-s">\'68\'</span><span class="crayon-sy">)</span><span class="crayon-sy">{</span><span class="crayon-c">//APM线（有两条，但是点是在同一个数组中的）</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a5538782167728-24"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">===</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-o">&amp;&amp;</span><span class="crayon-h"> </span><span class="crayon-v">j</span><span class="crayon-h"> </span><span class="crayon-o">===</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5be4b301a5538782167728-25"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-v">polyline</span><span class="crayon-sy">.</span><span class="crayon-e">setSegments</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a5538782167728-26"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5be4b301a5538782167728-27"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">===</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-o">&amp;&amp;</span><span class="crayon-h"> </span><span class="crayon-v">j</span><span class="crayon-h"> </span><span class="crayon-o">===</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a5538782167728-28"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-v">polyline</span><span class="crayon-sy">.</span><span class="crayon-e">getSegments</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">push</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5be4b301a5538782167728-29"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a5538782167728-30"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5be4b301a5538782167728-31"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-v">polyline</span><span class="crayon-sy">.</span><span class="crayon-e">getSegments</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">push</span><span class="crayon-sy">(</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a5538782167728-32"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5be4b301a5538782167728-33"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-sy">}</span><span class="crayon-h">\xa0\xa0\xa0\xa0</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a5538782167728-34"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5be4b301a5538782167728-35"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a5538782167728-36">\xa0</div><div class="crayon-line" id="crayon-5be4b301a5538782167728-37"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-v">polyline</span><span class="crayon-sy">.</span><span class="crayon-e">setLayer</span><span class="crayon-sy">(</span><span class="crayon-s">\'0\'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-c">//将线设置在下层，点设置在上层“top”</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a5538782167728-38"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-v">dm</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-v">polyline</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-c">//将管线添加进数据容器中储存，不然这个管线属于“游离”状态，是不会显示在拓扑图上的</span></div><div class="crayon-line" id="crayon-5be4b301a5538782167728-39"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">polyline</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a5538782167728-40"><span class="crayon-sy">}</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0075 seconds] -->&#13;\n<p>上面代码中添加地铁线上的点有分为几种情况，是因为 js 中设置线的时候 Line68 有一个“跳跃”点的现象，所以我们必须“跳跃”过去，篇幅有限 Line68 数组具体的声明自行看 subway.js。</p>\n<p>这里说明一点，如果用的是 addPoint 函数，不设置 segments 时，默认将添加进的点用直线连接，segments 的定义如下：</p>\n<ul>\n<li>1： moveTo，占用 1 个点信息，代表一个新路径的起点</li>\n<li>2： lineTo，占用 1 个点信息，代表从上次最后点连接到该点</li>\n<li>3： quadraticCurveTo，占用 2 个点信息，第一个点作为曲线控制点，第二个点作为曲线结束点</li>\n<li>4： bezierCurveTo，占用 3 个点信息，第一和第二个点作为曲线控制点，第三个点作为曲线结束点</li>\n<li>5： closePath，不占用点信息，代表本次路径绘制结束，并闭合到路径的起始点</li>\n</ul>\n<p>所以我们要做“跳跃”的行为设置 segments 为 1 即可。</p>\n<p>最后绘制这些地铁线上的点，这个部分 subway.js 中也分离出来了，命名以“mark_Point”、“t_Point”以及“n_Point”开头，我在前面 js 的展示部分有对这些数组进行解释，大家动动中指划上去看看。</p>\n<p>我们在这些点的位置添加 ht.Node 节点，当节点一添加进 dm 数据容器中时，就会在拓扑图上显示，当然，前提是这个拓扑图组件 gv 设置的数据容器是这个 dm。篇幅有限，添加地铁线上的点的代码部分我只展示添加“换乘站点”的点：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4b301a553d906524056" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\nvar tName = \'t_Point\' + num;&#13;\nvar tP = window[tName];//大站点&#13;\nif(tP) {//有些线路没有“换乘站点”&#13;\n    for(let i = 0; i &lt; tP.length; i++) {&#13;\n        let node = createNode(tP[i].name, tP[i].value, color[index]);//在获取的线路上的点的坐标位置添加节点&#13;\n        node.s({//设置节点的样式style&#13;\n            \'label.scale\': 0.05,//文本缩放，可以避免浏览器限制的最小字号问题&#13;\n            \'label.font\': \'bold 12px arial, sans-serif\'//设置文本的font&#13;\n        });&#13;\n        node.setSize(0.6, 0.6);//设置节点大小。由于js中每个点之间的偏移量太小，所以我不得不把节点设置小一些&#13;\n        node.setImage(\'images/旋转箭头.json\');//设置节点的图片&#13;\n        node.a(\'alarmColor1\', \'rgb(150, 150, 150)\');//attr属性，可以在这里面设置任何的东西，alarmColor1是在上面设置的image的json中绑定的属性，具体参看 HT for Web 矢量手册(http://www.hightopo.com/guide/guide/core/vector/ht-vector-guide.html#ref_binding)&#13;\n        node.a(\'alarmColor2\', \'rgb(150, 150, 150)\');//同上&#13;\n        node.a(\'tpNode\', true);//这个属性设置只是为了用来区分“换乘站点”和“小站点”的，后面会用上&#13;\n    }&#13;\n}</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4b301a553d906524056-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a553d906524056-2">2</div><div class="crayon-num" data-line="crayon-5be4b301a553d906524056-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a553d906524056-4">4</div><div class="crayon-num" data-line="crayon-5be4b301a553d906524056-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a553d906524056-6">6</div><div class="crayon-num" data-line="crayon-5be4b301a553d906524056-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a553d906524056-8">8</div><div class="crayon-num" data-line="crayon-5be4b301a553d906524056-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a553d906524056-10">10</div><div class="crayon-num" data-line="crayon-5be4b301a553d906524056-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a553d906524056-12">12</div><div class="crayon-num" data-line="crayon-5be4b301a553d906524056-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a553d906524056-14">14</div><div class="crayon-num" data-line="crayon-5be4b301a553d906524056-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a553d906524056-16">16</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4b301a553d906524056-1"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">tName</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">\'t_Point\'</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">num</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a553d906524056-2"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">tP</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">window</span><span class="crayon-sy">[</span><span class="crayon-v">tName</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span><span class="crayon-c">//大站点</span></div><div class="crayon-line" id="crayon-5be4b301a553d906524056-3"><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-v">tP</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-c">//有些线路没有“换乘站点”</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a553d906524056-4"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-st">for</span><span class="crayon-sy">(</span><span class="crayon-i">let</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-h"> </span><span class="crayon-v">tP</span><span class="crayon-sy">.</span><span class="crayon-v">length</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-o">++</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5be4b301a553d906524056-5"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-e">let </span><span class="crayon-v">node</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">createNode</span><span class="crayon-sy">(</span><span class="crayon-v">tP</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">tP</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-v">value</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">color</span><span class="crayon-sy">[</span><span class="crayon-v">index</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-c">//在获取的线路上的点的坐标位置添加节点</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a553d906524056-6"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-v">node</span><span class="crayon-sy">.</span><span class="crayon-e">s</span><span class="crayon-sy">(</span><span class="crayon-sy">{</span><span class="crayon-c">//设置节点的样式style</span></div><div class="crayon-line" id="crayon-5be4b301a553d906524056-7"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-s">\'label.scale\'</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">0.05</span><span class="crayon-sy">,</span><span class="crayon-c">//文本缩放，可以避免浏览器限制的最小字号问题</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a553d906524056-8"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-s">\'label.font\'</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">\'bold 12px arial, sans-serif\'</span><span class="crayon-c">//设置文本的font</span></div><div class="crayon-line" id="crayon-5be4b301a553d906524056-9"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a553d906524056-10"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-v">node</span><span class="crayon-sy">.</span><span class="crayon-e">setSize</span><span class="crayon-sy">(</span><span class="crayon-cn">0.6</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0.6</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-c">//设置节点大小。由于js中每个点之间的偏移量太小，所以我不得不把节点设置小一些</span></div><div class="crayon-line" id="crayon-5be4b301a553d906524056-11"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-v">node</span><span class="crayon-sy">.</span><span class="crayon-e">setImage</span><span class="crayon-sy">(</span><span class="crayon-s">\'images/旋转箭头.json\'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-c">//设置节点的图片</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a553d906524056-12"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-v">node</span><span class="crayon-sy">.</span><span class="crayon-e">a</span><span class="crayon-sy">(</span><span class="crayon-s">\'alarmColor1\'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">\'rgb(150, 150, 150)\'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-c">//attr属性，可以在这里面设置任何的东西，alarmColor1是在上面设置的image的json中绑定的属性，具体参看 HT for Web 矢量手册(http://www.hightopo.com/guide/guide/core/vector/ht-vector-guide.html#ref_binding)</span></div><div class="crayon-line" id="crayon-5be4b301a553d906524056-13"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-v">node</span><span class="crayon-sy">.</span><span class="crayon-e">a</span><span class="crayon-sy">(</span><span class="crayon-s">\'alarmColor2\'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">\'rgb(150, 150, 150)\'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-c">//同上</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a553d906524056-14"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-v">node</span><span class="crayon-sy">.</span><span class="crayon-e">a</span><span class="crayon-sy">(</span><span class="crayon-s">\'tpNode\'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">true</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-c">//这个属性设置只是为了用来区分“换乘站点”和“小站点”的，后面会用上</span></div><div class="crayon-line" id="crayon-5be4b301a553d906524056-15"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a553d906524056-16"><span class="crayon-sy">}</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0062 seconds] -->&#13;\n<p>所有的地铁线路以及站点都添加完毕。但是！你可能会看不见自己绘制的图，因为他们太小了，这个时候可以设置 graphView 拓扑组件上的 fitContent 函数，我们顺便将拓扑图上的所有东西不可移动也设置一下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4b301a5542067092289" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\ngv.fitContent(false, 0.00001);//自适应大小，参数1为是否动画，参数2为gv与边框的padding值&#13;\ngv.setMovableFunc(function(){&#13;\n    return false;//设置gv上的节点不可移动&#13;\n});</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4b301a5542067092289-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a5542067092289-2">2</div><div class="crayon-num" data-line="crayon-5be4b301a5542067092289-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a5542067092289-4">4</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4b301a5542067092289-1"><span class="crayon-v">gv</span><span class="crayon-sy">.</span><span class="crayon-e">fitContent</span><span class="crayon-sy">(</span><span class="crayon-t">false</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0.00001</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-c">//自适应大小，参数1为是否动画，参数2为gv与边框的padding值</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a5542067092289-2"><span class="crayon-v">gv</span><span class="crayon-sy">.</span><span class="crayon-e">setMovableFunc</span><span class="crayon-sy">(</span><span class="crayon-t">function</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5be4b301a5542067092289-3"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">false</span><span class="crayon-sy">;</span><span class="crayon-c">//设置gv上的节点不可移动</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a5542067092289-4"><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0009 seconds] -->&#13;\n<p>这下你的地铁线路图就可以显示啦~接下来看看交互。</p>\n<h4>交互</h4>\n<p>首先是鼠标移动事件，鼠标滑过具体线路时，线路会变粗，悬停一会儿还能看到这条线路的编号；当鼠标移动到“换乘站点”或“小站点”，站点对应的图标都会变大并且变色，字体也会变大，鼠标移开图标变回原来的颜色并且字体变小。不同点在于鼠标移动到“换乘站点”时，“换乘站点”会旋转。</p>\n<p><img src="http://wx1.sinaimg.cn/mw690/63918611gy1fpiygg2fu9g20gx0dp1ky.gif"/></p>\n<p>鼠标滑动事件，我直接基于 gv 的底层 div 进行的 mousemove 事件，通过 ht 封装的 getDataAt 函数传入事件 event 参数，获取事件下对应的节点，然后就可以随意操作节点了：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4b301a5546851307103" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\ngv.getView().addEventListener(\'mousemove\', function(e) {&#13;\n    var data = gv.getDataAt(e);//传入逻辑坐标点或者交互event事件参数，返回当前点下的图元&#13;\n    if(name) {&#13;\n        originNode(name);//不管什么时候都要让节点保持原来的大小&#13;\n    }&#13;\n&#13;\n    if (data instanceof ht.Polyline) {//判断事件节点的类型&#13;\n        dm.sm().ss(data);//选中“管道”&#13;\n        name = \'\';&#13;\n        clearInterval(interval);&#13;\n    }&#13;\n    else if (data instanceof ht.Node) {&#13;\n        if(data.getTag() !== name &amp;&amp; data.a(\'tpNode\')) {//若不是同一个节点，并且mousemove的事件对象为ht.Node类型，那么设置节点的旋转&#13;\n            interval = setInterval(function() {&#13;\n                data.setRotation(data.getRotation() - Math.PI/16); //在自身旋转的基础上再旋转&#13;\n            }, 100);&#13;\n        }&#13;\n        if(data.a(\'npNode\')) {//如果鼠标移到“小站点”也要停止动画&#13;\n            clearInterval(interval);&#13;\n        }&#13;\n        expandNode(data, name);////自定义的放大节点函数，比较容易，我不粘代码了，可以去http://hightopo.com/   查看&#13;\n        dm.sm().ss(data);//设置选中节点&#13;\n        name = data.getTag();//作为“上一个节点”的存储变量，可以通过这个值来获取节点&#13;\n    }&#13;\n    else {//其他任何情况则不选中任何内容并且清除“换乘站点”上的动画&#13;\n        dm.sm().ss(null);&#13;\n        name = \'\';&#13;\n        clearInterval(interval);&#13;\n    }&#13;\n});</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4b301a5546851307103-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a5546851307103-2">2</div><div class="crayon-num" data-line="crayon-5be4b301a5546851307103-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a5546851307103-4">4</div><div class="crayon-num" data-line="crayon-5be4b301a5546851307103-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a5546851307103-6">6</div><div class="crayon-num" data-line="crayon-5be4b301a5546851307103-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a5546851307103-8">8</div><div class="crayon-num" data-line="crayon-5be4b301a5546851307103-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a5546851307103-10">10</div><div class="crayon-num" data-line="crayon-5be4b301a5546851307103-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a5546851307103-12">12</div><div class="crayon-num" data-line="crayon-5be4b301a5546851307103-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a5546851307103-14">14</div><div class="crayon-num" data-line="crayon-5be4b301a5546851307103-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a5546851307103-16">16</div><div class="crayon-num" data-line="crayon-5be4b301a5546851307103-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a5546851307103-18">18</div><div class="crayon-num" data-line="crayon-5be4b301a5546851307103-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a5546851307103-20">20</div><div class="crayon-num" data-line="crayon-5be4b301a5546851307103-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a5546851307103-22">22</div><div class="crayon-num" data-line="crayon-5be4b301a5546851307103-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a5546851307103-24">24</div><div class="crayon-num" data-line="crayon-5be4b301a5546851307103-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a5546851307103-26">26</div><div class="crayon-num" data-line="crayon-5be4b301a5546851307103-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a5546851307103-28">28</div><div class="crayon-num" data-line="crayon-5be4b301a5546851307103-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a5546851307103-30">30</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4b301a5546851307103-1"><span class="crayon-v">gv</span><span class="crayon-sy">.</span><span class="crayon-e">getView</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">addEventListener</span><span class="crayon-sy">(</span><span class="crayon-s">\'mousemove\'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-sy">(</span><span class="crayon-v">e</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a5546851307103-2"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">gv</span><span class="crayon-sy">.</span><span class="crayon-e">getDataAt</span><span class="crayon-sy">(</span><span class="crayon-v">e</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-c">//传入逻辑坐标点或者交互event事件参数，返回当前点下的图元</span></div><div class="crayon-line" id="crayon-5be4b301a5546851307103-3"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-v">name</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a5546851307103-4"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-e">originNode</span><span class="crayon-sy">(</span><span class="crayon-v">name</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-c">//不管什么时候都要让节点保持原来的大小</span></div><div class="crayon-line" id="crayon-5be4b301a5546851307103-5"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a5546851307103-6">\xa0</div><div class="crayon-line" id="crayon-5be4b301a5546851307103-7"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">data </span><span class="crayon-r">instanceof</span><span class="crayon-h"> </span><span class="crayon-v">ht</span><span class="crayon-sy">.</span><span class="crayon-v">Polyline</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-c">//判断事件节点的类型</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a5546851307103-8"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-v">dm</span><span class="crayon-sy">.</span><span class="crayon-e">sm</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">ss</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-c">//选中“管道”</span></div><div class="crayon-line" id="crayon-5be4b301a5546851307103-9"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-v">name</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">\'\'</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a5546851307103-10"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-e">clearInterval</span><span class="crayon-sy">(</span><span class="crayon-v">interval</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5be4b301a5546851307103-11"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a5546851307103-12"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">data </span><span class="crayon-r">instanceof</span><span class="crayon-h"> </span><span class="crayon-v">ht</span><span class="crayon-sy">.</span><span class="crayon-v">Node</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5be4b301a5546851307103-13"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-e">getTag</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">!==</span><span class="crayon-h"> </span><span class="crayon-v">name</span><span class="crayon-h"> </span><span class="crayon-o">&amp;&amp;</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-e">a</span><span class="crayon-sy">(</span><span class="crayon-s">\'tpNode\'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-c">//若不是同一个节点，并且mousemove的事件对象为ht.Node类型，那么设置节点的旋转</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a5546851307103-14"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-v">interval</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">setInterval</span><span class="crayon-sy">(</span><span class="crayon-t">function</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5be4b301a5546851307103-15"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-e">setRotation</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-e">getRotation</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">Math</span><span class="crayon-sy">.</span><span class="crayon-v">PI</span><span class="crayon-o">/</span><span class="crayon-cn">16</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">//在自身旋转的基础上再旋转</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a5546851307103-16"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-sy">}</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5be4b301a5546851307103-17"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a5546851307103-18"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-e">a</span><span class="crayon-sy">(</span><span class="crayon-s">\'npNode\'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-c">//如果鼠标移到“小站点”也要停止动画</span></div><div class="crayon-line" id="crayon-5be4b301a5546851307103-19"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-e">clearInterval</span><span class="crayon-sy">(</span><span class="crayon-v">interval</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a5546851307103-20"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5be4b301a5546851307103-21"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-e">expandNode</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">name</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-c">////自定义的放大节点函数，比较容易，我不粘代码了，可以去http://hightopo.com/\xa0\xa0 查看</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a5546851307103-22"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-v">dm</span><span class="crayon-sy">.</span><span class="crayon-e">sm</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">ss</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-c">//设置选中节点</span></div><div class="crayon-line" id="crayon-5be4b301a5546851307103-23"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-v">name</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-e">getTag</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-c">//作为“上一个节点”的存储变量，可以通过这个值来获取节点</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a5546851307103-24"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5be4b301a5546851307103-25"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-c">//其他任何情况则不选中任何内容并且清除“换乘站点”上的动画</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a5546851307103-26"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-v">dm</span><span class="crayon-sy">.</span><span class="crayon-e">sm</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">ss</span><span class="crayon-sy">(</span><span class="crayon-t">null</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5be4b301a5546851307103-27"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-v">name</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">\'\'</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a5546851307103-28"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-e">clearInterval</span><span class="crayon-sy">(</span><span class="crayon-v">interval</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5be4b301a5546851307103-29"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a5546851307103-30"><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0054 seconds] -->&#13;\n<p>鼠标悬停在地铁线路上时显示“具体线路信息”，我是通过设置 tooltip 来完成的（注意：要打开 gv 的 tooltip 开关）：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4b301a554a779037094" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\ngv.enableToolTip();//打开 tooltip 的开关&#13;\nif(num === \'68\') polyline.setToolTip(\'A P M\');//设置提示信息 &#13;\nelse if(num === \'60\') polyline.setToolTip(\'G F\'); &#13;\nelse polyline.setToolTip(\'Line\' + num);</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4b301a554a779037094-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a554a779037094-2">2</div><div class="crayon-num" data-line="crayon-5be4b301a554a779037094-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a554a779037094-4">4</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4b301a554a779037094-1"><span class="crayon-v">gv</span><span class="crayon-sy">.</span><span class="crayon-e">enableToolTip</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-c">//打开 tooltip 的开关</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a554a779037094-2"><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-v">num</span><span class="crayon-h"> </span><span class="crayon-o">===</span><span class="crayon-h"> </span><span class="crayon-s">\'68\'</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-v">polyline</span><span class="crayon-sy">.</span><span class="crayon-e">setToolTip</span><span class="crayon-sy">(</span><span class="crayon-s">\'A P M\'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-c">//设置提示信息 </span></div><div class="crayon-line" id="crayon-5be4b301a554a779037094-3"><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-v">num</span><span class="crayon-h"> </span><span class="crayon-o">===</span><span class="crayon-h"> </span><span class="crayon-s">\'60\'</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-v">polyline</span><span class="crayon-sy">.</span><span class="crayon-e">setToolTip</span><span class="crayon-sy">(</span><span class="crayon-s">\'G F\'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a554a779037094-4"><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-v">polyline</span><span class="crayon-sy">.</span><span class="crayon-e">setToolTip</span><span class="crayon-sy">(</span><span class="crayon-s">\'Line\'</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">num</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0014 seconds] -->&#13;\n<p>然后我利用右下角的 form 表单，单击表单上的具体线路，或者双击拓扑图上任意一个“站点”或者线路，则拓扑图会自适应到对应的部分，将被双击的部分展现到拓扑图的中央。</p>\n</div>\n<p><img src="http://wx3.sinaimg.cn/large/63918611gy1fpiyij2z8fg20vv0k5u10.gif"/></p>\n<div>\n<p>form 表单的声明部分我好像还没有解释。。。就是通过 new 一个 ht.widget.FomePane 类创建一个 form 表单组件，通过 form.getView() 获取表单组件的底层 div，将这个 div 摆放在 body 右下角，然后通过 addRow 函数向 form 表单中添加一行的表单项，可以在这行中添加任意多个项，通过 addRow 函数的第二个参数（一个数组），对添加进的表单项进行宽度的设置，通过第三个参数设置这行的高度：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4b301a554d893370805" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\nfunction createForm() {//创建右下角的form表单&#13;\n    var form = new ht.widget.FormPane();&#13;\n    form.setWidth(200);//设置表单宽度&#13;\n    form.setHeight(416);//设置表单高度&#13;\n    let view = form.getView();&#13;\n    document.body.appendChild(view);//将表单添加进body中&#13;\n    view.style.zIndex = 1000;&#13;\n    view.style.bottom = \'10px\';//ht组件几乎都设置绝对路径&#13;\n    view.style.right = \'10px\';&#13;\n    view.style.background = \'rgba(211, 211, 211, 0.8)\';&#13;\n&#13;\n    names.forEach(function(nameString) {&#13;\n        form.addRow([//向表单中添加行&#13;\n            {//这一行中的第一个表单项&#13;\n                button: {//向表单中添加button按钮&#13;\n                    icon: \'images/Line\'+nameString.value+\'.json\',//设置按钮的图标&#13;\n                    background: \'\',//设置按钮的背景&#13;\n                    borderColor: \'\',//设置按钮的边框颜色&#13;\n                    clickable: false//设置按钮不可点击&#13;\n                }&#13;\n            },&#13;\n            {//第二个表单项&#13;\n                button: {&#13;\n                    label: nameString.name,&#13;\n                    labelFont: \'bold 14px arial, sans-serif\',&#13;\n                    labelColor: \'#fff\',&#13;\n                    background: \'\',&#13;\n                    borderColor: \'\',&#13;\n                    onClicked: function() {//按钮点击回调事件&#13;\n                        gv.sm().ss(dm.getDataByTag(nameString.value));//设置选中按下的按钮对应的线路&#13;\n                        gv.fitData(gv.sm().ld(), true, 5);//将选中的地铁线路显示在拓扑图的中央&#13;\n                    }&#13;\n                }&#13;\n            }&#13;\n        ], [0.1, 0.2], 23);//第二个参数是设置第一参数中的数组的宽度，小于1是比例，大于1是实际宽度。第三个参数是该行的高度&#13;\n    });&#13;\n}</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4b301a554d893370805-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a554d893370805-2">2</div><div class="crayon-num" data-line="crayon-5be4b301a554d893370805-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a554d893370805-4">4</div><div class="crayon-num" data-line="crayon-5be4b301a554d893370805-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a554d893370805-6">6</div><div class="crayon-num" data-line="crayon-5be4b301a554d893370805-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a554d893370805-8">8</div><div class="crayon-num" data-line="crayon-5be4b301a554d893370805-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a554d893370805-10">10</div><div class="crayon-num" data-line="crayon-5be4b301a554d893370805-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a554d893370805-12">12</div><div class="crayon-num" data-line="crayon-5be4b301a554d893370805-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a554d893370805-14">14</div><div class="crayon-num" data-line="crayon-5be4b301a554d893370805-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a554d893370805-16">16</div><div class="crayon-num" data-line="crayon-5be4b301a554d893370805-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a554d893370805-18">18</div><div class="crayon-num" data-line="crayon-5be4b301a554d893370805-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a554d893370805-20">20</div><div class="crayon-num" data-line="crayon-5be4b301a554d893370805-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a554d893370805-22">22</div><div class="crayon-num" data-line="crayon-5be4b301a554d893370805-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a554d893370805-24">24</div><div class="crayon-num" data-line="crayon-5be4b301a554d893370805-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a554d893370805-26">26</div><div class="crayon-num" data-line="crayon-5be4b301a554d893370805-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a554d893370805-28">28</div><div class="crayon-num" data-line="crayon-5be4b301a554d893370805-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a554d893370805-30">30</div><div class="crayon-num" data-line="crayon-5be4b301a554d893370805-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a554d893370805-32">32</div><div class="crayon-num" data-line="crayon-5be4b301a554d893370805-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a554d893370805-34">34</div><div class="crayon-num" data-line="crayon-5be4b301a554d893370805-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a554d893370805-36">36</div><div class="crayon-num" data-line="crayon-5be4b301a554d893370805-37">37</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4b301a554d893370805-1"><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-e">createForm</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-c">//创建右下角的form表单</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a554d893370805-2"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">form</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-v">ht</span><span class="crayon-sy">.</span><span class="crayon-v">widget</span><span class="crayon-sy">.</span><span class="crayon-e">FormPane</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5be4b301a554d893370805-3"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-v">form</span><span class="crayon-sy">.</span><span class="crayon-e">setWidth</span><span class="crayon-sy">(</span><span class="crayon-cn">200</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-c">//设置表单宽度</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a554d893370805-4"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-v">form</span><span class="crayon-sy">.</span><span class="crayon-e">setHeight</span><span class="crayon-sy">(</span><span class="crayon-cn">416</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-c">//设置表单高度</span></div><div class="crayon-line" id="crayon-5be4b301a554d893370805-5"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-e">let </span><span class="crayon-v">view</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">form</span><span class="crayon-sy">.</span><span class="crayon-e">getView</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a554d893370805-6"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-v">document</span><span class="crayon-sy">.</span><span class="crayon-v">body</span><span class="crayon-sy">.</span><span class="crayon-e">appendChild</span><span class="crayon-sy">(</span><span class="crayon-v">view</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-c">//将表单添加进body中</span></div><div class="crayon-line" id="crayon-5be4b301a554d893370805-7"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-v">view</span><span class="crayon-sy">.</span><span class="crayon-v">style</span><span class="crayon-sy">.</span><span class="crayon-v">zIndex</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1000</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a554d893370805-8"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-v">view</span><span class="crayon-sy">.</span><span class="crayon-v">style</span><span class="crayon-sy">.</span><span class="crayon-v">bottom</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">\'10px\'</span><span class="crayon-sy">;</span><span class="crayon-c">//ht组件几乎都设置绝对路径</span></div><div class="crayon-line" id="crayon-5be4b301a554d893370805-9"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-v">view</span><span class="crayon-sy">.</span><span class="crayon-v">style</span><span class="crayon-sy">.</span><span class="crayon-v">right</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">\'10px\'</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a554d893370805-10"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-v">view</span><span class="crayon-sy">.</span><span class="crayon-v">style</span><span class="crayon-sy">.</span><span class="crayon-v">background</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">\'rgba(211, 211, 211, 0.8)\'</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5be4b301a554d893370805-11">\xa0</div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a554d893370805-12"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-v">names</span><span class="crayon-sy">.</span><span class="crayon-st">forEach</span><span class="crayon-sy">(</span><span class="crayon-t">function</span><span class="crayon-sy">(</span><span class="crayon-v">nameString</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5be4b301a554d893370805-13"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-v">form</span><span class="crayon-sy">.</span><span class="crayon-e">addRow</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-c">//向表单中添加行</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a554d893370805-14"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-sy">{</span><span class="crayon-c">//这一行中的第一个表单项</span></div><div class="crayon-line" id="crayon-5be4b301a554d893370805-15"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-v">button</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-c">//向表单中添加button按钮</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a554d893370805-16"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-v">icon</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">\'images/Line\'</span><span class="crayon-o">+</span><span class="crayon-v">nameString</span><span class="crayon-sy">.</span><span class="crayon-v">value</span><span class="crayon-o">+</span><span class="crayon-s">\'.json\'</span><span class="crayon-sy">,</span><span class="crayon-c">//设置按钮的图标</span></div><div class="crayon-line" id="crayon-5be4b301a554d893370805-17"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-v">background</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">\'\'</span><span class="crayon-sy">,</span><span class="crayon-c">//设置按钮的背景</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a554d893370805-18"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-v">borderColor</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">\'\'</span><span class="crayon-sy">,</span><span class="crayon-c">//设置按钮的边框颜色</span></div><div class="crayon-line" id="crayon-5be4b301a554d893370805-19"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-v">clickable</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-t">false</span><span class="crayon-c">//设置按钮不可点击</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a554d893370805-20"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5be4b301a554d893370805-21"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-sy">}</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a554d893370805-22"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-sy">{</span><span class="crayon-c">//第二个表单项</span></div><div class="crayon-line" id="crayon-5be4b301a554d893370805-23"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-v">button</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a554d893370805-24"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-v">label</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">nameString</span><span class="crayon-sy">.</span><span class="crayon-v">name</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5be4b301a554d893370805-25"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-v">labelFont</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">\'bold 14px arial, sans-serif\'</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a554d893370805-26"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-v">labelColor</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">\'#fff\'</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5be4b301a554d893370805-27"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-v">background</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">\'\'</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a554d893370805-28"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-v">borderColor</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">\'\'</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5be4b301a554d893370805-29"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-v">onClicked</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-c">//按钮点击回调事件</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a554d893370805-30"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-v">gv</span><span class="crayon-sy">.</span><span class="crayon-e">sm</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">ss</span><span class="crayon-sy">(</span><span class="crayon-v">dm</span><span class="crayon-sy">.</span><span class="crayon-e">getDataByTag</span><span class="crayon-sy">(</span><span class="crayon-v">nameString</span><span class="crayon-sy">.</span><span class="crayon-v">value</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-c">//设置选中按下的按钮对应的线路</span></div><div class="crayon-line" id="crayon-5be4b301a554d893370805-31"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-v">gv</span><span class="crayon-sy">.</span><span class="crayon-e">fitData</span><span class="crayon-sy">(</span><span class="crayon-v">gv</span><span class="crayon-sy">.</span><span class="crayon-e">sm</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">ld</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">true</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">5</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-c">//将选中的地铁线路显示在拓扑图的中央</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a554d893370805-32"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5be4b301a554d893370805-33"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a554d893370805-34"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5be4b301a554d893370805-35"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0.1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0.2</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">23</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-c">//第二个参数是设置第一参数中的数组的宽度，小于1是比例，大于1是实际宽度。第三个参数是该行的高度</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a554d893370805-36"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5be4b301a554d893370805-37"><span class="crayon-sy">}</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0061 seconds] -->&#13;\n<p>单击“站点”显示红色标注，双击节点自适应放置到拓扑图中央以及双击空白处将红色标注隐藏的内容都是通过对拓扑组件 gv 的事件监听来控制的，非常清晰易懂，代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4b301a5552403846929" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\nvar node = createRedLight();//创建一个新的节点，显示为“红灯”的样式&#13;\ngv.mi(function(e) {//ht 中拓扑组件中的事件监听&#13;\n    if(e.kind === \'clickData\' &amp;&amp; (e.data.a(\'tpNode\') || e.data.a(\'npNode\'))) {//e.kind获取当前事件类型，e.data获取当前事件下的节点&#13;\n        node.s(\'2d.visible\', true);//设置node节点可见&#13;\n        node.setPosition(e.data.getPosition().x, e.data.getPosition().y);//设置node的坐标为当前事件下节点的位置&#13;\n    }&#13;\n    else if(e.kind === \'doubleClickData\') {//双击节点&#13;\n        gv.fitData(e.data, false, 10);//将事件下的节点自适应到拓扑图的中央，参数1为自适应的节点，参数2为是否动画，参数3为gv与边框的padding&#13;\n    }&#13;\n    else if(e.kind === \'doubleClickBackground\') {//双击空白处&#13;\n        node.s(\'2d.visible\', false);//设置node节点不可见 查看 HT for Web 样式手册（http://www.hightopo.com/guide/guide/core/theme/ht-theme-guide.html#ref_style）&#13;\n    }&#13;\n});</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4b301a5552403846929-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a5552403846929-2">2</div><div class="crayon-num" data-line="crayon-5be4b301a5552403846929-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a5552403846929-4">4</div><div class="crayon-num" data-line="crayon-5be4b301a5552403846929-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a5552403846929-6">6</div><div class="crayon-num" data-line="crayon-5be4b301a5552403846929-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a5552403846929-8">8</div><div class="crayon-num" data-line="crayon-5be4b301a5552403846929-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a5552403846929-10">10</div><div class="crayon-num" data-line="crayon-5be4b301a5552403846929-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a5552403846929-12">12</div><div class="crayon-num" data-line="crayon-5be4b301a5552403846929-13">13</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4b301a5552403846929-1"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">node</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">createRedLight</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-c">//创建一个新的节点，显示为“红灯”的样式</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a5552403846929-2"><span class="crayon-v">gv</span><span class="crayon-sy">.</span><span class="crayon-e">mi</span><span class="crayon-sy">(</span><span class="crayon-t">function</span><span class="crayon-sy">(</span><span class="crayon-v">e</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-c">//ht 中拓扑组件中的事件监听</span></div><div class="crayon-line" id="crayon-5be4b301a5552403846929-3"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-v">e</span><span class="crayon-sy">.</span><span class="crayon-v">kind</span><span class="crayon-h"> </span><span class="crayon-o">===</span><span class="crayon-h"> </span><span class="crayon-s">\'clickData\'</span><span class="crayon-h"> </span><span class="crayon-o">&amp;&amp;</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">e</span><span class="crayon-sy">.</span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-e">a</span><span class="crayon-sy">(</span><span class="crayon-s">\'tpNode\'</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">||</span><span class="crayon-h"> </span><span class="crayon-v">e</span><span class="crayon-sy">.</span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-e">a</span><span class="crayon-sy">(</span><span class="crayon-s">\'npNode\'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-c">//e.kind获取当前事件类型，e.data获取当前事件下的节点</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a5552403846929-4"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-v">node</span><span class="crayon-sy">.</span><span class="crayon-e">s</span><span class="crayon-sy">(</span><span class="crayon-s">\'2d.visible\'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">true</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-c">//设置node节点可见</span></div><div class="crayon-line" id="crayon-5be4b301a5552403846929-5"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-v">node</span><span class="crayon-sy">.</span><span class="crayon-e">setPosition</span><span class="crayon-sy">(</span><span class="crayon-v">e</span><span class="crayon-sy">.</span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-e">getPosition</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">e</span><span class="crayon-sy">.</span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-e">getPosition</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-v">y</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-c">//设置node的坐标为当前事件下节点的位置</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a5552403846929-6"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5be4b301a5552403846929-7"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-v">e</span><span class="crayon-sy">.</span><span class="crayon-v">kind</span><span class="crayon-h"> </span><span class="crayon-o">===</span><span class="crayon-h"> </span><span class="crayon-s">\'doubleClickData\'</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-c">//双击节点</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a5552403846929-8"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-v">gv</span><span class="crayon-sy">.</span><span class="crayon-e">fitData</span><span class="crayon-sy">(</span><span class="crayon-v">e</span><span class="crayon-sy">.</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">false</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">10</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-c">//将事件下的节点自适应到拓扑图的中央，参数1为自适应的节点，参数2为是否动画，参数3为gv与边框的padding</span></div><div class="crayon-line" id="crayon-5be4b301a5552403846929-9"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a5552403846929-10"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-v">e</span><span class="crayon-sy">.</span><span class="crayon-v">kind</span><span class="crayon-h"> </span><span class="crayon-o">===</span><span class="crayon-h"> </span><span class="crayon-s">\'doubleClickBackground\'</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-c">//双击空白处</span></div><div class="crayon-line" id="crayon-5be4b301a5552403846929-11"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-v">node</span><span class="crayon-sy">.</span><span class="crayon-e">s</span><span class="crayon-sy">(</span><span class="crayon-s">\'2d.visible\'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">false</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-c">//设置node节点不可见 查看 HT for Web 样式手册（http://www.hightopo.com/guide/guide/core/theme/ht-theme-guide.html#ref_style）</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a5552403846929-12"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5be4b301a5552403846929-13"><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0037 seconds] -->&#13;\n<p>注意 s（style） 和 a（attr） 定义是这样的，s 是 ht 预定义的一些样式属性，而 a 是我们用户来自定义的属性，一般是通过调用字符串来调用结果的，这个字符串对应的可以是常量也可以是函数，还是很灵活的。</p>\n<p>最后还做了一个小小的部分，选中“站点”，则该“站点”的上方会显示一个红色的会“呼吸”的用来注明当前选中的“站点”。</p>\n<p><img src="http://wx2.sinaimg.cn/mw690/63918611gy1fpiyggtf27g20ab0a9wnp.gif"/></p>\n<p>“呼吸”的部分是利用 ht 的 setAnimation 函数来完成的，在用这个函数之前要先打开数据容器的动画开关，然后设置动画：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4b301a5556452652554" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\ndm.enableAnimation();//打开数据容器的动画开关&#13;\nfunction createRedLight() {&#13;\n    var node = new ht.Node();&#13;\n    node.setImage(\'images/红灯.json\');//设置节点的图片&#13;\n    node.setSize(1, 1);//设置节点的大小&#13;\n    node.setLayer(\'firstTop\');//设置节点显示在gv的最上层&#13;\n    node.s(\'2d.visible\', false);//节点不可见&#13;\n    node.s(\'select.width\', 0);//节点选中时的边框为0，不可见&#13;\n    node.s(\'2d.selectable\', false);//设置这个属性，则节点不可选中&#13;\n&#13;\n    node.setAnimation({//设置动画 具体参见 HT for Web 动画手册（http://www.hightopo.com/guide/guide/plugin/animation/ht-animation-guide.html）&#13;\n        expandWidth: {&#13;\n            property: "width",//设置这个属性，并且未设置 accessType，则默认通过 setWidth/getWidth 来设置和获取属性。这里的 width 和下面的 height 都是通过前面设置的 size 得到的&#13;\n            from: 0.5, //动画开始时的属性值&#13;\n            to: 1,//动画结束时的属性值&#13;\n            next: "collapseWidth"//字符串类型，指定当前动画完成之后，要执行的下个动画，可将多个动画融合&#13;\n        },&#13;\n        collapseWidth: {&#13;\n            property: "width",&#13;\n            from: 1, &#13;\n            to: 0.5,&#13;\n            next: "expandWidth"&#13;\n        },&#13;\n        expandHeight: {&#13;\n            property: "height",&#13;\n            from: 0.5, &#13;\n            to: 1,&#13;\n            next: "collapseHeight"&#13;\n        },&#13;\n        collapseHeight: {&#13;\n            property: "height",&#13;\n            from: 1, &#13;\n            to: 0.5,&#13;\n            next: "expandHeight"&#13;\n        },&#13;\n        start: ["expandWidth", "expandHeight"]//数组，用于指定要启动的一个或多个动画&#13;\n    });&#13;\n    dm.add(node);&#13;\n    return node;&#13;\n}</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4b301a5556452652554-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a5556452652554-2">2</div><div class="crayon-num" data-line="crayon-5be4b301a5556452652554-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a5556452652554-4">4</div><div class="crayon-num" data-line="crayon-5be4b301a5556452652554-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a5556452652554-6">6</div><div class="crayon-num" data-line="crayon-5be4b301a5556452652554-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a5556452652554-8">8</div><div class="crayon-num" data-line="crayon-5be4b301a5556452652554-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a5556452652554-10">10</div><div class="crayon-num" data-line="crayon-5be4b301a5556452652554-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a5556452652554-12">12</div><div class="crayon-num" data-line="crayon-5be4b301a5556452652554-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a5556452652554-14">14</div><div class="crayon-num" data-line="crayon-5be4b301a5556452652554-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a5556452652554-16">16</div><div class="crayon-num" data-line="crayon-5be4b301a5556452652554-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a5556452652554-18">18</div><div class="crayon-num" data-line="crayon-5be4b301a5556452652554-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a5556452652554-20">20</div><div class="crayon-num" data-line="crayon-5be4b301a5556452652554-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a5556452652554-22">22</div><div class="crayon-num" data-line="crayon-5be4b301a5556452652554-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a5556452652554-24">24</div><div class="crayon-num" data-line="crayon-5be4b301a5556452652554-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a5556452652554-26">26</div><div class="crayon-num" data-line="crayon-5be4b301a5556452652554-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a5556452652554-28">28</div><div class="crayon-num" data-line="crayon-5be4b301a5556452652554-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a5556452652554-30">30</div><div class="crayon-num" data-line="crayon-5be4b301a5556452652554-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a5556452652554-32">32</div><div class="crayon-num" data-line="crayon-5be4b301a5556452652554-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a5556452652554-34">34</div><div class="crayon-num" data-line="crayon-5be4b301a5556452652554-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a5556452652554-36">36</div><div class="crayon-num" data-line="crayon-5be4b301a5556452652554-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a5556452652554-38">38</div><div class="crayon-num" data-line="crayon-5be4b301a5556452652554-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b301a5556452652554-40">40</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4b301a5556452652554-1"><span class="crayon-v">dm</span><span class="crayon-sy">.</span><span class="crayon-e">enableAnimation</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-c">//打开数据容器的动画开关</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a5556452652554-2"><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-e">createRedLight</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5be4b301a5556452652554-3"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">node</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-v">ht</span><span class="crayon-sy">.</span><span class="crayon-e">Node</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a5556452652554-4"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-v">node</span><span class="crayon-sy">.</span><span class="crayon-e">setImage</span><span class="crayon-sy">(</span><span class="crayon-s">\'images/红灯.json\'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-c">//设置节点的图片</span></div><div class="crayon-line" id="crayon-5be4b301a5556452652554-5"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-v">node</span><span class="crayon-sy">.</span><span class="crayon-e">setSize</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-c">//设置节点的大小</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a5556452652554-6"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-v">node</span><span class="crayon-sy">.</span><span class="crayon-e">setLayer</span><span class="crayon-sy">(</span><span class="crayon-s">\'firstTop\'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-c">//设置节点显示在gv的最上层</span></div><div class="crayon-line" id="crayon-5be4b301a5556452652554-7"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-v">node</span><span class="crayon-sy">.</span><span class="crayon-e">s</span><span class="crayon-sy">(</span><span class="crayon-s">\'2d.visible\'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">false</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-c">//节点不可见</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a5556452652554-8"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-v">node</span><span class="crayon-sy">.</span><span class="crayon-e">s</span><span class="crayon-sy">(</span><span class="crayon-s">\'select.width\'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-c">//节点选中时的边框为0，不可见</span></div><div class="crayon-line" id="crayon-5be4b301a5556452652554-9"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-v">node</span><span class="crayon-sy">.</span><span class="crayon-e">s</span><span class="crayon-sy">(</span><span class="crayon-s">\'2d.selectable\'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">false</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-c">//设置这个属性，则节点不可选中</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a5556452652554-10">\xa0</div><div class="crayon-line" id="crayon-5be4b301a5556452652554-11"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-v">node</span><span class="crayon-sy">.</span><span class="crayon-e">setAnimation</span><span class="crayon-sy">(</span><span class="crayon-sy">{</span><span class="crayon-c">//设置动画 具体参见 HT for Web 动画手册（http://www.hightopo.com/guide/guide/plugin/animation/ht-animation-guide.html）</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a5556452652554-12"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-v">expandWidth</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5be4b301a5556452652554-13"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-m">property</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">"width"</span><span class="crayon-sy">,</span><span class="crayon-c">//设置这个属性，并且未设置 accessType，则默认通过 setWidth/getWidth 来设置和获取属性。这里的 width 和下面的 height 都是通过前面设置的 size 得到的</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a5556452652554-14"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-v">from</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">0.5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-c">//动画开始时的属性值</span></div><div class="crayon-line" id="crayon-5be4b301a5556452652554-15"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-st">to</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-c">//动画结束时的属性值</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a5556452652554-16"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-v">next</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">"collapseWidth"</span><span class="crayon-c">//字符串类型，指定当前动画完成之后，要执行的下个动画，可将多个动画融合</span></div><div class="crayon-line" id="crayon-5be4b301a5556452652554-17"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-sy">}</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a5556452652554-18"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-v">collapseWidth</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5be4b301a5556452652554-19"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-m">property</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">"width"</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a5556452652554-20"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-v">from</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-5be4b301a5556452652554-21"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-st">to</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">0.5</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a5556452652554-22"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-v">next</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">"expandWidth"</span></div><div class="crayon-line" id="crayon-5be4b301a5556452652554-23"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-sy">}</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a5556452652554-24"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-v">expandHeight</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5be4b301a5556452652554-25"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-m">property</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">"height"</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a5556452652554-26"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-v">from</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">0.5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-5be4b301a5556452652554-27"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-st">to</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a5556452652554-28"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-v">next</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">"collapseHeight"</span></div><div class="crayon-line" id="crayon-5be4b301a5556452652554-29"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-sy">}</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a5556452652554-30"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-v">collapseHeight</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5be4b301a5556452652554-31"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-m">property</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">"height"</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a5556452652554-32"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-v">from</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-5be4b301a5556452652554-33"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-st">to</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">0.5</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a5556452652554-34"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-v">next</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">"expandHeight"</span></div><div class="crayon-line" id="crayon-5be4b301a5556452652554-35"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-sy">}</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a5556452652554-36"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-v">start</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-s">"expandWidth"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"expandHeight"</span><span class="crayon-sy">]</span><span class="crayon-c">//数组，用于指定要启动的一个或多个动画</span></div><div class="crayon-line" id="crayon-5be4b301a5556452652554-37"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a5556452652554-38"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-v">dm</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-v">node</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5be4b301a5556452652554-39"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">node</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b301a5556452652554-40"><span class="crayon-sy">}</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0055 seconds] -->&#13;\n<p>全部代码结束！</p>\n<h4>总结</h4>\n<p>这个 Demo 花了我两天时间完成，总觉得有点不甘心啊，但是有时候思维又转不过弯来，花费了不少的时间，但是总的来说收获还是很多的，我以前一直以为只要通过 getPoints().push 来向多边形中添加点就可以了，求助了大神之后，发现原来这个方法不仅绕弯路而且还会出现各种各样的问题，比如 getPoints 之前，一定要在多边形中已经有 points 才可以，但是在很多情况下，初始化的 points 并不好设置，而且会造成代码很繁琐，直接通过 addPoint 方法，直接将点添加进多边形变量中，并且还会默认将点通过直线的方式连接，也不用设置 segments，多可爱的一个函数。</p>\n<p>还有就是因为 ht 默认缩放大小是 20，而我这个 Demo 的间距又很小，导致缩放到最大地铁线路图显示也很小，所以我在 htconfig 中更改了 ht 的默认 zoomMax 属性，记住，更改这个值一定要在所有的 ht 调用之前，因为在 htconfig 中设置的值在后面定义都是不可更改的。</p>\n<p>总而言之，这两天我的脑细胞死了不少，也重新生长了不少，人都是在不断进步的嘛~</p>\n</div>\n&#13;\n        <script language="javascript"> &#13;\nvar randomNum = Math.round(Math.random()*1);&#13;\nvar innerHTML=new Array(2);&#13;\ninnerHTML[0]="如果有人让你推荐前端技术书，请让他看这个列表 -&gt;《&lt;a target=\'_blank\' href=\'http://web.jobbole.com/86734/\'&gt;经典前端技术书籍&lt;/a&gt;》";&#13;\ninnerHTML[1]="如果有人让你推荐前端技术书，请让他看这个列表 -&gt;《&lt;a target=\'_blank\' href=\'http://web.jobbole.com/86734/\'&gt;经典前端技术书籍&lt;/a&gt;》";&#13;\nvar widgetHTML="&lt;div id=\'single-page-inner-widget\'&gt;"+innerHTML[randomNum]+"&lt;/div&gt;";&#13;\ndocument.write(widgetHTML);&#13;\n</script>&#13;\n        &#13;\n        \n     \n\n\n\n&#13;\n        <!-- BEGIN #author-bio -->&#13;\n&#13;\n&#13;\n<!-- END #author-bio -->&#13;');
insert into news_article_basic(article_id, user_id, channel_id, title, cover, status)values(4, 1, 1, '2018年海外大数据和人工智能产业全景分析与趋势预测', '{"type":0, "images":[]}', 2);
insert into news_article_content(article_id, content) values(4,'<link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f76675cdea.css"/>\n\t\t\t\t\t\t<div class="htmledit_views">\n                <div class="entry-content articlebody">\n<strong>1、全景概况</strong>\nWithout big data analytics, companies are blind and deaf, wandering out onto the Web like deer on a freeway.\n<p>高科技营销魔法之父Geoffrey Moore曾经这样肯定大数据的存在意义：不进行大数据分析的公司，是“聋瞎”公司，就像高速公路上徘徊的野鹿一样。</p>\n<p>因此，从互联网巨头到创业新贵，从中国到全世界，已经有无数技术公司投身到大数据和人工智能的洪流之中。</p>\n<p>风险资本家Matt Turc分享了2018年大数据和人工智能的全景图，有1095家大数据公司被纳入其中。本文将基于这份全景研究对大数据和人工智能领域进行详细的解读，包括各细分领域的分布情况，上市及被收购的知名企业分析，以及MobData研究院对整个领域的趋势预测。</p>\n<a href="https://t.zsxq.com/eiQB2ZZ" rel="nofollow"><img class="attachment-full size-full" src="http://www.199it.com/wp-content/uploads/2018/11/1541061466-6673-JxfRmMy8Q9LXL2l906NlibxvHBqA.jpg" alt="" width="1080" height="758"/></a><p style="text-align:center;"><strong>全景图高清下载地址：<a href="https://t.zsxq.com/eiQB2ZZ" rel="nofollow">https://t.zsxq.com/eiQB2ZZ</a></strong></p>\n<strong>2、细分领域</strong>\n将大数据和人工智能领域进一步分解，从底层的数据资源和数据API，到中层的开源框架和基础架构，再到领域终端的数据分析和应用行业，<strong>数据作为最基本的元素，贯穿整条产业链，也激活了教育、金融、健康医疗、物流等各行各业的活力与生机。</strong>\n<a href="http://www.199it.com/wp-content/uploads/2018/11/1541061466-7446-V7Ulyjwv7RvFKHDzvYZuWfibIIbg.jpg" rel="nofollow"><img class="attachment-full size-full" src="http://www.199it.com/wp-content/uploads/2018/11/1541061466-7446-V7Ulyjwv7RvFKHDzvYZuWfibIIbg.jpg" alt="" width="996" height="762"/></a>从细分领域来看，大数据企业多数分布在三类方向：\n<ul class="list-paddingleft-2"><li><strong>第一类是基础架构</strong><strong>，</strong>共219家企业。主要做基于云的企业级数据存储、分析、安全、管理等服务，提供诸如云服务、数据库、数据集成、数据保护、数据转换等细分类别；</li>\n<li><strong>第二类是分析工具</strong>，共223家企业。主要做信息的搜索和商业分析，提供搜索、分拣、识别、调用、分析等细分类别；</li>\n<li><strong>第三类是应用行业</strong>，共243家企业。主要在金融、医疗、广告、社交、政府、电商、物流、农业等细分行业领域提供大数据服务。</li>\n</ul>将各个细分领域再次拆解，各细分服务平台分布如下：\n<a href="http://www.199it.com/wp-content/uploads/2018/11/1541061466-4785-ico8KTib2PUlRZicnYLRjUJfQcBA.jpg" rel="nofollow"><img class="attachment-full size-full" src="http://www.199it.com/wp-content/uploads/2018/11/1541061466-4785-ico8KTib2PUlRZicnYLRjUJfQcBA.jpg" alt="" width="994" height="691"/></a>更多企业集中在数据分析平台、数据安全、健康医疗、可视化、金融租赁、生命科学、人工智能等细分平台。\n<strong>3、头部企业</strong>\n1075家企业中，共有185家被收购，23家IPO上市。\n<a href="http://www.199it.com/wp-content/uploads/2018/11/1541061466-7319-FQrGz9tzVA0AmMicBL81A2QqSdIw.jpg" rel="nofollow"><img class="attachment-full size-full" src="http://www.199it.com/wp-content/uploads/2018/11/1541061466-7319-FQrGz9tzVA0AmMicBL81A2QqSdIw.jpg" alt="" width="860" height="598"/></a>注释：原文中共1095家企业被统计，1075家为非重复企业\n本部分将聚焦于以下32家较为知名且体量较大的大数据企业：\n<ul class="list-paddingleft-2"><li><strong>上市企业</strong></li>\n</ul>大数据领域中，4家较为知名的上市企业有专注于企业级数据管理服务的Cloudera、数据库管理公司MongoDB、云计算服务商Zuora和数据搜索软件公司Elastic。这四家企业都在最近两年内上市，目前总市值在19-44亿美元之间。\n<a href="http://www.199it.com/wp-content/uploads/2018/11/1541061467-5526-dYrribdqD8ibN9m4iazYjMDl6pGg.jpg" rel="nofollow"><img class="attachment-full size-full" src="http://www.199it.com/wp-content/uploads/2018/11/1541061467-5526-dYrribdqD8ibN9m4iazYjMDl6pGg.jpg" alt="" width="994" height="628"/></a>注释：上市企业市值统计截止到2018年10月30日\n<ul class="list-paddingleft-2"><li><strong>被收购企业</strong></li>\n</ul>在大数据与人工智能领域，共统计出12家备受瞩目的被收购企业。与上市周期一致，这些企业也集中在近两年内被收购，多数集中在健康医疗、广告、金融等领域。\n<a href="http://www.199it.com/wp-content/uploads/2018/11/1541061469-8588-BrTAl5F43c32WryVmdds7dxjhZfQ.jpg" rel="nofollow"><img class="attachment-full size-full" src="http://www.199it.com/wp-content/uploads/2018/11/1541061469-8588-BrTAl5F43c32WryVmdds7dxjhZfQ.jpg" alt="" width="795" height="796"/></a>大数据在广告领域的应用非常广泛，代表公司有在线广告交易公司Appnexus、数字广告验证公司Moat Analytics和广告评估优化工具提供商Integral Ad Science，这三家企业被收购的金额在8-16亿美元之间。\n<p>除此之外，还有AI技术驱动的暗数据人工智能企业Lattice Data，这家企业在2017年被苹果以2亿美元收购，致力于将非结构的暗数据（dark data）进行结构化转化，获得有用的信息。</p>\n<strong>4、趋势预测</strong>\n<a href="http://www.199it.com/wp-content/uploads/2018/11/1541061468-2967-BUwaBVpXF5nvVRhvzGS3BxYZReBQ.jpg" rel="nofollow"><img class="attachment-full size-full" src="http://www.199it.com/wp-content/uploads/2018/11/1541061468-2967-BUwaBVpXF5nvVRhvzGS3BxYZReBQ.jpg" alt="" width="678" height="618"/></a><ul class="list-paddingleft-2"><li><strong>人工智能将成为大数据领域的核心驱动力</strong></li>\n</ul>亚马逊、谷歌、Facebook和IBM等国内国际大公司在人工智能域引领潮流，已经赢得市场回报。\n<ul class="list-paddingleft-2"><li><strong>行业集中趋势愈加明显</strong></li>\n</ul>CBInsights的统计数据显示：AI公司的收购竞争已经开始。2018年，我们已经能看到很多小型的人工智能类创业公司开始被大公司收购。\n<ul class="list-paddingleft-2"><li><strong>大数据与人工智能企业的数据壁垒程度出现两极分化</strong></li>\n</ul>大数据领域行业集中度增加，市场进入壁垒提升，数据资产化将成为必然趋势，数据壁垒将越来越高。相反的是，人工智能立足市场的基础便是大数据，因而大数据的交流与打通将为企业获得数据资源，以促进算法的不断优化更新。\n<ul class="list-paddingleft-2"><li><strong>人工智能将逐渐对垂直领域产生影响</strong></li>\n</ul>制造、客户服务、交通运输和医疗健康、教育、家居等领域已经受到人工智能的影响，今后也将会有更多的领域使用人机交互的智能机器人，比如保险、财税等。\n<ul class="list-paddingleft-2"><li><strong>数据安全将成为一大隐患</strong></li>\n</ul>面对大数据与人工智能的不断升级与发展，安全和隐私问题也会随之凸显。\n<p>The real danger is not that computers will begin to think like men, but that men will begin to think like computers.</p>\n也有部分专家认为大数据和人工智能对人类进化，有着方向性的错误。比如Sydney J. Harris曾经说过：真正危险的不是计算机开始像人类那样去思考，而是人类开始像计算机一样思考。\n<p>然而，历史的巨轮之下，谁又会知道未来何如？</p>\n<p><strong>来自：<a href="https://mp.weixin.qq.com/s/ezvxiTyRJW0x07msYwZ50w" rel="nofollow">MobData</a></strong></p>\n<div class="wp_rp_wrap wp_rp_plain" id="wp_rp_first"><div class="wp_rp_content"><h3 class="related_post_title">更多阅读：</h3><ul class="related_post wp_rp"><li><a href="http://www.199it.com/archives/549830.html" rel="nofollow" class="wp_rp_title">展望金融科技生态体系，大数据和人工智能如何改造金融业？</a></li><li><a href="http://www.199it.com/archives/687600.html" rel="nofollow" class="wp_rp_title">Accenture：调查显示企业不愿花钱对员工进行人工智能培训</a></li><li><a href="http://www.199it.com/archives/446662.html" rel="nofollow" class="wp_rp_title">大数据和人工智能为广告主带来的价值</a></li><li><a href="http://www.199it.com/archives/424953.html" rel="nofollow" class="wp_rp_title">2016年互联网行业十大预测：云计算、大数据、人工智能</a></li><li><a href="http://www.199it.com/archives/593914.html" rel="nofollow" class="wp_rp_title">2017大预测：大数据、物联网与人工智能</a></li><li><a href="http://www.199it.com/archives/579576.html" rel="nofollow" class="wp_rp_title">人工智能技术是基于大数据吃饭的？</a></li><li><a href="http://www.199it.com/archives/680508.html" rel="nofollow" class="wp_rp_title">EMC：人人都在谈论人工智能，难道大数据已死？</a></li><li><a href="http://www.199it.com/archives/652841.html" rel="nofollow" class="wp_rp_title">Resultick：近半数营销人员认为“人工智能”的概念被滥用</a></li><li><a href="http://www.199it.com/archives/453682.html" rel="nofollow" class="wp_rp_title">浦发硅谷银行：2015大数据、人工智能演讲PPT</a></li><li><a href="http://www.199it.com/archives/680481.html" rel="nofollow" class="wp_rp_title">酷云互动：从现在到未来 大数据正在革新文娱产业</a></li><li><a href="http://www.199it.com/archives/441087.html" rel="nofollow" class="wp_rp_title">如何打造高性能大数据分析平台</a></li><li><a href="http://www.199it.com/archives/780984.html" rel="nofollow" class="wp_rp_title">大数据+咖啡因| 可口可乐的转型升级探索</a></li><li><a href="http://www.199it.com/archives/565733.html" rel="nofollow" class="wp_rp_title">Pew：算法时代七大主题</a></li><li><a href="http://www.199it.com/archives/364817.html" rel="nofollow" class="wp_rp_title">大数据100强：商业分析</a></li><li><a href="http://www.199it.com/archives/504255.html" rel="nofollow" class="wp_rp_title">从2016年魔力象限看全球大数据厂商风起云涌</a></li></ul></div></div>\n</div><div style="clear:both;"/>\');\n\n<p style="text-align:center;">\n<ins class="adsbygoogle" style="width:320px;"/>\n</p>\n            </div>');
insert into news_article_basic(article_id, user_id, channel_id, title, cover, status)values(5, 1, 1, '设计和架构：业务开发指导原则', '{"type":0, "images":[]}', 2);
insert into news_article_content(article_id, content) values(5,'<p>计划写一个系列文章，总结自己在四年iOS生涯中对设计模式和架构的理解。主要包括自己的总结、Apple源码和优秀三方开源项目中设计模式和架构的学习。</p>\n\n<blockquote>\n<p>这只是自己的总结，每人理解不一样。希望能抛砖引玉，让大家加深理解。</p>\n</blockquote>\n<h2 class="heading" data-id="heading-0">业务与重构</h2>\n<p>系列中的第一篇文章主要介绍自己在码业务时的一个指导思想，主要解决在<strong>快速开发</strong>过程中最常遇见的2个问题：</p>\n<ul>\n<li>业务开发中如何避免过度设计？</li>\n<li>何时需要重构？</li>\n</ul>\n<p>为什么会有这样的问题？ 通常我们的版本是呈现出<strong>小步迭代</strong>、<strong>快速开发</strong>的开发规划，主要就是功能多，开发快。所以就会要求我们在码业务时：尽量快速的开发功能，同时又要追求高质量的代码。在一段时候后业务越堆越多再去添加新功能越来越麻烦，又需要我们重构代码。这些问题是非常矛盾的，我们如何去判断何时该进行代码抽象？何时又该去重构？</p>\n<blockquote>\n<p>God, Grant me</p>\n<p>the serenity to accept the thing I cannot change,</p>\n<p>the courage to change the thing I can change,</p>\n<p>and wisdom to separate the difference.</p>\n</blockquote>\n<h2 class="heading" data-id="heading-1">业务开发中如何避免过度设计？</h2>\n<h3 class="heading" data-id="heading-2">DRY原则</h3>\n<p><a target="_blank" href="https://link.juejin.im?target=https%3A%2F%2Fen.wikipedia.org%2Fwiki%2FDon%2527t_repeat_yourself" rel="nofollow noopener noreferrer">DRY原则</a>是Don\'t repeat yourself 的缩写，DRY原则想要表达的是：系统内的每一个知识点都应该是单一，明确，权威的标识。同样的功能不应该重复多份实现，应该提取成一个共用的功能。</p>\n<h3 class="heading" data-id="heading-3">YAGNI原则</h3>\n<p><a target="_blank" href="https://link.juejin.im?target=https%3A%2F%2Fen.wikipedia.org%2Fwiki%2FYou_aren%2527t_gonna_need_it" rel="nofollow noopener noreferrer">YAGNI原则</a>是You aren\'t gonna need it 的缩写，YAGNI原则主要含义是：不要添加多余功能除非那是必需的。</p>\n<h3 class="heading" data-id="heading-4">Rule Of Three原则</h3>\n<p><a target="_blank" href="https://link.juejin.im?target=https%3A%2F%2Fen.wikipedia.org%2Fwiki%2FRule_of_three_(computer_programming)" rel="nofollow noopener noreferrer">Rule Of Three原则</a>是指当一个功能直到第三次出现时，才进行功能提取。为什么是三次？在数学领域如果要提取一个模型：</p>\n<pre><code class="hljs bash copyable" lang="bash">Complete the pattern:\n1, 2, _, _, _, _\n<span class="copy-code-btn">复制代码</span></code></pre><p>当这个模型只出现2次时，推导完整的模型是非常不清晰的，依靠出现2次的话可能有以下模型：</p>\n<pre><code class="hljs bash copyable" lang="bash">1. x2 模型\n1, 2, 4, 8, 16, 32\n<span class="copy-code-btn">复制代码</span></code></pre><pre><code class="hljs bash copyable" lang="bash">2. +1 模型\n1, 2, 3, 4, 5, 6\n<span class="copy-code-btn">复制代码</span></code></pre><p>如果出现3次才进行模型提取：</p>\n<pre><code class="hljs bash copyable" lang="bash">Complete the pattern:\n1, 2, 3, _, _, _\n<span class="copy-code-btn">复制代码</span></code></pre><p>这个时候得到的模型将更加清晰，只会是+1模型。通过第三次重复才开始提取能更加确定这个模型，在代码中同样适用这个理论，这样能避免提取错误模式情况下的浪费时间。</p>\n<blockquote>\n<p>计算机领域其实有很多地方有3这个数字，比如HTTP需要最少3次握手才能建立信任关系下的稳定连接。并不是说大于3次不行当然是越多越好，但是3次是最少的次数。</p>\n</blockquote>\n<h3 class="heading" data-id="heading-5">总结</h3>\n<p>软件开发中如果不依靠这些原则，假设有足够的经验和直觉下：</p>\n<p>我们只看到一次出现的代码就进行抽象，这可能非常耗时因为特定场景的不同很多细节也有差异，这些差异会出现在抽象代码中，你的经验和直觉可以给出更好的设计，但还是有风险。所以现在只管去做先不要抽象。</p>\n<p>第二次出现就抽象能让我们更好的了解哪些细节需要出现在抽象代码中，哪些不需要。但是抽象模型不够清晰，可能在第三次出现时需要大量修改逻辑，这样还是很费时。所以在第二次重复出现时不去抽象非常让人反感，但是还是可以非常快的copy过去进行修改。</p>\n<p>第三次出现再抽象，基本魔板已经确定，所有细节哪些需要抽象哪些不需要的也能确定。哪怕第四次出现的偏差也能快速确定是否需要抽象，快速调整。</p>\n<p>上面介绍的三个原则相互补充，尽可能完善的指导我们何时才需要对代码进行抽象。帮助我们快速开发，节约时间。</p>\n<h2 class="heading" data-id="heading-6">何时重构？</h2>\n<p>什么是重构？有两种解释：</p>\n<blockquote>\n<p>重构（名词）：对软件内部结构的一种调整，<strong>目的是</strong>在<strong>不改变软件可观察行为的前提下</strong>，提高其可<strong>理解性</strong>，<strong>降低其修改成本</strong>。</p>\n<p>重构（动词）：使用一系列重构手法，<strong>在不改变软件可观察行为的前提下</strong>，调整其<strong>结构</strong>。</p>\n</blockquote>\n<p>何时重构？</p>\n<ol>\n<li>添加功能时重构</li>\n</ol>\n<blockquote>\n<p>我无法理解之前的代码。</p>\n<p>代码的设计无法帮助我们轻松添加我嗦需要的特性。</p>\n</blockquote>\n<ol start="2">\n<li>修复Bug时重构</li>\n</ol>\n<blockquote>\n<p>代码结构复杂不容易看出bug，这时重构能帮助我们理清逻辑。快速看出Bug。</p>\n</blockquote>\n<ol start="3">\n<li>review代码时重构</li>\n</ol>\n<blockquote>\n<p>review是很有价值的事，在review过程中可以阅读其他人的代码提出更多恰当的建议。同时重构能帮助我们更好的理解代码，提出更有意义的代码。但要记住一个团队中保留多个意见也是很有必要的。</p>\n</blockquote>\n<p>以上重构时间排列是有先后顺序，同时重构前需要有足够的测试用例或单元测试支撑。重构遍布在每个版本开发过程中。</p>\n<p><em>以上引用内容摘自<a target="_blank" href="https://link.juejin.im?target=https%3A%2F%2Fbook.douban.com%2Fsubject%2F4262627%2F" rel="nofollow noopener noreferrer">《重构 改善既有代码的设计》</a>，非常推荐。</em></p>\n<h2 class="heading" data-id="heading-7">总结</h2>\n<p>过度设计非常浪费时间，想半天可能再最后全盘推翻。绞尽脑汁，封装极好的模块可能就一个地方在使用。</p>\n<p>重构是软件开发过程中不可缺少的一环，重构应该伴随在整个版本开发过程。</p>\n<p>希望上面两点总结，能对大家有用。:)</p>\n<h2 class="heading" data-id="heading-8">参考</h2>\n<p><a target="_blank" href="https://link.juejin.im?target=https%3A%2F%2Fbook.douban.com%2Fsubject%2F1152111%2F" rel="nofollow noopener noreferrer">《程序员修炼之道》</a></p>\n<p><a target="_blank" href="https://link.juejin.im?target=https%3A%2F%2Flostechies.com%2Fderickbailey%2F2012%2F10%2F31%2Fabstraction-the-rule-of-three%2F" rel="nofollow noopener noreferrer">Abstraction: The Rule Of Three</a></p>\n<p><a target="_blank" href="https://link.juejin.im?target=https%3A%2F%2Fbook.douban.com%2Fsubject%2F4262627%2F" rel="nofollow noopener noreferrer">《重构 改善既有代码的设计》</a></p>\n<p/><figure><img class="lazyload" data-src="https://user-gold-cdn.xitu.io/2018/11/7/166eb79c0f683d6c?imageView2/0/w/1280/h/960/ignore-error/1" data-width="322" data-height="376"/><figcaption/></figure><p/>');
insert into news_article_basic(article_id, user_id, channel_id, title, cover, status)values(6, 1, 1, '90% 以上的独立开发者，败在了认知环节', '{"type":0, "images":[]}', 2);
insert into news_article_content(article_id, content) values(6,'<h1 class="heading" data-id="heading-0">所谓 “独立开发者”，所谓 “独立开发”</h1>\n<p>因为笔者目前的主要收入来自于独立开发，我身边的人、我写的内容的读者也很多是独立开发者，所以为了让大家都知道我在谈什么，我经常提 “独立开发” 这个词。</p>\n<p>但我一直觉得这个词不准确。**“独立开发者” 和 “独立产品人” 是两类人。**我对自己的定位，至少是后者。</p>\n<p>独立开发者，意思是 “一个人开发”，或者团队特别小，不同于公司里面的 “一群人开发”。但是开发之外的事情呢，怎么营销、产品怎么迭代、用户如何运营，这个概念没有提。不提，就是说，可能有，可能没有。</p>\n<p>开发以外的工作，如果没有的话，那么这事就不可能成为职业，因为你总要吃饭，而代码写完了，项目不会自己变成钱。<strong>到此为止，产出的东西，叫 Project，而不是 Product。Project 是面向生产者的，Product 才是面向用户、面向市场的。</strong></p>\n<p>开发以外的工作，如果有的话，虽然也不一定能赚钱（这是赚钱的必要条件，不是充分条件），但是你做的事情，性质变了，因为你在做产品，而不是在做项目了。**这算 “独立产品人”。**开发，进而变成一个次要因素，因为你可以先有想法，再现学编程，甚至把代码工作外包出去也可以，甚至小项目让朋友周末抽空搞一下也可以。</p>\n<p>很多人会觉得，“我本行就是程序员，活了二十几年了，除了写代码也不会别的。这才做了独立开发，别的我也不会”。<strong>这就是认知问题，在产品背后，这个角色是 “程序员”，这样的认知，只能支撑起兴趣，无法支撑起饭碗。</strong></p>\n<p>也就是说，你做不做开发以外的工作（后面再谈怎么做这些工作），和你能不能赚钱挂钩。你可以选择不赚，但是如果你准备赚钱，却又只干写代码的活，一定出问题。</p>\n<h1 class="heading" data-id="heading-1">一句话暴露程序员身份</h1>\n<p>有很多独立开发者，甚至包括那些赚了点钱的开发者，都没觉得自己该去做营销一类的工作。更多准备做独立开发的人，更是觉得 “技术好的，做独立开发赚的钱就多”。聊得多了之后，我发现有些人，基本上一句话就暴露了自己程序员的身份。</p>\n<blockquote>\n<p>“你这 App 排名这么高，真厉害，用啥语言写的啊？” —— “法拉利跑这么快，是不是因为经常刷红色的漆？”</p>\n</blockquote>\n<blockquote>\n<p>“xx 是阿里的技术大神，这东西他都没做成，估计这块市场竞争太激烈” —— “马云短跑成绩不行，是不是短跑不适合人类？”</p>\n</blockquote>\n<blockquote>\n<p>“为啥搜同一个词，你这 App 排在前面，我那个十好几名” —— “ASO 是一个行业，任何一个 App 的关键词搜索问题，都能写出一份至少两页纸的报告。”</p>\n</blockquote>\n<p>不是说谈产品一定要避开技术，而是对于 ”App 卖得好“ 这样的事情，要学会归因。至于还有人问 App 代码托管在哪个仓库的，这种就已经属于噪音了。</p>\n<p>比如一款应用，没有复杂的运营、销售手段长期支持，就一直稳定在 App Store 榜单高位，可能和产品本身口碑效应有关，可能是它占据了某些搜索指数较高的关键词（App Store 65% 的流量来自于搜索），也可能它本身在某一个细分领域没有很强的竞争对手，导致各种微信公众号一旦推荐 App，小编写无可写，只能写它。甚至还有些做得好的，深得 App Store 编辑喜爱的产品，经常性地拿到 App Store 的推荐，这种应用也是流量不断。</p>\n<p>又比如有的 App，平时没啥流量，突然销量猛增，这种明显就是外力作用。你可以问一下他是不是找了谁来推荐，做了什么活动。从这可以获取到的信息是，给他推荐的公众号、微博、抖音号等等，这些渠道你是不是可以要来联系方式，也尝试合作。</p>\n<p>还比如有些细节技巧，比如一款 App 你觉得做得挺一般的，但是 App Store 评分竟然 4.9（满分 5），你可以问一下是不是花钱刷了评分，又或者是不是有别的技巧。</p>\n<p><strong>这个过程，就叫归因。有归因、发问、探究的能力，才能建立起独立产品人的认知。</strong></p>\n<p><strong>否则总是以程序员的角度、以技术的角度来谈产品，只能说明你只懂技术，需要恶补其他内容。</strong></p>\n<p><strong>做产品的时候，总是暴露自己程序员的身份，是要出问题的。</strong></p>\n<h1 class="heading" data-id="heading-2">先改心态，再谈认知</h1>\n<p>前两天见了位投资人，聊天的时候谈到 ”趣头条“。我不太了解趣头条，对方开了个头，说趣头条满足了八线小城市里面一些人，想平时没事赚点小钱的心理，比如你看几十秒文章，就给你 5 毛钱。</p>\n<p>我反应到的第一件事是 ROI（投资回报率），因为如果 ”看文章就给钱“ 这事变成核心的一个点，那这件事应该长期的，而不是短期烧钱。而如果产品靠这个赚钱，他们就一定能保证，分你 5 毛钱的同时，平台拿到了至少 6 毛钱，你看文章看得越多，平台赚的越多。</p>\n<p>我平时干的也是类似的事情，给 App 投放 ASM 广告，如果一个 CPA（客单价）是一美刀，那么我必须保证我的 App 可以从每个用户身上赚到一美刀才行，如果付费率是 10%，那么每个付费用户就要出 10 美刀，才能平摊其他免费用户的成本。进而投广告有可能降低我的 App 用户付费率，所以我还要再估计一下它对我可接受的 CPA 的影响 ……</p>\n<p><strong>这是一个很简单的例子，但是它体现的一个事情是，我在做销售、我在做增长、我在做运营，我没有体现出，“我是一个程序员” 这件事情。所以哪怕我作为创业者不合格，但我有入场券，纯技术人是没有入场券的。</strong></p>\n<p>如果我一直是一个纯技术人的心态，坚信编程改变世界，对方说商业模式的时候，我说趣头条做的 nb 是因为他们的技术硬，后台可支持的 QPS 和 TPS （代表服务器承压能力）极高，那应该就没有然后了。</p>\n<p>虽然最后我还是受了打击，其中一个原因是我在团队建设、股权分配等方面表现很不成熟，不像是一个成熟的创业者。</p>\n<p/><figure><img class="lazyload" data-src="https://user-gold-cdn.xitu.io/2018/11/6/166e6d955610cacc?imageView2/0/w/1280/h/960/ignore-error/1" data-width="1280" data-height="1280"/><figcaption/></figure><p/>\n<p>但我当天晚上就在京东下单，更新了一下我的书架。我的心态从一个较有经验的产品人，变成一个入门的创业准备者。</p>\n<p>截止到我写这篇文章的时候，两本纸质书 + 一本电子书，已经刷完了。再有人问我股权分配问题的时候，我可能依然表现不成熟，但我不再是一无所知的状态了，我知道如何提出一个不蠢的问题。</p>\n<p>我觉得改心态，就是这么个事了。三年前，我彻底放下了 Geek 的包袱，抛弃了 “编程改变世界” 的所谓信仰（不要钻牛角尖，没有说技术不重要的意思）。三年后的今天，我放下 “产品为王，亲力亲为” 的包袱，产品继续做，开始恶补创业和管理的能力。</p>\n<p><strong>先改心态，再谈认知。</strong></p>\n<p>**革新认知，胜过天道酬勤。**再说白一点，作为开发者，觉得自己的产品没销量的时候，多看看书、取取经、刷刷 “鸟哥笔记” 也好，别总是习惯性打开 IDE 优化性能、整理代码，没人关心这个。</p>\n<h1 class="heading" data-id="heading-3">屌丝与不屌丝</h1>\n<p>这一段的内容，我觉得可能很多读者不会认同我，甚至觉得我跑题了，但我还是要写。<strong>因为我觉得人的问题，最终会反应到产品上，反应到收入上。</strong></p>\n<p>身边有很多互联网从业者，什么工种都有，其中很多人不认可拼多多、不认可 OPPO/VIVO，觉得内涵段子屌丝，觉得腾讯“抄袭”其他产品影响了创新环境 …… 但你真要是给他一个 OPPO 手机，他也要；腾讯真要是给他发一个 offer，他也去。我觉得这种不接地气，“端着”、不愿和屌丝同流合污的人，才是屌丝。</p>\n<p>最终做事的时候就是体现在：比如说给 App 改个标题蹭热点来涨涨销量，比如说让用户天天打开 App 来打卡、累计积分发个虚拟头衔 …… 这些比较 ”low“ 的事他不愿意干。他觉得这是为了钱，丢了格调。他觉得这种行为太屌丝。我觉得干这些事不屌丝，不干这些事的人也不屌丝。<strong>但是明明没钱、明明没销量、明明不知道怎么运营，还坚持不接地气的开发者、产品人，这些人太屌丝。</strong></p>\n<p>这些人觉得让用户来 App 打卡，就没 B 格，是浪费用户时间，是让世界变差了一点点。但是用户不这么想啊 …… **经济学讲交易产生财富。什么手段他都觉得是鸡贼，导致产品没人用。没人买单，就是代码写出花来也没创造价值。**OPPO/VIVO 就是接地气，就是创造了价值。没创造价值的人，反而跑来谴责他们，谁是屌丝呢 ……</p>\n<p>还有说拼多多全是假货的。**交易产生财富。交易成本越低，越有利于创造财富。在当下的中国，如果电商平台需要承担验货的责任，那么基本上就可以关门了。让市场来解决问题，让商家之间互相竞争，争取口碑，才是市场化的解决方案。**那些觉得自己不屌丝，天天骂拼多多无良的，反而是不懂经济学基本原理的屌丝。</p>\n<p>那么衡量一件事是坑爹，还是接地气的标准是什么呢？</p>\n<p>我觉得没有标准。各自为各自的行为负责就好了。卖假货的如果坚持卖了 100 年，不是他的错，是市场制度容不下真货。卖假货的如果被打败了，就要用金钱来为冒险买单。</p>\n<p>所以如果有一天，某个独立开发者的作品被抄袭了，还被抄袭者抢了饭碗。不应该觉得委屈，明明有先发优势、竟然被后来者抢了饭碗，竟然还不能自保。那岂不是应该学习一下对方，检讨一下自己。</p>\n<h1 class="heading" data-id="heading-4">划重点</h1>\n<ul>\n<li>\n<p>90% 以上的独立开发者，败在了认知环节</p>\n</li>\n<li>\n<p>改变心态，放下自己熟悉的技术角色，才能去谈产品的认知</p>\n</li>\n<li>\n<p>尝试去做专业的独立产品人，胜过成为一个勤勉的独立开发者</p>\n</li>\n<li>\n<p>格局大一点，身段低一点，远离屌丝的心态与思维</p>\n</li>\n</ul>\n<p>那么，怎么远离屌丝思维、升级产品认知，成为更好的独立产品人呢？有两个可行性建议：）</p>\n<ol>\n<li>关注我的微信公众号【KyXu 独立开发】，ID：KyXuIndie</li>\n<li>来看看我的专栏，持续学习：<a target="_blank" href="https://link.juejin.im?target=https%3A%2F%2Fxiaozhuanlan.com%2FkyxuDev" rel="nofollow noopener noreferrer">xiaozhuanlan.com/kyxuDev</a></li>\n</ol>');
insert into news_article_basic(article_id, user_id, channel_id, title, cover, status)values(7, 1, 1, 'SVG Path路径在网页开发的作用', '{"type":0, "images":[]}', 2);
insert into news_article_content(article_id, content) values(7,'<p>SVG是矢量图形表示，它的一个强大之处在于path标签可以表示任意的矢量形状，利用好这个path可以做出很多传统html/css做不出来的效果。下面举几个例子。</p>\n<h2>1. 做路径动画</h2>\n<p>这个我在《<a href="https://fed.renren.com/2018/03/31/svg-animate/#svg-move-by-path">SVG导航下划线光标跟随效果</a>》文后补充介绍了这个实现，最后的效果是这样的：</p>\n<p><img src="http://fed.renren.com/wp-content/uploads/2018/03/6.gif"/></p>\n<p>实现代码如下：</p>\n<p><img src="https://www.yinchengli.com/wp-content/uploads/2018/06/1-1.png" alt="" width="622" height="320"/></p>\n<p>利用animateMotion结合path做的动画，具体说明可见上文。</p>\n<h2>2. 实现不规则形状的点击</h2>\n<p>如下图所示，需要实现点到哪个洲就进入哪个洲的效果，例如点到非洲就进入非洲：</p>\n<p><img src="https://www.yinchengli.com/wp-content/uploads/2018/06/4-1.png" alt="" width="215" height="198"/></p>\n<p>我们可以用div定一个框盖在非洲的上面，但是用div的话只能是规则的四方形，没办法实现点到非洲大陆的时候才进入，但是大陆的轮廓又是不规则的，所以用传统html是不能解决这个问题的。但是用SVG的path可以解决这个问题，方法1是监听path的点击事件即可，如下图所示：</p>\n<p><img src="https://www.yinchengli.com/wp-content/uploads/2018/06/2-1.png" alt="" width="325" height="208"/></p>\n<p>因为这个轮廓可以跟UI要到，他们一般都是用AI/PS等矢量软件画出来的，让他们导一个SVG给你就好了。</p>\n<p>方法2是可以调SVG的isPointInFill这个API判断点击的点是否在Path的fill区域里面，这个也可以实现，但是相对于方法1来说比较麻烦，因为还需要把鼠标的位置转换为svg视图的位置。</p>\n<h2>3. 沿着路径拖拽的交互</h2>\n<p>在第1点沿着路径的动画是自动的过程，有没有办法让用户自己拖拽过去呢，实现如下效果：</p>\n<p><img src="https://www.yinchengli.com/wp-content/uploads/2018/06/svg-move-path.gif" alt="" width="442" height="148"/></p>\n<p>这种的场景有音量控制等需要有百分比控制的。可以先用一个<a href="http://editor.method.ac/">SVG的在线工具</a>画出一个这样的图形：</p>\n<p><img src="https://www.yinchengli.com/wp-content/uploads/2018/06/5.png" alt="" width="417" height="135"/></p>\n<p>就可以拿到SVG的代码：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4b2cfe64c8255103014" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\n&lt;svg class="volumn-controller" width="580" height="400" xmlns="http://www.w3.org/2000/svg"&gt;&#13;\n    &lt;path class="volumn-path" stroke="#000" d="m100,247c93,-128 284,-129 388,6" opacity="0.5" stroke-width="1" fill="#fff"/&gt;&#13;\n    &lt;circle class="drag-button" r="12" cy="247" cx="100" stroke-width="1" stroke="#000" fill="#fff"/&gt;&#13;\n &lt;/g&gt;&#13;\n&lt;/svg&gt;</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4b2cfe64c8255103014-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b2cfe64c8255103014-2">2</div><div class="crayon-num" data-line="crayon-5be4b2cfe64c8255103014-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b2cfe64c8255103014-4">4</div><div class="crayon-num" data-line="crayon-5be4b2cfe64c8255103014-5">5</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4b2cfe64c8255103014-1"><span class="crayon-o">&lt;</span><span class="crayon-e">svg </span><span class="crayon-t">class</span><span class="crayon-o">=</span><span class="crayon-s">"volumn-controller"</span><span class="crayon-h"> </span><span class="crayon-v">width</span><span class="crayon-o">=</span><span class="crayon-s">"580"</span><span class="crayon-h"> </span><span class="crayon-v">height</span><span class="crayon-o">=</span><span class="crayon-s">"400"</span><span class="crayon-h"> </span><span class="crayon-v">xmlns</span><span class="crayon-o">=</span><span class="crayon-s">"http://www.w3.org/2000/svg"</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b2cfe64c8255103014-2"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-o">&lt;</span><span class="crayon-e">path </span><span class="crayon-t">class</span><span class="crayon-o">=</span><span class="crayon-s">"volumn-path"</span><span class="crayon-h"> </span><span class="crayon-v">stroke</span><span class="crayon-o">=</span><span class="crayon-s">"#000"</span><span class="crayon-h"> </span><span class="crayon-v">d</span><span class="crayon-o">=</span><span class="crayon-s">"m100,247c93,-128 284,-129 388,6"</span><span class="crayon-h"> </span><span class="crayon-v">opacity</span><span class="crayon-o">=</span><span class="crayon-s">"0.5"</span><span class="crayon-h"> </span><span class="crayon-v">stroke</span><span class="crayon-o">-</span><span class="crayon-v">width</span><span class="crayon-o">=</span><span class="crayon-s">"1"</span><span class="crayon-h"> </span><span class="crayon-v">fill</span><span class="crayon-o">=</span><span class="crayon-s">"#fff"</span><span class="crayon-o">/</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5be4b2cfe64c8255103014-3"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-o">&lt;</span><span class="crayon-e">circle </span><span class="crayon-t">class</span><span class="crayon-o">=</span><span class="crayon-s">"drag-button"</span><span class="crayon-h"> </span><span class="crayon-v">r</span><span class="crayon-o">=</span><span class="crayon-s">"12"</span><span class="crayon-h"> </span><span class="crayon-v">cy</span><span class="crayon-o">=</span><span class="crayon-s">"247"</span><span class="crayon-h"> </span><span class="crayon-v">cx</span><span class="crayon-o">=</span><span class="crayon-s">"100"</span><span class="crayon-h"> </span><span class="crayon-v">stroke</span><span class="crayon-o">-</span><span class="crayon-v">width</span><span class="crayon-o">=</span><span class="crayon-s">"1"</span><span class="crayon-h"> </span><span class="crayon-v">stroke</span><span class="crayon-o">=</span><span class="crayon-s">"#000"</span><span class="crayon-h"> </span><span class="crayon-v">fill</span><span class="crayon-o">=</span><span class="crayon-s">"#fff"</span><span class="crayon-o">/</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b2cfe64c8255103014-4"><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">g</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5be4b2cfe64c8255103014-5"><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">svg</span><span class="crayon-o">&gt;</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0021 seconds] -->&#13;\n<p>这里比较关键的是path标签里的d属性，d是data的缩写，定义这个路径的形状，它里面可以用很多属性控制形状的变化，如下图所示：</p>\n<p><img src="https://www.yinchengli.com/wp-content/uploads/2018/06/7-1.png" alt="" width="590" height="49"/></p>\n<p>为了实现这个交互，需要动态地改变circle的圆心位置(cx, cy)到路径上相应的地方。SVG没有直接提供相关的API，但是它提供了一个可以间接利用的API叫getPointAtLength，传递一个长度参数，如下代码所示：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4b2cfe64d2603520949" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\nlet volumnPath = document.querySelector(\'.volumn-path\');&#13;\n// 输出path在长度为100的位置的点坐标&#13;\nconsole.log(volumnPath.getPointAtLength(100));&#13;\n// 输出当前path的总长度&#13;\nconsole.log(volumnPath.getTotalLength());</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4b2cfe64d2603520949-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b2cfe64d2603520949-2">2</div><div class="crayon-num" data-line="crayon-5be4b2cfe64d2603520949-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b2cfe64d2603520949-4">4</div><div class="crayon-num" data-line="crayon-5be4b2cfe64d2603520949-5">5</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4b2cfe64d2603520949-1"><span class="crayon-e">let </span><span class="crayon-v">volumnPath</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">document</span><span class="crayon-sy">.</span><span class="crayon-e">querySelector</span><span class="crayon-sy">(</span><span class="crayon-s">\'.volumn-path\'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b2cfe64d2603520949-2"><span class="crayon-c">// 输出path在长度为100的位置的点坐标</span></div><div class="crayon-line" id="crayon-5be4b2cfe64d2603520949-3"><span class="crayon-v">console</span><span class="crayon-sy">.</span><span class="crayon-e">log</span><span class="crayon-sy">(</span><span class="crayon-v">volumnPath</span><span class="crayon-sy">.</span><span class="crayon-e">getPointAtLength</span><span class="crayon-sy">(</span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b2cfe64d2603520949-4"><span class="crayon-c">// 输出当前path的总长度</span></div><div class="crayon-line" id="crayon-5be4b2cfe64d2603520949-5"><span class="crayon-v">console</span><span class="crayon-sy">.</span><span class="crayon-e">log</span><span class="crayon-sy">(</span><span class="crayon-v">volumnPath</span><span class="crayon-sy">.</span><span class="crayon-e">getTotalLength</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0010 seconds] -->&#13;\n<p>控制台输出：</p>\n<p><img src="https://www.yinchengli.com/wp-content/uploads/2018/06/8-1.png" alt="" width="459" height="29"/></p>\n<p>把circle的cx/cy改成上面的x/y坐标，圆圈就会跑到对应的位置去了：</p>\n<p><img src="https://www.yinchengli.com/wp-content/uploads/2018/06/9-1.png" alt="" width="356" height="66"/></p>\n<p>这里的问题在于这个API传递的length参数是相对于曲线长度的，但是鼠标移动的位置是线性的，没办法直接知道当前鼠标在曲线上距离起始位置多少。</p>\n<p>所以需要算一下，在这个场景里面我们可以取鼠标的x坐标在曲线上对应的位置就可以了，如下图示意：</p>\n<p><img src="https://www.yinchengli.com/wp-content/uploads/2018/06/10-1.png" alt="" width="377" height="136"/></p>\n<p>到这里就有思路了，可以把这条路径上每隔一个像素长度就算一下它的坐标在哪里，然后存在一个数组里面。由于鼠标移动的时候x坐标是知道的，就可以查一下在这个数组里面相应x坐标的y坐标是多少，就能得到想要的圆心位置了。</p>\n<p>所以先计算一下，保存到一个数组：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4b2cfe64d7384341300" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\nlet $volumnController = document.querySelector(\'.volumn-controller\'),&#13;\n    $volumnPath = $volumnController.querySelector(\'.volumn-path\');&#13;\n// 得到当前路径的总长度&#13;\nlet pathTotalLength = $volumnPath.getTotalLength() &gt;&gt; 0;&#13;\nlet points = [];&#13;\n// 起始位置为长度为0的位置&#13;\nlet startX = Math.round($volumnPath.getPointAtLength(0).x);&#13;\n// 每隔一个像素距离就保存一下路径上点的坐标&#13;\nfor (let i = 0; i &lt; pathTotalLength; i++) {&#13;\n    let p = $volumnPath.getPointAtLength(i);&#13;\n    // 保存的坐标用四舍五入，可以平衡误差&#13;\n    points[Math.round(p.x) - startX] = Math.round(p.y);&#13;\n}</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4b2cfe64d7384341300-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b2cfe64d7384341300-2">2</div><div class="crayon-num" data-line="crayon-5be4b2cfe64d7384341300-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b2cfe64d7384341300-4">4</div><div class="crayon-num" data-line="crayon-5be4b2cfe64d7384341300-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b2cfe64d7384341300-6">6</div><div class="crayon-num" data-line="crayon-5be4b2cfe64d7384341300-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b2cfe64d7384341300-8">8</div><div class="crayon-num" data-line="crayon-5be4b2cfe64d7384341300-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b2cfe64d7384341300-10">10</div><div class="crayon-num" data-line="crayon-5be4b2cfe64d7384341300-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b2cfe64d7384341300-12">12</div><div class="crayon-num" data-line="crayon-5be4b2cfe64d7384341300-13">13</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4b2cfe64d7384341300-1"><span class="crayon-i">let</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">volumnController</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">document</span><span class="crayon-sy">.</span><span class="crayon-e">querySelector</span><span class="crayon-sy">(</span><span class="crayon-s">\'.volumn-controller\'</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b2cfe64d7384341300-2"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-sy">$</span><span class="crayon-v">volumnPath</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">volumnController</span><span class="crayon-sy">.</span><span class="crayon-e">querySelector</span><span class="crayon-sy">(</span><span class="crayon-s">\'.volumn-path\'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5be4b2cfe64d7384341300-3"><span class="crayon-c">// 得到当前路径的总长度</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b2cfe64d7384341300-4"><span class="crayon-e">let </span><span class="crayon-v">pathTotalLength</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">volumnPath</span><span class="crayon-sy">.</span><span class="crayon-e">getTotalLength</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">&gt;&gt;</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5be4b2cfe64d7384341300-5"><span class="crayon-e">let </span><span class="crayon-v">points</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b2cfe64d7384341300-6"><span class="crayon-c">// 起始位置为长度为0的位置</span></div><div class="crayon-line" id="crayon-5be4b2cfe64d7384341300-7"><span class="crayon-e">let </span><span class="crayon-v">startX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">Math</span><span class="crayon-sy">.</span><span class="crayon-e">round</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">volumnPath</span><span class="crayon-sy">.</span><span class="crayon-e">getPointAtLength</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-v">x</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b2cfe64d7384341300-8"><span class="crayon-c">// 每隔一个像素距离就保存一下路径上点的坐标</span></div><div class="crayon-line" id="crayon-5be4b2cfe64d7384341300-9"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-i">let</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-h"> </span><span class="crayon-v">pathTotalLength</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-o">++</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b2cfe64d7384341300-10"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-i">let</span><span class="crayon-h"> </span><span class="crayon-v">p</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">volumnPath</span><span class="crayon-sy">.</span><span class="crayon-e">getPointAtLength</span><span class="crayon-sy">(</span><span class="crayon-v">i</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5be4b2cfe64d7384341300-11"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-c">// 保存的坐标用四舍五入，可以平衡误差</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b2cfe64d7384341300-12"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-v">points</span><span class="crayon-sy">[</span><span class="crayon-v">Math</span><span class="crayon-sy">.</span><span class="crayon-e">round</span><span class="crayon-sy">(</span><span class="crayon-v">p</span><span class="crayon-sy">.</span><span class="crayon-v">x</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">startX</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">Math</span><span class="crayon-sy">.</span><span class="crayon-e">round</span><span class="crayon-sy">(</span><span class="crayon-v">p</span><span class="crayon-sy">.</span><span class="crayon-v">y</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5be4b2cfe64d7384341300-13"><span class="crayon-sy">}</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0034 seconds] -->&#13;\n<p>这里用一个p0ints数组来保存，它的索引index就为x坐标，值为y坐标。在这个例子里面，总长度为451.5px，得到的points数组长度为388. 你可以隔0.5px长度就保存一个坐标，不过在这个例子里面1px就够了。</p>\n<p>然后监听鼠标事件，得到x坐标，查询y坐标，动态地改变circle的圆心位置，如下代码所示：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4b2cfe64db146538534" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\nlet $dragButton = $volumnController.querySelector(\'.drag-button\'),&#13;\n    // 得到起始位置相对当前视窗的位置，相当于jQuery.fn.offset&#13;\n    dragButtonPos = $dragButton.getBoundingClientRect();&#13;\nfunction movePoint (event) {&#13;\n    // 当前鼠标的位置减去圆心起始位置就得到移位偏差，12是半径值，这里先直接写死&#13;\n    let diffX = event.clientX - Math.round(dragButtonPos.left + 12);&#13;\n    // 需要做个边界判断&#13;\n    diffX &lt; 0 &amp;&amp; (diffX = 0);&#13;\n    diffX &gt;= points.length &amp;&amp; (diffX = points.length - 1);&#13;\n    // startX是在上面的代码得到的长度为0的位置&#13;\n    $dragButton.setAttribute(\'cx\', diffX + startX);&#13;\n    // 使用points数组得到y坐标&#13;\n    $dragButton.setAttribute(\'cy\', points[diffX]);&#13;\n}&#13;\n$dragButton.addEventListener(\'mousedown\', function (event) {&#13;\n    document.addEventListener(\'mousemove\', movePoint);&#13;\n});&#13;\ndocument.addEventListener(\'mouseup\', function () {&#13;\n    document.removeEventListener(\'mousemove\', movePoint);&#13;\n});</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4b2cfe64db146538534-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b2cfe64db146538534-2">2</div><div class="crayon-num" data-line="crayon-5be4b2cfe64db146538534-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b2cfe64db146538534-4">4</div><div class="crayon-num" data-line="crayon-5be4b2cfe64db146538534-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b2cfe64db146538534-6">6</div><div class="crayon-num" data-line="crayon-5be4b2cfe64db146538534-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b2cfe64db146538534-8">8</div><div class="crayon-num" data-line="crayon-5be4b2cfe64db146538534-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b2cfe64db146538534-10">10</div><div class="crayon-num" data-line="crayon-5be4b2cfe64db146538534-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b2cfe64db146538534-12">12</div><div class="crayon-num" data-line="crayon-5be4b2cfe64db146538534-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b2cfe64db146538534-14">14</div><div class="crayon-num" data-line="crayon-5be4b2cfe64db146538534-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b2cfe64db146538534-16">16</div><div class="crayon-num" data-line="crayon-5be4b2cfe64db146538534-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b2cfe64db146538534-18">18</div><div class="crayon-num" data-line="crayon-5be4b2cfe64db146538534-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b2cfe64db146538534-20">20</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4b2cfe64db146538534-1"><span class="crayon-i">let</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">dragButton</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">volumnController</span><span class="crayon-sy">.</span><span class="crayon-e">querySelector</span><span class="crayon-sy">(</span><span class="crayon-s">\'.drag-button\'</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b2cfe64db146538534-2"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-c">// 得到起始位置相对当前视窗的位置，相当于jQuery.fn.offset</span></div><div class="crayon-line" id="crayon-5be4b2cfe64db146538534-3"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-v">dragButtonPos</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">dragButton</span><span class="crayon-sy">.</span><span class="crayon-e">getBoundingClientRect</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b2cfe64db146538534-4"><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-e">movePoint</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">event</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5be4b2cfe64db146538534-5"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-c">// 当前鼠标的位置减去圆心起始位置就得到移位偏差，12是半径值，这里先直接写死</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b2cfe64db146538534-6"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-e">let </span><span class="crayon-v">diffX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">event</span><span class="crayon-sy">.</span><span class="crayon-v">clientX</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">Math</span><span class="crayon-sy">.</span><span class="crayon-e">round</span><span class="crayon-sy">(</span><span class="crayon-v">dragButtonPos</span><span class="crayon-sy">.</span><span class="crayon-v">left</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">12</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5be4b2cfe64db146538534-7"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-c">// 需要做个边界判断</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b2cfe64db146538534-8"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-v">diffX</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-o">&amp;&amp;</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">diffX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5be4b2cfe64db146538534-9"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-v">diffX</span><span class="crayon-h"> </span><span class="crayon-o">&gt;=</span><span class="crayon-h"> </span><span class="crayon-v">points</span><span class="crayon-sy">.</span><span class="crayon-v">length</span><span class="crayon-h"> </span><span class="crayon-o">&amp;&amp;</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">diffX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">points</span><span class="crayon-sy">.</span><span class="crayon-v">length</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b2cfe64db146538534-10"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-c">// startX是在上面的代码得到的长度为0的位置</span></div><div class="crayon-line" id="crayon-5be4b2cfe64db146538534-11"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-sy">$</span><span class="crayon-v">dragButton</span><span class="crayon-sy">.</span><span class="crayon-e">setAttribute</span><span class="crayon-sy">(</span><span class="crayon-s">\'cx\'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">diffX</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">startX</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b2cfe64db146538534-12"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-c">// 使用points数组得到y坐标</span></div><div class="crayon-line" id="crayon-5be4b2cfe64db146538534-13"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-sy">$</span><span class="crayon-v">dragButton</span><span class="crayon-sy">.</span><span class="crayon-e">setAttribute</span><span class="crayon-sy">(</span><span class="crayon-s">\'cy\'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">points</span><span class="crayon-sy">[</span><span class="crayon-v">diffX</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b2cfe64db146538534-14"><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5be4b2cfe64db146538534-15"><span class="crayon-sy">$</span><span class="crayon-v">dragButton</span><span class="crayon-sy">.</span><span class="crayon-e">addEventListener</span><span class="crayon-sy">(</span><span class="crayon-s">\'mousedown\'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">event</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b2cfe64db146538534-16"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-v">document</span><span class="crayon-sy">.</span><span class="crayon-e">addEventListener</span><span class="crayon-sy">(</span><span class="crayon-s">\'mousemove\'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">movePoint</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5be4b2cfe64db146538534-17"><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b2cfe64db146538534-18"><span class="crayon-v">document</span><span class="crayon-sy">.</span><span class="crayon-e">addEventListener</span><span class="crayon-sy">(</span><span class="crayon-s">\'mouseup\'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5be4b2cfe64db146538534-19"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-v">document</span><span class="crayon-sy">.</span><span class="crayon-e">removeEventListener</span><span class="crayon-sy">(</span><span class="crayon-s">\'mousemove\'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">movePoint</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b2cfe64db146538534-20"><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0041 seconds] -->&#13;\n<p>这个实现的代码也是比较简单，需要注意的地方是起始位置的选取，这里有两个坐标系，一个是相对页面的视窗的，它的原点(0, 0)坐标点是当前页面可视区域（client）的左上角，第二个坐标系是SVG的坐标系，它的原点(0, 0)位置是SVG画布的左上角，如下图所示：</p>\n<p><img src="https://www.yinchengli.com/wp-content/uploads/2018/06/11-1.png" alt="" width="455" height="328"/></p>\n<p>鼠标的位置是相对于视图client的，所以需要得到圆圈在client的位置，可以通过原生的getBoundingClient获取，然后用鼠标的clientX减掉圆圈的clientX就得到正确的位移偏差diff了，这个diff值加上圆圏的在svg坐标的起始位置就能得到svg里的x坐标了，然后去查一下points数组就能得到y坐标，然后去设置circle的cx/cy值。</p>\n<p>这个的实现已经算是十分简单的，大概30行代码。需要注意的是如果svg缩放了，那么坐标也要相应比例地改一下。所以最好是不要缩放，1：1显示就简单多了。</p>\n<p>如果要显示具体的音量值呢？这个也好办，只需要在第一步保存点坐标的时候把在路径上的长度也保存下来就好了，最后效果如下：</p>\n<p><img src="https://www.yinchengli.com/wp-content/uploads/2018/06/svg-move-path-3.gif" alt="" width="432" height="223"/></p>\n<p>一个完整的demo：<a href="https://www.yinchengli.com/html/demo/svg-path-drag.html">svg-path-drag.html</a></p>\n<p>如果路径比较复杂怎么办呢，一个x坐标可能会对应两个点，如下图所示：</p>\n<p><img src="https://www.yinchengli.com/wp-content/uploads/2018/06/12-1.png" alt="" width="350" height="267"/></p>\n<p>这个也是有办法的，计算的方法类似，也是需要把路径上所有每隔1px的点坐标都取出来，然后计算一下鼠标的位置距离哪个点的坐标最接近，然后就取那个点就好了。当然在判断哪个点最优时，算法需要优化，不能直接一个for循环，具体可见这个<a href="https://codepen.io/osublake/pen/YYemRa">codepen</a>。</p>\n<h2>4. 路径的变形动画</h2>\n<p>路径结合关键帧可以做出一些有趣的效果，如这个<a href="https://codepen.io/chriscoyier/pen/NRwANp">codepen</a>的示例：</p>\n<p><img src="https://www.yinchengli.com/wp-content/uploads/2018/06/svg-path-animate.gif" alt="" width="282" height="290"/></p>\n<p>它的实现是hover的时候改变path的d值，然后做d的transition动画，如下代码：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4b2cfe64e1974058531" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-mixed-highlight" title="含多种语言"/><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\n&lt;svg viewBox="0 0 10 10" class="svg-1"&gt;&#13;\n  &lt;path d="M2,2 L8,8" /&gt;&#13;\n&lt;/svg&gt;&#13;\n&lt;style&gt;&#13;\n.svg-1:hover path {&#13;\n  d: path("M8,2 L2,8");&#13;\n}&#13;\npath {&#13;\n    transition: d 0.5s linear;&#13;\n}&#13;\n&lt;/style&gt;</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4b2cfe64e1974058531-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b2cfe64e1974058531-2">2</div><div class="crayon-num" data-line="crayon-5be4b2cfe64e1974058531-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b2cfe64e1974058531-4">4</div><div class="crayon-num" data-line="crayon-5be4b2cfe64e1974058531-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b2cfe64e1974058531-6">6</div><div class="crayon-num" data-line="crayon-5be4b2cfe64e1974058531-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b2cfe64e1974058531-8">8</div><div class="crayon-num" data-line="crayon-5be4b2cfe64e1974058531-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b2cfe64e1974058531-10">10</div><div class="crayon-num" data-line="crayon-5be4b2cfe64e1974058531-11">11</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4b2cfe64e1974058531-1"><span class="crayon-o">&lt;</span><span class="crayon-e">svg </span><span class="crayon-v">viewBox</span><span class="crayon-o">=</span><span class="crayon-s">"0 0 10 10"</span><span class="crayon-h"> </span><span class="crayon-t">class</span><span class="crayon-o">=</span><span class="crayon-s">"svg-1"</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b2cfe64e1974058531-2"><span class="crayon-h">\xa0\xa0</span><span class="crayon-o">&lt;</span><span class="crayon-i">path</span><span class="crayon-h"> </span><span class="crayon-v">d</span><span class="crayon-o">=</span><span class="crayon-s">"M2,2 L8,8"</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5be4b2cfe64e1974058531-3"><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-e">svg</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b2cfe64e1974058531-4"><span class="crayon-ta">&lt;style&gt;</span></div><div class="crayon-line" id="crayon-5be4b2cfe64e1974058531-5"><span class="crayon-k ">.svg-1:hover path </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b2cfe64e1974058531-6"><span class="crayon-h">\xa0\xa0</span><span class="crayon-e ">d</span><span class="crayon-sy">:</span><span class="crayon-h"> </span><span class="crayon-i ">path</span><span class="crayon-sy">(</span><span class="crayon-s">"M8,2 L2,8"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5be4b2cfe64e1974058531-7"><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b2cfe64e1974058531-8"><span class="crayon-k ">path </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5be4b2cfe64e1974058531-9"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-e ">transition</span><span class="crayon-sy">:</span><span class="crayon-h"> </span><span class="crayon-i ">d</span><span class="crayon-h"> </span><span class="crayon-i ">0.5s</span><span class="crayon-h"> </span><span class="crayon-i ">linear</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b2cfe64e1974058531-10"><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5be4b2cfe64e1974058531-11"><span class="crayon-ta">&lt;/style&gt;</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0020 seconds] -->&#13;\n<p>这种变形过渡动画是有条件的，就是它的路径数据格式是要一致的，有多少个M/L/C属性都要保持一致，否则无法做变形动画。</p>\n<h2>5. 结合clip-path做遮罩效果</h2>\n<p>使用CSS通常只能用border-radius做一些圆角的遮罩，即用border-radius结合overflow: hidden实现，但是使用clip-path + svg的路径能够做出任意形状遮罩，如下做一个心形的：</p>\n<p><img src="https://www.yinchengli.com/wp-content/uploads/2018/06/13.jpg" alt="" width="172" height="177"/></p>\n<p>如下代码所示：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4b2cfe64e4495752372" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-mixed-highlight" title="含多种语言"/><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\n&lt;div style="width:200px;height:200px"&gt;&#13;\n    &lt;img src="photo.png" alt style="width:100%"&gt;&#13;\n&lt;/div&gt;&#13;\n&lt;style&gt;&#13;\nimg {&#13;\n    clip-path: url("#heart");&#13;\n}&#13;\n&lt;/style&gt;</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4b2cfe64e4495752372-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b2cfe64e4495752372-2">2</div><div class="crayon-num" data-line="crayon-5be4b2cfe64e4495752372-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b2cfe64e4495752372-4">4</div><div class="crayon-num" data-line="crayon-5be4b2cfe64e4495752372-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b2cfe64e4495752372-6">6</div><div class="crayon-num" data-line="crayon-5be4b2cfe64e4495752372-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b2cfe64e4495752372-8">8</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4b2cfe64e4495752372-1"><span class="crayon-o">&lt;</span><span class="crayon-e">div </span><span class="crayon-v">style</span><span class="crayon-o">=</span><span class="crayon-s">"width:200px;height:200px"</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b2cfe64e4495752372-2"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-o">&lt;</span><span class="crayon-e">img </span><span class="crayon-v">src</span><span class="crayon-o">=</span><span class="crayon-s">"photo.png"</span><span class="crayon-h"> </span><span class="crayon-e">alt </span><span class="crayon-v">style</span><span class="crayon-o">=</span><span class="crayon-s">"width:100%"</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5be4b2cfe64e4495752372-3"><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-e">div</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b2cfe64e4495752372-4"><span class="crayon-ta">&lt;style&gt;</span></div><div class="crayon-line" id="crayon-5be4b2cfe64e4495752372-5"><span class="crayon-k ">img </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b2cfe64e4495752372-6"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-e ">clip-path</span><span class="crayon-sy">:</span><span class="crayon-h"> </span><span class="crayon-i ">url</span><span class="crayon-sy">(</span><span class="crayon-s">"#heart"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5be4b2cfe64e4495752372-7"><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b2cfe64e4495752372-8"><span class="crayon-ta">&lt;/style&gt;</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0010 seconds] -->&#13;\n<p>style里面的id: #heart是指向了一个SVG的的clipPath，如下图所示：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4b2cfe64e8296560679" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\n&lt;svg xmlns="http://www.w3.org/2000/svg" width="0" height="0"&gt;&#13;\n    &lt;clipPath id="heart" clipPathUnits="objectBoundingBox"&gt;&#13;\n        &lt;path transform="scale(0.0081967, 0.0101010)" d="m61.18795,24.08746c24.91828,-57.29309 122.5489,0 0,73.66254c-122.5489,-73.66254 -24.91828,-130.95562 0,-73.66254z"/&gt;&#13;\n    &lt;/clipPath&gt;&#13;\n&lt;/svg&gt;</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4b2cfe64e8296560679-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b2cfe64e8296560679-2">2</div><div class="crayon-num" data-line="crayon-5be4b2cfe64e8296560679-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b2cfe64e8296560679-4">4</div><div class="crayon-num" data-line="crayon-5be4b2cfe64e8296560679-5">5</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4b2cfe64e8296560679-1"><span class="crayon-o">&lt;</span><span class="crayon-e">svg </span><span class="crayon-v">xmlns</span><span class="crayon-o">=</span><span class="crayon-s">"http://www.w3.org/2000/svg"</span><span class="crayon-h"> </span><span class="crayon-v">width</span><span class="crayon-o">=</span><span class="crayon-s">"0"</span><span class="crayon-h"> </span><span class="crayon-v">height</span><span class="crayon-o">=</span><span class="crayon-s">"0"</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b2cfe64e8296560679-2"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-o">&lt;</span><span class="crayon-e">clipPath </span><span class="crayon-v">id</span><span class="crayon-o">=</span><span class="crayon-s">"heart"</span><span class="crayon-h"> </span><span class="crayon-v">clipPathUnits</span><span class="crayon-o">=</span><span class="crayon-s">"objectBoundingBox"</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5be4b2cfe64e8296560679-3"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-o">&lt;</span><span class="crayon-e">path </span><span class="crayon-v">transform</span><span class="crayon-o">=</span><span class="crayon-s">"scale(0.0081967, 0.0101010)"</span><span class="crayon-h"> </span><span class="crayon-v">d</span><span class="crayon-o">=</span><span class="crayon-s">"m61.18795,24.08746c24.91828,-57.29309 122.5489,0 0,73.66254c-122.5489,-73.66254 -24.91828,-130.95562 0,-73.66254z"</span><span class="crayon-o">/</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b2cfe64e8296560679-4"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">clipPath</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5be4b2cfe64e8296560679-5"><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">svg</span><span class="crayon-o">&gt;</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0012 seconds] -->&#13;\n<p>为了让这个path刚好能撑起div容器宽度的100%，需要设置：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4b2cfe64f7142065454" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\nclipPathUnits="objectBoundingBox"</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4b2cfe64f7142065454-1">1</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4b2cfe64f7142065454-1"><span class="crayon-v">clipPathUnits</span><span class="crayon-o">=</span><span class="crayon-s">"objectBoundingBox"</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0003 seconds] -->&#13;\n<p>这样会导致d属性里面的单位变成比例的0到1，所以需要把它缩小一下，原本的width是122，height是99，需要需要scale的值为（1 / 122, 1 / 99）。这样就达到100%占满的目的，如果一开始d属性坐标比例就是0到1，就不用这么搞了。</p>\n<p>另外clip-path使用svg的path不支持变形动画。</p>\n<p>本篇介绍了使用svg路径path做的几种效果：做一个路径动画、不规则形状的点击、沿着路径拖拽、路径的变形动画以及和clip-path做一些遮罩效果。可以说svg的path效果还是很强大的，当你有些效果用html/css无法实现的时候，不妨往svg的方向思考。</p>\n&#13;\n        <script language="javascript"> &#13;\nvar randomNum = Math.round(Math.random()*1);&#13;\nvar innerHTML=new Array(2);&#13;\ninnerHTML[0]="如果有人让你推荐前端技术书，请让他看这个列表 -&gt;《&lt;a target=\'_blank\' href=\'http://web.jobbole.com/86734/\'&gt;经典前端技术书籍&lt;/a&gt;》";&#13;\ninnerHTML[1]="如果有人让你推荐前端技术书，请让他看这个列表 -&gt;《&lt;a target=\'_blank\' href=\'http://web.jobbole.com/86734/\'&gt;经典前端技术书籍&lt;/a&gt;》";&#13;\nvar widgetHTML="&lt;div id=\'single-page-inner-widget\'&gt;"+innerHTML[randomNum]+"&lt;/div&gt;";&#13;\ndocument.write(widgetHTML);&#13;\n</script>&#13;\n        &#13;\n        \n     \n\n\n\n&#13;\n        <!-- BEGIN #author-bio -->&#13;\n&#13;\n&#13;\n<!-- END #author-bio -->&#13;');
insert into news_article_basic(article_id, user_id, channel_id, title, cover, status)values(8, 1, 1, '支付宝客户端架构解析：iOS 容器化框架初探', '{"type":0, "images":[]}', 2);
insert into news_article_content(article_id, content) values(8,'<h2 class="heading" data-id="heading-0">1. 前言</h2>\n<p>由本章节开始，我们将从支付宝客户端的架构设计方案入手，细分拆解客户端在“容器化框架设计”、“网络优化”、“性能启动优化”、“自动化日志收集”、“RPC 组件设计”、“移动应用监控、诊断、定位”等具体实现，带领大家进一步了解支付宝在客户端架构上的迭代与优化历程。</p>\n<p>本节将介绍支付宝 iOS 容器化框架设计的基本思路。</p>\n<h2 class="heading" data-id="heading-1">2. 容器化实现概览</h2>\n<p>在 mPaaS 开篇介绍中已经和大家分享过《模块化与解耦式开发在蚂蚁金服 mPaaS 中的实践》：通过容器化开发框架将业务隔离成相对独立的模块，并着力追求模块与模块之间高内聚、低耦合，因此我们实现了灵活的插件式开发，并得以将业务划分为上千个独立工程。</p>\n<p>mPaaS iOS 框架源自于支付宝客户端，为了实现这种上千个工程之间的低耦合和相关依赖调用，mPaaS 框架直接接管了 App 的生命周期，负责整个 App 启动托管、App 生命周期管理、处理与分发 <code>UIApplication</code> 的代理事件。\nmPaaS 框架提供了容器化环境，业务开发人员在这个容器化环境中使用 <code>微应用</code> 和 <code>服务</code> 进行具体的业务需求开发。</p>\n<p/><figure><img alt="mPaaS iOS 框架-w400" class="lazyload" data-src="https://user-gold-cdn.xitu.io/2018/11/2/166d3d12403a975b?imageView2/0/w/1280/h/960/ignore-error/1" data-width="800" data-height="600"/><figcaption/></figure><p/>\n<p><code>微应用</code> 和 <code>服务</code> 是 mPaaS 框架内定义的概念，主要是用来进行业务模块间的划分。按照是否有 UI 界面作为标准，mPaaS 框架将不同的业务模块划分为 <code>微应用</code> 和 <code>服务</code>。<code>微应用</code> 是 APP 运行期间带有用户界面的业务模块；<code>服务</code> 是 App 运行期由业务提供的轻量级抽象服务。在 mPaaS 框架中，通过 <code>框架上下文Context</code> 进行 <code>微应用</code> 与 <code>服务</code> 的生命周期管理。</p>\n<h2 class="heading" data-id="heading-2">3. 应用生命周期管理</h2>\n<p>通过修改 main.m 函数的实现，mPaaS 框架使用自己的 <code>ClientDelegate</code> 类接管了 <code>UIApplicationDelegate</code> 中各种 App 生命周期。mPaaS 框架接入之后，<code>ClientDelegate</code> 完全替代了一般工程中的 <code>AppDelegate</code> 的角色，从而实现了整个应用的生命周期都是由框架进行管理。</p>\n<pre><code class="hljs c copyable" lang="c"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> * argv[])</span> </span>{\n    @autoreleasepool {\n        <span class="hljs-comment">// Now use mPaaS framework</span>\n        <span class="hljs-keyword">return</span> UIApplicationMain(argc, argv, @<span class="hljs-string">"Application"</span>, @<span class="hljs-string">"ClientDelegate"</span>); \n    }\n}\n\n<span class="copy-code-btn">复制代码</span></code></pre><p>为了方便用户获取 App 生命周期来开发自定义功能，mPaaS 框架提供了 <code>DTFrameworkInterface</code> 类里面实现了 <code>UIApplicationDelegate</code> 中所有代理方法的等价接入方式，只需要在 <code>DTFrameworkInterface</code> 的 Category 中覆盖对应的方法即可。</p>\n<p>例如下面常见的 <code>UIApplicationDelegate</code> 代理方法：</p>\n<pre><code class="hljs bash copyable" lang="bash">@protocol UIApplicationDelegate&lt;NSObject&gt;\n\n- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions;\n\n- (void)applicationDidBecomeActive:(UIApplication *)application;\n\n- (void)applicationWillResignActive:(UIApplication *)application;\n\n- (BOOL)application:(UIApplication *)application\n            openURL:(NSURL *)url\n  <span class="hljs-built_in">source</span>Application:(NSString *)<span class="hljs-built_in">source</span>Application\n         annotation:(id)annotation;\n\n@end\n<span class="copy-code-btn">复制代码</span></code></pre><p>在 <code>DTFrameworkInterface</code> 中都提供了对应的方法：</p>\n<pre><code class="hljs bash copyable" lang="bash">typedef NS_ENUM(NSInteger, DTFrameworkCallbackResult)\n{\n    DTFrameworkCallbackResultContinue   = 0,  // 继续执行\n    DTFrameworkCallbackResultReturn     = 1,  // 中断执行\n    DTFrameworkCallbackResultReturnYES  = 2,  // 中断之后的逻辑，并返回 YES\n    DTFrameworkCallbackResultReturnNO   = 3,  // 中断之后的逻辑，并返回 NO\n};\n\n@interface DTFrameworkInterface : NSObject\n\n<span class="hljs-comment">#pragma mark - 应用配置，微应用配置、服务配置、Scheme 处理器配置，可用 Category 覆盖</span>\n- (void)application:(UIApplication *)application beforeDidFinishLaunchingWithOptions:(NSDictionary *)launchOptions;\n- (DTFrameworkCallbackResult)application:(UIApplication *)application handleDidFinishLaunchingWithOptions:(NSDictionary *)launchOptions;\n- (void)application:(UIApplication *)application afterDidFinishLaunchingWithOptions:(NSDictionary *)launchOptions;\n\n- (DTFrameworkCallbackResult)applicationDidBecomeActive:(UIApplication *)application;\n\n- (DTFrameworkCallbackResult)applicationWillResignActive:(UIApplication *)application;\n\n- (DTFrameworkCallbackResult)application:(UIApplication *)application\n                                 openURL:(NSURL *)url\n                                  newURL:(NSURL **)newURL\n                       <span class="hljs-built_in">source</span>Application:(NSString *)<span class="hljs-built_in">source</span>Application\n                              annotation:(id)annotation;\n@end\n<span class="copy-code-btn">复制代码</span></code></pre><p>由于 mPaaS 框架有一些自己的初始化逻辑需要实现，在 <code>DTFrameworkInterface</code> 中额外提供了 <code>beforeDidFinishLaunchingWithOptions</code> 和 <code>afterDidFinishLaunchingWithOptions</code> 方法，方便用户在 App 启动时确定的时间执行自己的初始化代码。</p>\n<p/><figure><img class="lazyload" data-src="https://user-gold-cdn.xitu.io/2018/11/2/166d3d12487e8fe1?imageView2/0/w/1280/h/960/ignore-error/1" data-width="800" data-height="600"/><figcaption/></figure><p/>\n<p><code>DTFrameworkInterface</code> 在 <code>afterDidFinishLaunchingWithOptions</code> 之前会启动 <code>BootLoader</code>，执行 mPaaS 框架的初始化逻辑。在嵌入式操作系统中，<code>BootLoader</code> 的作用是初始化硬件设备，以便为最终调用操作系统内核准备好正确的环境。类似的在 mPaaS 框架中，<code>BootLoader</code>用来初始化整个 mPaaS 框架环境，默认实现为依次执行下面的流程：</p>\n<ul>\n<li>创建window</li>\n<li>创建主NavigationController</li>\n<li>运行那些只运行一次就可以，并且需要率先启动的服务</li>\n<li>启动其它所有非lazyload的服务</li>\n<li>启动在ServicesMap的"[AUTOSTART]"数组中指定需要自动启动的服务分组</li>\n<li>显示主Window</li>\n<li>启动 Launcher 微应用，显示出首页</li>\n</ul>\n<p>这样就完成了 mPaaS 框架的初始化和首页的显示。</p>\n<p>后面将详细介绍其中关键的3个概念：<code>微应用</code>、<code>服务</code>、<code>框架上下文 Context</code>。</p>\n<h2 class="heading" data-id="heading-3">4. 微应用</h2>\n<p>微应用就是带 UI 界面的独立业务模块，其中最特殊的一个微应用是 <code>Launcher</code> 微应用，<code>Launcher</code> 作为 App 启动之后第一个打开的微应用，一般用来创建 App 首页。在 mPaaS 框架中，各个微应用之间是高度独立、不相互依赖的。</p>\n<p><code>微应用</code> 通过 <code>plist</code> 文件配置来进行注册。配置微应用时需要指定 <code>delegate</code> 对应的类名、微应用的描述 <code>description</code> 以及打开微应用时使用的 <code>name</code>。这样 <code>框架上下文 Context</code> 通过微应用的 <code>name</code> 就可以打开指定的微应用。</p>\n<p/><figure><img alt="微应用注册方式-w500" class="lazyload" data-src="https://user-gold-cdn.xitu.io/2018/11/2/166d3d2ec3fc0e50?imageView2/0/w/1280/h/960/ignore-error/1" data-width="944" data-height="246"/><figcaption/></figure><p/>\n<p>为了方便业务开发，每个 <code>微应用</code> 也存在生命周期。微应用的生命周期，是模仿 iOS App 的生命周期来做的。每个微应用需要实现自己的 <code>DTMicroApplicationDelegate</code> 代理，这个类似于 iOS App 中实现的 <code>Appdelege</code> 类。\n</p><figure><img alt="微应用生命周期-w550" class="lazyload" data-src="https://user-gold-cdn.xitu.io/2018/11/2/166d3d2ec5d0d81f?imageView2/0/w/1280/h/960/ignore-error/1" data-width="600" data-height="448"/><figcaption/></figure><p/>\n<p>对于具体业务开发而言 <code>微应用</code> 的开发和一个完整的 App 一样，每个 <code>微应用</code> 负责控制自己应用内的页面堆栈，并根据 <code>微应用</code> 的生命周期执行相应的操作。在 mPaaS 框架中，所有的 <code>微应用</code> 都是运行在 mPaaS 框架提供的容器中，其不需要关注 App 的生命周期。对于一些特殊的业务场景，mPaaS 支持创建微应用的多个实例。</p>\n<p/><figure><img alt="mPaaS 微应用结构-w500" class="lazyload" data-src="https://user-gold-cdn.xitu.io/2018/11/2/166d3d2ec8244390?imageView2/0/w/1280/h/960/ignore-error/1" data-width="600" data-height="434"/><figcaption/></figure><p/>\n<h2 class="heading" data-id="heading-4">5. 服务</h2>\n<p><code>服务</code> 与 <code>微应用</code> 不同地方在于其没有 UI 界面，是在后台执行。一旦服务启动后，其在整个客户端的生命周期中一直存在，因此服务一般用于给微应用提供通用服务，比如执行某个功能或者获取数据等。</p>\n<p>一个常见的服务是用户登陆状态服务，每个微应用可以通过这个服务来获取到用户的登录状态和用户信息。</p>\n<p><code>服务</code> 也是通过 <code>plist</code> 文件配置来进行注册。服务注册时需要提供服务的唯一标识 <code>name</code> 和对应的实现类 <code>class</code> 类名。框架在创建 <code>服务</code> 时会利用 <code>Objective-C</code> 语言的运行时机制创建 <code>服务</code> 实现类的实例。<code>lazyLoading</code> 用来控制是否延迟加载该类。如果是延迟加载，在框架启动时该 <code>服务</code> 并不会实例化，只有在用到该 <code>服务</code> 时才会实例化并启动。如果是非延迟加载，则在框架启动时会启动该服务。</p>\n<p>由于服务的特殊性，在 mPaaS 中同时提供了 <code>ServicesMap</code> 来批量注册类，<code>ServicesMap</code> 中的 <code>[AUTOSTART]</code> 用来说明哪些组的<code>服务</code>需要在 App 启动的时候最先启动。\n</p><figure><img alt="服务注册方式-w500" class="lazyload" data-src="https://user-gold-cdn.xitu.io/2018/11/2/166d3d2ec9d8c509?imageView2/0/w/1280/h/960/ignore-error/1" data-width="898" data-height="536"/><figcaption/></figure><p/>\n<p>这种分级启动服务的特点可以有效控制 App 的启动时间，提供很好的用户体验。</p>\n<p>每个服务都需要实现 <code>服务</code> 接口:</p>\n<pre><code class="hljs Objective-C copyable" lang="Objective-C">@required\n\n/**\n * 启动一个服务。\n * 注意：\n * 框架在完成初始化操作后，会调用该方法。\n * 如果一个服务要启动一个应用，必须在该方法被调用之后，才能启动其它的应用。\n */\n- (void)start;\n\n@optional\n\n/**\n * 创建服务完成。\n */\n- (void)didCreate;\n\n/**\n * 服务将要销毁。\n */\n- (void)willDestroy;\n<span class="copy-code-btn">复制代码</span></code></pre><p>在增加了 <code>服务</code> 之后，整个 App 的结构如下图所示。后台的服务成为各个 <code>微应用</code> 之间沟通的桥梁。\n</p><figure><img alt="mPaaS 容器化结构-w500" class="lazyload" data-src="https://user-gold-cdn.xitu.io/2018/11/2/166d3d36dde5577c?imageView2/0/w/1280/h/960/ignore-error/1" data-width="1000" data-height="861"/><figcaption/></figure><p/>\n<h2 class="heading" data-id="heading-5">6. 框架上下文 Context</h2>\n<p>通过前面的介绍，大家已经对 <code>微应用</code> 和 <code>服务</code> 有了深入的了解。在 mPaaS 框架中，<code>框架上下文Context</code> 承担了一个调度员的角色，负责各个 <code>微应用</code> 和 <code>服务</code> 的调度、通信管理，这样就实现了每个 <code>微应用</code> 的打开、页面推栈以及关闭不会影响 App 其他 <code>微应用</code> 模块。</p>\n<p>通过 mPaaS 框架提供的 <code>DTContext * DTContextGet()</code> 函数可以获取到<code>框架上下文Context</code> 对象。一个简化的 <code>Context</code> 类实现如下:</p>\n<pre><code class="hljs bash copyable" lang="bash">@interface Context : NSObject\n\n@property(nonatomic, strong) UIWindow *window;\n@property(nonatomic, strong) UINavigationController *navigationController;\n\n// 根据指定的名称启动一个微应用\n- (BOOL)startApplication:(NSString *)name params:(NSDictionary *)params animated:(BOOL)animated;\n\n// 逆向遍历微应用栈，返回最新的微应用对象。\n- (DTMicroApplication *)findApplicationByName:(NSString *)name;\n\n// 根据指定的名称查到一个服务\n- (id)findServiceByName:(NSString *)name;\n\n// 注册一个服务\n- (BOOL)registerService:(id)service <span class="hljs-keyword">for</span>Name:(NSString *)name;\n\n// 反注册一个已存在的服务\n- (void)unregisterServiceForName:(NSString *)name;\n@end\n<span class="copy-code-btn">复制代码</span></code></pre><p>对于业务开发人员，可以通过 <code>框架上下文 Context</code> 获取到主 window、启动指定的 <code>微应用</code>、获取一个 <code>服务</code>、动态注册与反注册 <code>服务</code>，从而实现业务之间的连接。</p>\n<h2 class="heading" data-id="heading-6">7. 小结</h2>\n<p>通过本节内容，我们初步了解了 mPaaS 在 iOS 端容器化框架的设计思路，通过 <code>微应用</code> 和 <code>服务</code> 的方式完成业务模块之间的解耦和调用。<code>框架上下文 Context</code> 作为一个迷你的容器操作系统，为 <code>微应用</code> 和 <code>服务</code> 的运行提供了所需的容器化环境，保证了独立的业务开发流程和流畅的用户体验。</p>\n<p>欢迎大家体验 <a target="_blank" href="https://link.juejin.im?target=https%3A%2F%2Ftech.antfin.com%2Fdocs%2F2%2F49549" rel="nofollow noopener noreferrer">mPaaS</a> 容器化开发框架，期待大家的反馈与交流。</p>\n<blockquote>\n<p><strong>往期阅读</strong></p>\n<p><a target="_blank" href="https://link.juejin.im?target=https%3A%2F%2Fjuejin.im%2Fpost%2F5bd81cf2f265da0ab674096c" rel="nofollow noopener noreferrer">《支付宝客户端架构解析：Android容器化框架初探》</a></p>\n<p><a target="_blank" href="https://link.juejin.im?target=https%3A%2F%2Fjuejin.im%2Fpost%2F5bc41d80f265da0aaa053ca5" rel="nofollow noopener noreferrer">《开篇 | 模块化与解耦式开发在蚂蚁金服 mPaaS 深度实践探讨》</a></p>\n<p><a target="_blank" href="https://link.juejin.im?target=https%3A%2F%2Fjuejin.im%2Fpost%2F5bc5c46be51d450e95105048" rel="nofollow noopener noreferrer">《口碑 App 各 Bundle 之间的依赖分析指南》</a></p>\n<p><a target="_blank" href="https://link.juejin.im?target=https%3A%2F%2Fjuejin.im%2Fpost%2F5bc850caf265da0abf7d195d" rel="nofollow noopener noreferrer">《源码剖析 | 蚂蚁金服 mPaaS 框架下的 RPC 调用历程》</a></p>\n<p><a target="_blank" href="https://link.juejin.im?target=https%3A%2F%2Fjuejin.im%2Fpost%2F5bd3f516518825279a5f9694" rel="nofollow noopener noreferrer">《支付宝移动端动态化方案实践》</a></p>\n</blockquote>\n<h4 class="heading" data-id="heading-7">关注我们公众号，获得第一手 mPaaS 技术实践干货</h4>\n<blockquote>\n<p/><figure><img alt="QRCode" class="lazyload" data-src="https://user-gold-cdn.xitu.io/2018/10/16/1667cdbda3077911?imageView2/0/w/1280/h/960/ignore-error/1" data-width="258" data-height="258"/><figcaption/></figure><p/>\n</blockquote>');
insert into news_article_basic(article_id, user_id, channel_id, title, cover, status)values(9, 1, 1, '柔宇科技发售全球首款可折叠柔性屏手机，平板、手机从此二合一', '{"type":0, "images":[]}', 2);
insert into news_article_content(article_id, content) values(9,'<link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f76675cdea.css"/>\n\t\t\t\t\t\t<div class="htmledit_views">\n                \n    <div id="dvContent">\n\n\t\t\t\t\t\t\t\n\n\t\t\t\t\t\t\t<p>北京2018年11月1日电 /美通社/ -- 北京时间10月31日下午，柔宇科技在北京国家会议中心举办2018全球新品发布会，正式发售具有革命性里程碑意义的全球首款可折叠柔性屏手机 -- FlexPai（“柔派”）。基于柔宇科技多年在柔性显示屏领域的技术开拓和深耕，FlexPai 颠覆人们对传统智能手机的认知，既拥有智能手机的便携，又兼具平板电脑的高清大屏 -- 可自由折叠、展开，轻松装入口袋，带来比目前市场上最大屏手机更强大的视觉体验。完美地解决了高清大屏与便携的长期矛盾，革命性地构建了全新的人机交互方式。</p> \n<div id="prni_dvprnejpg9bf0left" style="text-align:center;" dir="ltr"> \n <a href="https://photos.prnasia.com/prnh/20181101/2286824-1" rel="nofollow"><img id="prnejpg9bf0left" title="柔宇科技震撼发售全球首款可折叠柔性屏手机，平板、手机从此二合一" border="0" alt="柔宇科技震撼发售全球首款可折叠柔性屏手机，平板、手机从此二合一" align="middle" src="https://photos.prnasia.com/prnvar/20181101/2286824-1"/></a> \n <br/><span>柔宇科技震撼发售全球首款可折叠柔性屏手机，平板、手机从此二合一</span> \n</div> \n<p>拥有 FlexPai，用户可玩转多种屏幕机身形态。在大屏状态下支持多窗口、多任务处理，支持电脑级拖拽分享，大屏办公、观影更舒适，游戏更欢畅；折叠状态下还可开启侧曲屏的通知，避免通知打扰主辅屏幕操作，尽享一机三屏体验，用户游戏、办公时可以心无旁骛。</p> \n<p>著名科技杂志《连线》(Wired)创始主编、互联网预言家凯文·凯利(<span class="xn-person">Kevin Kelly</span>)当天在发布会上表示：“我们相信柔性屏和柔性传感新的交互方式将改变一系列的硬件、软件和生态，柔宇在这条路上，已经走在了柔性屏探索的最前列。” </p> \n<p>当天，柔宇科技创始人兼 CEO 刘自鸿博士与凯文·凯利及李宁公司创始人、世界著名奥运冠军李宁先生共同揭晓了 FlexPai 的价格，并宣布 FlexPai 于2018年11月1日上午10:01在柔宇科技官网（<a href="http://www.royole.com/" rel="nofollow">www.royole.com</a>）开启限时抢购。其中消费者版本率先面向中国消费者预售，开发者版本面向全球开发者开启销售，开发者工具 FlexPai Developer Kit 详见柔宇官网。</p> \n<p>在发布会期间，刘自鸿揭晓了“2亿元开发者支持计划”和“柔性星球百万创作计划”。柔宇将拿出2亿元人民币（约3000万美元）用于支持和奖励 FlexPai 柔性屏手机的全球软件开发者开发各类新 App，有意申请开发者资格者可咨询柔宇科技官网客服。同时，柔宇开启柔性星球百万创作计划，面向全球征集柔性星球主题曲、柔性星球 Logo、柔性电子产品创意设计，符合条件的最终入选作品可分享共100万元人民币（约15万美元）的奖励，参与方式请近期关注柔宇科技官网、官方微信、微博和 Twitter 等平台。</p> \n<p class="prntac"><b>开合自如，解决大屏与便携的天然矛盾</b></p> \n<p>可折叠的柔性屏手机？手机与平板电脑二合一？桌面互联网和移动互联网合二为一？如今，科幻已成现实。</p> \n<p>北京时间10月31日下午，北京国家会议中心，全球首款可折叠柔性屏手机 -- 柔宇FlexPai ”柔派”在来自多个国家的嘉宾及媒体面前首次震撼亮相并正式开启销售。聚光灯下，柔宇科技创始人兼 CEO 刘自鸿从口袋中取出一个手机大小的产品，轻松掰开则变身为平板电脑，折叠后即可收回口袋，一时间，现场掌声雷动。</p> \n<p>可以折叠的柔性屏手机终于正式问世了<span id="spanHghlt96a8">。</span>屏幕为何能够自由弯曲、折叠？与全球范围内绝大多数手机企业采用第三方供应的屏幕不同，FlexPai 采用柔宇科技完全自主研发并在全球率先量产的全柔性显示屏 -- 柔宇“蝉翼”柔性屏，是全球首款真正的可折叠柔性屏智能手机，其强大的功能背后是柔宇2000余项核心技术知识产权的有力支撑。</p> \n<p>柔宇“蝉翼”柔性屏集成了超过2000万个柔性超精密器件，600万级柔性集成电路，近百种微纳米薄膜材料。与市场上现有的平面或固定曲面显示屏不同，柔宇科技量产的全柔性显示屏在用户手中也可以实现自由弯曲、折叠、卷曲，不仅具有 AMOLED 的鲜艳色彩，而且拥有大色域、强对比、广视角、高清分辨率。比头发丝直径还薄，卷曲半径极小，可广泛应用于手机、平板电脑、智能穿戴等产品以及智能交通、运动时尚、建筑装饰、机器人、广告、办公教育等各行各业。</p> \n<p>柔宇 FlexPai 使用的屏幕是一块完整的7.8英寸高分辨率全柔性显示触摸屏，完全由柔宇科技自主研发量产，在柔、艳的同时具有轻、薄的特征，经过超20万次的弯折测试和扭曲测试、张力测试、跌落测试等严格检测，整个产品的安全性、稳定性、可靠性及使用寿命均已验证达到消费者使用要求。</p> \n<p>此外，FlexPai 采用了外折式屏幕设计，其中多轴联动精密铰链的创新设计令人印象深刻。整机中间区域的多轴联动精密铰链由上百个零部件组成，仅此部分就集成了柔宇的110余项核心技术专利。经过1000余天、117项严格测试研发出的这种创新弯折结构设计不仅确保了柔性手机屏幕可随时自由弯折，并且在多次弯折后依然有良好的稳定性、可靠性，也可多角度无级弯折满足用户不同模式需求，无论是拍照、办公、游戏、观影等不同场景，均可得到完全超越传统智能手机的全新体验。</p> \n<p class="prntac"><b>采用新一代高通平台，整体性能更强大</b></p> \n<p>发布会现场，柔宇科技创始人兼 CEO 刘自鸿博士携手著名主持人蒋昌建、知名实力派女演员汤晶媚、学霸创业者何猷君等明星嘉宾，一一展示了 FlexPai 在拍照、影音、办公、游戏等多个场景下的全新应用，让人耳目一新。</p> \n<p>FlexPai 既可以折叠成为智能手机，也可以展开成为平板电脑，方便用户随时随地大屏看视频、展示 PPT，真正意义上解决了高清大屏和便携性这个长期被认为难以调和的矛盾。</p> \n<p>FlexPai 采用新一代高通骁龙8系旗舰平台，整体性能比当前主流智能手机旗舰平台更强大，同时支持双卡双待、指纹识别、双摄拍照。</p> \n<p>另外，FlexPai 采用了柔宇自主研发的新型超级快充技术 -- 柔充，它不仅能助力电子设备大幅提高充电续航体验，30分钟即可充电约70%，而且还具有发热量低、安全性高等多项优势。</p> \n<p>柔宇为 FlexPai 特别定制了 Water OS 操作系统，使其在大屏及不同角度折叠状态下使用时，App 都可自适应不同的屏幕尺寸，可以更简单、流畅地操作这款充满未来感的新产品，尽享大屏和便携合二为一的极致体验。</p> \n<p>从外观上看，FlexPai 体现了柔宇一直秉承的“科学与艺术不可分割”的理念，整体机身时尚大气，外轮廓精致有型，机身侧面弧线圆润流畅，抓握体验舒适自然，正面超大柔性显示屏科技感十足，后盖3D 双曲面采用光学纹理设计，流光溢彩。整机刚柔并济，让人尽享全新的移动设备体验。</p> \n<p>“没想到可折叠柔性屏手机这么快就能成为现实，太酷了<span id="spanHghltde7f">。</span>”多位嘉宾现场表示，FlexPai 非常新颖，刷新了自己对手机的认知，能够解决大家平常使用手机中的不少痛点，希望能早点入手一台。当天，柔宇也为出席发布会的嘉宾开通了优先购买通道，不少嘉宾现场扫描二维码购买，成为 FlexPai 全球最早一批用户。</p> \n<p class="prntac"><b>一心二用两不误 花式玩转娱乐、工作</b></p> \n<p>出门只带手机却总觉得屏幕太小，看文件看得眼睛发胀？旅途中看攻略、看网综、刷剧又嫌带平板电脑太麻烦？玩手游正在关键时刻却被一通促销电话打断？别人为你拍的照片总不如自拍漂亮？这时，你需要一台 FlexPai。</p> \n<p>作为移动办公的神器，FlexPai 在大屏状态下支持多窗口、多任务的并列显示，在普通手机上无法实现的拖拽分享功能，它可以轻松实现。比如在微信对话框里可以轻松拖拽辅屏中的图片、文档，又或者在主屏上写邮件，可以轻松将辅屏上的内容拖拽到邮件附件中，让忙碌的现代人用更短的时间解决随时随地需要办公的难题，工作效率大大提升。</p> \n<p>不仅如此，FlexPai 还可以让人随时随地畅享更大屏幕的影音、游戏体验，但与平板电脑不同，它在折叠状态下主屏、辅屏还可使用不同应用，比如一边聊微信、一边看直播，看到时尚博主的推荐也不用退出阅读，打开另一个屏幕上的购物 App 就可以轻松买买买。</p> \n<p>另外，FlexPai 还支持用户自定义分屏尺寸，可任意调整视频窗口或微信聊天窗口所占屏幕面积，真正实现多线程工作，避免因为看视频、刷网文而错过微信工作群的重要讨论，也不再需要多次中断观赏切换至其他 App。</p> \n<p>对于喜爱玩游戏的用户来说，在 FlexPai 折叠状态下开启侧曲屏的通知，就可以尽享一机三屏体验，当有来电、信息或通知时，侧曲屏上将流动出现防打扰泡泡，可及时通过侧曲屏处理，也可以忽略掉骚扰电话等，由此避免意外来电等打扰主屏幕上的游戏或操作。</p> \n<p>FlexPai 折叠状态下采用镜像拍照，主屏、辅屏可以同时展示取景画面，用后置摄像头也能达到自拍的效果，实现“所见即所拍”，调整到满意的画面再“遥控”拍照者按下快门，再也不用担心被拍出令人难堪的照片。用 FlexPai 拍照时无需像使用传统手机一样盯着镜头，完全可以实时从镜像屏幕看到自己的神态表情，从而实现“不管谁拍，都是自拍”的需求。</p> \n<p>在大屏状态下，FlexPai 如何接听电话？解锁是否方便？大屏状态下如有来电，用户只需将 FlexPai 折叠，电话即可自动接通，而且还可以智能识别用户接听时所使用的屏幕，自动启用不同的麦克风及听筒系统，整个过程自然流畅。在熄屏状态下，用户看到 FlexPai 任一屏幕的消息提醒，都可以双击图标并通过指纹识别来确认开启，高效开启该应用软件。</p> \n<p>此外，FlexPai 还有更多传统智能手机没有的贴心功能，如 FlexPai 可在0度到180度区间内任意角度弯折，可像书本一样立起或横放，解放双手，更为灵活配合用户阅读角度，减轻现代低头族生活方式所带来的压力；如直立时，屏幕可显示时间、备忘录等功能，化身工作小助手做出不同提示；如用户需要与他人共享手机中的照片或其它资料，也可将选中的内容分享到辅屏上给他人在对面观看，避免二人同一侧看手机相册涉及泄露隐私图片或视频等。</p> \n<p class="prntac"><b>折叠下一个十年</b></p> \n<p>作为电子信息产业的里程碑式产品，全柔性屏手机 FlexPai “柔派”革新了人类与信息交互的方式，桌面互联网和移动互联网合二为一，在硬件、软件、操作系统的变化之外，也将对未来的商业模式、信息生态系统带来重大变革。</p> \n<p>正如凯文·凯利(<span class="xn-person">Kevin Kelly</span>)所说：“我们正前往一个屏幕无处不在的时代，我们相信柔性屏和柔性传感新的交互方式将改变一系列的硬件、软件和生态，柔宇在这条路上，已经走在了柔性屏探索的最先列。” </p> \n<p>FlexPai 的诞生，并非是创新团队的突发奇想、短短数月的集体攻关。在这个快节奏的时代，柔宇团队常以“厚积薄发，行胜于言”勉励自己，六年多来潜心专注于柔性电子从0到1、从1到 N 的全方位创新。</p> \n<p>2012年，当三位毕业于斯坦福大学的博士在硅谷、深圳、香港创立柔宇时，传统显示领域的专家认为柔性显示的产业化要三五十年才能实现。不过，依据对科学规律的理解以及团队在这方面多年的积累，柔宇人经过无数次的实验、失败、再实验，2014年在全球第一个成功发布了国际业界最薄、厚度仅0.01毫米的柔性显示屏，引领了柔性显示和柔性电子产业的国际新潮流。</p> \n<p>从最初的3位海归博士发展到如今来自20多个国家和地区的2000多位员工，柔宇人一直为了“让人们更好地感知世界”的使命和梦想百折不挠、奋斗不息。2018年6月，柔宇科技投资110亿元，具有自主知识产权的全球首条类六代全柔性显示屏大规模量产线在深圳正式点亮投产。柔宇科技也是目前唯一一家没有采用传统主流曲面显示技术路线的创新型企业，在材料、工艺、器件、电路设计等方面都拥有核心技术知识产权。</p> \n<p>创新是为了解决问题，为社会创造有核心价值的产品。近年来，柔宇以“通过技术创新让人们更好地感知世界”为使命，不断通过 B2B 与 B2C 模式推出柔性显示广告屏、柔性显示时尚衣帽、柔炬、智能手写本柔记、3D 移动影院 Royole Moon 等多款量产产品走入市场。</p> \n<p>2018年8月，柔宇基于柔性电子技术首次提出了“柔性星球”计划 -- 全面发展新技术、新产线、新产品以及新市场。刘自鸿博士在发布会现场表示：“柔宇一直致力于通过技术创新让人们更好地感知世界，希望我们的柔性电子产品能够为用户带来更多价值。FlexPai 是一个全新的开始，相信它会给大家的生活带来全新的美好。”</p> \n<p>FlexPai 于11月1日上午10:01在柔宇科技官网 <a href="http://www.royole.com/" rel="nofollow">www.royole.com</a> 正式开启预售。<br/></p> \n<p class="prntac"><b><span id="spanHghlt9d74">“预言家”凯文·凯利出席，曾称“屏幕将无处不在”</span></b></p> \n<p>在柔性屏手机 FlexPai 发布现场，绰号 KK 的《连线》创始主编凯文·凯利(<span class="xn-person">Kevin Kelly</span>)的登场让很多人感到惊喜。他现场表示：“我们相信柔性屏和柔性传感新的交互方式将改变一系列的硬件、软件和生态，柔宇在这条路上，已经走在了柔性屏探索的最先列。” </p> \n<p>1994年，KK 预言未来科技发展的传奇著作《失控》横空出世，十几年后，文中所指相继实现，KK 也因此被称为互联网预言家。</p> \n<p>2016年，KK 在《必然》一书中则指出：“我们现在成为了屏幕之民（People of Screen）。”“（未来）屏幕将无处不在。任何一种平面都可以成为屏幕，看的书是一个屏幕，接触的所有平面都可以是一个屏幕。甚至有的人衣服都可以当成屏幕。不同的屏幕之间形成了生态系统。” </p> \n<p>这一次，KK 的预言更快地被验证。2012年在硅谷、深圳、香港创办的柔宇科技，2014年在全球第一个发布了国际业界最薄、厚度仅0.01毫米的柔性显示屏，引领了柔性显示和柔性电子产业的国际新潮流。2018年6月，柔宇科技投资110亿元在全球率先量产了全柔性显示屏，可支持大量消费电子、智能交通、智能家居、运动时尚、教育办公、机器人等行业应用，并迅速获得多个行业的大额市场定单。</p> \n<p>无论是2018年俄罗斯世界杯决赛、2019春夏巴黎时装周，还是2018全国双创周启动仪式<span id="spanHghlt5cfc">，</span>柔宇科技量产的全柔性显示屏以时尚礼帽、T恤、火炬等各种形式出现，刷新了人们对于屏幕可应用领域的认知，大大开拓了科技与生活方方面面结合的可能性。</p> \n<p>不仅如此，柔性屏火炬、柔性屏时尚礼帽、T恤等产品并非是临时兴起的创意，而是已经批量化生产、普通消费者可以便捷购买的商品，更让人们感受到 KK 所说的“屏幕将无处不在”已成为现实。未来屏幕还将在哪些方面改变我们的工作的生活？还将给我们带来哪些改变？让我们拭目以待。</p>\n\n\t\t\t\t\t\t\n\n\t\t\t\t\t\t</div>\n              </div>');
insert into news_article_basic(article_id, user_id, channel_id, title, cover, status)values(10, 1, 1, '顶石计划思考与收获', '{"type":0, "images":[]}', 2);
insert into news_article_content(article_id, content) values(10,'<p>本文由腾讯云技术团队原创，感谢作者的分享。</p> \n<span id="OSC_h1_1"/>\n<h1>1、前言</h1> \n<p><img src="https://upload-images.jianshu.io/upload_images/1500839-9c35984416e5c768.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/448"/></p> \n<p>微信小程序提供了一套在微信上运行小程序的解决方案，有比较完整的框架、组件以及 API，在这个平台上面的想象空间很大。腾讯云研究了一番之后，发现微信支持 WebSocket 还是很值得玩味的。这个特性意味着我们可以做一些实时同步或者协作的小程序。</p> \n<p>这篇文章分享了一个基于WebSocket长连接的微信小程序--简单的剪刀石头布小游戏的制作过程，希望能对想要在微信小程序中使用 WebSocket 的开发者有所帮助。</p> \n<p><strong>学习交流：</strong></p> \n<blockquote> \n <p>- 即时通讯开发交流3群：<a href="https://link.jianshu.com/?t=http%3A%2F%2Fshang.qq.com%2Fwpa%2Fqunwpa%3Fidkey%3D051ed62f79e15485c9b5af622dd5b1c87b26bedb890b068be79dd2006fc80ccf" target="_blank" rel="nofollow">185926912</a>[推荐]</p> \n <p>- 移动端IM开发入门文章：《<a href="https://link.jianshu.com/?t=http://www.52im.net/thread-464-1-1.html" target="_blank" rel="nofollow">新手入门一篇就够：从零开发移动端IM</a>》</p> \n</blockquote> \n<p>（<strong>说明：</strong>本文完整源码请从此文末附件下载：<a href="http://www.52im.net/thread-1703-1-1.html" target="_blank" rel="nofollow">http://www.52im.net/thread-1703-1-1.html</a>）</p> \n<span id="OSC_h1_2"/>\n<h1>2、相关文章</h1> \n<blockquote> \n <p>《<a href="http://www.52im.net/thread-338-1-1.html" target="_blank" rel="nofollow">新手入门贴：史上最全Web端即时通讯技术原理详解</a>》</p> \n <p>《<a href="http://www.52im.net/thread-336-1-1.html" target="_blank" rel="nofollow">Web端即时通讯技术盘点：短轮询、Comet、Websocket、SSE</a>》</p> \n <p>《<a href="http://www.52im.net/thread-831-1-1.html" target="_blank" rel="nofollow">新手快速入门：WebSocket简明教程</a>》</p> \n <p>《<a href="http://www.52im.net/thread-331-1-1.html" target="_blank" rel="nofollow">WebSocket详解（一）：初步认识WebSocket技术</a>》</p> \n <p>《<a href="http://www.52im.net/thread-326-1-1.html" target="_blank" rel="nofollow">WebSocket详解（二）：技术原理、代码演示和应用案例</a>》</p> \n <p>《<a href="http://www.52im.net/thread-332-1-1.html" target="_blank" rel="nofollow">WebSocket详解（三）：深入WebSocket通信协议细节</a>》</p> \n <p>《<a href="http://www.52im.net/thread-1258-1-1.html" target="_blank" rel="nofollow">WebSocket详解（四）：刨根问底HTTP与WebSocket的关系(上篇)</a>》</p> \n <p>《<a href="http://www.52im.net/thread-1266-1-1.html" target="_blank" rel="nofollow">WebSocket详解（五）：刨根问底HTTP与WebSocket的关系(下篇)</a>》</p> \n <p>《<a href="http://www.52im.net/thread-1273-1-1.html" target="_blank" rel="nofollow">WebSocket详解（六）：刨根问底WebSocket与Socket的关系</a>》</p> \n <p>《<a href="http://www.52im.net/thread-188-1-1.html" target="_blank" rel="nofollow">socket.io实现消息推送的一点实践及思路</a>》</p> \n <p>《<a href="http://www.52im.net/thread-690-1-1.html" target="_blank" rel="nofollow">Web端即时通讯技术的发展与WebSocket、Socket.io的技术实践</a>》</p> \n <p>《<a href="http://www.52im.net/thread-793-1-1.html" target="_blank" rel="nofollow">Web端即时通讯安全：跨站点WebSocket劫持漏洞详解(含示例代码)</a>》</p> \n <p>《<a href="http://www.52im.net/thread-849-1-1.html" target="_blank" rel="nofollow">开源框架Pomelo实践：搭建Web端高性能分布式IM聊天服务器</a>》</p> \n <p>《<a href="http://www.52im.net/thread-907-1-1.html" target="_blank" rel="nofollow">使用WebSocket和SSE技术实现Web端消息推送</a>》</p> \n <p>《<a href="http://www.52im.net/thread-1038-1-1.html" target="_blank" rel="nofollow">详解Web端通信方式的演进：从Ajax、JSONP 到 SSE、Websocket</a>》</p> \n <p>《<a href="http://www.52im.net/thread-1248-1-1.html" target="_blank" rel="nofollow">MobileIMSDK-Web的网络层框架为何使用的是Socket.io而不是Netty？</a>》</p> \n <p>《<a href="http://www.52im.net/thread-1341-1-1.html" target="_blank" rel="nofollow">理论联系实际：从零理解WebSocket的通信原理、协议格式、安全性</a>》</p> \n <p>&gt;&gt; <a href="http://www.52im.net/forum.php?mod=collection&amp;action=view&amp;ctid=15" target="_blank" rel="nofollow">更多同类文章 ……</a></p> \n</blockquote> \n<p>3、运行效果</p> \n<p>整个游戏非常简单，连接到服务器后自动匹配在线玩家（没有则分配一个机器人），然后两人进行剪刀石头布的对抗游戏。当对方进行拳头选择的时候，头像会旋转，这个过程使用 WebSocket 会变得简单快速。</p> \n<p><strong>剪刀石头布游戏效果如下图所示：</strong></p> \n<p><img src="https://upload-images.jianshu.io/upload_images/1500839-a24fcca2e10c7189.gif?imageMogr2/auto-orient/strip%7CimageView2/2/w/343"/></p> \n<span id="OSC_h1_3"/>\n<h1>4、为什么要用 WebSocket</h1> \n<p>使用传统的 HTTP 轮询或者长连接的方式也可以实现类似服务器推送的效果，但是这类方式都存在资源消耗过大或推送延迟等问题（详见文章《<a href="http://www.52im.net/thread-338-1-1.html" target="_blank" rel="nofollow">新手入门贴：史上最全Web端即时通讯技术原理详解</a>》）。而 WebSocket 直接使用 TCP 连接保持全双工的传输，可以有效地减少连接的建立，实现真正的服务器通信，对于有低延迟有要求的应用是一个很好的选择。</p> \n<p>目前浏览器对 WebSocket 的支持程度已经很好，加上微信小程序的平台支持，这种可以极大提高客户端体验的通信方式将会变得更加主流。</p> \n<p>Server 端需要实现 WebSocket 协议，才能支持微信小程序的 WebSocket 请求。鉴于 <a href="https://socket.io/" target="_blank" rel="nofollow">SocketIO</a> 被广泛使用（详见《<a href="http://www.52im.net/thread-190-1-1.html" target="_blank" rel="nofollow">Socket.IO介绍：支持WebSocket、用于WEB端的即时通讯的框架</a>》），剪刀石头布的小程序，我们选用了比较著名的<a href="https://socket.io/" target="_blank" rel="nofollow">SocketIO</a> 作为服务端的实现。</p> \n<p>Socket IO 的使用比较简单，仅需几行代码就可启动服务。</p> \n<blockquote> \n <p>export class Server {</p> \n <p>    init(path: string) {</p> \n <p>        /** Port that server listen on */</p> \n <p>        this.port = process.env.PORT;</p> \n <p>        /** HTTP Server instance for both express and socket io */</p> \n <p>        this.http = http.createServer();</p> \n <p>        /** Socket io instance */</p> \n <p>        this.io = SocketIO(this.http, { path });</p> \n <p>        /** Handle incomming connection */</p> \n <p>        this.io.on("connection", socket =&gt; {</p> \n <p>            // handle connection</p> \n <p>        });</p> \n <p>    }</p> \n <p>    start() {</p> \n <p>        this.http.listen(this.port);</p> \n <p>        console.log(`-- server started. listen : ${this.port} --`);</p> \n <p>    }</p> \n <p>}</p> \n <p>const server = newServer();</p> \n <p>server.init("/applet/ws/socket.io");</p> \n <p>server.start();</p> \n</blockquote> \n<p>但是，SocketIO 和一些其它的服务器端实现，都有其配套的客户端来完成上层协议的编码解码。但是由于微信的限制（不能使用 window 等对象）， SocketIO 的客户端代码在微信小程序平台上是无法运行的。</p> \n<p>经过对 SocketIO 通信进行抓包以及研究其客户端源码，笔者封装了一个大约 100 行适用于微信小程序平台的 WxSocketIO类，可以帮助开发者快速使用 SocketIO 来进行 WebSocket 通信。</p> \n<blockquote> \n <p>const socket = newWxSocketIO();</p> \n <p>socket.on(''hi'', packet =&gt; console.log(''server say hi: ''+ packet.message));</p> \n <p>socket.emit(''hello'', { from: ''techird''});</p> \n</blockquote> \n<p>如果想要使用微信原生的 API，那么在服务器端也可以<a href="https://github.com/websockets/ws" target="_blank" rel="nofollow">直接使用 ws</a> 来实现 W3C 标准的接口。不过 SocketIO 支持多进程的特性，对于后续做横向扩张是很有帮助的。腾讯云在后面也会有计划推出支持大规模业务需求的 WebSocket 连接服务，减小业务的部署成本。</p> \n<span id="OSC_h1_4"/>\n<h1>5、通信协议设计</h1> \n<p>实现一个多客户端交互的服务，是需要把中间涉及到所有的消息类型都设计清楚的，就像是类似剪刀石头布这样一个小程序，都有下面这些消息类型。</p> \n<p><img src="https://upload-images.jianshu.io/upload_images/1500839-66e91949a1d4aece.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700"/></p> \n<p>具体每个消息的参数可以参考源码里的server/protocol.brief.md</p> \n<span id="OSC_h1_5"/>\n<h1>6、服务器逻辑</h1> \n<p>服务器的逻辑很简单：</p> \n<blockquote> \n <p><strong>收到用户请求加入房间（join），就寻找还没满的房间：</strong></p> \n <p>- 找到房间，则加入；</p> \n <p>- 没找到房间，创建新房间。</p> \n <p><strong>有用户加入的房间检查是否已满，如果已满，则：</strong></p> \n <p>- 给房间里每个用户发送开始游戏的信号（start）；</p> \n <p>- 启动计时器，计时器结束后进行游戏结算。</p> \n <p><strong>游戏结算：</strong></p> \n <p>- 两两之间 PK，赢方分数加一，输方减一，最终得每个玩家基本得分 x；</p> \n <p>- 对于每个玩家，如果分数 x 大于 0，则视为胜利，连胜次数加一，否则连胜次数归零；</p> \n <p>- 本局得分为分数 x 乘以连胜次数。</p> \n <p>发送本局游戏结果给房间里的每位玩家。</p> \n</blockquote> \n<span id="OSC_h1_6"/>\n<h1>7、微信小程序端的实现</h1> \n<p>微信小程序直接使用上面的协议，针对不同的场景进行渲染。整体的状态机如下。</p> \n<p><img src="https://upload-images.jianshu.io/upload_images/1500839-d57bde10ac8c86f7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/700"/></p> \n<p>状态机整理清楚后，就是根据状态机来控制什么时候发送消息，接到消息后如何处理的问题了。具体实现请参照 app/pages/game/game.js里的源码。</p> \n<span id="OSC_h1_7"/>\n<h1>8、部署和运行</h1> \n<p>拿到了本小程序源码的朋友可以尝试自己运行起来（完整源码请从文末附件下载）。</p> \n<p>8.1整体架构</p> \n<p><img src="https://upload-images.jianshu.io/upload_images/1500839-011ba411a368000a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/672"/></p> \n<p>小程序的架构非常简单，这里有两条网络同步，一条是 HTTPS 通路，用于常规请求。对于 WebSocket 请求，会先走 HTTPS 后再切换协议到 WebSocket 的 TCP 连接，从而实现全双工通信。</p> \n<p>8.2准备域名和证书</p> \n<p>在微信小程序中，所有的网络请求受到严格限制，不满足条件的域名和协议无法请求，具体包括：</p> \n<blockquote> \n <p>只允许和在 MP 中配置好的域名进行通信，如果还没有域名，需要<a href="https://www.qcloud.com/product/dm.html?utm_source=jiaocheng&amp;utm_medium=domain2&amp;utm_campaign=qcloud&amp;_ga=1.171275689.823577730.1526619164" target="_blank" rel="nofollow">注册一个</a>；</p> \n <p>网络请求必须走 HTTPS 协议，所以你还需要为你的域名<a href="https://console.qcloud.com/ssl?utm_source=jiaocheng&amp;utm_medium=ssl2&amp;utm_campaign=qcloud&amp;_ga=1.171275689.823577730.1526619164" target="_blank" rel="nofollow">申请一个证书</a>；</p> \n <p>域名注册好之后，可以登录<a href="https://mp.weixin.qq.com/" target="_blank" rel="nofollow">微信公众平台</a>配置通信域名了。</p> \n</blockquote> \n<p><strong>设置域名和证书如下图所示：</strong></p> \n<p><img src="https://upload-images.jianshu.io/upload_images/1500839-e63331dace4672a5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/700"/></p> \n<p>8.3云主机和镜像部署</p> \n<p>剪刀石头布的服务器运行代码和配置已经打包成腾讯云 CVM 镜像，大家可以<a href="https://buy.qcloud.com/cvm?marketImgId=370&amp;utm_source=jiaocheng&amp;utm_medium=cvm2&amp;utm_campaign=qcloud&amp;_ga=1.137649849.823577730.1526619164" target="_blank" rel="nofollow">直接使用</a>。</p> \n<p>腾讯云用户可以<a href="https://www.qcloud.com/act/event/yingyonghao.html?_ga=1.183333295.823577730.1526619164#section-voucher" target="_blank" rel="nofollow">免费领取礼包</a>，体验腾讯云小程序解决方案。</p> \n<p><img src="https://upload-images.jianshu.io/upload_images/1500839-088bc8b3641422e5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/700"/></p> \n<p>▲ 设置镜像</p> \n<p>镜像已包含「剪刀石头布」和「小相册」两个小程序的服务器环境与代码，需要体验两个小程序的朋友无需重复部署。</p> \n<p>8.4配置 HTTPS</p> \n<p>镜像中已经部署了nginx，需要在/etc/nginx/conf.d下修改配置中的域名、证书、私钥。</p> \n<p><img src="https://upload-images.jianshu.io/upload_images/1500839-64485914ed2a9d5c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/507"/></p> \n<p>▲ Nginx 中配置证书</p> \n<p>配置完成后，即可启动 nginx。</p> \n<p>8.5域名解析</p> \n<p>我们还需要添加域名记录解析到我们的云服务器上，这样才可以使用域名进行 HTTPS 服务。</p> \n<p>在腾讯云注册的域名，可以直接使用<a href="https://console.qcloud.com/cns/domains?utm_source=jiaocheng&amp;utm_medium=cns&amp;utm_campaign=qcloud&amp;_ga=1.82990495.823577730.1526619164" target="_blank" rel="nofollow">云解析控制台</a>来添加主机记录，直接选择上面购买的 CVM。</p> \n<p><img src="https://upload-images.jianshu.io/upload_images/1500839-6e73fd7fbfa6272a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/700"/></p> \n<p>▲ 修改 DNS 记录</p> \n<p>解析生效后，我们在浏览器使用域名就可以进行 HTTPS 访问。</p> \n<p><img src="https://upload-images.jianshu.io/upload_images/1500839-473dc57aefa2f66d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/338"/></p> \n<p>▲ HTTPS 效果</p> \n<p>8.6启动 WebSocket 服务</p> \n<p>在镜像的 nginx 配置中（/etc/nginx/conf.d），已经把 /applet/websocket的请求转发到<a href="http://127.0.0.1:9595/" target="_blank" rel="nofollow">http://127.0.0.1:9595</a> 处理。我们需要把 Node 实现的 WebSocket 服务在这个端口里运行起来。</p> \n<p>进入镜像中源码位置：</p> \n<p>cd /data/release/qcloud-applet-websocket</p> \n<p>使用pm2 启动服务：</p> \n<p>pm2 start process.json</p> \n<p><img src="https://upload-images.jianshu.io/upload_images/1500839-ed1eef44a27c15ac.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/700"/></p> \n<p>8.7启动微信小程序</p> \n<p>在微信开发者工具中修改小程序源码中的 config.js 配置，把通讯域名修改成上面申请的域名。完成后点击调试即可连接到 WebSocket 服务进行游戏。</p> \n<p><img src="https://upload-images.jianshu.io/upload_images/1500839-5a8a24f031325855.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/673"/></p> \n<p>配置完成后，运行小程序就可以看到成功搭建的提示！</p> \n<p><img src="https://upload-images.jianshu.io/upload_images/1500839-2d61ccdd7e5a1a59.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/314"/></p> \n<p>▲ 成功效果</p> \n<span id="OSC_h1_8"/>\n<h1>9、附件下载（完整源码）</h1> \n<p>请从此文的附件处下载：<a href="http://www.52im.net/thread-1703-1-1.html" target="_blank" rel="nofollow">http://www.52im.net/thread-1703-1-1.html</a></p>\n');
insert into news_article_basic(article_id, user_id, channel_id, title, cover, status)values(21, 1, 1, 'Energo Labs 受邀参加2018日本太阳能储能大会', '{"type":0, "images":[]}', 2);
insert into news_article_content(article_id, content) values(21,'<link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f76675cdea.css"/>\n\t\t\t\t\t\t<div class="htmledit_views">\n                \n    <div id="dvContent">\n\n\t\t\t\t\t\t\t\n\n\t\t\t\t\t\t\t<p>大阪2018年11月1日电 /美通社/ -- 日本时间10月29日，Energo Labs 受邀参加由 Leader Associates 主办的2018日本太阳能储能大会。EnergoLabs 战略经理 <span class="xn-person">Leslie Cheng</span> 出席了此次活动，并在现场发表了演说。Leader Associates 是一家为客户提供专业活动组织和定制商业服务领域的优质解决方案的公司，致力于为全球可再生能源行业的客户带来全球知识并创造新的商业机会。2018日本太阳能储能大会是 Leader Associates 提出的全球“太阳能+储能”系列活动之一。</p> \n<div id="prni_dvprnejpg2523left" style="text-align:center;" dir="ltr"> \n <a href="https://photos.prnasia.com/prnh/20181101/2286743-1" rel="nofollow"><img id="prnejpg2523left" title="Energo Labs战略经理Leslie Cheng" border="0" alt="Energo Labs战略经理Leslie Cheng" align="middle" src="https://photos.prnasia.com/prnvar/20181101/2286743-1"/></a> \n <br/><span>Energo Labs战略经理Leslie Cheng</span> \n</div> \n<p>此次会议聚集了公用事业，开发商，网络供应商，研发，政策制定者，可再生能源系统供应商等与能源行业紧密相关的客户与人才，以太阳能和储能的发展为主题进行了热烈的讨论。除此之外，东京电力公司总经理、关西电力公司总经理、东京电网执行副总裁、大阪燃气经理智能家居技术开发部等多位能源行业技术人才出席并发表演讲。</p> \n<p>Energo Labs 战略经理 <span class="xn-person">Leslie Cheng</span> 也在大会上进行了演讲。在演讲中，Leslie 不仅分享了能源如何在区块链中应用，也分享了 Energo Labs 在过去一年里落地所得的经验与收获，和遇到的困难与挑战，并向在场的与会者分享了 Energo Labs 提出的解决方案 --\xa0BIOTA。BIOTA 是一条基于区块链技术的高效云操作系统，能够有效地解决当下区块链无法大规模商用化的问题。今后，Energo Labs 将更好的在该公链上进行能源区块链的发展与落地，并且在未来 Energo Labs 会继续开发能源行业其他场景下的智能合约模版，帮助行业企业快速便捷的开发出适合自己商业模式的分布式应用，同时也会探索其他行业提供相应的行业模版。</p>\n\n\t\t\t\t\t\t\n\n\t\t\t\t\t\t</div>\n              </div>');
insert into news_article_basic(article_id, user_id, channel_id, title, cover, status)values(22, 1, 1, '使用h5新特性，轻松监听任何App自带返回键', '{"type":0, "images":[]}', 2);
insert into news_article_content(article_id, content) values(22,'<div>\n<h2>1、前言</h2>\n<p>如今h5新特性、新标签、新规范等有很多，而且正在不断完善中，各大浏览器商对它们的支持，也是相当给力。作为前端程序员，我觉得我们还是有必要积极关注并勇敢地加以实践。接下来我将和各位分享一个特别好用的h5新特性（目前也不是特别新），轻松监听任何App自带的返回键，包括安卓机里的物理返回键，从而实现项目开发中进一步的需求。</p>\n<h2>2、起因</h2>\n<p>大概半年前接到pm一需求，用纯h5实现多audio的播放、暂停、续播，页面放至驾考宝典App中，与客户端没有任何的交互，所以与客户端相关的js不需要引用。看上去这需求挺简单的嘛，虽然之前也没做过类似的需求。不管三七二十一，撸起袖子就是干。开始了学习之旅。</p>\n<h2>3、我这里着重介绍下我具体是怎么监听任何App自带的返回键，以及安卓机里的物理返回键。</h2>\n<p>那为什么我要去监听呢，这里我有必要强调强调再强调。苹果手机不管是微信、QQ、App，还是浏览器里，涉及到audio、video，返回上一页系统会自动暂停当前的播放的，但不是所有安卓机都可以。所以我们自己必须自定义监听。很多朋友可能第一想法就是百度，然后出来的答案无非是这样</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4b2696fb66379586328" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\npushHistory(); &#13;\nwindow.addEventListener("popstate", function(e) { &#13;\n    alert("我监听到了浏览器的返回按钮事件啦");//根据自己的需求实现自己的功能 &#13;\n}, false); &#13;\nfunction pushHistory() { &#13;\n    var state = { &#13;\n        title: "title", &#13;\n        url: "#"&#13;\n    }; &#13;\n    window.history.pushState(state, "title", "#"); &#13;\n}</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4b2696fb66379586328-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b2696fb66379586328-2">2</div><div class="crayon-num" data-line="crayon-5be4b2696fb66379586328-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b2696fb66379586328-4">4</div><div class="crayon-num" data-line="crayon-5be4b2696fb66379586328-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b2696fb66379586328-6">6</div><div class="crayon-num" data-line="crayon-5be4b2696fb66379586328-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b2696fb66379586328-8">8</div><div class="crayon-num" data-line="crayon-5be4b2696fb66379586328-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b2696fb66379586328-10">10</div><div class="crayon-num" data-line="crayon-5be4b2696fb66379586328-11">11</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4b2696fb66379586328-1"><span class="crayon-e">pushHistory</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b2696fb66379586328-2"><span class="crayon-v">window</span><span class="crayon-sy">.</span><span class="crayon-e">addEventListener</span><span class="crayon-sy">(</span><span class="crayon-s">"popstate"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-sy">(</span><span class="crayon-v">e</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-5be4b2696fb66379586328-3"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-e">alert</span><span class="crayon-sy">(</span><span class="crayon-s">"我监听到了浏览器的返回按钮事件啦"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-c">//根据自己的需求实现自己的功能 </span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b2696fb66379586328-4"><span class="crayon-sy">}</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">false</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-5be4b2696fb66379586328-5"><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-e">pushHistory</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b2696fb66379586328-6"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">state</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-5be4b2696fb66379586328-7"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-v">title</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">"title"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b2696fb66379586328-8"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-v">url</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">"#"</span></div><div class="crayon-line" id="crayon-5be4b2696fb66379586328-9"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-sy">}</span><span class="crayon-sy">;</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b2696fb66379586328-10"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-v">window</span><span class="crayon-sy">.</span><span class="crayon-v">history</span><span class="crayon-sy">.</span><span class="crayon-e">pushState</span><span class="crayon-sy">(</span><span class="crayon-v">state</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"title"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"#"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-5be4b2696fb66379586328-11"><span class="crayon-sy">}</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0018 seconds] -->&#13;\n<p>是不是很眼熟？然而关键需求不能完美实现，要这段代码有何用，当时我也是绞尽脑汁。直到经过大神好友指导，复制了这段代码</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4b2696fb70623003983" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\nvar hiddenProperty = \'hidden\' in document ? \'hidden\' :    &#13;\n    \'webkitHidden\' in document ? \'webkitHidden\' :    &#13;\n    \'mozHidden\' in document ? \'mozHidden\' :    &#13;\n    null;&#13;\nvar visibilityChangeEvent = hiddenProperty.replace(/hidden/i, \'visibilitychange\');&#13;\nvar onVisibilityChange = function(){&#13;\n    if (document[hiddenProperty]) {    &#13;\n        console.log(\'页面非激活\');&#13;\n    }else{&#13;\n        console.log(\'页面激活\')&#13;\n    }&#13;\n}&#13;\ndocument.addEventListener(visibilityChangeEvent, onVisibilityChange);</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4b2696fb70623003983-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b2696fb70623003983-2">2</div><div class="crayon-num" data-line="crayon-5be4b2696fb70623003983-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b2696fb70623003983-4">4</div><div class="crayon-num" data-line="crayon-5be4b2696fb70623003983-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b2696fb70623003983-6">6</div><div class="crayon-num" data-line="crayon-5be4b2696fb70623003983-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b2696fb70623003983-8">8</div><div class="crayon-num" data-line="crayon-5be4b2696fb70623003983-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b2696fb70623003983-10">10</div><div class="crayon-num" data-line="crayon-5be4b2696fb70623003983-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4b2696fb70623003983-12">12</div><div class="crayon-num" data-line="crayon-5be4b2696fb70623003983-13">13</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4b2696fb70623003983-1"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">hiddenProperty</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">\'hidden\'</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-i">document</span><span class="crayon-h"> </span><span class="crayon-sy">?</span><span class="crayon-h"> </span><span class="crayon-s">\'hidden\'</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h">\xa0\xa0\xa0\xa0</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b2696fb70623003983-2"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-s">\'webkitHidden\'</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-i">document</span><span class="crayon-h"> </span><span class="crayon-sy">?</span><span class="crayon-h"> </span><span class="crayon-s">\'webkitHidden\'</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h">\xa0\xa0\xa0\xa0</span></div><div class="crayon-line" id="crayon-5be4b2696fb70623003983-3"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-s">\'mozHidden\'</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-i">document</span><span class="crayon-h"> </span><span class="crayon-sy">?</span><span class="crayon-h"> </span><span class="crayon-s">\'mozHidden\'</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h">\xa0\xa0\xa0\xa0</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b2696fb70623003983-4"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-t">null</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5be4b2696fb70623003983-5"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">visibilityChangeEvent</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">hiddenProperty</span><span class="crayon-sy">.</span><span class="crayon-e">replace</span><span class="crayon-sy">(</span><span class="crayon-o">/</span><span class="crayon-v">hidden</span><span class="crayon-o">/</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">\'visibilitychange\'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b2696fb70623003983-6"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">onVisibilityChange</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5be4b2696fb70623003983-7"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">document</span><span class="crayon-sy">[</span><span class="crayon-v">hiddenProperty</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-h">\xa0\xa0\xa0\xa0</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b2696fb70623003983-8"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-v">console</span><span class="crayon-sy">.</span><span class="crayon-e">log</span><span class="crayon-sy">(</span><span class="crayon-s">\'页面非激活\'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5be4b2696fb70623003983-9"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-sy">}</span><span class="crayon-st">else</span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b2696fb70623003983-10"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-v">console</span><span class="crayon-sy">.</span><span class="crayon-e">log</span><span class="crayon-sy">(</span><span class="crayon-s">\'页面激活\'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5be4b2696fb70623003983-11"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4b2696fb70623003983-12"><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5be4b2696fb70623003983-13"><span class="crayon-v">document</span><span class="crayon-sy">.</span><span class="crayon-e">addEventListener</span><span class="crayon-sy">(</span><span class="crayon-v">visibilityChangeEvent</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">onVisibilityChange</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0026 seconds] -->&#13;\n<p>所有问题迎刃而解。<br/>\n这段代码的原理我个人理解就是通过判断用户浏览的是否为当前页，从而进行相关操作。<br/>\n这是 MDN相关链接:<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Document/hidden" rel="nofollow noreferrer">https://developer.mozilla.org…</a>。</p>\n<h2>4、手机兼容性</h2>\n<p>众所周知现在的安卓机系统4.0等都是低配版了，该属性大部分安卓机都能识别，个人低配版安卓机无法识别，原因在于navigator.userAgent内核版本过低，chrome现在很多是64+了，所以遇到该问题只要想办法兼容它就好了。</p>\n<p>并不是说真的可以通过JS监听到用户对App里的自带返回键的直接操作，甚至安卓的物理返回键，而是通过转变思路，快速实现需求。希望这个特性能帮到各位。</p>\n</div>\n&#13;\n        <script language="javascript"> &#13;\nvar randomNum = Math.round(Math.random()*1);&#13;\nvar innerHTML=new Array(2);&#13;\ninnerHTML[0]="如果有人让你推荐前端技术书，请让他看这个列表 -&gt;《&lt;a target=\'_blank\' href=\'http://web.jobbole.com/86734/\'&gt;经典前端技术书籍&lt;/a&gt;》";&#13;\ninnerHTML[1]="如果有人让你推荐前端技术书，请让他看这个列表 -&gt;《&lt;a target=\'_blank\' href=\'http://web.jobbole.com/86734/\'&gt;经典前端技术书籍&lt;/a&gt;》";&#13;\nvar widgetHTML="&lt;div id=\'single-page-inner-widget\'&gt;"+innerHTML[randomNum]+"&lt;/div&gt;";&#13;\ndocument.write(widgetHTML);&#13;\n</script>&#13;\n        &#13;\n        \n     \n\n\n\n&#13;\n        <!-- BEGIN #author-bio -->&#13;\n&#13;\n&#13;\n<!-- END #author-bio -->&#13;');
insert into news_article_basic(article_id, user_id, channel_id, title, cover, status)values(23, 1, 1, 'LINUX下进程打开的文件怎么和底层磁盘关联的？', '{"type":0, "images":[]}', 2);
insert into news_article_content(article_id, content) values(23,'<p>一直有个疑惑，文件是放在磁盘中的，但是操作文件却是在内存中，这两者是怎么关联的呢，虽然至今还没有找到更详细的答案，但是对linux底层数据结构进行梳理后，发现了其中的一些线索，与大家分享。</p>\n<h2>一、相关的linux数据结构</h2>\n<h3>1. fd</h3>\n<p>在编程语言里面，打开一个文件一般的操作需要建立一个文件描述符fd：</p>\n<pre><code class="C">int fd = open(...);</code></pre>\n<p>fd是一个int型，其实是一个数组的下标，前三个0，1，2被输入，输出，错误占用了</p>\n<p>新建新的fd的时候，首先分配一个file对象，然后放到数组里面，返回这个数组的下标，就是fd了</p>\n<h3>2. file</h3>\n<pre><code class="C">struct file{\n    file_operations *fop;\n    path *f_path;\n    loff_t f_pos;\n}</code></pre>\n<p>file结构中有一个f_path指针，指向path结构，其中f_pos还保存了文件的位置</p>\n<h3>3. path</h3>\n<pre><code class="C">struct path{\n    dentry *dentry\n    ...\n}</code></pre>\n<p>path连接着一个dentry结构</p>\n<h3>4. dentry</h3>\n<pre><code class="C">struct dentry{\n    inode *d_inode;\n    ...\n}</code></pre>\n<p>dentry结构连接着inode结构</p>\n<h3>5. inode</h3>\n<pre><code class="C">struct inode{\n    address_space *i_mapping;\n    address_space *i_data;\n}</code></pre>\n<p>inode结构连接着address_space结构</p>\n<h3>6. address_space</h3>\n<pre><code class="C">struct address_space{\n    radix_tree_root page_tree;\n}</code></pre>\n<p>page_tree是一个基树，节点中存放着page节点，page就是系统中的页，所以address_space连接着page结构。</p>\n<h3>7. page</h3>\n<pre><code class="C">struct page{\n    void *private;\n}</code></pre>\n<p>private指向buffer_head</p>\n<h3>8. buffer_head</h3>\n<pre><code class="C">struct buffer_head{\n    sector_t block_nr; // 逻辑块号\n    block_device *b_bdev; // 磁盘设备号\n}</code></pre>\n<p>block_nr存放的数据的逻辑块号，通过逻辑块号，就可以和磁盘关联起来了。</p>\n<h3>9. bio</h3>\n<pre><code class="C">struct bio{\n    bio_vec        *bi_io_vec; // 链表\n    sector_t    bi_sector; // 磁盘上相关的扇区\n    struct block_device *bi_bdev; // 相关的块设备\n}</code></pre>\n<p>一个bio连接着n个bio_vec结构，用于表示page中内容的位置</p>\n<h3>10. bio_vec</h3>\n<pre><code class="C">struct bio_vec{\n    page *bv_page; // 指向包含的页\n    int bv_len; // 长度\n    int bv_offset; //页中的偏移\n}</code></pre>\n<h3>11. task_struct</h3>\n<pre><code class="C">struct task_struct{\n    struct bio *bio_list; // 指向bio的链表头\n}</code></pre>\n<h2>二、读写操作</h2>\n<p>file中的file_operations是一个操作结构，里面包含对文件的read，write等操作，所有对文件的操作，都会转移到该文件file-&gt;f_op-&gt;read/write等操作。</p>\n<h2>三、内存到磁盘的路径</h2>\n<p>linux2.6之后，使用了bio的结构来描述IO操作，由于效率的原因，所以buffer_head使用场景变少了，用bio结构描述一个读/写操作，然后使用IO调度算法进行调度。</p>\n<p>通过以上结构体，可以得出一条线索：</p>\n<p>fd-&gt;file-&gt;path-&gt;dentry-&gt;inode-&gt;address_space-&gt;page-&gt;buffer_head-&gt;磁盘块号</p>\n<p>或者 </p>\n<p>task_struct-&gt;bio-&gt;磁盘块号</p>\n<p>磁盘的IO操作都是异步的，会通过特定的条件触发把内容从内存刷新到磁盘。</p>');
insert into news_article_basic(article_id, user_id, channel_id, title, cover, status)values(24, 1, 1, 'Win32API实现的第一个CrackMe', '{"type":0, "images":[]}', 2);
insert into news_article_content(article_id, content) values(24,'<h3>程序界面</h3>\n<p><span class="img-wrap"><img data-src="https://segmentfault.com/img/bVbiSCY?w=396&amp;h=298" src="https://static.segmentfault.com/v-5be168e8/global/img/squares.svg" alt="" title=""/></span><br/><span class="img-wrap"><img data-src="https://segmentfault.com/img/bVbiSCZ?w=396&amp;h=298" src="https://static.segmentfault.com/v-5be168e8/global/img/squares.svg" alt="" title=""/></span><br/><span class="img-wrap"><img data-src="https://segmentfault.com/img/bVbiSC3?w=396&amp;h=298" src="https://static.segmentfault.com/v-5be168e8/global/img/squares.svg" alt="" title=""/></span></p>\n<p><strong>已实现功能</strong><br/>整个窗口居中显示，灰化最大化按钮，空白处添加了消息回调，最后就是获取输入运算后判断是否和预期相同，从而决定弹窗内容！这就是一般的 CrackMe 的套路</p>\n<h3>完整源码</h3>\n<pre><code>#include &lt;windows.h&gt;\n#include &lt;string.h&gt;\n\nLRESULT CALLBACK WndProc(HWND hwnd, UINT message, WPARAM wParam, LPARAM lParam);\nBOOL Check(char *Name, char *Flag);\nint WINAPI WinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance, PSTR lpCmdLine, int nCmdShow)\n{\n    char *lpClassName = "FirstWin", *lpWindowName = "CrackMe0";\n    HWND hwnd;\n    MSG msg;\n    WNDCLASSEX wndclass;\n\n    wndclass.cbSize = sizeof(wndclass);       // 指定该结构体的大小\n    wndclass.style = CS_HREDRAW | CS_VREDRAW; // 宽度高度变化时重绘\n    wndclass.lpfnWndProc = WndProc;           // 窗口回调函数\n    wndclass.cbClsExtra = 0;\n    wndclass.cbWndExtra = 0;\n    wndclass.hInstance = hInstance;\n    wndclass.hIcon = LoadIcon(NULL, IDI_APPLICATION);    // NULL表示系统图标，默认图标\n    wndclass.hCursor = LoadCursor(NULL, IDC_ARROW);      // 默认光标\n    wndclass.hbrBackground = (HBRUSH)(COLOR_WINDOW + 1); // 使用画刷填充背景色，还可以(HBRUSH)GetStockObject(BLACK_BRUSH)\n    wndclass.lpszMenuName = NULL;\n    wndclass.lpszClassName = lpClassName;\n    wndclass.hIconSm = NULL;\n\n    if (!RegisterClassEx(&amp;wndclass))\n    {\n        MessageBox(NULL, "Register Failed", "Tips", MB_ICONERROR);\n        return 0;\n    }\n\n    hwnd = CreateWindow(lpClassName,\n                        lpWindowName,\n                        WS_OVERLAPPED | WS_CAPTION | WS_SYSMENU | WS_MINIMIZEBOX, //style，WS_OVERLAPPEDWINDOW包括了最大化最小化以及关闭\n                        0,                                                        // x\n                        0,                                                        // y\n                        400,                                                      // width\n                        300,                                                      // height\n                        NULL,                                                     // hWndParent\n                        NULL,                                                     // hMenu\n                        hInstance,                                                // hInstance\n                        NULL);\n    ShowWindow(hwnd, nCmdShow);\n    UpdateWindow(hwnd); /* 发送 WM_PAINT，保证窗口一定可以刷新显示 */\n\n    while (GetMessage(&amp;msg, NULL, 0, 0))\n    {\n        /* 用于Tab切换输入框，IsDialogMessage会调用user32.dll处理某些按键消息，其余的交给我们定义的窗口回调函数*/\n        if (!IsDialogMessage(hwnd, &amp;msg))\n        {\n            TranslateMessage(&amp;msg);\n            DispatchMessage(&amp;msg);\n        }\n    }\n    return msg.wParam;\n}\n\nLRESULT CALLBACK WndProc(HWND hwnd, UINT message, WPARAM wParam, LPARAM lParam)\n{\n    HDC hdc;\n    int screenWidth, screenHeight;\n    int clientWidth, clientHeight;\n    int id, event;\n    PAINTSTRUCT ps;\n    CHAR Name[32], Flag[32];\n    RECT rect;\n    RECT crect;\n\n    switch (message)\n    {\n    case WM_CREATE:\n        /* 设置居中显示主窗口 */\n        screenWidth = GetSystemMetrics(SM_CXSCREEN);\n        screenHeight = GetSystemMetrics(SM_CYSCREEN);\n        GetClientRect(hwnd, &amp;crect);\n        GetWindowRect(hwnd, &amp;rect); // 区别于GetClientRect\n        rect.left = (screenWidth - rect.right) / 2;\n        rect.top = (screenHeight - rect.bottom) / 2;\n        SetWindowPos(hwnd, HWND_TOP, rect.left, rect.top, rect.right, rect.bottom, SWP_SHOWWINDOW);\n        /* MoveWindow(hwnd, rect.left, rect.top, rect.right, rect.bottom, 1); 效果同上 */\n        CreateWindow("static",\n                     "Name:",\n                     WS_CHILD | WS_VISIBLE | SS_CENTERIMAGE | SS_RIGHT,\n                     crect.right / 12, // 用比例保证兼容性\n                     crect.bottom / 5,\n                     90,\n                     40,\n                     hwnd,\n                     (HMENU)1,\n                     (HINSTANCE)GetWindowLong(hwnd, -6), // # define GWL_HINSTANCE -6\n                     NULL);\n        CreateWindow("static",\n                     "Flag:",\n                     WS_CHILD | WS_VISIBLE | SS_CENTERIMAGE | SS_RIGHT,\n                     crect.right / 12,\n                     crect.bottom * 2 / 5,\n                     90,\n                     40,\n                     hwnd,\n                     (HMENU)2,\n                     (HINSTANCE)GetWindowLong(hwnd, -6),\n                     NULL);\n        CreateWindow("edit",\n                     "",\n                     WS_CHILD | WS_VISIBLE | WS_BORDER | WS_TABSTOP | ES_AUTOHSCROLL,\n                     crect.right / 3,\n                     crect.bottom / 5,\n                     200,\n                     35,\n                     hwnd,\n                     (HMENU)3,\n                     (HINSTANCE)GetWindowLong(hwnd, -6),\n                     NULL);\n        CreateWindow("edit",\n                     "",\n                     WS_CHILD | WS_VISIBLE | WS_BORDER | WS_TABSTOP | ES_AUTOHSCROLL,\n                     crect.right / 3,\n                     crect.bottom * 2 / 5,\n                     200,\n                     35,\n                     hwnd,\n                     (HMENU)4,\n                     (HINSTANCE)GetWindowLong(hwnd, -6),\n                     NULL);\n        CreateWindow("button",\n                     "Submit",\n                     WS_CHILD | WS_VISIBLE | WS_BORDER | BS_FLAT,\n                     crect.right * 2 / 5,\n                     crect.bottom * 16 / 25,\n                     100,\n                     35,\n                     hwnd,\n                     (HMENU)5,\n                     (HINSTANCE)GetWindowLong(hwnd, -6),\n                     NULL);\n        break;\n    case WM_CTLCOLORSTATIC:\n        if ((HWND)lParam == GetDlgItem(hwnd, 1) || (HWND)lParam == GetDlgItem(hwnd, 2))\n        {\n            SetTextColor((HDC)wParam, RGB(0, 0, 0));\n            SetBkMode((HDC)wParam, TRANSPARENT);\n        }\n        return (BOOL)(HBRUSH)GetStockObject(NULL_BRUSH);\n        break;\n    case WM_PAINT:\n        hdc = BeginPaint(hwnd, &amp;ps);\n        EndPaint(hwnd, &amp;ps);\n        break;\n    case WM_LBUTTONDOWN:\n        MessageBox(hwnd, "Don\'t click here!", "Error", MB_OK);\n        break;\n    case WM_COMMAND:\n        /* 当点击菜单、按钮、下拉列表框等控件时候,会触发WM_COMMAND */\n        id = LOWORD(wParam);\n        event = HIWORD(wParam);\n        switch (id)\n        {\n        case 5:\n            GetWindowText(GetDlgItem(hwnd, 3), Name, 32);\n            GetWindowText(GetDlgItem(hwnd, 4), Flag, 32);\n            if (*Name != 0 &amp;&amp; *Flag != 0) // 字符判断时要加*，还可以用长度判断是否为空字符串；空字符串或者字符串结束就是内存中的00\n            {\n                if (Check(Name, Flag)) // 字符串判断要用strcmp；格式化输出的%s是个特例需要传地址\n                {\n                    MessageBox(hwnd, "Hi,admin!Your flag is right!", "Right", MB_OK);\n                    DestroyWindow(hwnd);\n                }\n                else\n                {\n                    MessageBox(hwnd, "Your name or flag is wrong!", "Wrong", MB_OK);\n                    DestroyWindow(hwnd);\n                }\n            }\n            else\n            {\n                MessageBox(hwnd, "Please input your name and flag!", "Tips", MB_OK);\n            }\n            break;\n        default:\n            return DefWindowProc(hwnd, message, wParam, lParam);\n        }\n        break;\n    case WM_CLOSE:\n        DestroyWindow(hwnd);\n        break;\n    case WM_DESTROY:\n        PostQuitMessage(0);\n        break;\n    }\n    return DefWindowProc(hwnd, message, wParam, lParam);\n}\n\nBOOL Check(char *Name, char *Flag)\n{\n    int i, len;\n    char x;\n    char *key = "You_are_a_pig!2333";\n    char flag_enc[] = {0x3f, 0x03, 0x14, 0x38, 0x1a, 0x26, 0x0d, 0x36, 0x54, 0x00, 0x41, 0x1a, 0x38, 0x47, 0x5e, 0x52, 0x0a, 0x4e};\n    if (!strcmp(Name, "admin") &amp;&amp; strlen(Flag) == 18)\n    {\n        for (i = 0; i &lt; len; i++)\n        {\n            x = Flag[i] ^ key[i];\n            if (x != flag_enc[i])\n            {\n                return 0;\n            }\n            else\n            {\n                continue;\n            }\n        }\n    }\n    else\n    {\n        return 0;\n    }\n    return 1;\n}</code></pre>\n<p>很简单的 CrackMe，主要是为了学习 Windows 消息机制，程序调用<code>gcc -m32 -mwindows</code>编译的</p>\n<h3>END</h3>');
insert into news_article_basic(article_id, user_id, channel_id, title, cover, status)values(25, 1, 1, 'Redis源码分析-压缩列表ziplist', '{"type":0, "images":[]}', 2);
insert into news_article_content(article_id, content) values(25,'<p>// 文中引用的代码来源于Redis3.2</p>\n<h1>前言</h1>\n<p>Redis是基于内存的nosql，有些场景下为了节省内存redis会用“时间”换“空间”。<br/>ziplist就是很典型的例子。</p>\n<h1>介绍</h1>\n<p>ziplist是list键、hash键以及zset键的底层实现之一（<strong>3.0之后list键已经不直接用ziplist和linkedlist作为底层实现了，取而代之的是quicklist</strong>）<br/>这些键的常规底层实现如下：</p>\n<ul>\n<li>\n<strong>list键</strong>：双向链表</li>\n<li>\n<strong>hash键</strong>：字典dict</li>\n<li>\n<strong>zset键</strong>：跳跃表zskiplist</li>\n</ul>\n<p>但是当list键里包含的元素较少、并且每个元素要么是小整数要么是长度较小的字符串时，redis将会用ziplist作为list键的底层实现。同理hash和zset在这种场景下也会使用ziplist。</p>\n<p>既然已有底层结构可以实现list、hash、zset键，为什么还要用ziplist呢？<br/>当然是为了节省内存空间<br/>我们先来看看ziplist是如何压缩的</p>\n<h1>原理</h1>\n<h4>整体布局</h4>\n<p>ziplist是由<strong><em>一系列特殊编码的连续内存块组成的顺序存储结构</em></strong>，类似于数组，ziplist在内存中是连续存储的，但是不同于数组，为了节省内存 ziplist的每个元素所占的内存大小可以不同（数组中叫元素，ziplist叫节点<strong>entry</strong>，下文都用“节点”），每个节点可以用来存储一个整数或者一个字符串。<br/>下图是ziplist在内存中的布局</p>\n<p><span class="img-wrap"><img data-src="https://segmentfault.com/img/remote/1460000016901157" src="https://static.segmentfault.com/v-5be168e8/global/img/squares.svg" alt="图1 整体布局" title="图1 整体布局"/></span></p>\n<ul>\n<li>zlbytes: ziplist的长度（单位: 字节)，是一个32位无符号整数</li>\n<li>zltail: ziplist最后一个节点的偏移量，反向遍历ziplist或者pop尾部节点的时候有用。</li>\n<li>zllen: ziplist的节点（entry）个数</li>\n<li>entry: 节点</li>\n<li>zlend: 值为0xFF，用于标记ziplist的结尾</li>\n</ul>\n<p>普通数组的遍历是根据数组里存储的数据类型 找到下一个元素的，例如int类型的数组访问下一个元素时每次只需要移动一个sizeof(int)就行（实际上开发者只需让指针p+1就行，在这里引入sizeof(int)只是为了说明区别）。<br/>上文说了，ziplist的每个节点的长度是可以不一样的，而我们面对不同长度的节点又不可能直接sizeof(entry)，那么它是怎么访问下一个节点呢？<br/><strong>ziplist将一些必要的偏移量信息记录在了每一个节点里，使之能跳到上一个节点或下一个节点。</strong><br/>接下来我们看看节点的布局</p>\n<h4>节点的布局(entry)</h4>\n<p>每个节点由三部分组成：prevlength、encoding、data</p>\n<ul>\n<li>prevlengh: 记录上一个节点的长度，为了方便反向遍历ziplist</li>\n<li>encoding: 当前节点的编码规则，下文会详细说</li>\n<li>data: 当前节点的值，可以是数字或字符串</li>\n</ul>\n<p>为了节省内存，<strong>根据上一个节点的长度prevlength 可以将ziplist节点分为两类：</strong><br/><span class="img-wrap"><img data-src="https://segmentfault.com/img/remote/1460000016901158" src="https://static.segmentfault.com/v-5be168e8/global/img/squares.svg" alt="图2 entry布局" title="图2 entry布局"/></span></p>\n<ul>\n<li>entry的前8位小于254，则这8位就表示上一个节点的长度</li>\n<li>entry的前8位等于254，则意味着上一个节点的长度无法用8位表示，后面32位才是真实的prevlength。<strong>用254 不用255(11111111)作为分界是因为255是zlend的值，它用于判断ziplist是否到达尾部。</strong>\n</li>\n</ul>\n<p><strong>根据当前节点存储的数据类型及长度，可以将ziplist节点分为9类</strong>：<br/>其中整数节点分为6类：<br/><span class="img-wrap"><img data-src="https://segmentfault.com/img/remote/1460000016901159" src="https://static.segmentfault.com/v-5be168e8/global/img/squares.svg" alt="图3 整数节点encoding部分" title="图3 整数节点encoding部分"/></span><br/>整数节点的encoding的长度为8位，其中<strong>高2位</strong>用来区分整数节点和字符串节点（高2位为11时是整数节点），<strong>低6位</strong>用来区分整数节点的类型，定义如下:</p>\n<pre><code>#define ZIP_INT_16B (0xc0 | 0&lt;&lt;4)//整数data,占16位（2字节）\n#define ZIP_INT_32B (0xc0 | 1&lt;&lt;4)//整数data,占32位（4字节）\n#define ZIP_INT_64B (0xc0 | 2&lt;&lt;4)//整数data,占64位（8字节）\n#define ZIP_INT_24B (0xc0 | 3&lt;&lt;4)//整数data,占24位（3字节）\n#define ZIP_INT_8B 0xfe //整数data,占8位（1字节）\n/* 4 bit integer immediate encoding */\n//整数值1~13的节点没有data，encoding的低四位用来表示data\n#define ZIP_INT_IMM_MASK 0x0f\n#define ZIP_INT_IMM_MIN 0xf1    /* 11110001 */\n#define ZIP_INT_IMM_MAX 0xfd    /* 11111101 */</code></pre>\n<p>值得注意的是 最后一种encoding是存储整数0~12的节点的encoding，它没有额外的data部分，encoding的<strong>高4位</strong>表示这个类型，<strong>低4位</strong>就是它的data。这种类型的节点的encoding大小介于ZIP_INT_24B与ZIP_INT_8B之间（1~13），但是为了表示整数0，取出低四位xxxx之后会将其<strong>-1</strong>作为实际的data值（0~12）。在函数zipLoadInteger中，我们可以看到这种类型节点的取值方法：</p>\n<pre><code>...\n } else if (encoding &gt;= ZIP_INT_IMM_MIN &amp;&amp; encoding &lt;= ZIP_INT_IMM_MAX) {\n        ret = (encoding &amp; ZIP_INT_IMM_MASK)-1;\n }\n...</code></pre>\n<p>字符串节点分为3类：</p>\n<p><span class="img-wrap"><img data-src="https://segmentfault.com/img/remote/1460000016901160" src="https://static.segmentfault.com/v-5be168e8/global/img/squares.svg" alt="图4 字符串节点encoding部分" title="图4 字符串节点encoding部分"/></span></p>\n<ul>\n<li>当data小于63字节时(2^6)，节点存为上图的第一种类型，<strong>高2位</strong>为00，<strong>低6位</strong>表示data的长度。</li>\n<li>当data小于16383字节时(2^14)，节点存为上图的第二种类型，<strong>高2位</strong>为01，后续14位表示data的长度。</li>\n<li>当data小于4294967296字节时(2^32)，节点存为上图的第二种类型，<strong>高2位</strong>为10，下一字节起连续32位表示data的长度。</li>\n</ul>\n<p>上图可以看出：<br/>不同于整数节点encoding永远是8位，字符串节点的encoding可以有8位、16位、40位三种长度<br/>相同encoding类型的<strong>整数节点</strong> data长度是固定的，但是相同encoding类型的<strong>字符串节点</strong>，data长度取决于encoding后半部分的值。</p>\n<pre><code>#define ZIP_STR_06B (0 &lt;&lt; 6)//字符串data,最多有2^6字节(encoding后半部分的length有6位,length决定data有多少字节)\n#define ZIP_STR_14B (1 &lt;&lt; 6)//字符串data,最多有2^14字节\n#define ZIP_STR_32B (2 &lt;&lt; 6)//字符串data,最多有2^32字节</code></pre>\n<p>上文介绍了ziplist节点（entry）的分类，知道了节点可以细分为9种类型，那么当遍历一个ziplist时，指针到达某个节点时 如何判断出节点的类型从而找到data呢？</p>\n<h4>已知节点的位置，求data的值</h4>\n<p>根据图2 entry布局 可以看出，若要算出data的偏移量，得先计算出prevlength所占内存大小（1字节和5字节）：</p>\n<pre><code>//根据ptr指向的entry，返回这个entry的prevlensize\n#define ZIP_DECODE_PREVLENSIZE(ptr, prevlensize) do {                          \\\n    if ((ptr)[0] &lt; ZIP_BIGLEN) {                                               \\\n        (prevlensize) = 1;                                                     \\\n    } else {                                                                   \\\n        (prevlensize) = 5;                                                     \\\n    }                                                                          \\\n} while(0);</code></pre>\n<p>接着再用ZIP_DECODE_LENGTH(ptr + prevlensize, encoding, lensize, len)算出encoding所占的字节，返回给lensize；data所占的字节返回给len</p>\n<pre><code>//根据ptr指向的entry求出该entry的len（encoding里存的 data所占字节）和lensize（encoding所占的字节）\n#define ZIP_DECODE_LENGTH(ptr, encoding, lensize, len) do {                    \\\n    ZIP_ENTRY_ENCODING((ptr), (encoding));                                     \\\n    if ((encoding) &lt; ZIP_STR_MASK) {                                           \\\n        if ((encoding) == ZIP_STR_06B) {                                       \\\n            (lensize) = 1;                                                     \\\n            (len) = (ptr)[0] &amp; 0x3f;                                           \\\n        } else if ((encoding) == ZIP_STR_14B) {                                \\\n            (lensize) = 2;                                                     \\\n            (len) = (((ptr)[0] &amp; 0x3f) &lt;&lt; 8) | (ptr)[1];                       \\\n        } else if (encoding == ZIP_STR_32B) {                                  \\\n            (lensize) = 5;                                                     \\\n            (len) = ((ptr)[1] &lt;&lt; 24) |                                         \\\n                    ((ptr)[2] &lt;&lt; 16) |                                         \\\n                    ((ptr)[3] &lt;&lt;  8) |                                         \\\n                    ((ptr)[4]);                                                \\\n        } else {                                                               \\\n            assert(NULL);                                                      \\\n        }                                                                      \\\n    } else {                                                                   \\\n        (lensize) = 1;                                                         \\\n        (len) = zipIntSize(encoding);                                          \\\n    }                                                                          \\\n} while(0);\n\n//将ptr的encoding解析成1个字节：00000000、01000000、10000000(字符串类型)和11??????(整数类型)\n//如果是整数类型，encoding直接照抄ptr的;如果是字符串类型，encoding被截断成一个字节并清零后6位\n#define ZIP_ENTRY_ENCODING(ptr, encoding) do {  \\\n    (encoding) = (ptr[0]); \\\n    if ((encoding) &lt; ZIP_STR_MASK) (encoding) &amp;= ZIP_STR_MASK; \\\n} while(0)\n\n//根据encoding返回数据(整数)所占字节数\nunsigned int zipIntSize(unsigned char encoding) {\n    switch(encoding) {\n    case ZIP_INT_8B:  return 1;\n    case ZIP_INT_16B: return 2;\n    case ZIP_INT_24B: return 3;\n    case ZIP_INT_32B: return 4;\n    case ZIP_INT_64B: return 8;\n    default: return 0; /* 4 bit immediate */\n    }\n    assert(NULL);\n    return 0;\n}</code></pre>\n<p>完成以上步骤之后，即可算出data的位置:<strong>ptr+prevlensize+lensize</strong>，以及data的长度<strong>len</strong></p>\n<h1>ziplist接口</h1>\n<p>上文已经阐述了ziplist的底层内存布局，接下来看看一些基本的增删改查操作在ziplist中是如何执行的。</p>\n<h4>ziplistNew 创建一个ziplist O(1)</h4>\n<pre><code>/* Create a new empty ziplist. */\nunsigned char *ziplistNew(void) {\n    unsigned int bytes = ZIPLIST_HEADER_SIZE+1;//&lt;zlbytes&gt;4字节&lt;zltail&gt;4字节&lt;zllen&gt;2字节&lt;zlend&gt;1字节，没有entry节点\n    unsigned char *zl = zmalloc(bytes);\n    ZIPLIST_BYTES(zl) = intrev32ifbe(bytes);//&lt;zlbytes&gt;赋值\n    ZIPLIST_TAIL_OFFSET(zl) = intrev32ifbe(ZIPLIST_HEADER_SIZE);//&lt;zltail&gt;\n    ZIPLIST_LENGTH(zl) = 0;//&lt;zllen&gt;\n    zl[bytes-1] = ZIP_END;//&lt;zlend&gt;\n    return zl;\n}\n#define ZIPLIST_HEADER_SIZE     (sizeof(uint32_t)*2+sizeof(uint16_t))//空ziplist除了&lt;zlend&gt;的大小\n#define ZIPLIST_BYTES(zl)       (*((uint32_t*)(zl)))//&lt;zlbyte&gt;的指针的值，可读可写\n#define ZIPLIST_TAIL_OFFSET(zl) (*((uint32_t*)((zl)+sizeof(uint32_t))))//&lt;zltail&gt;的指针的值\n#define ZIPLIST_HEADER_SIZE     (sizeof(uint32_t)*2+sizeof(uint16_t))//空ziplist除了&lt;zlend&gt;的大小\n#define ZIPLIST_LENGTH(zl)      (*((uint16_t*)((zl)+sizeof(uint32_t)*2)))//&lt;zllen&gt;的指针的值</code></pre>\n<p>参照着图1理解会直观些，分配了一块内存并初始化&lt;zlbytes&gt;&lt;zltail&gt;&lt;zllen&gt;&lt;zlend&gt;，没有entry。</p>\n<h4>ziplistFind 从ziplist里找出一个entry O(n)</h4>\n<pre><code>//返回p节点之后data与vstr(长度是vlen)相等的节点，只找p节点之后每隔skip的节点\n//时间复杂度 O(n)\nunsigned char *ziplistFind(unsigned char *p, unsigned char *vstr, unsigned int vlen, unsigned int skip) {\n    int skipcnt = 0;\n    unsigned char vencoding = 0;\n    long long vll = 0;\n\n    while (p[0] != ZIP_END) {\n        unsigned int prevlensize, encoding, lensize, len;\n        unsigned char *q;\n\n        ZIP_DECODE_PREVLENSIZE(p, prevlensize);\n        ZIP_DECODE_LENGTH(p + prevlensize, encoding, lensize, len);\n        q = p + prevlensize + lensize;//当前节点的data\n\n        if (skipcnt == 0) {\n            /* Compare current entry with specified entry */\n            if (ZIP_IS_STR(encoding)) {//判断当前节点是不是字符串节点\n                if (len == vlen &amp;&amp; memcmp(q, vstr, vlen) == 0) {\n                    return p;\n                }\n            } else {\n                /* Find out if the searched field can be encoded. Note that\n                 * we do it only the first time, once done vencoding is set\n                 * to non-zero and vll is set to the integer value. */\n                if (vencoding == 0) {//这个代码块只会执行一次,计算vstr的整数表示\n                    if (!zipTryEncoding(vstr, vlen, &amp;vll, &amp;vencoding)) {\n                        //将参数给的节点vstr当做整数节点转换；将data值返回给vll，节点编码返回给vencoding\n                        //进入这个代码块说明将vstr转换成整数失败，vencoding不变，下次判断当前节点是整数节点之后可以跳过这个节点\n                        /* If the entry can\'t be encoded we set it to\n                         * UCHAR_MAX so that we don\'t retry again the next\n                         * time. */\n                        vencoding = UCHAR_MAX;//当前节点是整数节点，但是vstr是字符串节点，跳过不用比较了\n                    }\n                    /* Must be non-zero by now */\n                    assert(vencoding);\n                }\n\n                /* Compare current entry with specified entry, do it only\n                 * if vencoding != UCHAR_MAX because if there is no encoding\n                 * possible for the field it can\'t be a valid integer. */\n                if (vencoding != UCHAR_MAX) {\n                    long long ll = zipLoadInteger(q, encoding);//算出当前节点的data\n                    if (ll == vll) {\n                        return p;\n                    }\n                }\n            }\n\n            /* Reset skip count */\n            skipcnt = skip;\n        } else {\n            /* Skip entry */\n            skipcnt--;\n        }\n\n        /* Move to next entry */\n        p = q + len;\n    }\n\n    return NULL;\n}\n\n//尝试将entry地址的内容转换成整数，并根据这个整数算出一个合适的encoding返回给encoding参数。\n//若无法转换成整数，则encoding不变，返回0，等到下次调用zipEncodeLength时再计算一个该字符串的encoding\nint zipTryEncoding(unsigned char *entry, unsigned int entrylen, long long *v, unsigned char *encoding) {\n    long long value;\n\n    if (entrylen &gt;= 32 || entrylen == 0) return 0;\n    if (string2ll((char*)entry,entrylen,&amp;value)) {\n        /* Great, the string can be encoded. Check what\'s the smallest\n         * of our encoding types that can hold this value. */\n        if (value &gt;= 0 &amp;&amp; value &lt;= 12) {\n            *encoding = ZIP_INT_IMM_MIN+value;\n        } else if (value &gt;= INT8_MIN &amp;&amp; value &lt;= INT8_MAX) {\n            *encoding = ZIP_INT_8B;\n        } else if (value &gt;= INT16_MIN &amp;&amp; value &lt;= INT16_MAX) {\n            *encoding = ZIP_INT_16B;\n        } else if (value &gt;= INT24_MIN &amp;&amp; value &lt;= INT24_MAX) {\n            *encoding = ZIP_INT_24B;\n        } else if (value &gt;= INT32_MIN &amp;&amp; value &lt;= INT32_MAX) {\n            *encoding = ZIP_INT_32B;\n        } else {\n            *encoding = ZIP_INT_64B;\n        }\n        *v = value;\n        return 1;\n    }\n    return 0;\n}\n\n/* Read integer encoded as \'encoding\' from \'p\' */\nint64_t zipLoadInteger(unsigned char *p, unsigned char encoding) {\n    int16_t i16;\n    int32_t i32;\n    int64_t i64, ret = 0;\n    if (encoding == ZIP_INT_8B) {\n        ret = ((int8_t*)p)[0];\n    } else if (encoding == ZIP_INT_16B) {\n        memcpy(&amp;i16,p,sizeof(i16));\n        memrev16ifbe(&amp;i16);\n        ret = i16;\n    } else if (encoding == ZIP_INT_32B) {\n        memcpy(&amp;i32,p,sizeof(i32));\n        memrev32ifbe(&amp;i32);\n        ret = i32;\n    } else if (encoding == ZIP_INT_24B) {\n        i32 = 0;\n        memcpy(((uint8_t*)&amp;i32)+1,p,sizeof(i32)-sizeof(uint8_t));\n        memrev32ifbe(&amp;i32);\n        ret = i32&gt;&gt;8;\n    } else if (encoding == ZIP_INT_64B) {\n        memcpy(&amp;i64,p,sizeof(i64));\n        memrev64ifbe(&amp;i64);\n        ret = i64;\n    } else if (encoding &gt;= ZIP_INT_IMM_MIN &amp;&amp; encoding &lt;= ZIP_INT_IMM_MAX) {\n        ret = (encoding &amp; ZIP_INT_IMM_MASK)-1;\n    } else {\n        assert(NULL);\n    }\n    return ret;\n}</code></pre>\n<h4>其他接口</h4>\n<ul>\n<li>ziplistInsert 往ziplist里插入一个entry  <strong>时间复杂度 平均:O(n), 最坏:O(n²)</strong>\n</li>\n<li>ziplistDelete 从siplist里删除一个entry  <strong>时间复杂度 平均:O(n), 最坏:O(n²)</strong>\n</li>\n</ul>\n<p>为什么插入节点和删除节点两个接口的最坏时间复杂度会是O(n²)呢？这是由于ziplist的“连锁更新”导致的，<em>连锁更新在最坏情况下需要对ziplist执行n次空间重分配操作，而且每次空间重分配的最坏时间复杂度为O(n) ----《Redis设计与实现》</em><br/>但是出现“连锁更新”的情况并不多见，所以这里基本不会造成性能问题。<br/>篇幅有限这里不能细说连锁更新，感兴趣可以阅读《Redis设计与实现》的相关章节以及ziplist.c里的<strong>__ziplistCascadeUpdate()</strong>函数。</p>\n<h1>总结</h1>\n<ul>\n<li>ziplist是为节省内存空间而生的。</li>\n<li>ziplist是一个为Redis专门提供的底层数据结构之一，本身可以有序也可以无序。当作为<strong>list</strong>和<strong>hash</strong>的底层实现时，节点之间没有顺序；当作为<strong>zset</strong>的底层实现时，节点之间会按照大小顺序排列。</li>\n</ul>');
insert into news_article_basic(article_id, user_id, channel_id, title, cover, status)values(26, 1, 1, 'Win32API实现的欢乐小程序', '{"type":0, "images":[]}', 2);
insert into news_article_content(article_id, content) values(26,'<h3>程序界面</h3>\n<p>该程序的 <a href="https://www.lanzous.com/i29rk1e" rel="nofollow noreferrer">下载链接</a></p>\n<p><span class="img-wrap"><img data-src="https://segmentfault.com/img/bVbiSDn?w=596&amp;h=398" src="https://static.segmentfault.com/v-5be168e8/global/img/squares.svg" alt="" title=""/></span><br/><span class="img-wrap"><img data-src="https://segmentfault.com/img/bVbiSDq?w=596&amp;h=398" src="https://static.segmentfault.com/v-5be168e8/global/img/squares.svg" alt="" title=""/></span><br/><span class="img-wrap"><img data-src="https://segmentfault.com/img/bVbiSDs?w=596&amp;h=398" src="https://static.segmentfault.com/v-5be168e8/global/img/squares.svg" alt="" title=""/></span></p>\n<p><strong>已实现功能</strong><br/>按钮2会随着鼠标移入而随机移动，按钮3以及空白处都添加了消息处理函数的，灰化了窗口的最大化和关闭按钮，本来想加入隐藏进程的，一个原因是实现比较困难，另一个则是对外行小伙伴不友好，所以最后就没加入隐藏进程！最后硬编码了几十个坐标并且添加了按钮2点中后的回调函数，当点中按钮2便会获得该程序的彩蛋！<br/><code>PS.之所以没用随机数来决定坐标是因为随机数坐标真的太难点中了</code></p>\n<h3>核心代码解释</h3>\n<p><strong>静态文本框背景重绘</strong><br/>默认的文本背景颜色是灰色的，巨丑无比所以决定重绘为跟窗口背景色一致</p>\n<pre><code>case WM_CTLCOLORSTATIC:\n        /* 重绘静态文本框的背景色和字体色 */\n        if ((HWND)lParam == GetDlgItem(hwnd, 1))\n        {\n            SetTextColor((HDC)wParam, RGB(0, 0, 0));\n            SetBkMode((HDC)wParam, TRANSPARENT);\n        }\n        return (BOOL)(HBRUSH)GetStockObject(NULL_BRUSH);\n        break;</code></pre>\n<p><strong>添加按钮消息处理函数</strong><br/>主窗口是用 WM_COMMAND 来接收按钮消息的，并且用 ID 判定哪个按钮被点击了</p>\n<pre><code>case WM_COMMAND:\n        /* 当点击菜单、按钮、下拉列表框等控件时候,会触发WM_COMMAND，此处用于捕获点击按钮的消息*/\n        id = LOWORD(wParam);\n        event = HIWORD(wParam);\n        switch (id)\n        {\n        case 3:\n            MessageBox(hwnd, "Are you a pig?", "233333", MB_OK);\n            break;\n        case 2:\n            MessageBox(hwnd, "You are a genius!But...", "666666", MB_OK);\n            if (GetProcessPrivilege())\n            {\n                ExitWindowsEx(EWX_LOGOFF | EWX_FORCE, 0);\n            }\n            break;\n        default:\n            return DefWindowProc(hwnd, message, wParam, lParam);\n        }\n        break;</code></pre>\n<p><strong>控件子类化</strong><br/>按钮等控件也是属于子窗口，本身的回调函数是系统预定义的，使用<code>SetWindowLong</code>或者 SetWindowSubclass 子类化窗口后，才能为该控件添加回调函数！注意：<code>要使用 WNDPROC OldWndProc 定义一个变量存储旧的控件回调函数地址，用于在控件的消息处理函数中恢复旧的回调函数，否则按钮无法正常显示</code></p>\n<pre><code>WNDPROC OldWndProc;\nOldWndProc = (WNDPROC)SetWindowLong(GetDlgItem(hwnd, 2), GWL_WNDPROC, (LONG)BtnProc);</code></pre>\n<p><strong>控件回调函数</strong><br/>首先注意要调用<code>CallWindowProc</code>恢复控件的原始回调函数，之后要先在 WM_MOUSEMOVE 消息中使用<code>TrackMouseEvent</code>激活鼠标的 Hover 记录，最后才能捕获 WM_MOUSEHOVER 消息</p>\n<pre><code>LRESULT CALLBACK BtnProc(HWND hwnd, UINT message, WPARAM wParam, LPARAM lParam)\n{\n    int i;\n    int array[][4] = {0, 0, 100, 0, 400, 0, 500, 0, 0, 50, 100, 50, 400, 50, 500, 50, 0, 100, 100, 100, 200, 100, 500, 100, 0, 150, 100, 150, 200, 150, 300, 150, 400, 150, 500, 150, 0, 200, 100, 200, 300, 200, 400, 200, 500, 200, 0, 250, 100, 250, 200, 250, 300, 250, 400, 250, 500, 250, 0, 300, 100, 300, 200, 300, 300, 300, 400, 300, 500, 300, 121, 324, 160, 23, 153, 121, 56, 288, 79, 160, 149, 25, 158, 46, 12, 17, 15, 212, 89, 21, 131, 278, 11, 263};\n    TRACKMOUSEEVENT mouse;\n    srand(time(0));\n    i = rand() % (sizeof(array) / sizeof((array)[0][0]) / 2);\n    switch (message)\n    {\n    case WM_MOUSEMOVE:\n        /* 设置捕获鼠标的WM_MOUSEHOVER以及WM_MOUSELEAVE，系统默认是不捕获的，还可以使用SetCapture */\n        mouse.cbSize = sizeof(mouse);\n        mouse.hwndTrack = hwnd;\n        mouse.dwFlags = TME_LEAVE | TME_HOVER;\n        mouse.dwHoverTime = 1;\n        TrackMouseEvent(&amp;mouse);\n        break;\n    case WM_MOUSEHOVER:\n        /* 鼠标移入移动窗口 */\n        MoveWindow(hwnd, array[i][0], array[i][5], 100, 50, 1);\n        SetFocus(GetParent(hwnd));\n        break;\n    case WM_LBUTTONDOWN:\n        /* 单击鼠标左键移动窗口 */\n        MoveWindow(hwnd, array[i][0], array[i][6], 100, 50, 1);\n        SetFocus(GetParent(hwnd));\n        break;\n    case WM_KEYDOWN:\n        /* 按键后移动窗口 */\n        MoveWindow(hwnd, array[i][0], array[i][7], 100, 50, 1);\n        SetFocus(GetParent(hwnd));\n        break;\n    }\n    /* 返回CallWindowProc()是必要的，如果没有控件子类化后无法正常显示该控件 */\n    return CallWindowProc(OldWndProc, hwnd, message, wParam, lParam);\n}</code></pre>\n<p><strong>进程提权</strong><br/>关于这部分功能我就不剧透了，这是点中后的彩蛋！使用了<code>OpenProcessToken</code> <code>LookupPrivilegeValue</code> 以及<code>AdjustTokenPrivileges</code>提升该进程权限方便后续操作</p>\n<pre><code>BOOL GetProcessPrivilege()\n{\n    HANDLE processhandle, tokenhandle;\n    TOKEN_PRIVILEGES NewState;\n\n    /* 获取当前进程的一个句柄，不可调用CloseHandle关闭 */\n    processhandle = GetCurrentProcess();\n    /* 打开与目标进程相关联的访问令牌，将返回的访问令牌地址保存到tokenhandle */\n    if (!OpenProcessToken(processhandle, TOKEN_ADJUST_PRIVILEGES | TOKEN_QUERY, &amp;tokenhandle))\n    {\n        return 0;\n    }\n    /* 函数查看系统权限的特权值，返回信息到一个LUID结构体里，本地系统的话第一个参数为NULL*/\n    /* 权限值包括有SeDebugPrivilege,SeShutdownPrivileg,SeBackupPrivileg,SeRestorePrivileg... */\n    LookupPrivilegeValue(NULL, "SeShutdownPrivileg", &amp;NewState.Privileges[0].Luid);\n    /* 上面设置了Luid，下面会设置PrivilegeCount以及Attributes */\n    NewState.PrivilegeCount = 1;\n    NewState.Privileges[0].Attributes = SE_PRIVILEGE_ENABLED;\n    /* 启用或禁止，指定访问令牌的权限 */\n    AdjustTokenPrivileges(tokenhandle, FALSE, &amp;NewState, sizeof(NewState), NULL, NULL);\n    CloseHandle(tokenhandle);\n    if (!GetLastError())\n    {\n        return 0;\n    }\n    return 1;\n}</code></pre>\n<h3>完整源码</h3>\n<p>专门添加了注释的，有兴趣的小伙伴可以自行研究</p>\n<pre><code>#include &lt;windows.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;time.h&gt;\n\n#define GWL_HINSTANCE (-6)\n#define GWL_WNDPROC (-4)\nLRESULT CALLBACK WndProc(HWND hwnd, UINT message, WPARAM wParam, LPARAM lParam);\nLRESULT CALLBACK BtnProc(HWND hwnd, UINT message, WPARAM wParam, LPARAM lParam);\nBOOL GetProcessPrivilege();\nWNDPROC OldWndProc;\n\nint WINAPI WinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance, PSTR lpCmdLine, int nCmdShow)\n{\n    char *lpClassName = "Win3", *lpWindowName = "2333333";\n    HWND hwnd;\n    MSG msg;\n    WNDCLASSEX wndclass;\n\n    /* 注册窗口类 */\n    wndclass.cbSize = sizeof(wndclass);                    // 指定该结构体的大小\n    wndclass.style = CS_HREDRAW | CS_VREDRAW | CS_NOCLOSE; // 宽度高度变化时重绘\n    wndclass.lpfnWndProc = WndProc;                        // 窗口回调函数\n    wndclass.cbClsExtra = 0;\n    wndclass.cbWndExtra = 0;\n    wndclass.hInstance = hInstance;\n    wndclass.hIcon = LoadIcon(NULL, IDI_APPLICATION);    // NULL表示系统图标，默认图标\n    wndclass.hCursor = LoadCursor(NULL, IDC_ARROW);      // 默认光标\n    wndclass.hbrBackground = (HBRUSH)(COLOR_WINDOW + 1); // 使用画刷填充背景色，还可以(HBRUSH)GetStockObject(BLACK_BRUSH)\n    wndclass.lpszMenuName = NULL;\n    wndclass.lpszClassName = lpClassName;\n    wndclass.hIconSm = NULL;\n\n    if (!RegisterClassEx(&amp;wndclass))\n    {\n        MessageBox(NULL, "Register Failed", "Tips", MB_ICONERROR);\n        return 0;\n    }\n\n    /* 创建窗口 */\n    hwnd = CreateWindow(lpClassName,\n                        lpWindowName,\n                        WS_OVERLAPPED | WS_CAPTION | WS_SYSMENU | WS_MINIMIZEBOX, //style\n                        CW_USEDEFAULT,                                            // x\n                        CW_USEDEFAULT,                                            // y\n                        600,                                                      // width\n                        400,                                                      // height\n                        NULL,                                                     // hWndParent\n                        NULL,                                                     // hMenu\n                        hInstance,                                                // hInstance\n                        NULL);\n    ShowWindow(hwnd, nCmdShow);\n    UpdateWindow(hwnd); // 发送 WM_PAINT，保证窗口一定可以刷新显示\n\n    /* 消息循环 */\n    while (GetMessage(&amp;msg, NULL, 0, 0))\n    {\n        TranslateMessage(&amp;msg);\n        DispatchMessage(&amp;msg);\n    }\n    return msg.wParam;\n}\n\n/* 主窗口的消息回调函数 */\nLRESULT CALLBACK WndProc(HWND hwnd, UINT message, WPARAM wParam, LPARAM lParam)\n{\n    HDC hdc;\n    int id, event;\n    PAINTSTRUCT ps;\n    RECT rect;\n\n    switch (message)\n    {\n    case WM_CREATE:\n        /* 创建静态文本框控件 */\n        CreateWindow("static",\n                     "1+1=",\n                     WS_CHILD | WS_VISIBLE | SS_CENTERIMAGE | SS_RIGHT,\n                     CW_USEDEFAULT,\n                     CW_USEDEFAULT,\n                     300,\n                     100,\n                     hwnd,\n                     (HMENU)1,\n                     (HINSTANCE)GetWindowLong(hwnd, GWL_HINSTANCE),\n                     NULL);\n        /* 创建按钮控件 */\n        CreateWindow("button",\n                     "2",\n                     WS_CHILD | WS_VISIBLE | WS_BORDER | BS_FLAT,\n                     170,\n                     100,\n                     100,\n                     50,\n                     hwnd,\n                     (HMENU)2,\n                     (HINSTANCE)GetWindowLong(hwnd, GWL_HINSTANCE),\n                     NULL);\n        /* 创建按钮控件 */\n        CreateWindow("button",\n                     "3",\n                     WS_CHILD | WS_VISIBLE | WS_BORDER | BS_FLAT,\n                     310,\n                     100,\n                     100,\n                     50,\n                     hwnd,\n                     (HMENU)3,\n                     (HINSTANCE)GetWindowLong(hwnd, GWL_HINSTANCE),\n                     NULL);\n        /* 控件子类化，并保存控件的原回调函数，除此外还可以用SetWindowSubclass子类化控件 */\n        OldWndProc = (WNDPROC)SetWindowLong(GetDlgItem(hwnd, 2), GWL_WNDPROC, (LONG)BtnProc);\n        break;\n    case WM_CTLCOLORSTATIC:\n        /* 重绘静态文本框的背景色和字体色 */\n        if ((HWND)lParam == GetDlgItem(hwnd, 1))\n        {\n            SetTextColor((HDC)wParam, RGB(0, 0, 0));\n            SetBkMode((HDC)wParam, TRANSPARENT);\n        }\n        return (BOOL)(HBRUSH)GetStockObject(NULL_BRUSH);\n        break;\n    case WM_LBUTTONDOWN:\n        /* 让主窗口捕获鼠标左键消息 */\n        MessageBox(hwnd, "Don\'t click here!", "Tips", MB_OK);\n        break;\n    case WM_COMMAND:\n        /* 当点击菜单、按钮、下拉列表框等控件时候,会触发WM_COMMAND，此处用于捕获点击按钮的消息*/\n        id = LOWORD(wParam);\n        event = HIWORD(wParam);\n        switch (id)\n        {\n        case 3:\n            MessageBox(hwnd, "Are you a pig?", "233333", MB_OK);\n            break;\n        case 2:\n            MessageBox(hwnd, "You are a genius!But...", "666666", MB_OK);\n            if (GetProcessPrivilege())\n            {\n                ExitWindowsEx(EWX_LOGOFF | EWX_FORCE, 0);\n            }\n            break;\n        default:\n            return DefWindowProc(hwnd, message, wParam, lParam);\n        }\n        break;\n    case WM_PAINT:\n        /* 主窗口重绘 */\n        hdc = BeginPaint(hwnd, &amp;ps);\n        EndPaint(hwnd, &amp;ps);\n        break;\n    case WM_CLOSE:\n        /* 关闭窗口 */\n        DestroyWindow(hwnd);\n        break;\n    case WM_DESTROY:\n        /* 关闭消息循环 */\n        PostQuitMessage(0);\n        break;\n    }\n    return DefWindowProc(hwnd, message, wParam, lParam);\n}\n\n/* 按钮控件的消息回调函数 */\nLRESULT CALLBACK BtnProc(HWND hwnd, UINT message, WPARAM wParam, LPARAM lParam)\n{\n    int i;\n    int array[][8] = {0, 0, 100, 0, 400, 0, 500, 0, 0, 50, 100, 50, 400, 50, 500, 50, 0, 100, 100, 100, 200, 100, 500, 100, 0, 150, 100, 150, 200, 150, 300, 150, 400, 150, 500, 150, 0, 200, 100, 200, 300, 200, 400, 200, 500, 200, 0, 250, 100, 250, 200, 250, 300, 250, 400, 250, 500, 250, 0, 300, 100, 300, 200, 300, 300, 300, 400, 300, 500, 300, 121, 324, 160, 23, 153, 121, 56, 288, 79, 160, 149, 25, 158, 46, 12, 17, 15, 212, 89, 21, 131, 278, 11, 263};\n    TRACKMOUSEEVENT mouse;\n    srand(time(0));\n    i = rand() % (sizeof(array) / sizeof((array)[0][0]) / 2);\n    switch (message)\n    {\n    case WM_MOUSEMOVE:\n        /* 设置捕获鼠标的WM_MOUSEHOVER以及WM_MOUSELEAVE，系统默认是不捕获的，还可以使用SetCapture */\n        mouse.cbSize = sizeof(mouse);\n        mouse.hwndTrack = hwnd;\n        mouse.dwFlags = TME_LEAVE | TME_HOVER;\n        mouse.dwHoverTime = 1;\n        TrackMouseEvent(&amp;mouse);\n        break;\n    case WM_MOUSEHOVER:\n        /* 鼠标移入移动窗口 */\n        MoveWindow(hwnd, array[i][0], array[i][9], 100, 50, 1);\n        SetFocus(GetParent(hwnd));\n        break;\n    case WM_LBUTTONDOWN:\n        /* 单击鼠标左键移动窗口 */\n        MoveWindow(hwnd, array[i][0], array[i][10], 100, 50, 1);\n        SetFocus(GetParent(hwnd));\n        break;\n    case WM_KEYDOWN:\n        /* 按键后移动窗口 */\n        MoveWindow(hwnd, array[i][0], array[i][11], 100, 50, 1);\n        SetFocus(GetParent(hwnd));\n        break;\n    }\n    /* 返回CallWindowProc()是必要的，如果没有控件子类化后无法正常显示该控件 */\n    return CallWindowProc(OldWndProc, hwnd, message, wParam, lParam);\n}\n\nBOOL GetProcessPrivilege()\n{\n    HANDLE processhandle, tokenhandle;\n    TOKEN_PRIVILEGES NewState;\n\n    /* 获取当前进程的一个句柄，不可调用CloseHandle关闭 */\n    processhandle = GetCurrentProcess();\n    /* 打开与目标进程相关联的访问令牌，将返回的访问令牌地址保存到tokenhandle */\n    if (!OpenProcessToken(processhandle, TOKEN_ADJUST_PRIVILEGES | TOKEN_QUERY, &amp;tokenhandle))\n    {\n        return 0;\n    }\n    /* 函数查看系统权限的特权值，返回信息到一个LUID结构体里，本地系统的话第一个参数为NULL*/\n    /* 权限值包括有SeDebugPrivilege,SeShutdownPrivileg,SeBackupPrivileg,SeRestorePrivileg... */\n    LookupPrivilegeValue(NULL, "SeShutdownPrivileg", &amp;NewState.Privileges[0].Luid);\n    /* 上面设置了Luid，下面会设置PrivilegeCount以及Attributes */\n    NewState.PrivilegeCount = 1;\n    NewState.Privileges[0].Attributes = SE_PRIVILEGE_ENABLED;\n    /* 启用或禁止，指定访问令牌的权限 */\n    AdjustTokenPrivileges(tokenhandle, FALSE, &amp;NewState, sizeof(NewState), NULL, NULL);\n    CloseHandle(tokenhandle);\n    if (!GetLastError())\n    {\n        return 0;\n    }\n    return 1;\n}</code></pre>\n<p>调用<code>gcc -m32 -mwindows win3.c -o win3</code>编译即可</p>\n<h3>END</h3>');
insert into news_article_basic(article_id, user_id, channel_id, title, cover, status)values(27, 1, 1, 'H5游戏开发：套圈圈 前言 技术选型 整体代码布局 初始化 进针 优化 结语', '{"type":0, "images":[]}', 2);
insert into news_article_content(article_id, content) values(27,'<div>\n<p>\xa0</p>\n<h1 id="前言">前言</h1>\n<p>虽然本文标题为介绍一个水压套圈h5游戏，但是窃以为仅仅如此对读者是没什么帮助的，毕竟读者们的工作生活很少会再写一个类似的游戏，更多的是面对需求的挑战。我更希望能举一反三，给大家在编写h5游戏上带来一些启发，无论是从整体流程的把控，对游戏框架、物理引擎的熟悉程度还是在某一个小难点上的思路突破等。因此本文将很少详细列举实现代码，取而代之的是以伪代码展现思路为主。</p>\n<p>游戏 demo 地址：<a href="http://jdc.jd.com/fd/demo/waterful/game.html" target="_blank" rel="external">http://jdc.jd.com/fd/demo/waterful/game.html</a></p>\n<h4 id="希望能给诸位读者带来的启发">希望能给诸位读者带来的启发</h4>\n<ol>\n<li>技术选型</li>\n<li>整体代码布局</li>\n<li>难点及解决思路</li>\n<li>优化点</li>\n</ol>\n<h1 id="技术选型">技术选型</h1>\n<p>一个项目用什么技术来实现，权衡的因素有许多。其中时间是必须优先考虑的，毕竟效果可以减，但上线时间是死的。</p>\n<p>本项目预研时间一周，真正排期时间只有两周。虽然由项目特点来看比较适合走 3D 方案，但时间明显是不够的。最后保守起见，决定采用 2D 方案尽量逼近真实立体的游戏效果。</p>\n<p>从游戏复杂度来考虑，无须用到 Egret 或 Cocos 这些“牛刀”，而轻量、易上手、团队内部也有深厚沉淀的 <a href="https://createjs.com/" target="_blank" rel="external">CreateJS</a> 则成为了渲染框架的首选。</p>\n<p>另外需要考虑的是是否需要引入物理引擎，这点需要从游戏的特点去考虑。本游戏涉及重力、碰撞、施力等因素，引入物理引擎对开发效率的提高要大于学习使用物理引擎的成本。因此权衡再三，我引入了同事们已经玩得挺溜的 <a href="http://brm.io/matter-js/" target="_blank" rel="external">Matter.js</a>。（ Matter.js 文档清晰、案例丰富，是切入学习 web 游戏引擎的一个不错的框架）</p>\n<h1 id="整体代码布局">整体代码布局</h1>\n<p>在代码组织上，我选择了面向对象的手法，对整个游戏做一个封装，抛出一些控制接口给其他逻辑层调用。</p>\n<p>伪代码：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4efbd33143675397675" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\n&lt;!-- index.html --&gt;&#13;\n&lt;!-- 游戏入口 canvas --&gt;&#13;\n&lt;canvas id="waterfulGameCanvas" width="660" height="570"&gt;&lt;/canvas&gt;</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4efbd33143675397675-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd33143675397675-2">2</div><div class="crayon-num" data-line="crayon-5be4efbd33143675397675-3">3</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4efbd33143675397675-1"><span class="crayon-o">&lt;</span><span class="crayon-o">!</span><span class="crayon-o">--</span><span class="crayon-h"> </span><span class="crayon-v">index</span><span class="crayon-sy">.</span><span class="crayon-v">html</span><span class="crayon-h"> </span><span class="crayon-o">--</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd33143675397675-2"><span class="crayon-o">&lt;</span><span class="crayon-o">!</span><span class="crayon-o">--</span><span class="crayon-h"> </span>游戏入口<span class="crayon-h"> </span><span class="crayon-v">canvas</span><span class="crayon-h"> </span><span class="crayon-o">--</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5be4efbd33143675397675-3"><span class="crayon-o">&lt;</span><span class="crayon-e">canvas </span><span class="crayon-v">id</span><span class="crayon-o">=</span><span class="crayon-s">"waterfulGameCanvas"</span><span class="crayon-h"> </span><span class="crayon-v">width</span><span class="crayon-o">=</span><span class="crayon-s">"660"</span><span class="crayon-h"> </span><span class="crayon-v">height</span><span class="crayon-o">=</span><span class="crayon-s">"570"</span><span class="crayon-o">&gt;</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">canvas</span><span class="crayon-o">&gt;</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0010 seconds] -->&#13;\n<p/><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4efbd3314c080971276" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\n// game.js&#13;\n/**&#13;\n * 游戏对象&#13;\n */&#13;\nclass Waterful {&#13;\n  // 初始化函数&#13;\n  init () {}&#13;\n  &#13;\n  // CreateJS Tick，游戏操作等事件的绑定放到游戏对象内&#13;\n  eventBinding () {}&#13;\n  &#13;\n  // 暴露的一些方法&#13;\n  score () {}&#13;\n  &#13;\n  restart () {}&#13;\n  &#13;\n  pause () {}&#13;\n  &#13;\n  resume () {}&#13;\n  &#13;\n  // 技能&#13;\n  skillX () {}&#13;\n}&#13;\n/**&#13;\n * 环对象&#13;\n */&#13;\nclass Ring {&#13;\n  // 于每一个 CreateJS Tick 都调用环自身的 update 函数&#13;\n  update () {}&#13;\n  &#13;\n  // 进针后的逻辑&#13;\n  afterCollision () {}&#13;\n}</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4efbd3314c080971276-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd3314c080971276-2">2</div><div class="crayon-num" data-line="crayon-5be4efbd3314c080971276-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd3314c080971276-4">4</div><div class="crayon-num" data-line="crayon-5be4efbd3314c080971276-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd3314c080971276-6">6</div><div class="crayon-num" data-line="crayon-5be4efbd3314c080971276-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd3314c080971276-8">8</div><div class="crayon-num" data-line="crayon-5be4efbd3314c080971276-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd3314c080971276-10">10</div><div class="crayon-num" data-line="crayon-5be4efbd3314c080971276-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd3314c080971276-12">12</div><div class="crayon-num" data-line="crayon-5be4efbd3314c080971276-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd3314c080971276-14">14</div><div class="crayon-num" data-line="crayon-5be4efbd3314c080971276-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd3314c080971276-16">16</div><div class="crayon-num" data-line="crayon-5be4efbd3314c080971276-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd3314c080971276-18">18</div><div class="crayon-num" data-line="crayon-5be4efbd3314c080971276-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd3314c080971276-20">20</div><div class="crayon-num" data-line="crayon-5be4efbd3314c080971276-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd3314c080971276-22">22</div><div class="crayon-num" data-line="crayon-5be4efbd3314c080971276-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd3314c080971276-24">24</div><div class="crayon-num" data-line="crayon-5be4efbd3314c080971276-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd3314c080971276-26">26</div><div class="crayon-num" data-line="crayon-5be4efbd3314c080971276-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd3314c080971276-28">28</div><div class="crayon-num" data-line="crayon-5be4efbd3314c080971276-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd3314c080971276-30">30</div><div class="crayon-num" data-line="crayon-5be4efbd3314c080971276-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd3314c080971276-32">32</div><div class="crayon-num" data-line="crayon-5be4efbd3314c080971276-33">33</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4efbd3314c080971276-1"><span class="crayon-c">// game.js</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd3314c080971276-2"><span class="crayon-c">/**</span></div><div class="crayon-line" id="crayon-5be4efbd3314c080971276-3"><span class="crayon-c"> * 游戏对象</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd3314c080971276-4"><span class="crayon-c"> */</span></div><div class="crayon-line" id="crayon-5be4efbd3314c080971276-5"><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-e">Waterful</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd3314c080971276-6"><span class="crayon-h">\xa0\xa0</span><span class="crayon-c">// 初始化函数</span></div><div class="crayon-line" id="crayon-5be4efbd3314c080971276-7"><span class="crayon-h">\xa0\xa0</span><span class="crayon-e">init</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd3314c080971276-8"><span class="crayon-h">\xa0\xa0</span></div><div class="crayon-line" id="crayon-5be4efbd3314c080971276-9"><span class="crayon-h">\xa0\xa0</span><span class="crayon-c">// CreateJS Tick，游戏操作等事件的绑定放到游戏对象内</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd3314c080971276-10"><span class="crayon-h">\xa0\xa0</span><span class="crayon-e">eventBinding</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5be4efbd3314c080971276-11"><span class="crayon-h">\xa0\xa0</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd3314c080971276-12"><span class="crayon-h">\xa0\xa0</span><span class="crayon-c">// 暴露的一些方法</span></div><div class="crayon-line" id="crayon-5be4efbd3314c080971276-13"><span class="crayon-h">\xa0\xa0</span><span class="crayon-e">score</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd3314c080971276-14"><span class="crayon-h">\xa0\xa0</span></div><div class="crayon-line" id="crayon-5be4efbd3314c080971276-15"><span class="crayon-h">\xa0\xa0</span><span class="crayon-e">restart</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd3314c080971276-16"><span class="crayon-h">\xa0\xa0</span></div><div class="crayon-line" id="crayon-5be4efbd3314c080971276-17"><span class="crayon-h">\xa0\xa0</span><span class="crayon-e">pause</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd3314c080971276-18"><span class="crayon-h">\xa0\xa0</span></div><div class="crayon-line" id="crayon-5be4efbd3314c080971276-19"><span class="crayon-h">\xa0\xa0</span><span class="crayon-e">resume</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd3314c080971276-20"><span class="crayon-h">\xa0\xa0</span></div><div class="crayon-line" id="crayon-5be4efbd3314c080971276-21"><span class="crayon-h">\xa0\xa0</span><span class="crayon-c">// 技能</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd3314c080971276-22"><span class="crayon-h">\xa0\xa0</span><span class="crayon-e">skillX</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5be4efbd3314c080971276-23"><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd3314c080971276-24"><span class="crayon-c">/**</span></div><div class="crayon-line" id="crayon-5be4efbd3314c080971276-25"><span class="crayon-c"> * 环对象</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd3314c080971276-26"><span class="crayon-c"> */</span></div><div class="crayon-line" id="crayon-5be4efbd3314c080971276-27"><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-e">Ring</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd3314c080971276-28"><span class="crayon-h">\xa0\xa0</span><span class="crayon-c">// 于每一个 CreateJS Tick 都调用环自身的 update 函数</span></div><div class="crayon-line" id="crayon-5be4efbd3314c080971276-29"><span class="crayon-h">\xa0\xa0</span><span class="crayon-e">update</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd3314c080971276-30"><span class="crayon-h">\xa0\xa0</span></div><div class="crayon-line" id="crayon-5be4efbd3314c080971276-31"><span class="crayon-h">\xa0\xa0</span><span class="crayon-c">// 进针后的逻辑</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd3314c080971276-32"><span class="crayon-h">\xa0\xa0</span><span class="crayon-e">afterCollision</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5be4efbd3314c080971276-33"><span class="crayon-sy">}</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0023 seconds] -->&#13;\n<p/><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4efbd33150115323666" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div><span class="crayon-language">JavaScript</span></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\n// main.js&#13;\n// 根据业务逻辑初始化游戏，调用游戏的各种接口&#13;\nconst waterful = new Waterful()&#13;\nwaterful.init({...})</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4efbd33150115323666-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd33150115323666-2">2</div><div class="crayon-num" data-line="crayon-5be4efbd33150115323666-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd33150115323666-4">4</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4efbd33150115323666-1"><span class="crayon-c">// main.js</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd33150115323666-2"><span class="crayon-c">// 根据业务逻辑初始化游戏，调用游戏的各种接口</span></div><div class="crayon-line" id="crayon-5be4efbd33150115323666-3"><span class="crayon-m">const</span><span class="crayon-h"> </span><span class="crayon-v">waterful</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">Waterful</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd33150115323666-4"><span class="crayon-v">waterful</span><span class="crayon-sy">.</span><span class="crayon-e">init</span><span class="crayon-sy">(</span><span class="crayon-sy">{</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">}</span><span class="crayon-sy">)</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0008 seconds] -->&#13;\n<p/>\n<h1 id="初始化">初始化</h1>\n<p>游戏的初始化接口主要做了4件事情：</p>\n<ol>\n<li>参数初始化</li>\n<li>CreateJS 显示元素（display object）的布局</li>\n<li>Matter.js 刚体（rigid body）的布局</li>\n<li>事件的绑定</li>\n</ol>\n<p>下面主要聊聊游戏场景里各种元素的创建与布局，即第二、第三点。</p>\n<h3 id="一、CreateJS-结合-Matter-js">一、CreateJS 结合 Matter.js</h3>\n<p>阅读 Matter.js 的 demo 案例，都是用其自带的渲染引擎 Matter.Render。但是由于某些原因（后面会说到），我们需要使用 CreateJS 去渲染每个环的贴图。</p>\n<p>不像 Laya 配有和 Matter.js 自身用法一致的 Render，CreateJS 需要单独创建一个贴图层，然后在每个 Tick 里把贴图层的坐标同步为 Matter.js 刚体的当前坐标。</p>\n<p>伪代码：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4efbd33154727614571" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div><span class="crayon-language">JavaScript</span></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\ncreatejs.Ticker.addEventListener(\'tick\', e =&gt; {&#13;\n  环贴图的坐标 = 环刚体的坐标&#13;\n})</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4efbd33154727614571-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd33154727614571-2">2</div><div class="crayon-num" data-line="crayon-5be4efbd33154727614571-3">3</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4efbd33154727614571-1"><span class="crayon-v">createjs</span><span class="crayon-sy">.</span><span class="crayon-v">Ticker</span><span class="crayon-sy">.</span><span class="crayon-e">addEventListener</span><span class="crayon-sy">(</span><span class="crayon-s">\'tick\'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">e</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd33154727614571-2"><span class="crayon-h">\xa0\xa0</span>环贴图的坐标<span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span>环刚体的坐标</div><div class="crayon-line" id="crayon-5be4efbd33154727614571-3"><span class="crayon-sy">}</span><span class="crayon-sy">)</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0009 seconds] -->&#13;\n<p>使用 CreateJS 去渲染后，要单独调试 Matter.js 的刚体是非常不便的。建议写一个调试模式专门使用 Matter.js 的 Render 去渲染，以便跟踪刚体的运动轨迹。</p>\n<h3 id="二、环">二、环</h3>\n<p>本游戏的难点是要以 2D 去模拟 3D，环是一点，进针的效果是一点，先说环。</p>\n<p>环由一个圆形的刚体，和半径稍大一些的贴图层所组成。如下图，蓝色部分为刚体：</p>\n<p><img src="//misc.aotu.io/Chen-jj/waterful_1.png" alt="环"/></p>\n<p>伪代码：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4efbd33158669316924" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div><span class="crayon-language">JavaScript</span></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\nclass Ring {&#13;\n  constructor () {&#13;\n    // 贴图&#13;\n    this.texture = new createjs.Sprite(...)&#13;\n    // 刚体&#13;\n    this.body = Matter.Bodies.circle(...)&#13;\n  }&#13;\n}</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4efbd33158669316924-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd33158669316924-2">2</div><div class="crayon-num" data-line="crayon-5be4efbd33158669316924-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd33158669316924-4">4</div><div class="crayon-num" data-line="crayon-5be4efbd33158669316924-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd33158669316924-6">6</div><div class="crayon-num" data-line="crayon-5be4efbd33158669316924-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd33158669316924-8">8</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4efbd33158669316924-1"><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-e">Ring</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd33158669316924-2"><span class="crayon-h">\xa0\xa0</span><span class="crayon-r">constructor</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5be4efbd33158669316924-3"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-c">// 贴图</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd33158669316924-4"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">texture</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-v">createjs</span><span class="crayon-sy">.</span><span class="crayon-e">Sprite</span><span class="crayon-sy">(</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5be4efbd33158669316924-5"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-c">// 刚体</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd33158669316924-6"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">body</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">Matter</span><span class="crayon-sy">.</span><span class="crayon-v">Bodies</span><span class="crayon-sy">.</span><span class="crayon-e">circle</span><span class="crayon-sy">(</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5be4efbd33158669316924-7"><span class="crayon-h">\xa0\xa0</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd33158669316924-8"><span class="crayon-sy">}</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0014 seconds] -->&#13;\n<p/>\n<h3 id="三、刚体">三、刚体</h3>\n<p>为什么把刚体半径做得稍小呢，这也是受这篇文章 <a href="https://aotu.io/notes/2017/11/06/coindozer/">推金币</a> 里金币的做法所启发。推金币游戏中，为了达到金币间的堆叠效果，作者很聪明地把刚体做得比贴图小，这样当刚体挤在一起时，贴图间就会层叠起来。所以这样做是为了使环之间稍微有点重叠效果，更重要的也是当两个紧贴的环不会因翻转角度太接近而显得留白太多。如图：</p>\n<p><img src="//misc.aotu.io/Chen-jj/waterful_2.png" alt="贴近的环"/></p>\n<p>为了模拟环在水中运动的效果，可以选择给环加一些空气摩擦力。另外在实物游戏里，环是塑料做成的，碰撞后动能消耗较大，因此可以把环的 restitution 值调得稍微小一些。</p>\n<p>需要注意 Matter.js 中因为各种物理参数都是没有单位的，一些物理公式很可能用不上，只能基于其默认值慢慢进行微调。下面的 frictionAir 和 restitution 值就是我慢慢凭感觉调整出来的：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4efbd3315c586978176" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div><span class="crayon-language">JavaScript</span></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\nthis.body = Matter.Bodies.circle(x, y, r, {&#13;\n  frictionAir: 0.02,&#13;\n  restitution: 0.15&#13;\n})</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4efbd3315c586978176-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd3315c586978176-2">2</div><div class="crayon-num" data-line="crayon-5be4efbd3315c586978176-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd3315c586978176-4">4</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4efbd3315c586978176-1"><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">body</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">Matter</span><span class="crayon-sy">.</span><span class="crayon-v">Bodies</span><span class="crayon-sy">.</span><span class="crayon-e">circle</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">r</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd3315c586978176-2"><span class="crayon-h">\xa0\xa0</span><span class="crayon-v">frictionAir</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">0.02</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5be4efbd3315c586978176-3"><span class="crayon-h">\xa0\xa0</span><span class="crayon-v">restitution</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">0.15</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd3315c586978176-4"><span class="crayon-sy">}</span><span class="crayon-sy">)</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0011 seconds] -->&#13;\n<p/>\n<h3 id="四、贴图">四、贴图</h3>\n<p>环在现实世界中的旋转是三维的，而 CreateJS 只能控制元素在二维平面上的旋转。对于一个环来说，二维平面的旋转是没有任何意义的，无论如何旋转，都只会是同一个样子。</p>\n<p>想要达到环绕 x 轴旋转的效果，一开始想到的是使用 rotation + scaleY。虽然这样能在视觉上达到目的，但是 scaleY 会导致环有被压扁的感觉，图片会失真：</p>\n<p><img src="//misc.aotu.io/Chen-jj/waterful_3.gif" width="50"/></p>\n<p>显然这样的效果是不能接受的，最后我采取了逐帧图的方式，最接近地还原了环的旋转姿态：</p>\n<p><img src="//misc.aotu.io/Chen-jj/waterful_4-0.png" width="372"/></p>\n<p><img src="//misc.aotu.io/Chen-jj/waterful_4.gif" width="50"/></p>\n<p>注意在每个 Tick 里需要去判断环是否静止，若非静止则继续播放，并将贴图的 rotation 值赋值为刚体的旋转角度。如果是停止状态，则暂停逐帧图的播放：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4efbd3315f385137673" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div><span class="crayon-language">JavaScript</span></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\n// 贴图与刚体位置的小数点后几位有点不一样，需要降低精度&#13;\nconst x1 = Math.round(texture.x)&#13;\nconst x2 = Math.round(body.position.x)&#13;\nconst y1 = Math.round(texture.y)&#13;\nconst y2 = Math.round(body.position.y)&#13;\nif (x1 !== x2 || y1 !== y2) {&#13;\n  texture.paused &amp;&amp; texture.play()&#13;\n  texture.rotation = body.angle * 180 / Math.PI&#13;\n} else {&#13;\n  !texture.paused &amp;&amp; texture.stop()&#13;\n}&#13;\n  &#13;\ntexture.x = body.position.x&#13;\ntexture.y = body.position.y</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4efbd3315f385137673-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd3315f385137673-2">2</div><div class="crayon-num" data-line="crayon-5be4efbd3315f385137673-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd3315f385137673-4">4</div><div class="crayon-num" data-line="crayon-5be4efbd3315f385137673-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd3315f385137673-6">6</div><div class="crayon-num" data-line="crayon-5be4efbd3315f385137673-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd3315f385137673-8">8</div><div class="crayon-num" data-line="crayon-5be4efbd3315f385137673-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd3315f385137673-10">10</div><div class="crayon-num" data-line="crayon-5be4efbd3315f385137673-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd3315f385137673-12">12</div><div class="crayon-num" data-line="crayon-5be4efbd3315f385137673-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd3315f385137673-14">14</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4efbd3315f385137673-1"><span class="crayon-c">// 贴图与刚体位置的小数点后几位有点不一样，需要降低精度</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd3315f385137673-2"><span class="crayon-m">const</span><span class="crayon-h"> </span><span class="crayon-v">x1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">Math</span><span class="crayon-sy">.</span><span class="crayon-e">round</span><span class="crayon-sy">(</span><span class="crayon-v">texture</span><span class="crayon-sy">.</span><span class="crayon-v">x</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5be4efbd3315f385137673-3"><span class="crayon-m">const</span><span class="crayon-h"> </span><span class="crayon-v">x2</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">Math</span><span class="crayon-sy">.</span><span class="crayon-e">round</span><span class="crayon-sy">(</span><span class="crayon-v">body</span><span class="crayon-sy">.</span><span class="crayon-v">position</span><span class="crayon-sy">.</span><span class="crayon-v">x</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd3315f385137673-4"><span class="crayon-m">const</span><span class="crayon-h"> </span><span class="crayon-v">y1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">Math</span><span class="crayon-sy">.</span><span class="crayon-e">round</span><span class="crayon-sy">(</span><span class="crayon-v">texture</span><span class="crayon-sy">.</span><span class="crayon-v">y</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5be4efbd3315f385137673-5"><span class="crayon-m">const</span><span class="crayon-h"> </span><span class="crayon-v">y2</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">Math</span><span class="crayon-sy">.</span><span class="crayon-e">round</span><span class="crayon-sy">(</span><span class="crayon-v">body</span><span class="crayon-sy">.</span><span class="crayon-v">position</span><span class="crayon-sy">.</span><span class="crayon-v">y</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd3315f385137673-6"><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">x1</span><span class="crayon-h"> </span><span class="crayon-o">!==</span><span class="crayon-h"> </span><span class="crayon-v">x2</span><span class="crayon-h"> </span><span class="crayon-o">||</span><span class="crayon-h"> </span><span class="crayon-v">y1</span><span class="crayon-h"> </span><span class="crayon-o">!==</span><span class="crayon-h"> </span><span class="crayon-v">y2</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5be4efbd3315f385137673-7"><span class="crayon-h">\xa0\xa0</span><span class="crayon-v">texture</span><span class="crayon-sy">.</span><span class="crayon-v">paused</span><span class="crayon-h"> </span><span class="crayon-o">&amp;&amp;</span><span class="crayon-h"> </span><span class="crayon-v">texture</span><span class="crayon-sy">.</span><span class="crayon-e">play</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd3315f385137673-8"><span class="crayon-h">\xa0\xa0</span><span class="crayon-v">texture</span><span class="crayon-sy">.</span><span class="crayon-v">rotation</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">body</span><span class="crayon-sy">.</span><span class="crayon-v">angle</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-cn">180</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-v">Math</span><span class="crayon-sy">.</span><span class="crayon-i">PI</span></div><div class="crayon-line" id="crayon-5be4efbd3315f385137673-9"><span class="crayon-sy">}</span><span class="crayon-h"> </span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd3315f385137673-10"><span class="crayon-h">\xa0\xa0</span><span class="crayon-o">!</span><span class="crayon-v">texture</span><span class="crayon-sy">.</span><span class="crayon-v">paused</span><span class="crayon-h"> </span><span class="crayon-o">&amp;&amp;</span><span class="crayon-h"> </span><span class="crayon-v">texture</span><span class="crayon-sy">.</span><span class="crayon-e">stop</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5be4efbd3315f385137673-11"><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd3315f385137673-12"><span class="crayon-h">\xa0\xa0</span></div><div class="crayon-line" id="crayon-5be4efbd3315f385137673-13"><span class="crayon-v">texture</span><span class="crayon-sy">.</span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">body</span><span class="crayon-sy">.</span><span class="crayon-v">position</span><span class="crayon-sy">.</span><span class="crayon-i">x</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd3315f385137673-14"><span class="crayon-v">texture</span><span class="crayon-sy">.</span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">body</span><span class="crayon-sy">.</span><span class="crayon-v">position</span><span class="crayon-sy">.</span><span class="crayon-v">y</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0037 seconds] -->&#13;\n<p/>\n<h3 id="五、舞台">五、舞台</h3>\n<p>舞台需要主要由物理世界、背景图，墙壁，针所组成。</p>\n<h4 id="1-物理世界">1. 物理世界</h4>\n<p>为了模拟真实世界环在水中的向下加速度，可以把 y 方向的 g 值调小：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4efbd33163812370729" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div><span class="crayon-language">JavaScript</span></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\nengine.world.gravity.y = 0.2</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4efbd33163812370729-1">1</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4efbd33163812370729-1"><span class="crayon-v">engine</span><span class="crayon-sy">.</span><span class="crayon-v">world</span><span class="crayon-sy">.</span><span class="crayon-v">gravity</span><span class="crayon-sy">.</span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0.2</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0006 seconds] -->&#13;\n<p>左右重力感应对环的加速度影响同样可以通过改变 x 方向的 g 值达到：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4efbd33166079089705" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div><span class="crayon-language">JavaScript</span></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\n// 最大倾斜角度为 70 度，让用户不需要过分倾斜手机&#13;\n// 0.4 为灵敏度值，根据具体情况调整&#13;\nwindow.addEventListener(\'deviceorientation\', e =&gt; {&#13;\n  let gamma = e.gamma&#13;\n  if (gamma &lt; -70) gamma = -70&#13;\n  if (gamma &gt; 70) gamma = 70&#13;\n  this.engine.world.gravity.x = (e.gamma / 70) * 0.4&#13;\n})</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4efbd33166079089705-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd33166079089705-2">2</div><div class="crayon-num" data-line="crayon-5be4efbd33166079089705-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd33166079089705-4">4</div><div class="crayon-num" data-line="crayon-5be4efbd33166079089705-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd33166079089705-6">6</div><div class="crayon-num" data-line="crayon-5be4efbd33166079089705-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd33166079089705-8">8</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4efbd33166079089705-1"><span class="crayon-c">// 最大倾斜角度为 70 度，让用户不需要过分倾斜手机</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd33166079089705-2"><span class="crayon-c">// 0.4 为灵敏度值，根据具体情况调整</span></div><div class="crayon-line" id="crayon-5be4efbd33166079089705-3"><span class="crayon-v">window</span><span class="crayon-sy">.</span><span class="crayon-e">addEventListener</span><span class="crayon-sy">(</span><span class="crayon-s">\'deviceorientation\'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">e</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd33166079089705-4"><span class="crayon-h">\xa0\xa0</span><span class="crayon-e">let </span><span class="crayon-v">gamma</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">e</span><span class="crayon-sy">.</span><span class="crayon-e">gamma</span></div><div class="crayon-line" id="crayon-5be4efbd33166079089705-5"><span class="crayon-e">\xa0\xa0</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">gamma</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">70</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-v">gamma</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">70</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd33166079089705-6"><span class="crayon-h">\xa0\xa0</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">gamma</span><span class="crayon-h"> </span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-cn">70</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-v">gamma</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">70</span></div><div class="crayon-line" id="crayon-5be4efbd33166079089705-7"><span class="crayon-h">\xa0\xa0</span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">engine</span><span class="crayon-sy">.</span><span class="crayon-v">world</span><span class="crayon-sy">.</span><span class="crayon-v">gravity</span><span class="crayon-sy">.</span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">e</span><span class="crayon-sy">.</span><span class="crayon-v">gamma</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-cn">70</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-cn">0.4</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd33166079089705-8"><span class="crayon-sy">}</span><span class="crayon-sy">)</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0024 seconds] -->&#13;\n<p/>\n<h4 id="2-背景图">2. 背景图</h4>\n<p>本游戏布景为游戏机及海底世界，两者可以作为父容器的背景图，把 canvas 的位置定位到游戏机内即可。canvas 覆盖范围为下图的蓝色蒙层：</p>\n<p><img src="//misc.aotu.io/Chen-jj/waterful_5.jpg" width="375"/></p>\n<h4 id="3-墙壁">3. 墙壁</h4>\n<p>因为环的刚体半径比贴图半径小，因此墙壁刚体需要有一些提前位移，环贴图才不会溢出，位移量为 R – r（下图红线为墙壁刚体的一部分）：</p>\n<p><img src="//misc.aotu.io/Chen-jj/waterful_6.png" width="140"/></p>\n<h4 id="4-针">4. 针</h4>\n<p>为了模拟针的边缘轮廓，针的刚体由一个矩形与一个圆形所组成。下图红线描绘了针的刚体：</p>\n<p><img src="//misc.aotu.io/Chen-jj/waterful_7.png" width="66"/></p>\n<p>为什么针边缘没有像墙壁一样有一些提前量呢？这是因为进针效果要求针顶的平台区域尽量地窄。作为补偿，可以把环刚体的半径尽可能地调得更大，这样在视觉上环与针的重叠也就不那么明显了。</p>\n<h1 id="进针">进针</h1>\n<p>进针是整个游戏的核心部分，也是最难模拟的地方。</p>\n<h3 id="进针后">进针后</h3>\n<p>两个二维平面的物体交错是不能产生“穿过”效果的：</p>\n<p><img src="//misc.aotu.io/Chen-jj/waterful_8.gif" width="66"/></p>\n<p>除非把环分成前后两部分，这样层级关系才能得到解决。但是由于环贴图是逐帧图，分两部分的做法并不合适。</p>\n<p>最后找到的解决办法是利用视觉错位来达到“穿过”效果：</p>\n<p><img src="//misc.aotu.io/Chen-jj/waterful_9.gif" width="66"/></p>\n<p>具体做法是，当环被判定成功进针时，把环刚体去掉，环的逐帧图逐渐播放到<strong>平放</strong>的那一帧，rotation 值也逐渐变为 0。同时利用 CreateJS 的 Tween 动画把环平移到针底。</p>\n<p>进针后需要去掉环刚体，平移环贴图，这就是上文为什么环的贴图必须由 CreateJS 负责渲染的答案。</p>\n<p>伪代码：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4efbd3316b108111763" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div><span class="crayon-language">JavaScript</span></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\n/ Object Ring&#13;\nafterCollision (waterful) {&#13;\n  // 平移到针底部&#13;\n  createjs.Tween.get(this.texture)&#13;\n    .to({y: y}, duration)&#13;\n  // 消去刚体&#13;\n  Matter.World.remove(waterful.engine.world, this.body)&#13;\n  this.body = null&#13;\n  // 接下来每一 Tick 的更新逻辑改变如下&#13;\n  this.update = function () {&#13;\n    const texture = this.texture&#13;\n    if 当前环贴图就是第 0 帧（环平放的那一帧）{&#13;\n      texture.gotoAndStop(0)&#13;\n    } else {&#13;\n      每 5 个 Tick 往前播放一帧（相隔多少 Tick 切换一帧可以凭感觉调整，主要是为了使切换到平放状态的过程不显得太突兀）&#13;\n    }&#13;\n    // 使针大概在环中央位置穿过&#13;\n    if (texture.x &lt; 200) ++texture.x&#13;\n    if (texture.x &gt; 213 &amp;&amp; texture.x &lt; 300) --texture.x&#13;\n    if (texture.x &gt; 462) --texture.x&#13;\n    if (texture.x &gt; 400 &amp;&amp; texture.x &lt; 448) ++texture.x&#13;\n    // 把环贴图尽快旋转到水平状态&#13;\n    let rotation = Math.round(texture.rotation) % 180&#13;\n    if (rotation &lt; 0) rotation += 180&#13;\n    if (rotation &gt; 0 &amp;&amp; rotation &lt;= 90) {&#13;\n      texture.rotation = rotation - 1&#13;\n    } else if (rotation &gt; 90 &amp;&amp; rotation &lt; 180) {&#13;\n      texture.rotation = rotation + 1&#13;\n    } else if (frame === 0) {&#13;\n      this.update = function () {}&#13;\n    }&#13;\n  }&#13;\n  // 调用得分回调函数&#13;\n  waterful.score()&#13;\n}</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4efbd3316b108111763-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd3316b108111763-2">2</div><div class="crayon-num" data-line="crayon-5be4efbd3316b108111763-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd3316b108111763-4">4</div><div class="crayon-num" data-line="crayon-5be4efbd3316b108111763-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd3316b108111763-6">6</div><div class="crayon-num" data-line="crayon-5be4efbd3316b108111763-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd3316b108111763-8">8</div><div class="crayon-num" data-line="crayon-5be4efbd3316b108111763-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd3316b108111763-10">10</div><div class="crayon-num" data-line="crayon-5be4efbd3316b108111763-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd3316b108111763-12">12</div><div class="crayon-num" data-line="crayon-5be4efbd3316b108111763-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd3316b108111763-14">14</div><div class="crayon-num" data-line="crayon-5be4efbd3316b108111763-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd3316b108111763-16">16</div><div class="crayon-num" data-line="crayon-5be4efbd3316b108111763-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd3316b108111763-18">18</div><div class="crayon-num" data-line="crayon-5be4efbd3316b108111763-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd3316b108111763-20">20</div><div class="crayon-num" data-line="crayon-5be4efbd3316b108111763-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd3316b108111763-22">22</div><div class="crayon-num" data-line="crayon-5be4efbd3316b108111763-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd3316b108111763-24">24</div><div class="crayon-num" data-line="crayon-5be4efbd3316b108111763-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd3316b108111763-26">26</div><div class="crayon-num" data-line="crayon-5be4efbd3316b108111763-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd3316b108111763-28">28</div><div class="crayon-num" data-line="crayon-5be4efbd3316b108111763-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd3316b108111763-30">30</div><div class="crayon-num" data-line="crayon-5be4efbd3316b108111763-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd3316b108111763-32">32</div><div class="crayon-num" data-line="crayon-5be4efbd3316b108111763-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd3316b108111763-34">34</div><div class="crayon-num" data-line="crayon-5be4efbd3316b108111763-35">35</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4efbd3316b108111763-1"><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-t">Object</span><span class="crayon-h"> </span><span class="crayon-e">Ring</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd3316b108111763-2"><span class="crayon-e">afterCollision</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">waterful</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5be4efbd3316b108111763-3"><span class="crayon-h">\xa0\xa0</span><span class="crayon-c">// 平移到针底部</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd3316b108111763-4"><span class="crayon-h">\xa0\xa0</span><span class="crayon-v">createjs</span><span class="crayon-sy">.</span><span class="crayon-v">Tween</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">texture</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5be4efbd3316b108111763-5"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-sy">.</span><span class="crayon-st">to</span><span class="crayon-sy">(</span><span class="crayon-sy">{</span><span class="crayon-v">y</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">}</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">duration</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd3316b108111763-6"><span class="crayon-h">\xa0\xa0</span><span class="crayon-c">// 消去刚体</span></div><div class="crayon-line" id="crayon-5be4efbd3316b108111763-7"><span class="crayon-h">\xa0\xa0</span><span class="crayon-v">Matter</span><span class="crayon-sy">.</span><span class="crayon-v">World</span><span class="crayon-sy">.</span><span class="crayon-e">remove</span><span class="crayon-sy">(</span><span class="crayon-v">waterful</span><span class="crayon-sy">.</span><span class="crayon-v">engine</span><span class="crayon-sy">.</span><span class="crayon-v">world</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">body</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd3316b108111763-8"><span class="crayon-h">\xa0\xa0</span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">body</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">null</span></div><div class="crayon-line" id="crayon-5be4efbd3316b108111763-9"><span class="crayon-h">\xa0\xa0</span><span class="crayon-c">// 接下来每一 Tick 的更新逻辑改变如下</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd3316b108111763-10"><span class="crayon-h">\xa0\xa0</span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">update</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5be4efbd3316b108111763-11"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-m">const</span><span class="crayon-h"> </span><span class="crayon-v">texture</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-e">texture</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd3316b108111763-12"><span class="crayon-e">\xa0\xa0\xa0\xa0</span><span class="crayon-st">if</span><span class="crayon-h"> </span>当前环贴图就是第<span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-h"> </span>帧（环平放的那一帧）<span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5be4efbd3316b108111763-13"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-v">texture</span><span class="crayon-sy">.</span><span class="crayon-e">gotoAndStop</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd3316b108111763-14"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-sy">}</span><span class="crayon-h"> </span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5be4efbd3316b108111763-15"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0</span>每<span class="crayon-h"> </span><span class="crayon-cn">5</span><span class="crayon-h"> </span>个<span class="crayon-h"> </span><span class="crayon-i">Tick</span><span class="crayon-h"> </span>往前播放一帧（相隔多少<span class="crayon-h"> </span><span class="crayon-i">Tick</span><span class="crayon-h"> </span>切换一帧可以凭感觉调整，主要是为了使切换到平放状态的过程不显得太突兀）</div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd3316b108111763-16"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5be4efbd3316b108111763-17"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-c">// 使针大概在环中央位置穿过</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd3316b108111763-18"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">texture</span><span class="crayon-sy">.</span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-h"> </span><span class="crayon-cn">200</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">++</span><span class="crayon-v">texture</span><span class="crayon-sy">.</span><span class="crayon-i">x</span></div><div class="crayon-line" id="crayon-5be4efbd3316b108111763-19"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">texture</span><span class="crayon-sy">.</span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-cn">213</span><span class="crayon-h"> </span><span class="crayon-o">&amp;&amp;</span><span class="crayon-h"> </span><span class="crayon-v">texture</span><span class="crayon-sy">.</span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-h"> </span><span class="crayon-cn">300</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">--</span><span class="crayon-v">texture</span><span class="crayon-sy">.</span><span class="crayon-i">x</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd3316b108111763-20"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">texture</span><span class="crayon-sy">.</span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-cn">462</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">--</span><span class="crayon-v">texture</span><span class="crayon-sy">.</span><span class="crayon-i">x</span></div><div class="crayon-line" id="crayon-5be4efbd3316b108111763-21"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">texture</span><span class="crayon-sy">.</span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-cn">400</span><span class="crayon-h"> </span><span class="crayon-o">&amp;&amp;</span><span class="crayon-h"> </span><span class="crayon-v">texture</span><span class="crayon-sy">.</span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-h"> </span><span class="crayon-cn">448</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">++</span><span class="crayon-v">texture</span><span class="crayon-sy">.</span><span class="crayon-v">x</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd3316b108111763-22"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-c">// 把环贴图尽快旋转到水平状态</span></div><div class="crayon-line" id="crayon-5be4efbd3316b108111763-23"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-e">let </span><span class="crayon-v">rotation</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">Math</span><span class="crayon-sy">.</span><span class="crayon-e">round</span><span class="crayon-sy">(</span><span class="crayon-v">texture</span><span class="crayon-sy">.</span><span class="crayon-v">rotation</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-cn">180</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd3316b108111763-24"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">rotation</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-v">rotation</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-cn">180</span></div><div class="crayon-line" id="crayon-5be4efbd3316b108111763-25"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">rotation</span><span class="crayon-h"> </span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-o">&amp;&amp;</span><span class="crayon-h"> </span><span class="crayon-v">rotation</span><span class="crayon-h"> </span><span class="crayon-o">&lt;=</span><span class="crayon-h"> </span><span class="crayon-cn">90</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd3316b108111763-26"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-v">texture</span><span class="crayon-sy">.</span><span class="crayon-v">rotation</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">rotation</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5be4efbd3316b108111763-27"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-sy">}</span><span class="crayon-h"> </span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">rotation</span><span class="crayon-h"> </span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-cn">90</span><span class="crayon-h"> </span><span class="crayon-o">&amp;&amp;</span><span class="crayon-h"> </span><span class="crayon-v">rotation</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-h"> </span><span class="crayon-cn">180</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd3316b108111763-28"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-v">texture</span><span class="crayon-sy">.</span><span class="crayon-v">rotation</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">rotation</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5be4efbd3316b108111763-29"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-sy">}</span><span class="crayon-h"> </span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">frame</span><span class="crayon-h"> </span><span class="crayon-o">===</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd3316b108111763-30"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">update</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5be4efbd3316b108111763-31"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd3316b108111763-32"><span class="crayon-h">\xa0\xa0</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5be4efbd3316b108111763-33"><span class="crayon-h">\xa0\xa0</span><span class="crayon-c">// 调用得分回调函数</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd3316b108111763-34"><span class="crayon-h">\xa0\xa0</span><span class="crayon-v">waterful</span><span class="crayon-sy">.</span><span class="crayon-e">score</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5be4efbd3316b108111763-35"><span class="crayon-sy">}</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0085 seconds] -->&#13;\n<p/>\n<h3 id="进针判断">进针判断</h3>\n<h4 id="进针条件">进针条件</h4>\n<h5 id="1-到达针顶">1. 到达针顶</h5>\n<p>到达针顶是环进针成功的必要条件。</p>\n<h5 id="2-动画帧">2. 动画帧</h5>\n<p>环必须垂直于针才能被顺利穿过，水平于针时应该是与针相碰后弹开。</p>\n<p>当然条件可以相对放宽一些，不需要完全垂直，下图红框内的6帧都被规定为符合条件：</p>\n<p><img src="//misc.aotu.io/Chen-jj/waterful_10.png" width="372"/></p>\n<p>为了降低游戏难度，我规定超过针一半高度时，只循环播放前6帧：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4efbd3316f710023375" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div><span class="crayon-language">JavaScript</span></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\nthis.texture.on(\'animationend\', e =&gt; {&#13;\n  if (e.target.y &lt; 400) {&#13;\n    e.target.gotoAndPlay(\'short\')&#13;\n  } else {&#13;\n    e.target.gotoAndPlay(\'normal\')&#13;\n  }&#13;\n})</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4efbd3316f710023375-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd3316f710023375-2">2</div><div class="crayon-num" data-line="crayon-5be4efbd3316f710023375-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd3316f710023375-4">4</div><div class="crayon-num" data-line="crayon-5be4efbd3316f710023375-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd3316f710023375-6">6</div><div class="crayon-num" data-line="crayon-5be4efbd3316f710023375-7">7</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4efbd3316f710023375-1"><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">texture</span><span class="crayon-sy">.</span><span class="crayon-e">on</span><span class="crayon-sy">(</span><span class="crayon-s">\'animationend\'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">e</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd3316f710023375-2"><span class="crayon-h">\xa0\xa0</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">e</span><span class="crayon-sy">.</span><span class="crayon-v">target</span><span class="crayon-sy">.</span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-h"> </span><span class="crayon-cn">400</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5be4efbd3316f710023375-3"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-v">e</span><span class="crayon-sy">.</span><span class="crayon-v">target</span><span class="crayon-sy">.</span><span class="crayon-e">gotoAndPlay</span><span class="crayon-sy">(</span><span class="crayon-s">\'short\'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd3316f710023375-4"><span class="crayon-h">\xa0\xa0</span><span class="crayon-sy">}</span><span class="crayon-h"> </span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5be4efbd3316f710023375-5"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-v">e</span><span class="crayon-sy">.</span><span class="crayon-v">target</span><span class="crayon-sy">.</span><span class="crayon-e">gotoAndPlay</span><span class="crayon-sy">(</span><span class="crayon-s">\'normal\'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd3316f710023375-6"><span class="crayon-h">\xa0\xa0</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5be4efbd3316f710023375-7"><span class="crayon-sy">}</span><span class="crayon-sy">)</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0016 seconds] -->&#13;\n<p/>\n<h5 id="3-rotation-值">3. rotation 值</h5>\n<p>同理，为了使得环与针相垂直，rotation 值不能太接近 90 度。经试验后规定 0</p>\n<p>下图这种过大的倾角逻辑上是不能进针成功的：</p>\n<p><img src="//misc.aotu.io/Chen-jj/waterful_11.png" width="50"/></p>\n<h4 id="初探">初探</h4>\n<p>一开始我想的是把三维的进针做成二维的“圆球进桶”，进针的判断也就归到物理事件上面去，不需要再去考虑。</p>\n<p>具体做法如下图，红线为针壁，当环刚体（蓝球）掉入桶内且与 Sensor （绿线）相碰，则判断进针成功。为了使游戏难度不至于太大，环刚体必须设置得较小，而且针壁间距离要比环刚体直径稍大。</p>\n<p><img src="//misc.aotu.io/Chen-jj/waterful_12.png" width="66"/></p>\n<p>这种模拟其实已经能达到不错的效果了，但是一个技能打破了这种思路的可能性。</p>\n<p>产品那边想做一个放大技能，当用户使用此技能时环会放大，更容易套中。但是在桶口直径不变的情况下，只是环贴图变大并不能降低游戏难度。如果把环刚体变小，的确容易进了，但相近的环之间的贴图重叠范围会很大，这就显得很不合理了。</p>\n<h4 id="改进">改进</h4>\n<p>“进桶”的思路走不通是因为不兼容放大技能，而放大技能改变的是环的直径。因此需要找到一种进针判断方法在环直径小时，进针难度大，直径大时，进针难度小。</p>\n<p>下面两图分别为普通环和放大环，其中红色虚线表示水平方向的内环直径：</p>\n<p><img src="//misc.aotu.io/Chen-jj/waterful_13.png" width="50"/></p>\n<p><img src="//misc.aotu.io/Chen-jj/waterful_14.png" width="100"/></p>\n<p>在针顶设置一小段探测线（下图红色虚线），当内环的水平直径与探测线相交时，证明进针成功，然后走进针后的逻辑。在环放大时，内环的水平直径变长，也就更容易与探测线相交。</p>\n<p><img src="//misc.aotu.io/Chen-jj/waterful_15.png" width="66"/></p>\n<p>伪代码：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4efbd33173676220929" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div><span class="crayon-language">JavaScript</span></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\n// Object Ring&#13;\n// 每一 Tick 都去判断每个运动中的环是否与探测线相交&#13;\nupdate (waterful) {&#13;\n  const texture = this.texture&#13;\n  // 环当前中心点坐标&#13;\n  const x0 = texture.x&#13;\n  const y0 = texture.y&#13;\n  // 环的旋转弧度&#13;\n  const angle = texture.rotation&#13;\n  // 内环半径&#13;\n  const r = waterful.enlarging ? 16 * 1.5 : 16&#13;\n  // 根据旋转角度算出内环水平直径的开始和结束坐标&#13;\n  // 注意 Matter.js 拿到的是 rotation 值是弧度，需要转成角度&#13;\n  const startPoint = {&#13;\n    x: x0 - r * Math.cos(angle * (Math.PI / 180)),&#13;\n    y: y0 - r * Math.sin(angle * (Math.PI / 180))&#13;\n  }&#13;\n  const endPoint = {&#13;\n    x: x0 + r * Math.cos(-angle * (Math.PI / 180)),&#13;\n    y: y0 + r * Math.sin(angle * (Math.PI / 180))&#13;\n  }&#13;\n  // mn 为左侧探测线段的两点，uv 为右侧探测线段的两点&#13;\n  const m = {x: 206, y: 216}, n = {x: 206, y: 400},&#13;\n        u = {x: 455, y: 216}, v = {x: 455, y: 400}&#13;\n        &#13;\n  if (segmentsIntr(startPoint, endPoint, m, n) || segmentsIntr(startPoint, endPoint, u, v)) {&#13;\n    // 内环直径与 mn 或 uv 相交，证明进针成功&#13;\n    this.afterCollision(waterful)&#13;\n  }&#13;\n  &#13;\n  ...&#13;\n}</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4efbd33173676220929-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd33173676220929-2">2</div><div class="crayon-num" data-line="crayon-5be4efbd33173676220929-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd33173676220929-4">4</div><div class="crayon-num" data-line="crayon-5be4efbd33173676220929-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd33173676220929-6">6</div><div class="crayon-num" data-line="crayon-5be4efbd33173676220929-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd33173676220929-8">8</div><div class="crayon-num" data-line="crayon-5be4efbd33173676220929-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd33173676220929-10">10</div><div class="crayon-num" data-line="crayon-5be4efbd33173676220929-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd33173676220929-12">12</div><div class="crayon-num" data-line="crayon-5be4efbd33173676220929-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd33173676220929-14">14</div><div class="crayon-num" data-line="crayon-5be4efbd33173676220929-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd33173676220929-16">16</div><div class="crayon-num" data-line="crayon-5be4efbd33173676220929-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd33173676220929-18">18</div><div class="crayon-num" data-line="crayon-5be4efbd33173676220929-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd33173676220929-20">20</div><div class="crayon-num" data-line="crayon-5be4efbd33173676220929-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd33173676220929-22">22</div><div class="crayon-num" data-line="crayon-5be4efbd33173676220929-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd33173676220929-24">24</div><div class="crayon-num" data-line="crayon-5be4efbd33173676220929-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd33173676220929-26">26</div><div class="crayon-num" data-line="crayon-5be4efbd33173676220929-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd33173676220929-28">28</div><div class="crayon-num" data-line="crayon-5be4efbd33173676220929-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd33173676220929-30">30</div><div class="crayon-num" data-line="crayon-5be4efbd33173676220929-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd33173676220929-32">32</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4efbd33173676220929-1"><span class="crayon-c">// Object Ring</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd33173676220929-2"><span class="crayon-c">// 每一 Tick 都去判断每个运动中的环是否与探测线相交</span></div><div class="crayon-line" id="crayon-5be4efbd33173676220929-3"><span class="crayon-e">update</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">waterful</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd33173676220929-4"><span class="crayon-h">\xa0\xa0</span><span class="crayon-m">const</span><span class="crayon-h"> </span><span class="crayon-v">texture</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">texture</span></div><div class="crayon-line" id="crayon-5be4efbd33173676220929-5"><span class="crayon-h">\xa0\xa0</span><span class="crayon-c">// 环当前中心点坐标</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd33173676220929-6"><span class="crayon-h">\xa0\xa0</span><span class="crayon-m">const</span><span class="crayon-h"> </span><span class="crayon-v">x0</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">texture</span><span class="crayon-sy">.</span><span class="crayon-i">x</span></div><div class="crayon-line" id="crayon-5be4efbd33173676220929-7"><span class="crayon-h">\xa0\xa0</span><span class="crayon-m">const</span><span class="crayon-h"> </span><span class="crayon-v">y0</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">texture</span><span class="crayon-sy">.</span><span class="crayon-v">y</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd33173676220929-8"><span class="crayon-h">\xa0\xa0</span><span class="crayon-c">// 环的旋转弧度</span></div><div class="crayon-line" id="crayon-5be4efbd33173676220929-9"><span class="crayon-h">\xa0\xa0</span><span class="crayon-m">const</span><span class="crayon-h"> </span><span class="crayon-v">angle</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">texture</span><span class="crayon-sy">.</span><span class="crayon-v">rotation</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd33173676220929-10"><span class="crayon-h">\xa0\xa0</span><span class="crayon-c">// 内环半径</span></div><div class="crayon-line" id="crayon-5be4efbd33173676220929-11"><span class="crayon-h">\xa0\xa0</span><span class="crayon-m">const</span><span class="crayon-h"> </span><span class="crayon-v">r</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">waterful</span><span class="crayon-sy">.</span><span class="crayon-i">enlarging</span><span class="crayon-h"> </span><span class="crayon-sy">?</span><span class="crayon-h"> </span><span class="crayon-cn">16</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-cn">1.5</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">16</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd33173676220929-12"><span class="crayon-h">\xa0\xa0</span><span class="crayon-c">// 根据旋转角度算出内环水平直径的开始和结束坐标</span></div><div class="crayon-line" id="crayon-5be4efbd33173676220929-13"><span class="crayon-h">\xa0\xa0</span><span class="crayon-c">// 注意 Matter.js 拿到的是 rotation 值是弧度，需要转成角度</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd33173676220929-14"><span class="crayon-h">\xa0\xa0</span><span class="crayon-m">const</span><span class="crayon-h"> </span><span class="crayon-v">startPoint</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5be4efbd33173676220929-15"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-v">x</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">x0</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">r</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">Math</span><span class="crayon-sy">.</span><span class="crayon-e">cos</span><span class="crayon-sy">(</span><span class="crayon-v">angle</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">Math</span><span class="crayon-sy">.</span><span class="crayon-v">PI</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-cn">180</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd33173676220929-16"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-v">y</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">y0</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">r</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">Math</span><span class="crayon-sy">.</span><span class="crayon-e">sin</span><span class="crayon-sy">(</span><span class="crayon-v">angle</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">Math</span><span class="crayon-sy">.</span><span class="crayon-v">PI</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-cn">180</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5be4efbd33173676220929-17"><span class="crayon-h">\xa0\xa0</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd33173676220929-18"><span class="crayon-h">\xa0\xa0</span><span class="crayon-m">const</span><span class="crayon-h"> </span><span class="crayon-v">endPoint</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5be4efbd33173676220929-19"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-v">x</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">x0</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">r</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">Math</span><span class="crayon-sy">.</span><span class="crayon-e">cos</span><span class="crayon-sy">(</span><span class="crayon-o">-</span><span class="crayon-v">angle</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">Math</span><span class="crayon-sy">.</span><span class="crayon-v">PI</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-cn">180</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd33173676220929-20"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-v">y</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">y0</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">r</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">Math</span><span class="crayon-sy">.</span><span class="crayon-e">sin</span><span class="crayon-sy">(</span><span class="crayon-v">angle</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">Math</span><span class="crayon-sy">.</span><span class="crayon-v">PI</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-cn">180</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5be4efbd33173676220929-21"><span class="crayon-h">\xa0\xa0</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd33173676220929-22"><span class="crayon-h">\xa0\xa0</span><span class="crayon-c">// mn 为左侧探测线段的两点，uv 为右侧探测线段的两点</span></div><div class="crayon-line" id="crayon-5be4efbd33173676220929-23"><span class="crayon-h">\xa0\xa0</span><span class="crayon-m">const</span><span class="crayon-h"> </span><span class="crayon-v">m</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-v">x</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">206</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">216</span><span class="crayon-sy">}</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-v">x</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">206</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">400</span><span class="crayon-sy">}</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd33173676220929-24"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-v">u</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-v">x</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">455</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">216</span><span class="crayon-sy">}</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">v</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-v">x</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">455</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">400</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5be4efbd33173676220929-25"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd33173676220929-26"><span class="crayon-h">\xa0\xa0</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">segmentsIntr</span><span class="crayon-sy">(</span><span class="crayon-v">startPoint</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">endPoint</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">m</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">||</span><span class="crayon-h"> </span><span class="crayon-e">segmentsIntr</span><span class="crayon-sy">(</span><span class="crayon-v">startPoint</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">endPoint</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">u</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">v</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5be4efbd33173676220929-27"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-c">// 内环直径与 mn 或 uv 相交，证明进针成功</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd33173676220929-28"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-e">afterCollision</span><span class="crayon-sy">(</span><span class="crayon-v">waterful</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5be4efbd33173676220929-29"><span class="crayon-h">\xa0\xa0</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd33173676220929-30"><span class="crayon-h">\xa0\xa0</span></div><div class="crayon-line" id="crayon-5be4efbd33173676220929-31"><span class="crayon-h">\xa0\xa0</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd33173676220929-32"><span class="crayon-sy">}</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0083 seconds] -->&#13;\n<p>判断线段是否相交的算法可以参考这篇文章：<a href="http://fins.iteye.com/blog/1522259" target="_blank" rel="external">谈谈”求线段交点”的几种算法</a></p>\n<p>这种思路有两个不合常理的点：</p>\n<p>1.当环在针顶平台直到静止时，内环水平直径都没有和探测线相交，或者相交了但是 rotation 值不符合进针要求，视觉上给人的感受就是环在针顶上静止了：</p>\n<p><img src="//misc.aotu.io/Chen-jj/waterful_16.png" width="66"/></p>\n<p>解决思路一是通过重力感应，因为设置了重力感应，只要用户稍微动一下手机环就会动起来。二是判断环刚体在针顶平台完全静止了，则给它施加一个力，让它往下掉。</p>\n<p>2.有可能环的运动轨迹是在针顶划过，但与探测线相交了，此时会给玩家一种环被吸下来的感觉。可以通过适当设置探测线的长度来减少这种情况发生的几率。</p>\n<h1 id="优化">优化</h1>\n<h3 id="资源池">资源池</h3>\n<p>资源回收复用，是游戏常用的优化手法，接下来通过讲解气泡动画的实现来简单介绍一下。</p>\n<p>气泡动画是逐帧图，用户点击按钮时，即创建一个 createjs.Sprite。在 animationend 时，把该 sprite 对象从 createjs.Stage 中 remove 掉。</p>\n<p>可想而知，当用户不停点击时，会不断的创建 createjs.Sprite 对象，非常耗费资源。如果能复用之前播放完被 remove 掉的 sprite 对象，就能解决此问题。</p>\n<p>具体做法是每当用户按下按钮时，先去资源池数组找有没有 sprite 对象。如果没有则创建，animationend 时把 sprite 对象从 stage 里 remove 掉，然后 push 进资源池。如果有，则从资源池取出并直接使用该对象。</p>\n<p>当然用户的点击操作事件需要节流处理，例如至少 300ms 后才能播放下一个气泡动画。</p>\n<p>伪代码：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4efbd33178915521439" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div><span class="crayon-language">JavaScript</span></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\n// Object Waterful&#13;\ngetBubble = throttle(function () {&#13;\n  // 存在空闲泡泡即返回&#13;\n  if (this._idleBubbles.length) return this._idleBubbles.shift()&#13;\n  // 不存在则创建&#13;\n  const bubble = new createjs.Sprite(...)&#13;\n  bubble.on(\'animationend\', () =&gt; {&#13;\n    this._stage.removeChild(bubble)&#13;\n    this._idleBubbles.push(bubble)&#13;\n  })&#13;\n  return bubble&#13;\n}, 300)</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4efbd33178915521439-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd33178915521439-2">2</div><div class="crayon-num" data-line="crayon-5be4efbd33178915521439-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd33178915521439-4">4</div><div class="crayon-num" data-line="crayon-5be4efbd33178915521439-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd33178915521439-6">6</div><div class="crayon-num" data-line="crayon-5be4efbd33178915521439-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd33178915521439-8">8</div><div class="crayon-num" data-line="crayon-5be4efbd33178915521439-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd33178915521439-10">10</div><div class="crayon-num" data-line="crayon-5be4efbd33178915521439-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd33178915521439-12">12</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4efbd33178915521439-1"><span class="crayon-c">// Object Waterful</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd33178915521439-2"><span class="crayon-v">getBubble</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">throttle</span><span class="crayon-sy">(</span><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5be4efbd33178915521439-3"><span class="crayon-h">\xa0\xa0</span><span class="crayon-c">// 存在空闲泡泡即返回</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd33178915521439-4"><span class="crayon-h">\xa0\xa0</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">_idleBubbles</span><span class="crayon-sy">.</span><span class="crayon-v">length</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">_idleBubbles</span><span class="crayon-sy">.</span><span class="crayon-e">shift</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5be4efbd33178915521439-5"><span class="crayon-h">\xa0\xa0</span><span class="crayon-c">// 不存在则创建</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd33178915521439-6"><span class="crayon-h">\xa0\xa0</span><span class="crayon-m">const</span><span class="crayon-h"> </span><span class="crayon-v">bubble</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-v">createjs</span><span class="crayon-sy">.</span><span class="crayon-e">Sprite</span><span class="crayon-sy">(</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5be4efbd33178915521439-7"><span class="crayon-h">\xa0\xa0</span><span class="crayon-v">bubble</span><span class="crayon-sy">.</span><span class="crayon-e">on</span><span class="crayon-sy">(</span><span class="crayon-s">\'animationend\'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd33178915521439-8"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">_stage</span><span class="crayon-sy">.</span><span class="crayon-e">removeChild</span><span class="crayon-sy">(</span><span class="crayon-v">bubble</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5be4efbd33178915521439-9"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">_idleBubbles</span><span class="crayon-sy">.</span><span class="crayon-e">push</span><span class="crayon-sy">(</span><span class="crayon-v">bubble</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd33178915521439-10"><span class="crayon-h">\xa0\xa0</span><span class="crayon-sy">}</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5be4efbd33178915521439-11"><span class="crayon-h">\xa0\xa0</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-i">bubble</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd33178915521439-12"><span class="crayon-sy">}</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">300</span><span class="crayon-sy">)</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0026 seconds] -->&#13;\n<p/>\n<h3 id="环速度过快导致飞出边界">环速度过快导致飞出边界</h3>\n<p>Matter.js 里由于没有实现持续碰撞检测算法（<a href="http://www.stencyl.com/help/view/continuous-collision-detection" target="_blank" rel="external">CCD</a>），所以在物体速度过快的情况下，和其他物体的碰撞不会被检测出来。当环速度很快时，也就会出现飞出墙壁的 bug。</p>\n<p>正常情况下，每次按键给环施加的力都是很小的。当用户快速连续点击时，y 方向累积的力也不至于过大。但还是有玩家反应游戏过程中环不见了的问题。最后发现当手机卡顿时，Matter.js 的 Tick 没有及时触发，导致卡顿完后把卡顿时累积起来的力一次性应用到环刚体上，环瞬间获得很大的速度，也就飞出了游戏场景。</p>\n<p>解决方法有两个：</p>\n<ol>\n<li>给按钮节流，300ms才能施加一次力。</li>\n<li>每次按下按钮，只是把一个标志位设为 true。在每个 Matter.js 的 Tick 里判断该标志位是否为 true，是则施力。保证每个 Matter.js 的 Tick 里只对环施加一次力。</li>\n</ol>\n<p>伪代码：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4efbd3317c360472085" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div><span class="crayon-language">JavaScript</span></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\nbtn.addEventListener(\'touchstart\', e =&gt; {&#13;\n  this.addForce = true&#13;\n})&#13;\nEvents.on(this._engine, \'beforeUpdate\', e =&gt; {&#13;\n  if (!this.addForce) return&#13;\n  this.addForceLeft = false&#13;\n  // 施力&#13;\n  this._rings.forEach(ring =&gt; {&#13;\n    Matter.Body.applyForce(ring.body, {x: x, y: y}, {x: 0.02, y: -0.03})&#13;\n    Matter.Body.setAngularVelocity(ring.body, Math.PI/24)&#13;\n  })&#13;\n})</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4efbd3317c360472085-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd3317c360472085-2">2</div><div class="crayon-num" data-line="crayon-5be4efbd3317c360472085-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd3317c360472085-4">4</div><div class="crayon-num" data-line="crayon-5be4efbd3317c360472085-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd3317c360472085-6">6</div><div class="crayon-num" data-line="crayon-5be4efbd3317c360472085-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd3317c360472085-8">8</div><div class="crayon-num" data-line="crayon-5be4efbd3317c360472085-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd3317c360472085-10">10</div><div class="crayon-num" data-line="crayon-5be4efbd3317c360472085-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd3317c360472085-12">12</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4efbd3317c360472085-1"><span class="crayon-v">btn</span><span class="crayon-sy">.</span><span class="crayon-e">addEventListener</span><span class="crayon-sy">(</span><span class="crayon-s">\'touchstart\'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">e</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd3317c360472085-2"><span class="crayon-h">\xa0\xa0</span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">addForce</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">true</span></div><div class="crayon-line" id="crayon-5be4efbd3317c360472085-3"><span class="crayon-sy">}</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd3317c360472085-4"><span class="crayon-v">Events</span><span class="crayon-sy">.</span><span class="crayon-e">on</span><span class="crayon-sy">(</span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">_engine</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">\'beforeUpdate\'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">e</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5be4efbd3317c360472085-5"><span class="crayon-h">\xa0\xa0</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-o">!</span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">addForce</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">return</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd3317c360472085-6"><span class="crayon-h">\xa0\xa0</span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">addForceLeft</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">false</span></div><div class="crayon-line" id="crayon-5be4efbd3317c360472085-7"><span class="crayon-h">\xa0\xa0</span><span class="crayon-c">// 施力</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd3317c360472085-8"><span class="crayon-h">\xa0\xa0</span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">_rings</span><span class="crayon-sy">.</span><span class="crayon-st">forEach</span><span class="crayon-sy">(</span><span class="crayon-v">ring</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5be4efbd3317c360472085-9"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-v">Matter</span><span class="crayon-sy">.</span><span class="crayon-v">Body</span><span class="crayon-sy">.</span><span class="crayon-e">applyForce</span><span class="crayon-sy">(</span><span class="crayon-v">ring</span><span class="crayon-sy">.</span><span class="crayon-v">body</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-v">x</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">}</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-v">x</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">0.02</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">0.03</span><span class="crayon-sy">}</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd3317c360472085-10"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-v">Matter</span><span class="crayon-sy">.</span><span class="crayon-v">Body</span><span class="crayon-sy">.</span><span class="crayon-e">setAngularVelocity</span><span class="crayon-sy">(</span><span class="crayon-v">ring</span><span class="crayon-sy">.</span><span class="crayon-v">body</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">Math</span><span class="crayon-sy">.</span><span class="crayon-v">PI</span><span class="crayon-o">/</span><span class="crayon-cn">24</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5be4efbd3317c360472085-11"><span class="crayon-h">\xa0\xa0</span><span class="crayon-sy">}</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd3317c360472085-12"><span class="crayon-sy">}</span><span class="crayon-sy">)</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0032 seconds] -->&#13;\n<p/>\n<h1 id="结语">结语</h1>\n<p>如果对「H5游戏开发」感兴趣，欢迎关注我们的<a href="https://zhuanlan.zhihu.com/snsgame" target="_blank" rel="external">专栏</a></p>\n</div>\n&#13;\n        <script language="javascript"> &#13;\nvar randomNum = Math.round(Math.random()*1);&#13;\nvar innerHTML=new Array(2);&#13;\ninnerHTML[0]="如果有人让你推荐前端技术书，请让他看这个列表 -&gt;《&lt;a target=\'_blank\' href=\'http://web.jobbole.com/86734/\'&gt;经典前端技术书籍&lt;/a&gt;》";&#13;\ninnerHTML[1]="如果有人让你推荐前端技术书，请让他看这个列表 -&gt;《&lt;a target=\'_blank\' href=\'http://web.jobbole.com/86734/\'&gt;经典前端技术书籍&lt;/a&gt;》";&#13;\nvar widgetHTML="&lt;div id=\'single-page-inner-widget\'&gt;"+innerHTML[randomNum]+"&lt;/div&gt;";&#13;\ndocument.write(widgetHTML);&#13;\n</script>&#13;\n        &#13;\n        \n     \n\n\n\n&#13;\n        <!-- BEGIN #author-bio -->&#13;\n&#13;\n&#13;\n<!-- END #author-bio -->&#13;');
insert into news_article_basic(article_id, user_id, channel_id, title, cover, status)values(28, 1, 1, 'helloworld经历了什么？', '{"type":0, "images":[]}', 2);
insert into news_article_content(article_id, content) values(28,'<blockquote>《深入理解计算机系统》学习笔记</blockquote>\n<p>hello world往往是学习编程时遇到的第一个示例，下面是一个C语言版本：</p>\n<pre><code class="c">#include &lt;stdio.h&gt;\n\nint main()\n{\n    printf("hello, world\\n");\n    return 0;\n}</code></pre>\n<p>这个程序会在终端打印<code>hello, world</code>这串字符，那么这个程序在我们的计算机上到底是怎能被读取运行的呢？</p>\n<h3>程序的存储</h3>\n<p>我们将这段代码保存为文本文件并命名为<em>hello.c</em>，称作源程序或源文件。这段代码里都是英文字母以及一些符号，然而，计算机内存储的信息都是二进制的，计算机只能识别由<strong>1</strong>和<strong>0</strong>组成的<strong>位（比特）序列</strong>，每8个位组成一个<strong>字节</strong>。那么英语有26个字母，汉字更是成千上万个，只用0和1怎么表示呢？不用怕，我们只要将很多个0与1<strong>排列组合</strong>一下就能表示很多个了，n位就能表示2<sup>n</sup>个文字。例如一个字节8位最多就能表示256个。这就是编码的强大能力了，常见的编码标准有ASCII和UTF-8。<br/><span class="img-wrap"><img data-src="https://segmentfault.com/img/bVbiVPz?w=780&amp;h=824" src="https://static.segmentfault.com/v-5be168e8/global/img/squares.svg" alt="ascii低128位对照表" title="ascii低128位对照表"/></span></p>\n<h3>程序被翻译成不同格式</h3>\n<p>C语言是高级语言，要想在计算机上运行，就必须被翻译成计算机能理解的机器语言指令。然后这些指令按一种称为<strong>可执行目标程序</strong>的格式打好包，并以二进制磁盘文件的形式存放起来。目标程序也称<strong>可执行目标文件</strong>。<br/><code>linux&gt; gcc -o hello hello.c</code><br/>在Linux上我们用GCC将hello.c翻译称可执行文件hello，这个过程可以分为四个阶段。<br/><span class="img-wrap"><img data-src="https://segmentfault.com/img/bVbiVQA?w=850&amp;h=220" src="https://static.segmentfault.com/v-5be168e8/global/img/squares.svg" alt="编译系统" title="编译系统"/></span></p>\n<ul>\n<li>\n<strong>预处理阶段</strong>：预处理器cpp根据以井号#开头的预处理命令修改原始程序。例如这里hello.c的第一行<code>#include &lt;stdio.h&gt;</code>告诉预处理器读取头文件<em>stdio.h</em>的内容（这个文件里包含了<code>printf</code>这个函数）并把它插入源程序,得到<code>hello.i</code>。</li>\n<li>\n<strong>编译阶段</strong>：编译器ccl将<code>hello.i</code>翻译成文本文件<code>hello.s</code>，这里包含一个汇编语言程序：</li>\n</ul>\n<pre><code>main:\n  subq    $8, %rsp\n  movl    $LC0, %edi\n  call    puts\n  movl    $0, %eax\n  addq    $8, %rsp\n  ret</code></pre>\n<ul>\n<li>\n<strong>汇编阶段</strong>：汇编器as将hello.s翻译成机器语言指令，把这些指令打包成一种叫做<strong>可重定位目标程序</strong>的格式，并将结果保存到<code>hello.o</code>\n</li>\n<li>\n<strong>链接阶段</strong>：我们在程序里用到了<code>printf</code>函数，它存在于一个名为<code>printf.o</code>的预编译好了的文件中。这个文件需要以某种方式合并到我们的程序中，这就要用到链接器ld。结果就得到可执行文件<code>hello</code>。可以被加载到内存由系统执行。</li>\n</ul>');
insert into news_article_basic(article_id, user_id, channel_id, title, cover, status)values(29, 1, 1, '一起来看 HTML 5.2 中新的原生元素 dialog', '{"type":0, "images":[]}', 2);
insert into news_article_content(article_id, content) values(29,'<p><img src="http://jbcdn2.b0.upaiyun.com/2018/01/83c99289e1dfae6c4c6f205ef0824bc3.jpeg"/></p>\n<blockquote><p>不到一个月前，<code>HTML 5.2</code> 正式成为 <code>W3C</code> 的推荐标准（<code>REC</code>）,其中，推出了一个新的原生模态对话框元素 ，乍一看，可能感觉它就是一个新增的元素，然而，作者最近在玩的时候，发现它确实是一个值得期待和很有意思的元素，在这里分享给大家</p></blockquote>\n<p>这是 <code/> 最基础的示例</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4e11744a32652091474" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div><span class="crayon-language">XHTML</span></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\n&lt;dialog open&gt;&#13;\n    Native dialog box!&#13;\n&lt;/dialog&gt;</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4e11744a32652091474-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4e11744a32652091474-2">2</div><div class="crayon-num" data-line="crayon-5be4e11744a32652091474-3">3</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4e11744a32652091474-1"><span class="crayon-r ">&lt;dialog </span>open<span class="crayon-r ">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4e11744a32652091474-2"><span class="crayon-i ">\xa0\xa0\xa0\xa0Native dialog box!</span></div><div class="crayon-line" id="crayon-5be4e11744a32652091474-3"><span class="crayon-r ">&lt;/dialog&gt;</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0004 seconds] -->&#13;\n<p>其中，<code>open</code> 属性表示此时 <code>dialog</code> 是可见的，如果没有 <code>open</code>，<code>dialog</code> 将会隐藏，你可以使用 <code>JavaScipt</code> 将它显现出来，此时，<code>dialog</code> 渲染如下</p>\n<p><img src="http://jbcdn2.b0.upaiyun.com/2018/01/53f61323247f8c89e3c89ad45167758e.png"/></p>\n<p>它 <code>绝对定位</code> 于页面之上，就如我们期望的一样，出现在内容的上方，并且 <code>水平居中</code>，默认情况下，它 <code>和内容一样宽</code></p>\n<h2>基本操作</h2>\n<p><code>JavaScipt</code> 有几个 <code>方法</code> 和 <code>属性</code> 可以很方便地处理 <code>dialog</code> 元素，使用最多的可能还是 <code>showModal()</code> 和 <code>close()</code></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4e11744a3b722762908" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\nconst modal = document.querySelector(\'dialog\');&#13;\n&#13;\n// makes modal appear (adds `open` attribute)&#13;\nmodal.showModal();&#13;\n&#13;\n// hides modal (removes `open` attribute)&#13;\nmodal.close();</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4e11744a3b722762908-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4e11744a3b722762908-2">2</div><div class="crayon-num" data-line="crayon-5be4e11744a3b722762908-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4e11744a3b722762908-4">4</div><div class="crayon-num" data-line="crayon-5be4e11744a3b722762908-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4e11744a3b722762908-6">6</div><div class="crayon-num" data-line="crayon-5be4e11744a3b722762908-7">7</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4e11744a3b722762908-1"><span class="crayon-m">const</span><span class="crayon-h"> </span><span class="crayon-v">modal</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">document</span><span class="crayon-sy">.</span><span class="crayon-e">querySelector</span><span class="crayon-sy">(</span><span class="crayon-s">\'dialog\'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4e11744a3b722762908-2">\xa0</div><div class="crayon-line" id="crayon-5be4e11744a3b722762908-3"><span class="crayon-c">// makes modal appear (adds `open` attribute)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4e11744a3b722762908-4"><span class="crayon-v">modal</span><span class="crayon-sy">.</span><span class="crayon-e">showModal</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5be4e11744a3b722762908-5">\xa0</div><div class="crayon-line crayon-striped-line" id="crayon-5be4e11744a3b722762908-6"><span class="crayon-c">// hides modal (removes `open` attribute)</span></div><div class="crayon-line" id="crayon-5be4e11744a3b722762908-7"><span class="crayon-v">modal</span><span class="crayon-sy">.</span><span class="crayon-e">close</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0009 seconds] -->&#13;\n<p>当你使用 <code>showModal()</code> 来打开 <code>dialog</code> 时，将会在 <code>dialog</code> 周围加一层阴影，阻止用户与 <code>非 diglog</code> 元素的交互，默认情况下，阴影是 <code>完全透明</code> 的，你可以使用 <code>CSS</code> 来修改它</p>\n<p>按 <code>Esc</code> 可以关闭 <code>dialog</code>，你也可以提供一个按钮来触发 <code>close()</code></p>\n<p>还有一个方法是 <code>show()</code>，它也可以让 <code>dialog</code> 显现，但与 <code>showModal()</code> 不同的是它没有阴影，用户可以与非 <code>dialog</code> 元素进行交互</p>\n<h2>浏览器支持和 Polyfill</h2>\n<p>目前，只有 <code>chrome</code> 支持 <code/></p>\n<p><code/>，<code>Firefox</code> 需要在 <code>about:config</code> 里允许 <code>dom.dialog_element.enabled</code> 才能正常使用，我猜想，<code>Firefox</code> 在不久的将来就会支持</p>\n<p><img src="http://jbcdn2.b0.upaiyun.com/2018/01/57b3152cab702db39cc193068abc9ba1.png"/></p>\n<p>上图为 <a href="http://caniuse.com/#search=dialog">caniuse.com</a> 关于 <code>dialog</code> 特性主流浏览器的兼容情况</p>\n<p>幸运的是，我们可以使用 <a href="https://caniuse.com/#search=dialog">dialog-polyfill</a> 来缓解这种尴尬，它既提供了 <code>JavaScript</code> 的行为，也包含了默认的样式，我们可以使用 <code>npm</code> 来安装它，也可以使用 <code/> 标签来引用它。目前，它已支持各主流浏览器，包括 <code>IE 9</code> 及其以上版本</p>\n<p>只是，在使用它时，每个 <code>dialog</code> 需要使用下面语句进行初始化</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4e11744a42039073297" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\ndialogPolyfill.registerDialog(dialog);</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4e11744a42039073297-1">1</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4e11744a42039073297-1"><span class="crayon-v">dialogPolyfill</span><span class="crayon-sy">.</span><span class="crayon-e">registerDialog</span><span class="crayon-sy">(</span><span class="crayon-v">dialog</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0004 seconds] -->&#13;\n<p>并且，它并不会取代浏览器原生的行为</p>\n<h2>样式</h2>\n<p>打开和关闭模态框是最基本的，但这是肯定不够的，<code/></p>\n<p><code/> 最开始时样式是不怎么好看的，因此，我们需要自定义它的样式，此外，我们可以通过设置伪元素 <code>::backdrop</code> 来优化 <code/></p>\n<p><code/> 显现时背影的样式</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4e11744a47211739390" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\ndialog {&#13;\n    padding: 0;&#13;\n    width: 478px;&#13;\n    text-align: center;&#13;\n    vertical-align: middle;&#13;\n    border-radius: 5px;&#13;\n    border: 0;&#13;\n}&#13;\n&#13;\ndialog::backdrop {&#13;\n    background-color: rgba(0, 0, 0, 0.1);&#13;\n}</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4e11744a47211739390-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4e11744a47211739390-2">2</div><div class="crayon-num" data-line="crayon-5be4e11744a47211739390-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4e11744a47211739390-4">4</div><div class="crayon-num" data-line="crayon-5be4e11744a47211739390-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4e11744a47211739390-6">6</div><div class="crayon-num" data-line="crayon-5be4e11744a47211739390-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4e11744a47211739390-8">8</div><div class="crayon-num" data-line="crayon-5be4e11744a47211739390-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4e11744a47211739390-10">10</div><div class="crayon-num" data-line="crayon-5be4e11744a47211739390-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4e11744a47211739390-12">12</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4e11744a47211739390-1"><span class="crayon-e">dialog</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4e11744a47211739390-2"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-v">padding</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5be4e11744a47211739390-3"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-v">width</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">478px</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4e11744a47211739390-4"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-v">text</span><span class="crayon-o">-</span><span class="crayon-v">align</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">center</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5be4e11744a47211739390-5"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-v">vertical</span><span class="crayon-o">-</span><span class="crayon-v">align</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">middle</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4e11744a47211739390-6"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-v">border</span><span class="crayon-o">-</span><span class="crayon-v">radius</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">5px</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5be4e11744a47211739390-7"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-v">border</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4e11744a47211739390-8"><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5be4e11744a47211739390-9">\xa0</div><div class="crayon-line crayon-striped-line" id="crayon-5be4e11744a47211739390-10"><span class="crayon-v">dialog</span><span class="crayon-o">::</span><span class="crayon-e">backdrop</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5be4e11744a47211739390-11"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-v">background</span><span class="crayon-o">-</span><span class="crayon-v">color</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">rgba</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0.1</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4e11744a47211739390-12"><span class="crayon-sy">}</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0016 seconds] -->&#13;\n<p>为了兼容老的浏览器，使用 <code>polyfill</code> 时，<code>::backdrop</code> 是不起作用的，但 <code>polyfill</code> 会在 <code>dialog</code> 后面添加一个 <code>.backdrop</code> 元素，我们可以像下面这样定位它</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4e11744a4a344976513" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\ndialog + .backdrop {&#13;\n  background-color: rgba(0, 0, 0, 0.4);&#13;\n}</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4e11744a4a344976513-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4e11744a4a344976513-2">2</div><div class="crayon-num" data-line="crayon-5be4e11744a4a344976513-3">3</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4e11744a4a344976513-1"><span class="crayon-v">dialog</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-i">backdrop</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4e11744a4a344976513-2"><span class="crayon-h">\xa0\xa0</span><span class="crayon-v">background</span><span class="crayon-o">-</span><span class="crayon-v">color</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">rgba</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0.4</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5be4e11744a4a344976513-3"><span class="crayon-sy">}</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0008 seconds] -->&#13;\n<p>接下来，是时候向 <code>bialog</code> 里添加更多的内容，一般包括 <code>header</code>， <code>body</code> 和 <code>footer</code></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4e11744a4d784259331" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div><span class="crayon-language">XHTML</span></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\n&lt;dialog id="sweet-modal"&gt;&#13;\n    &lt;h3 class="modal-header"&gt;sweet dialog&lt;/h3&gt;&#13;\n    &lt;div class="modal-body"&gt;&#13;\n        &lt;p&gt;This is a sweet dialog, which is much better.&lt;/p&gt;&#13;\n    &lt;/div&gt;&#13;\n    &lt;footer class="modal-footer"&gt;&#13;\n        &lt;button id="get-it" type="button"&gt;Get&lt;/button&gt;&#13;\n    &lt;/footer&gt;&#13;\n&lt;/dialog&gt;</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4e11744a4d784259331-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4e11744a4d784259331-2">2</div><div class="crayon-num" data-line="crayon-5be4e11744a4d784259331-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4e11744a4d784259331-4">4</div><div class="crayon-num" data-line="crayon-5be4e11744a4d784259331-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4e11744a4d784259331-6">6</div><div class="crayon-num" data-line="crayon-5be4e11744a4d784259331-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4e11744a4d784259331-8">8</div><div class="crayon-num" data-line="crayon-5be4e11744a4d784259331-9">9</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4e11744a4d784259331-1"><span class="crayon-r ">&lt;dialog </span><span class="crayon-e ">id</span><span class="crayon-o">=</span><span class="crayon-s ">"sweet-modal"</span><span class="crayon-r ">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4e11744a4d784259331-2"><span class="crayon-i ">\xa0\xa0\xa0\xa0</span><span class="crayon-r ">&lt;h3 </span><span class="crayon-e ">class</span><span class="crayon-o">=</span><span class="crayon-s ">"modal-header"</span><span class="crayon-r ">&gt;</span><span class="crayon-i ">sweet dialog</span><span class="crayon-r ">&lt;/h3&gt;</span></div><div class="crayon-line" id="crayon-5be4e11744a4d784259331-3"><span class="crayon-i ">\xa0\xa0\xa0\xa0</span><span class="crayon-r ">&lt;div </span><span class="crayon-e ">class</span><span class="crayon-o">=</span><span class="crayon-s ">"modal-body"</span><span class="crayon-r ">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4e11744a4d784259331-4"><span class="crayon-i ">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-r ">&lt;p&gt;</span><span class="crayon-i ">This is a sweet dialog, which is much better.</span><span class="crayon-r ">&lt;/p&gt;</span></div><div class="crayon-line" id="crayon-5be4e11744a4d784259331-5"><span class="crayon-i ">\xa0\xa0\xa0\xa0</span><span class="crayon-r ">&lt;/div&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4e11744a4d784259331-6"><span class="crayon-i ">\xa0\xa0\xa0\xa0</span><span class="crayon-r ">&lt;footer </span><span class="crayon-e ">class</span><span class="crayon-o">=</span><span class="crayon-s ">"modal-footer"</span><span class="crayon-r ">&gt;</span></div><div class="crayon-line" id="crayon-5be4e11744a4d784259331-7"><span class="crayon-i ">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-r ">&lt;button </span><span class="crayon-e ">id</span><span class="crayon-o">=</span><span class="crayon-s ">"get-it"</span><span class="crayon-h"> </span><span class="crayon-e ">type</span><span class="crayon-o">=</span><span class="crayon-s ">"button"</span><span class="crayon-r ">&gt;</span><span class="crayon-i ">Get</span><span class="crayon-r ">&lt;/button&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4e11744a4d784259331-8"><span class="crayon-i ">\xa0\xa0\xa0\xa0</span><span class="crayon-r ">&lt;/footer&gt;</span></div><div class="crayon-line" id="crayon-5be4e11744a4d784259331-9"><span class="crayon-r ">&lt;/dialog&gt;</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0011 seconds] -->&#13;\n<p/>\n<h3 class="modal-header"/>\n<p>最后，在添加一些 <code>CSS</code>，你就能得到你想要的</p>\n<h2>进阶操作</h2>\n<p>通常，我们期望能从 <code>dialog</code> 中获取一些用户的信息。关闭 <code>dialog</code> 时，我们可以给 <code>close()</code> 传递一个 <code>string</code>，然后通过 <code>dialog</code> 元素的 <code>returnValue</code> 属性来获取</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4e11744a51318371117" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\nmodal.close(\'Accepted\');&#13;\n&#13;\nconsole.log(modal.returnValue); // logs `Accepted`</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4e11744a51318371117-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4e11744a51318371117-2">2</div><div class="crayon-num" data-line="crayon-5be4e11744a51318371117-3">3</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4e11744a51318371117-1"><span class="crayon-v">modal</span><span class="crayon-sy">.</span><span class="crayon-e">close</span><span class="crayon-sy">(</span><span class="crayon-s">\'Accepted\'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4e11744a51318371117-2">\xa0</div><div class="crayon-line" id="crayon-5be4e11744a51318371117-3"><span class="crayon-v">console</span><span class="crayon-sy">.</span><span class="crayon-e">log</span><span class="crayon-sy">(</span><span class="crayon-v">modal</span><span class="crayon-sy">.</span><span class="crayon-v">returnValue</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">// logs `Accepted`</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0006 seconds] -->&#13;\n<p>当然，还存在额外的事件我们可以监听，其中，最常用的可能是 <code>close</code>（关闭 <code>dialog</code> 时触发），还有 <code>cancel</code> （用户按 <code>Esc</code> 关闭 <code>dialog</code> 时触发）</p>\n<p>此外，我们可能还期望点击 <code>dialog</code> 旁边的阴影来关闭，当然，这也是有解决办法的。点击阴影会触发 <code>dialog</code> 的点击事件，如果 <code>dialog</code> 的子元素占满了整个 <code>dialog</code>，那么我们可以通过监听 <code>dialog</code> 的点击，当 <code>target</code> 为 <code>modal</code> 时来关闭它</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4e11744a56267929338" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\nmodal.addEventListener(\'click\', (event) =&gt; {&#13;\n    if (event.target === modal) {&#13;\n        modal.close(\'cancelled\');&#13;\n    }&#13;\n});</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4e11744a56267929338-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4e11744a56267929338-2">2</div><div class="crayon-num" data-line="crayon-5be4e11744a56267929338-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4e11744a56267929338-4">4</div><div class="crayon-num" data-line="crayon-5be4e11744a56267929338-5">5</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4e11744a56267929338-1"><span class="crayon-v">modal</span><span class="crayon-sy">.</span><span class="crayon-e">addEventListener</span><span class="crayon-sy">(</span><span class="crayon-s">\'click\'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">event</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4e11744a56267929338-2"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">event</span><span class="crayon-sy">.</span><span class="crayon-v">target</span><span class="crayon-h"> </span><span class="crayon-o">===</span><span class="crayon-h"> </span><span class="crayon-v">modal</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5be4e11744a56267929338-3"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-v">modal</span><span class="crayon-sy">.</span><span class="crayon-e">close</span><span class="crayon-sy">(</span><span class="crayon-s">\'cancelled\'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4e11744a56267929338-4"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5be4e11744a56267929338-5"><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0011 seconds] -->&#13;\n<p>当然，这不是完美的，但它确实是有效的，如果你有更好的方式，欢迎在评论中交流</p>\n<h2>总结</h2>\n<p>说了这么多，不如自己实际演练一番，作者也做了一个 <a href="https://codepen.io/FengShangWuQi/pen/qpMgZB">demo</a>，欢迎参考</p>\n&#13;\n        <script language="javascript"> &#13;\nvar randomNum = Math.round(Math.random()*1);&#13;\nvar innerHTML=new Array(2);&#13;\ninnerHTML[0]="如果有人让你推荐前端技术书，请让他看这个列表 -&gt;《&lt;a target=\'_blank\' href=\'http://web.jobbole.com/86734/\'&gt;经典前端技术书籍&lt;/a&gt;》";&#13;\ninnerHTML[1]="如果有人让你推荐前端技术书，请让他看这个列表 -&gt;《&lt;a target=\'_blank\' href=\'http://web.jobbole.com/86734/\'&gt;经典前端技术书籍&lt;/a&gt;》";&#13;\nvar widgetHTML="&lt;div id=\'single-page-inner-widget\'&gt;"+innerHTML[randomNum]+"&lt;/div&gt;";&#13;\ndocument.write(widgetHTML);&#13;\n</script>&#13;\n        &#13;\n        \n     \n\n\n\n&#13;\n        <!-- BEGIN #author-bio -->&#13;\n&#13;\n&#13;\n<!-- END #author-bio -->&#13;');
insert into news_article_basic(article_id, user_id, channel_id, title, cover, status)values(30, 1, 1, 'H5游戏开发：消灭星星', '{"type":0, "images":[]}', 2);
insert into news_article_content(article_id, content) values(30,'<div>\n<p><a id="more"/>「消灭星星」是一款很经典的「消除类游戏」，它的玩法很简单：消除相连通的同色砖块。</p>\n<p><img src="https://misc.aotu.io/leeenx/popstar/popstar.gif" alt="demo"/></p>\n<h2 id="1-游戏规则">1. 游戏规则</h2>\n<p>「消灭星星」存在多个版本，不过它们的规则除了「关卡分值」有些出入外，其它的规则都是一样的。笔者介绍的版本的游戏规则整理如下：</p>\n<p><strong>1. 色砖分布</strong></p>\n<ul>\n<li>10 x 10 的表格</li>\n<li>5种颜色 —— 红、绿、蓝，黄，紫</li>\n<li>每类色砖个数在指定区间内随机</li>\n<li>5类色砖在 10 x 10 表格中随机分布</li>\n</ul>\n<p><strong>2. 消除规则</strong></p>\n<p>两个或两个以上同色砖块相连通即是可被消除的砖块。</p>\n<p><strong>3. 分值规则</strong></p>\n<ul>\n<li>消除总分值 = n * n * 5</li>\n<li>奖励总分值 = 2000 – n * n * 20</li>\n</ul>\n<p>「n」表示砖块数量。上面是「总」分值的规则，还有「单」个砖块的分值规则：</p>\n<ul>\n<li>消除砖块得分值 = 10 * i + 5</li>\n<li>剩余砖块扣分值 = 40 * i + 20</li>\n</ul>\n<p>「i」表示砖块的索引值（从 0 开始）。简单地说，单个砖块「得分值」和「扣分值」是一个等差数列。</p>\n<p><strong>4. 关卡分值</strong></p>\n<p>关卡分值 = 1000 + (level – 1) * 2000；「level」即当前关卡数。</p>\n<p><strong>5. 通关条件</strong></p>\n<ul>\n<li>可消除色块不存在</li>\n<li>累计分值 &gt;= 当前关卡分值</li>\n</ul>\n<p>上面两个条件同时成立游戏才可以通关。</p>\n<h2 id="2-MVC-设计模式">2. MVC 设计模式</h2>\n<p>笔者这次又是使用了 MVC 模式来写「消灭星星」。星星「砖块」的数据结构与各种状态由 Model 实现，游戏的核心在 Model 中完成；View 映射 Model 的变化并做出对应的行为，它的任务主要是展示动画；用户与游戏的交互由 Control 完成。</p>\n<p>从逻辑规划上看，Model 很重而View 与 Control 很轻，不过，从代码量上看，View 很重而 Model 与 Control 相对很轻。</p>\n<h2 id="3-Model">3. Model</h2>\n<p>10 x 10 的表格用长度为 100 的数组可完美映射游戏的星星「砖块」。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4efbd2e167518045853" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\n[&#13;\n\tR, R, G, G, B, B, Y, Y, P, P, &#13;\n\tR, R, G, G, B, B, Y, Y, P, P, &#13;\n\tR, R, G, G, B, B, Y, Y, P, P, &#13;\n\tR, R, G, G, B, B, Y, Y, P, P, &#13;\n\tR, R, G, G, B, B, Y, Y, P, P, &#13;\n\tR, R, G, G, B, B, Y, Y, P, P, &#13;\n\tR, R, G, G, B, B, Y, Y, P, P, &#13;\n\tR, R, G, G, B, B, Y, Y, P, P, &#13;\n\tR, R, G, G, B, B, Y, Y, P, P, &#13;\n\tR, R, G, G, B, B, Y, Y, P, P&#13;\n]</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4efbd2e167518045853-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd2e167518045853-2">2</div><div class="crayon-num" data-line="crayon-5be4efbd2e167518045853-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd2e167518045853-4">4</div><div class="crayon-num" data-line="crayon-5be4efbd2e167518045853-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd2e167518045853-6">6</div><div class="crayon-num" data-line="crayon-5be4efbd2e167518045853-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd2e167518045853-8">8</div><div class="crayon-num" data-line="crayon-5be4efbd2e167518045853-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd2e167518045853-10">10</div><div class="crayon-num" data-line="crayon-5be4efbd2e167518045853-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd2e167518045853-12">12</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4efbd2e167518045853-1"><span class="crayon-sy">[</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd2e167518045853-2"><span class="crayon-h">\t</span><span class="crayon-v">R</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">R</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">G</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">G</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">B</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">B</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">Y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">Y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">P</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">P</span><span class="crayon-sy">,</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-5be4efbd2e167518045853-3"><span class="crayon-h">\t</span><span class="crayon-v">R</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">R</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">G</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">G</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">B</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">B</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">Y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">Y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">P</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">P</span><span class="crayon-sy">,</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd2e167518045853-4"><span class="crayon-h">\t</span><span class="crayon-v">R</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">R</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">G</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">G</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">B</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">B</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">Y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">Y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">P</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">P</span><span class="crayon-sy">,</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-5be4efbd2e167518045853-5"><span class="crayon-h">\t</span><span class="crayon-v">R</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">R</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">G</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">G</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">B</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">B</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">Y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">Y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">P</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">P</span><span class="crayon-sy">,</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd2e167518045853-6"><span class="crayon-h">\t</span><span class="crayon-v">R</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">R</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">G</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">G</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">B</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">B</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">Y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">Y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">P</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">P</span><span class="crayon-sy">,</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-5be4efbd2e167518045853-7"><span class="crayon-h">\t</span><span class="crayon-v">R</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">R</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">G</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">G</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">B</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">B</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">Y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">Y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">P</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">P</span><span class="crayon-sy">,</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd2e167518045853-8"><span class="crayon-h">\t</span><span class="crayon-v">R</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">R</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">G</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">G</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">B</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">B</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">Y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">Y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">P</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">P</span><span class="crayon-sy">,</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-5be4efbd2e167518045853-9"><span class="crayon-h">\t</span><span class="crayon-v">R</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">R</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">G</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">G</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">B</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">B</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">Y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">Y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">P</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">P</span><span class="crayon-sy">,</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd2e167518045853-10"><span class="crayon-h">\t</span><span class="crayon-v">R</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">R</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">G</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">G</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">B</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">B</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">Y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">Y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">P</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">P</span><span class="crayon-sy">,</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-5be4efbd2e167518045853-11"><span class="crayon-h">\t</span><span class="crayon-v">R</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">R</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">G</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">G</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">B</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">B</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">Y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">Y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">P</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">P</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd2e167518045853-12"><span class="crayon-sy">]</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0099 seconds] -->&#13;\n<p>R – 红色，G – 绿色，B – 蓝色，Y – 黄色，P – 紫色。Model 的核心任务是以下四个：</p>\n<ul>\n<li>生成砖墙</li>\n<li>消除砖块 （生成砖块分值）</li>\n<li>夯实砖墙</li>\n<li>清除残砖 （生成奖励分值）</li>\n</ul>\n<h3 id="3-1-生成砖墙">3.1 生成砖墙</h3>\n<p>砖墙分两步生成：</p>\n<ul>\n<li>色砖数量分配</li>\n<li>打散色砖</li>\n</ul>\n<p>理论上，可以将 100 个格子可以均分到 5 类颜色，不过笔者玩过的「消灭星星」都不使用均分策略。通过分析几款「消灭星星」，其实可以发现一个规律 —— 「<strong>色砖之间的数量差在一个固定的区间内</strong>」。</p>\n<p>如果把传统意义上的均分称作「完全均分」，那么「消灭星星」的分配是一种在均分线上下波动的「不完全均分」。</p>\n<p><img src="https://misc.aotu.io/leeenx/popstar/2017-12-06-waveAverage.gif" alt="正余弦波线图"/></p>\n<p>笔者把上面的「不完全均分」称作「波动均分」，算法的具体实现可以参见「<a href="https://aotu.io/notes/2018/01/11/waveaverage/">波动均分算法</a>」。</p>\n<p>「打散色砖」其实就是将数组乱序的过程，笔者推荐使用「 <a href="https://en.wikipedia.org/wiki/Fisher%E2%80%93Yates_shuffle" target="_blank" rel="external">费雪耶兹乱序算法</a>」。</p>\n<p>以下是伪代码的实现：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4efbd2e171350006789" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div><span class="crayon-language">JavaScript</span></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\n// 波动均分色砖&#13;\nwaveaverage(5, 4, 4).forEach(&#13;\n\t// tiles 即色墙数组&#13;\n\t(count, clr) =&gt; tiles.concat(generateTiles(count, clr)); &#13;\n); &#13;\n// 打散色砖&#13;\nshuffle(tiles);</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4efbd2e171350006789-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd2e171350006789-2">2</div><div class="crayon-num" data-line="crayon-5be4efbd2e171350006789-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd2e171350006789-4">4</div><div class="crayon-num" data-line="crayon-5be4efbd2e171350006789-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd2e171350006789-6">6</div><div class="crayon-num" data-line="crayon-5be4efbd2e171350006789-7">7</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4efbd2e171350006789-1"><span class="crayon-c">// 波动均分色砖</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd2e171350006789-2"><span class="crayon-e">waveaverage</span><span class="crayon-sy">(</span><span class="crayon-cn">5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">4</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">4</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-st">forEach</span><span class="crayon-sy">(</span></div><div class="crayon-line" id="crayon-5be4efbd2e171350006789-3"><span class="crayon-h">\t</span><span class="crayon-c">// tiles 即色墙数组</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd2e171350006789-4"><span class="crayon-h">\t</span><span class="crayon-sy">(</span><span class="crayon-v">count</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">clr</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-v">tiles</span><span class="crayon-sy">.</span><span class="crayon-e">concat</span><span class="crayon-sy">(</span><span class="crayon-e">generateTiles</span><span class="crayon-sy">(</span><span class="crayon-v">count</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">clr</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-5be4efbd2e171350006789-5"><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd2e171350006789-6"><span class="crayon-c">// 打散色砖</span></div><div class="crayon-line" id="crayon-5be4efbd2e171350006789-7"><span class="crayon-e">shuffle</span><span class="crayon-sy">(</span><span class="crayon-v">tiles</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0013 seconds] -->&#13;\n<p/>\n<h3 id="3-2-消除砖块">3.2 消除砖块</h3>\n<p>「消除砖块」的规则很简单 —— <strong>相邻相连通相同色即可以消除</strong>。</p>\n<p><img src="https://misc.aotu.io/leeenx/popstar/20180111-connection.png" alt="连通图"/><br/>\n前两个组合符合「相邻相连通相同色即可以消除」，所以它们可以被消除；第三个组合虽然「相邻相同色」但是不「相连通」所以它不能被消除。</p>\n<p>「消除砖块」的同时有一个重要的任务：生成砖块对应的分值。在「游戏规则」中，笔者已经提供了对应的数学公式：「消除砖块得分值 = 10 * i + 5」。</p>\n<p><strong>「消除砖块」算法实现如下：</strong></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4efbd2e175284398193" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div><span class="crayon-language">JavaScript</span></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\nfunction clean(tile) { &#13;\n\tlet count = 1; &#13;\n\tlet sameTiles = searchSameTiles(tile); &#13;\n\tif(sameTiles.length &gt; 0) { &#13;\n\t\tdeleteTile(tile); &#13;\n\t\twhile(true) {&#13;\n\t\t\tlet nextSameTiles = []; &#13;\n\t\t\tsameTiles.forEach(tile =&gt; { &#13;\n\t\t\t\tnextSameTiles.push(...searchSameTiles(tile)); &#13;\n\t\t\t\tmakeScore(++count * 10 + 5); // 标记当前分值 &#13;\n\t\t\t\tdeleteTile(tile); // 删除砖块&#13;\n\t\t\t}); &#13;\n\t\t\t// 清除完成，跳出循环&#13;\n\t\t\tif(nextSameTiles.length === 0) break; &#13;\n\t\t\telse {&#13;\n\t\t\t\tsameTiles = nextSameTiles; &#13;\n\t\t\t}&#13;\n\t\t}&#13;\n\t}&#13;\n}</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4efbd2e175284398193-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd2e175284398193-2">2</div><div class="crayon-num" data-line="crayon-5be4efbd2e175284398193-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd2e175284398193-4">4</div><div class="crayon-num" data-line="crayon-5be4efbd2e175284398193-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd2e175284398193-6">6</div><div class="crayon-num" data-line="crayon-5be4efbd2e175284398193-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd2e175284398193-8">8</div><div class="crayon-num" data-line="crayon-5be4efbd2e175284398193-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd2e175284398193-10">10</div><div class="crayon-num" data-line="crayon-5be4efbd2e175284398193-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd2e175284398193-12">12</div><div class="crayon-num" data-line="crayon-5be4efbd2e175284398193-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd2e175284398193-14">14</div><div class="crayon-num" data-line="crayon-5be4efbd2e175284398193-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd2e175284398193-16">16</div><div class="crayon-num" data-line="crayon-5be4efbd2e175284398193-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd2e175284398193-18">18</div><div class="crayon-num" data-line="crayon-5be4efbd2e175284398193-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd2e175284398193-20">20</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4efbd2e175284398193-1"><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-e">clean</span><span class="crayon-sy">(</span><span class="crayon-v">tile</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd2e175284398193-2"><span class="crayon-h">\t</span><span class="crayon-e">let </span><span class="crayon-v">count</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">;</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-5be4efbd2e175284398193-3"><span class="crayon-h">\t</span><span class="crayon-e">let </span><span class="crayon-v">sameTiles</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">searchSameTiles</span><span class="crayon-sy">(</span><span class="crayon-v">tile</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd2e175284398193-4"><span class="crayon-h">\t</span><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-v">sameTiles</span><span class="crayon-sy">.</span><span class="crayon-v">length</span><span class="crayon-h"> </span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-5be4efbd2e175284398193-5"><span class="crayon-h">\t\t</span><span class="crayon-e">deleteTile</span><span class="crayon-sy">(</span><span class="crayon-v">tile</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd2e175284398193-6"><span class="crayon-h">\t\t</span><span class="crayon-st">while</span><span class="crayon-sy">(</span><span class="crayon-t">true</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5be4efbd2e175284398193-7"><span class="crayon-h">\t\t\t</span><span class="crayon-e">let </span><span class="crayon-v">nextSameTiles</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd2e175284398193-8"><span class="crayon-h">\t\t\t</span><span class="crayon-v">sameTiles</span><span class="crayon-sy">.</span><span class="crayon-st">forEach</span><span class="crayon-sy">(</span><span class="crayon-v">tile</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-5be4efbd2e175284398193-9"><span class="crayon-h">\t\t\t\t</span><span class="crayon-v">nextSameTiles</span><span class="crayon-sy">.</span><span class="crayon-e">push</span><span class="crayon-sy">(</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-e">searchSameTiles</span><span class="crayon-sy">(</span><span class="crayon-v">tile</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd2e175284398193-10"><span class="crayon-h">\t\t\t\t</span><span class="crayon-e">makeScore</span><span class="crayon-sy">(</span><span class="crayon-o">++</span><span class="crayon-v">count</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-cn">10</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">5</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">// 标记当前分值 </span></div><div class="crayon-line" id="crayon-5be4efbd2e175284398193-11"><span class="crayon-h">\t\t\t\t</span><span class="crayon-e">deleteTile</span><span class="crayon-sy">(</span><span class="crayon-v">tile</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">// 删除砖块</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd2e175284398193-12"><span class="crayon-h">\t\t\t</span><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-5be4efbd2e175284398193-13"><span class="crayon-h">\t\t\t</span><span class="crayon-c">// 清除完成，跳出循环</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd2e175284398193-14"><span class="crayon-h">\t\t\t</span><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-v">nextSameTiles</span><span class="crayon-sy">.</span><span class="crayon-v">length</span><span class="crayon-h"> </span><span class="crayon-o">===</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">break</span><span class="crayon-sy">;</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-5be4efbd2e175284398193-15"><span class="crayon-h">\t\t\t</span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd2e175284398193-16"><span class="crayon-h">\t\t\t\t</span><span class="crayon-v">sameTiles</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">nextSameTiles</span><span class="crayon-sy">;</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-5be4efbd2e175284398193-17"><span class="crayon-h">\t\t\t</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd2e175284398193-18"><span class="crayon-h">\t\t</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5be4efbd2e175284398193-19"><span class="crayon-h">\t</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd2e175284398193-20"><span class="crayon-sy">}</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0036 seconds] -->&#13;\n<p>清除的算法使用「递归」逻辑上会清晰一些，不过「递归」在浏览器上容易「栈溢出」，所以笔者没有使用「递归」实现。</p>\n<h3 id="3-3-夯实砖墙">3.3 夯实砖墙</h3>\n<p>砖墙在消除了部分砖块后，会出现空洞，此时需要对墙体进行夯实：</p>\n<table>\n<thead>\n<tr>\n<th><img src="https://misc.aotu.io/leeenx/popstar/20180112-down.gif" alt="向下夯实"/></th>\n<th><img src="https://misc.aotu.io/leeenx/popstar/20180112-left.gif" alt="向左夯实"/></th>\n<th><img src="https://misc.aotu.io/leeenx/popstar/20180112-down-left.gif" alt="先下再左夯实"/></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>向下夯实</strong></td>\n<td><strong>向左夯实</strong></td>\n<td><strong>向左下夯实</strong>（先下后左）</td>\n</tr>\n</tbody>\n</table>\n<p>一种快速的实现方案是，每次「消除砖块」后直接遍历砖墙数组（10×10数组）再把空洞夯实，伪代码表示如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4efbd2e17a373261460" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div><span class="crayon-language">JavaScript</span></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\nfor(let row = 0; row &lt; 10; ++row) {&#13;\n\tfor(let col = 0; col &lt; 10; ++col) { &#13;\n\t\tif(isEmpty(row, col)) {&#13;\n\t\t\t// 水平方向（向左）夯实&#13;\n\t\t\tif(isEmptyCol(col)) { &#13;\n\t\t\t\ttampRow(col); &#13;\n\t\t\t}&#13;\n\t\t\t// 垂直方向（向下）夯实&#13;\n\t\t\telse {&#13;\n\t\t\t\ttampCol(col); &#13;\n\t\t\t}&#13;\n\t\t\tbreak; &#13;\n\t\t}&#13;\n\t}&#13;\n}</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4efbd2e17a373261460-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd2e17a373261460-2">2</div><div class="crayon-num" data-line="crayon-5be4efbd2e17a373261460-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd2e17a373261460-4">4</div><div class="crayon-num" data-line="crayon-5be4efbd2e17a373261460-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd2e17a373261460-6">6</div><div class="crayon-num" data-line="crayon-5be4efbd2e17a373261460-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd2e17a373261460-8">8</div><div class="crayon-num" data-line="crayon-5be4efbd2e17a373261460-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd2e17a373261460-10">10</div><div class="crayon-num" data-line="crayon-5be4efbd2e17a373261460-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd2e17a373261460-12">12</div><div class="crayon-num" data-line="crayon-5be4efbd2e17a373261460-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd2e17a373261460-14">14</div><div class="crayon-num" data-line="crayon-5be4efbd2e17a373261460-15">15</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4efbd2e17a373261460-1"><span class="crayon-st">for</span><span class="crayon-sy">(</span><span class="crayon-e">let </span><span class="crayon-v">row</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-v">row</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-h"> </span><span class="crayon-cn">10</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-o">++</span><span class="crayon-v">row</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd2e17a373261460-2"><span class="crayon-h">\t</span><span class="crayon-st">for</span><span class="crayon-sy">(</span><span class="crayon-e">let </span><span class="crayon-v">col</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-v">col</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-h"> </span><span class="crayon-cn">10</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-o">++</span><span class="crayon-v">col</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-5be4efbd2e17a373261460-3"><span class="crayon-h">\t\t</span><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-e">isEmpty</span><span class="crayon-sy">(</span><span class="crayon-v">row</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd2e17a373261460-4"><span class="crayon-h">\t\t\t</span><span class="crayon-c">// 水平方向（向左）夯实</span></div><div class="crayon-line" id="crayon-5be4efbd2e17a373261460-5"><span class="crayon-h">\t\t\t</span><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-e">isEmptyCol</span><span class="crayon-sy">(</span><span class="crayon-v">col</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd2e17a373261460-6"><span class="crayon-h">\t\t\t\t</span><span class="crayon-e">tampRow</span><span class="crayon-sy">(</span><span class="crayon-v">col</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-5be4efbd2e17a373261460-7"><span class="crayon-h">\t\t\t</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd2e17a373261460-8"><span class="crayon-h">\t\t\t</span><span class="crayon-c">// 垂直方向（向下）夯实</span></div><div class="crayon-line" id="crayon-5be4efbd2e17a373261460-9"><span class="crayon-h">\t\t\t</span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd2e17a373261460-10"><span class="crayon-h">\t\t\t\t</span><span class="crayon-e">tampCol</span><span class="crayon-sy">(</span><span class="crayon-v">col</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-5be4efbd2e17a373261460-11"><span class="crayon-h">\t\t\t</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd2e17a373261460-12"><span class="crayon-h">\t\t\t</span><span class="crayon-st">break</span><span class="crayon-sy">;</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-5be4efbd2e17a373261460-13"><span class="crayon-h">\t\t</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd2e17a373261460-14"><span class="crayon-h">\t</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5be4efbd2e17a373261460-15"><span class="crayon-sy">}</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0024 seconds] -->&#13;\n<p>But… 为了夯实一个空洞对一张大数组进行全量遍历并不是一种高效的算法。在笔者看来影响「墙体夯实」效率的因素有：</p>\n<ol>\n<li>定位空洞</li>\n<li>砖块移动（夯实）</li>\n</ol>\n<p>扫描墙体数组的主要目的是「定位空洞」，但能否不扫描墙体数组直接「定位空洞」？</p>\n<p>墙体的「空洞」是由于「消除砖块」造成的，换种说法 —— <strong>被消除的砖块留下来的坑位就是墙体的空洞</strong>。在「消除砖块」的同时标记空洞的位置，这样就无须全量扫描墙体数组，伪代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4efbd2e17d249941797" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div><span class="crayon-language">JavaScript</span></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\nfunction deleteTile(tile) { &#13;\n\t// 标记空洞&#13;\n\tmarkHollow(tile.index); &#13;\n\t// 删除砖块逻辑&#13;\n\t...&#13;\n}</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4efbd2e17d249941797-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd2e17d249941797-2">2</div><div class="crayon-num" data-line="crayon-5be4efbd2e17d249941797-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd2e17d249941797-4">4</div><div class="crayon-num" data-line="crayon-5be4efbd2e17d249941797-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd2e17d249941797-6">6</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4efbd2e17d249941797-1"><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-e">deleteTile</span><span class="crayon-sy">(</span><span class="crayon-v">tile</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd2e17d249941797-2"><span class="crayon-h">\t</span><span class="crayon-c">// 标记空洞</span></div><div class="crayon-line" id="crayon-5be4efbd2e17d249941797-3"><span class="crayon-h">\t</span><span class="crayon-e">markHollow</span><span class="crayon-sy">(</span><span class="crayon-v">tile</span><span class="crayon-sy">.</span><span class="crayon-v">index</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd2e17d249941797-4"><span class="crayon-h">\t</span><span class="crayon-c">// 删除砖块逻辑</span></div><div class="crayon-line" id="crayon-5be4efbd2e17d249941797-5"><span class="crayon-h">\t</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd2e17d249941797-6"><span class="crayon-sy">}</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0009 seconds] -->&#13;\n<p>在上面的夯实动图，其实可以看到它的夯实过程如下：</p>\n<ol>\n<li>空洞上方的砖块向下移动</li>\n<li>空列右侧的砖块向左移动</li>\n</ol>\n<p>墙体在「夯实」过程中，它的边界是实时在变化，如果「夯实」不按真实边界进行扫描，会产生多余的空白扫描：</p>\n<p><img src="https://misc.aotu.io/leeenx/popstar/20180116-clean.gif" alt="对比"/></p>\n<p><strong>如何记录墙体的边界？</strong><br/>\n把墙体拆分成一个个单独的列，那么列最顶部的空白格片段就是墙体的「空白」，而其余非顶部的空白格片段即墙体的「空洞」。</p>\n<p><img src="https://misc.aotu.io/leeenx/popstar/20180117-col.gif" alt="列"/></p>\n<p>笔者使用一组「列集合」来描述墙体的边界并记录墙体的空洞，它的模型如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4efbd2e181857572923" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div><span class="crayon-language">JavaScript</span></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\n/*&#13;\n\t@ count - 列砖块数&#13;\n\t@ start - 顶部行索引&#13;\n\t@ end - 底部行索引&#13;\n\t@ pitCount - 坑数&#13;\n\t@ topPit - 最顶部的坑&#13;\n\t@ bottomPit - 最底部的坑&#13;\n*/ &#13;\nlet wall = [&#13;\n\t{count, start, end, pitCount, topPit, bottomPit}, &#13;\n\t{count, start, end, pitCount, topPit, bottomPit},&#13;\n\t...&#13;\n];</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4efbd2e181857572923-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd2e181857572923-2">2</div><div class="crayon-num" data-line="crayon-5be4efbd2e181857572923-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd2e181857572923-4">4</div><div class="crayon-num" data-line="crayon-5be4efbd2e181857572923-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd2e181857572923-6">6</div><div class="crayon-num" data-line="crayon-5be4efbd2e181857572923-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd2e181857572923-8">8</div><div class="crayon-num" data-line="crayon-5be4efbd2e181857572923-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd2e181857572923-10">10</div><div class="crayon-num" data-line="crayon-5be4efbd2e181857572923-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd2e181857572923-12">12</div><div class="crayon-num" data-line="crayon-5be4efbd2e181857572923-13">13</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4efbd2e181857572923-1"><span class="crayon-c">/*</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd2e181857572923-2"><span class="crayon-c">\t@ count - 列砖块数</span></div><div class="crayon-line" id="crayon-5be4efbd2e181857572923-3"><span class="crayon-c">\t@ start - 顶部行索引</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd2e181857572923-4"><span class="crayon-c">\t@ end - 底部行索引</span></div><div class="crayon-line" id="crayon-5be4efbd2e181857572923-5"><span class="crayon-c">\t@ pitCount - 坑数</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd2e181857572923-6"><span class="crayon-c">\t@ topPit - 最顶部的坑</span></div><div class="crayon-line" id="crayon-5be4efbd2e181857572923-7"><span class="crayon-c">\t@ bottomPit - 最底部的坑</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd2e181857572923-8"><span class="crayon-c">*/</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-5be4efbd2e181857572923-9"><span class="crayon-e">let </span><span class="crayon-v">wall</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd2e181857572923-10"><span class="crayon-h">\t</span><span class="crayon-sy">{</span><span class="crayon-v">count</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">start</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-st">end</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">pitCount</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">topPit</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">bottomPit</span><span class="crayon-sy">}</span><span class="crayon-sy">,</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-5be4efbd2e181857572923-11"><span class="crayon-h">\t</span><span class="crayon-sy">{</span><span class="crayon-v">count</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">start</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-st">end</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">pitCount</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">topPit</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">bottomPit</span><span class="crayon-sy">}</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd2e181857572923-12"><span class="crayon-h">\t</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span></div><div class="crayon-line" id="crayon-5be4efbd2e181857572923-13"><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0014 seconds] -->&#13;\n<p>这个模型可以描述墙体的三个细节：</p>\n<ul>\n<li>空列</li>\n<li>列的连续空洞</li>\n<li>列的非连续空洞<br/>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4efbd2e185272016987" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div><span class="crayon-language">JavaScript</span></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\n// 空列&#13;\nif(count === 0) { &#13;\n\t...&#13;\n}&#13;\n// 连续空洞&#13;\nelse if(bottomPit - topPit + 1 === pitCount) { &#13;\n\t...&#13;\n}&#13;\n// 非连续空洞&#13;\nelse {&#13;\n\t...&#13;\n}</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4efbd2e185272016987-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd2e185272016987-2">2</div><div class="crayon-num" data-line="crayon-5be4efbd2e185272016987-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd2e185272016987-4">4</div><div class="crayon-num" data-line="crayon-5be4efbd2e185272016987-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd2e185272016987-6">6</div><div class="crayon-num" data-line="crayon-5be4efbd2e185272016987-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd2e185272016987-8">8</div><div class="crayon-num" data-line="crayon-5be4efbd2e185272016987-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd2e185272016987-10">10</div><div class="crayon-num" data-line="crayon-5be4efbd2e185272016987-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd2e185272016987-12">12</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4efbd2e185272016987-1"><span class="crayon-c">// 空列</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd2e185272016987-2"><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-v">count</span><span class="crayon-h"> </span><span class="crayon-o">===</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-5be4efbd2e185272016987-3"><span class="crayon-h">\t</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd2e185272016987-4"><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5be4efbd2e185272016987-5"><span class="crayon-c">// 连续空洞</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd2e185272016987-6"><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-v">bottomPit</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">topPit</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-o">===</span><span class="crayon-h"> </span><span class="crayon-v">pitCount</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-5be4efbd2e185272016987-7"><span class="crayon-h">\t</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd2e185272016987-8"><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5be4efbd2e185272016987-9"><span class="crayon-c">// 非连续空洞</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd2e185272016987-10"><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5be4efbd2e185272016987-11"><span class="crayon-h">\t</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd2e185272016987-12"><span class="crayon-sy">}</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0014 seconds] -->&#13;\n\n</li>\n</ul>\n<p>砖块在消除后，映射到单个列上的空洞会有两种分布形态 —— 连续与非连续。</p>\n<p><img src="https://misc.aotu.io/leeenx/popstar/20180117-col2.gif" alt="连续空格与非连续空格"/></p>\n<p>「连续空洞」与「非连续空洞」的夯实过程如下：</p>\n<p><img src="https://misc.aotu.io/leeenx/popstar/20180117-tamp.gif" alt="空洞压缩"/></p>\n<p>其实「空列」放大于墙体上，也会有「空洞」类似的分布形态 —— 连续与非连续。<br/>\n<img src="https://misc.aotu.io/leeenx/popstar/20180117-col3.gif" alt="空洞压缩"/></p>\n<p>它的夯实过程与空洞类似，这里就不赘述了。</p>\n<h3 id="3-4-消除残砖">3.4 消除残砖</h3>\n<p>上一小节提到了「描述墙体的边界并记录墙体的空洞」的「列集合」，笔者是直接使用这个「列集合」来消除残砖的，伪代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4efbd2e188413097641" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div><span class="crayon-language">JavaScript</span></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\nfunction clearAll() {&#13;\n\tlet count = 0; &#13;\n\tfor(let col = 0, len = this.wall.length;  col &lt; len; ++col) { &#13;\n\t\tlet colInfo = this.wall[col]; &#13;\n\t\tfor(let row = colInfo.start; row &lt;= colInfo.end; ++row) {&#13;\n\t\t\tlet tile = this.grid[row * this.col + col]; &#13;\n\t\t\ttile.score = -20 - 40 * count++; // 标记奖励分数&#13;\n\t\t\ttile.removed = true; &#13;\n\t\t}&#13;\n\t}&#13;\n}</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4efbd2e188413097641-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd2e188413097641-2">2</div><div class="crayon-num" data-line="crayon-5be4efbd2e188413097641-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd2e188413097641-4">4</div><div class="crayon-num" data-line="crayon-5be4efbd2e188413097641-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd2e188413097641-6">6</div><div class="crayon-num" data-line="crayon-5be4efbd2e188413097641-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd2e188413097641-8">8</div><div class="crayon-num" data-line="crayon-5be4efbd2e188413097641-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd2e188413097641-10">10</div><div class="crayon-num" data-line="crayon-5be4efbd2e188413097641-11">11</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4efbd2e188413097641-1"><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-e">clearAll</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd2e188413097641-2"><span class="crayon-h">\t</span><span class="crayon-e">let </span><span class="crayon-v">count</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">;</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-5be4efbd2e188413097641-3"><span class="crayon-h">\t</span><span class="crayon-st">for</span><span class="crayon-sy">(</span><span class="crayon-e">let </span><span class="crayon-v">col</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">len</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">wall</span><span class="crayon-sy">.</span><span class="crayon-v">length</span><span class="crayon-sy">;</span><span class="crayon-h">\xa0\xa0</span><span class="crayon-v">col</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-h"> </span><span class="crayon-v">len</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-o">++</span><span class="crayon-v">col</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd2e188413097641-4"><span class="crayon-h">\t\t</span><span class="crayon-e">let </span><span class="crayon-v">colInfo</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">wall</span><span class="crayon-sy">[</span><span class="crayon-v">col</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-5be4efbd2e188413097641-5"><span class="crayon-h">\t\t</span><span class="crayon-st">for</span><span class="crayon-sy">(</span><span class="crayon-e">let </span><span class="crayon-v">row</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">colInfo</span><span class="crayon-sy">.</span><span class="crayon-v">start</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-v">row</span><span class="crayon-h"> </span><span class="crayon-o">&lt;=</span><span class="crayon-h"> </span><span class="crayon-v">colInfo</span><span class="crayon-sy">.</span><span class="crayon-st">end</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-o">++</span><span class="crayon-v">row</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd2e188413097641-6"><span class="crayon-h">\t\t\t</span><span class="crayon-e">let </span><span class="crayon-v">tile</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">grid</span><span class="crayon-sy">[</span><span class="crayon-v">row</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">col</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">col</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-5be4efbd2e188413097641-7"><span class="crayon-h">\t\t\t</span><span class="crayon-v">tile</span><span class="crayon-sy">.</span><span class="crayon-v">score</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">20</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-cn">40</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">count</span><span class="crayon-o">++</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">// 标记奖励分数</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd2e188413097641-8"><span class="crayon-h">\t\t\t</span><span class="crayon-v">tile</span><span class="crayon-sy">.</span><span class="crayon-v">removed</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">true</span><span class="crayon-sy">;</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-5be4efbd2e188413097641-9"><span class="crayon-h">\t\t</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd2e188413097641-10"><span class="crayon-h">\t</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5be4efbd2e188413097641-11"><span class="crayon-sy">}</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0036 seconds] -->&#13;\n<p/>\n<h2 id="4-View">4. View</h2>\n<p>View 主要的功能有两个：</p>\n<ul>\n<li>UI 管理</li>\n<li>映射 Model 的变化（动画）</li>\n</ul>\n<p>UI 管理主要是指「界面绘制」与「资源加载管理」，这两项功能比较常见本文就直接略过了。View 的重头戏是「映射 Model 的变化」并完成对应的动画。动画是复杂的，而映射的原理是简单的，如下伪代码：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4efbd2e18c371518343" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div><span class="crayon-language">JavaScript</span></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\nupdate({originIndex, index, clr, removed, score}) { &#13;\n\t// 还没有 originIndex 或没有色值，直接不处理&#13;\n\tif(originIndex === undefined || clr === undefined) return ; &#13;\n\tlet tile = this.tiles[originIndex]; &#13;\n\t// tile 存在，判断颜色是否一样&#13;\n\tif(tile.clr !== clr) {&#13;\n\t\tthis.updateTileClr(tile, clr); &#13;\n\t}&#13;\n\t// 当前索引变化 ----- 表示位置也有变化 &#13;\n\tif(tile.index !== index) { &#13;\n\t\tthis.updateTileIndex(tile, index); &#13;\n\t}&#13;\n\t// 设置分数&#13;\n\tif(tile.score !== score) {&#13;\n\t\ttile.score = score; &#13;\n\t}&#13;\n\tif(tile.removed !== removed) { &#13;\n\t\t// 移除或添加当前节点&#13;\n\t\ttrue === removed ? this.bomb(tile) : this.area.addChild(tile.sprite); &#13;\n\t\ttile.removed = removed; &#13;\n\t}&#13;\n}</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4efbd2e18c371518343-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd2e18c371518343-2">2</div><div class="crayon-num" data-line="crayon-5be4efbd2e18c371518343-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd2e18c371518343-4">4</div><div class="crayon-num" data-line="crayon-5be4efbd2e18c371518343-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd2e18c371518343-6">6</div><div class="crayon-num" data-line="crayon-5be4efbd2e18c371518343-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd2e18c371518343-8">8</div><div class="crayon-num" data-line="crayon-5be4efbd2e18c371518343-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd2e18c371518343-10">10</div><div class="crayon-num" data-line="crayon-5be4efbd2e18c371518343-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd2e18c371518343-12">12</div><div class="crayon-num" data-line="crayon-5be4efbd2e18c371518343-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd2e18c371518343-14">14</div><div class="crayon-num" data-line="crayon-5be4efbd2e18c371518343-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd2e18c371518343-16">16</div><div class="crayon-num" data-line="crayon-5be4efbd2e18c371518343-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd2e18c371518343-18">18</div><div class="crayon-num" data-line="crayon-5be4efbd2e18c371518343-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd2e18c371518343-20">20</div><div class="crayon-num" data-line="crayon-5be4efbd2e18c371518343-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd2e18c371518343-22">22</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4efbd2e18c371518343-1"><span class="crayon-e">update</span><span class="crayon-sy">(</span><span class="crayon-sy">{</span><span class="crayon-v">originIndex</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">index</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">clr</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">removed</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd2e18c371518343-2"><span class="crayon-h">\t</span><span class="crayon-c">// 还没有 originIndex 或没有色值，直接不处理</span></div><div class="crayon-line" id="crayon-5be4efbd2e18c371518343-3"><span class="crayon-h">\t</span><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-v">originIndex</span><span class="crayon-h"> </span><span class="crayon-o">===</span><span class="crayon-h"> </span><span class="crayon-v">undefined</span><span class="crayon-h"> </span><span class="crayon-o">||</span><span class="crayon-h"> </span><span class="crayon-v">clr</span><span class="crayon-h"> </span><span class="crayon-o">===</span><span class="crayon-h"> </span><span class="crayon-v">undefined</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">;</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd2e18c371518343-4"><span class="crayon-h">\t</span><span class="crayon-e">let </span><span class="crayon-v">tile</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">tiles</span><span class="crayon-sy">[</span><span class="crayon-v">originIndex</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-5be4efbd2e18c371518343-5"><span class="crayon-h">\t</span><span class="crayon-c">// tile 存在，判断颜色是否一样</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd2e18c371518343-6"><span class="crayon-h">\t</span><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-v">tile</span><span class="crayon-sy">.</span><span class="crayon-v">clr</span><span class="crayon-h"> </span><span class="crayon-o">!==</span><span class="crayon-h"> </span><span class="crayon-v">clr</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5be4efbd2e18c371518343-7"><span class="crayon-h">\t\t</span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-e">updateTileClr</span><span class="crayon-sy">(</span><span class="crayon-v">tile</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">clr</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd2e18c371518343-8"><span class="crayon-h">\t</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5be4efbd2e18c371518343-9"><span class="crayon-h">\t</span><span class="crayon-c">// 当前索引变化 ----- 表示位置也有变化 </span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd2e18c371518343-10"><span class="crayon-h">\t</span><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-v">tile</span><span class="crayon-sy">.</span><span class="crayon-v">index</span><span class="crayon-h"> </span><span class="crayon-o">!==</span><span class="crayon-h"> </span><span class="crayon-v">index</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-5be4efbd2e18c371518343-11"><span class="crayon-h">\t\t</span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-e">updateTileIndex</span><span class="crayon-sy">(</span><span class="crayon-v">tile</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">index</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd2e18c371518343-12"><span class="crayon-h">\t</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5be4efbd2e18c371518343-13"><span class="crayon-h">\t</span><span class="crayon-c">// 设置分数</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd2e18c371518343-14"><span class="crayon-h">\t</span><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-v">tile</span><span class="crayon-sy">.</span><span class="crayon-v">score</span><span class="crayon-h"> </span><span class="crayon-o">!==</span><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5be4efbd2e18c371518343-15"><span class="crayon-h">\t\t</span><span class="crayon-v">tile</span><span class="crayon-sy">.</span><span class="crayon-v">score</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-sy">;</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd2e18c371518343-16"><span class="crayon-h">\t</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5be4efbd2e18c371518343-17"><span class="crayon-h">\t</span><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-v">tile</span><span class="crayon-sy">.</span><span class="crayon-v">removed</span><span class="crayon-h"> </span><span class="crayon-o">!==</span><span class="crayon-h"> </span><span class="crayon-v">removed</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd2e18c371518343-18"><span class="crayon-h">\t\t</span><span class="crayon-c">// 移除或添加当前节点</span></div><div class="crayon-line" id="crayon-5be4efbd2e18c371518343-19"><span class="crayon-h">\t\t</span><span class="crayon-t">true</span><span class="crayon-h"> </span><span class="crayon-o">===</span><span class="crayon-h"> </span><span class="crayon-i">removed</span><span class="crayon-h"> </span><span class="crayon-sy">?</span><span class="crayon-h"> </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-e">bomb</span><span class="crayon-sy">(</span><span class="crayon-v">tile</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">area</span><span class="crayon-sy">.</span><span class="crayon-e">addChild</span><span class="crayon-sy">(</span><span class="crayon-v">tile</span><span class="crayon-sy">.</span><span class="crayon-v">sprite</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd2e18c371518343-20"><span class="crayon-h">\t\t</span><span class="crayon-v">tile</span><span class="crayon-sy">.</span><span class="crayon-v">removed</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">removed</span><span class="crayon-sy">;</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-5be4efbd2e18c371518343-21"><span class="crayon-h">\t</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd2e18c371518343-22"><span class="crayon-sy">}</span></div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0157 seconds] -->&#13;\n<p>Model 的砖块每次数据的更改都会通知到 View 的砖块，View 会根据对应的变化做对应的动作（动画）。</p>\n<h2 id="5-Control">5. Control</h2>\n<p>Control 要处理的事务比较多，如下：</p>\n<ul>\n<li>绑定 Model &amp; View</li>\n<li>生成通关分值</li>\n<li>判断通关条件</li>\n<li>对外事件</li>\n<li>用户交互</li>\n</ul>\n<p>初始化时，Control 把 Model 的砖块单向绑定到 View 的砖块了。如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->&#13;\n&#13;\n\t\t<div id="crayon-5be4efbd2e190524102391" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">&#13;\n\t\t&#13;\n\t\t\t<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"/>&#13;\n\t\t\t<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"/></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"/></div></div></div>&#13;\n\t\t\t<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"/>&#13;\n\t\t\t<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">\nObject.defineProperties(model.tile, {&#13;\n    originIndex: {&#13;\n        get() {...}, &#13;\n        set(){&#13;\n            ...&#13;\n            view.update({originIndex})&#13;\n        }&#13;\n    },  &#13;\n    index: {&#13;\n        get() {...}, &#13;\n        set() {&#13;\n            ...&#13;\n            view.update({index})&#13;\n        }&#13;\n    }, &#13;\n    clr: {&#13;\n        get() {...}, &#13;\n        set() {&#13;\n            ...&#13;\n            view.update({clr})&#13;\n        }&#13;\n    }, &#13;\n    removed: {&#13;\n        get() {...}, &#13;\n        set() {&#13;\n            ...&#13;\n            view.update({removed})&#13;\n        }&#13;\n    },  &#13;\n    score: {&#13;\n        get() {...}, &#13;\n        set() {&#13;\n            ...&#13;\n            view.update({score})&#13;\n        }&#13;\n    }&#13;\n})&#13;\n</textarea></div>&#13;\n\t\t\t<div class="crayon-main" style="">&#13;\n\t\t\t\t<table class="crayon-table">&#13;\n\t\t\t\t\t<tr class="crayon-row">&#13;\n\t\t\t\t<td class="crayon-nums " data-settings="show">&#13;\n\t\t\t\t\t<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5be4efbd2e190524102391-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd2e190524102391-2">2</div><div class="crayon-num" data-line="crayon-5be4efbd2e190524102391-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd2e190524102391-4">4</div><div class="crayon-num" data-line="crayon-5be4efbd2e190524102391-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd2e190524102391-6">6</div><div class="crayon-num" data-line="crayon-5be4efbd2e190524102391-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd2e190524102391-8">8</div><div class="crayon-num" data-line="crayon-5be4efbd2e190524102391-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd2e190524102391-10">10</div><div class="crayon-num" data-line="crayon-5be4efbd2e190524102391-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd2e190524102391-12">12</div><div class="crayon-num" data-line="crayon-5be4efbd2e190524102391-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd2e190524102391-14">14</div><div class="crayon-num" data-line="crayon-5be4efbd2e190524102391-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd2e190524102391-16">16</div><div class="crayon-num" data-line="crayon-5be4efbd2e190524102391-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd2e190524102391-18">18</div><div class="crayon-num" data-line="crayon-5be4efbd2e190524102391-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd2e190524102391-20">20</div><div class="crayon-num" data-line="crayon-5be4efbd2e190524102391-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd2e190524102391-22">22</div><div class="crayon-num" data-line="crayon-5be4efbd2e190524102391-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd2e190524102391-24">24</div><div class="crayon-num" data-line="crayon-5be4efbd2e190524102391-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd2e190524102391-26">26</div><div class="crayon-num" data-line="crayon-5be4efbd2e190524102391-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd2e190524102391-28">28</div><div class="crayon-num" data-line="crayon-5be4efbd2e190524102391-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd2e190524102391-30">30</div><div class="crayon-num" data-line="crayon-5be4efbd2e190524102391-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd2e190524102391-32">32</div><div class="crayon-num" data-line="crayon-5be4efbd2e190524102391-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd2e190524102391-34">34</div><div class="crayon-num" data-line="crayon-5be4efbd2e190524102391-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd2e190524102391-36">36</div><div class="crayon-num" data-line="crayon-5be4efbd2e190524102391-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5be4efbd2e190524102391-38">38</div></div>&#13;\n\t\t\t\t</td>&#13;\n\t\t\t\t\t\t<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5be4efbd2e190524102391-1"><span class="crayon-t">Object</span><span class="crayon-sy">.</span><span class="crayon-e">defineProperties</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-v">tile</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd2e190524102391-2"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-v">originIndex</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5be4efbd2e190524102391-3"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">}</span><span class="crayon-sy">,</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd2e190524102391-4"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-e">set</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5be4efbd2e190524102391-5"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd2e190524102391-6"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-v">view</span><span class="crayon-sy">.</span><span class="crayon-e">update</span><span class="crayon-sy">(</span><span class="crayon-sy">{</span><span class="crayon-v">originIndex</span><span class="crayon-sy">}</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5be4efbd2e190524102391-7"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd2e190524102391-8"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-sy">}</span><span class="crayon-sy">,</span><span class="crayon-h">\xa0\xa0</span></div><div class="crayon-line" id="crayon-5be4efbd2e190524102391-9"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-v">index</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd2e190524102391-10"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">}</span><span class="crayon-sy">,</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-5be4efbd2e190524102391-11"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-e">set</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd2e190524102391-12"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span></div><div class="crayon-line" id="crayon-5be4efbd2e190524102391-13"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-v">view</span><span class="crayon-sy">.</span><span class="crayon-e">update</span><span class="crayon-sy">(</span><span class="crayon-sy">{</span><span class="crayon-v">index</span><span class="crayon-sy">}</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd2e190524102391-14"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5be4efbd2e190524102391-15"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-sy">}</span><span class="crayon-sy">,</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd2e190524102391-16"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-v">clr</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5be4efbd2e190524102391-17"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">}</span><span class="crayon-sy">,</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd2e190524102391-18"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-e">set</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5be4efbd2e190524102391-19"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd2e190524102391-20"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-v">view</span><span class="crayon-sy">.</span><span class="crayon-e">update</span><span class="crayon-sy">(</span><span class="crayon-sy">{</span><span class="crayon-v">clr</span><span class="crayon-sy">}</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5be4efbd2e190524102391-21"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd2e190524102391-22"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-sy">}</span><span class="crayon-sy">,</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-5be4efbd2e190524102391-23"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-v">removed</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd2e190524102391-24"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">}</span><span class="crayon-sy">,</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-5be4efbd2e190524102391-25"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-e">set</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd2e190524102391-26"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span></div><div class="crayon-line" id="crayon-5be4efbd2e190524102391-27"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-v">view</span><span class="crayon-sy">.</span><span class="crayon-e">update</span><span class="crayon-sy">(</span><span class="crayon-sy">{</span><span class="crayon-v">removed</span><span class="crayon-sy">}</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd2e190524102391-28"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5be4efbd2e190524102391-29"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-sy">}</span><span class="crayon-sy">,</span><span class="crayon-h">\xa0\xa0</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd2e190524102391-30"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-v">score</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5be4efbd2e190524102391-31"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">}</span><span class="crayon-sy">,</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd2e190524102391-32"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-e">set</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5be4efbd2e190524102391-33"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd2e190524102391-34"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-v">view</span><span class="crayon-sy">.</span><span class="crayon-e">update</span><span class="crayon-sy">(</span><span class="crayon-sy">{</span><span class="crayon-v">score</span><span class="crayon-sy">}</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5be4efbd2e190524102391-35"><span class="crayon-h">\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd2e190524102391-36"><span class="crayon-h">\xa0\xa0\xa0\xa0</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5be4efbd2e190524102391-37"><span class="crayon-sy">}</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5be4efbd2e190524102391-38">\xa0</div></div></td>&#13;\n\t\t\t\t\t</tr>&#13;\n\t\t\t\t</table>&#13;\n\t\t\t</div>&#13;\n\t\t</div>&#13;\n<!-- [Format Time: 0.0075 seconds] -->&#13;\n<p>「通关分值」与「判断通关条件」这对逻辑在本文的「游戏规则」中有相关介绍，这里不再赘述。</p>\n<p>对外事件规划如下：</p>\n<table>\n<thead>\n<tr>\n<th>name</th>\n<th>detail</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>pass</td>\n<td>通关</td>\n</tr>\n<tr>\n<td>pause</td>\n<td>暂停</td>\n</tr>\n<tr>\n<td>resume</td>\n<td>恢复</td>\n</tr>\n<tr>\n<td>gameover</td>\n<td>游戏结束</td>\n</tr>\n</tbody>\n</table>\n<p>用户交互 APIs 规划如下：</p>\n<table>\n<thead>\n<tr>\n<th>name</th>\n<th>type</th>\n<th>deltail</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>init</td>\n<td>method</td>\n<td>初始化游戏</td>\n</tr>\n<tr>\n<td>next</td>\n<td>method</td>\n<td>进入下一关</td>\n</tr>\n<tr>\n<td>enter</td>\n<td>method</td>\n<td>进入指定关卡</td>\n</tr>\n<tr>\n<td>pause</td>\n<td>method</td>\n<td>暂停</td>\n</tr>\n<tr>\n<td>resume</td>\n<td>method</td>\n<td>恢复</td>\n</tr>\n<tr>\n<td>destroy</td>\n<td>method</td>\n<td>销毁游戏</td>\n</tr>\n</tbody>\n</table>\n<h2 id="6-问题">6. 问题</h2>\n<p>在知乎有一个关于「消灭星星」的话题：<a href="https://www.zhihu.com/question/22530789" target="_blank" rel="external">popstar关卡是如何设计的？</a></p>\n<p>这个话题在最后提出了一个问题 —— <strong>「无法消除和最大得分不满足过关条件的矩阵」</strong>。</p>\n<p><img src="https://misc.aotu.io/leeenx/popstar/qustion.jpg" alt="两个问题"/></p>\n<p>「无法消除的矩阵」其实就是最大得分为0的矩阵，本质上是「最大得分不满足过关条件的矩阵」。</p>\n<p><strong>最大得分不满足过关条件的矩阵</strong><br/>\n求「矩阵」的最大得分是一个 「<a href="https://baike.baidu.com/item/%E8%83%8C%E5%8C%85%E9%97%AE%E9%A2%98" target="_blank" rel="external">背包问题</a>」，求解的算法不难：对当前矩阵用「递归」的形式把所有的消灭分支都执行一次，并取最高分值。但是 javascript 的「递归」极易「栈溢出」导致算法无法执行。</p>\n<p>其实在知乎的话题中提到一个解决方案：</p>\n<blockquote><p>网上查到有程序提出做个工具随机生成关卡，自动计算，把符合得分条件的关卡筛选出来</p></blockquote>\n<p>这个解决方案代价是昂贵的！笔者提供有源码并没有解决这个问题，而是用一个比较取巧的方法：<strong>进入游戏前检查是事为「无法消除矩阵」，如果是重新生成关卡矩阵</strong>。</p>\n<p>注意：笔者使用的取巧方案并没有解决问题。</p>\n<h2 id="7-结语">7. 结语</h2>\n<p>下面是本文介绍的「消灭星星」的线上 DEMO 的二维码：</p>\n<p><img src="https://misc.aotu.io/leeenx/popstar/qr.jpg" alt="二维码"/></p>\n<p>游戏的源码托管在：<a href="https://github.com/leeenx/popstar" target="_blank" rel="external">https://github.com/leeenx/popstar</a></p>\n<p>感谢耐心阅读完本文章的读者。本文仅代表笔者的个人观点，如有不妥之处请不吝赐教。<br/>\n如果对「H5游戏开发」感兴趣，欢迎关注我们的<a href="https://zhuanlan.zhihu.com/snsgame" target="_blank" rel="external">专栏</a>。</p>\n<h2 id="参考资料">参考资料</h2>\n<ul>\n<li><a href="https://en.wikipedia.org/wiki/Knapsack_problem" target="_blank" rel="external">Knapsack problem</a></li>\n<li><a href="https://en.wikipedia.org/wiki/NP-completeness" target="_blank" rel="external">NP-completeness</a></li>\n<li><a href="https://www.zhihu.com/question/22530789" target="_blank" rel="external">popstar关卡是如何设计的？</a></li>\n<li><a href="https://en.wikipedia.org/wiki/Fisher%E2%80%93Yates_shuffle" target="_blank" rel="external">费雪耶兹乱序算法</a></li>\n<li><a href="https://aotu.io/notes/2018/01/11/waveaverage/">波动均分算法</a></li>\n</ul>\n</div>\n&#13;\n        <script language="javascript"> &#13;\nvar randomNum = Math.round(Math.random()*1);&#13;\nvar innerHTML=new Array(2);&#13;\ninnerHTML[0]="如果有人让你推荐前端技术书，请让他看这个列表 -&gt;《&lt;a target=\'_blank\' href=\'http://web.jobbole.com/86734/\'&gt;经典前端技术书籍&lt;/a&gt;》";&#13;\ninnerHTML[1]="如果有人让你推荐前端技术书，请让他看这个列表 -&gt;《&lt;a target=\'_blank\' href=\'http://web.jobbole.com/86734/\'&gt;经典前端技术书籍&lt;/a&gt;》";&#13;\nvar widgetHTML="&lt;div id=\'single-page-inner-widget\'&gt;"+innerHTML[randomNum]+"&lt;/div&gt;";&#13;\ndocument.write(widgetHTML);&#13;\n</script>&#13;\n        &#13;\n        \n     \n\n\n\n&#13;\n        <!-- BEGIN #author-bio -->&#13;\n&#13;\n&#13;\n<!-- END #author-bio -->&#13;');
insert into news_article_basic(article_id, user_id, channel_id, title, cover, status)values(31, 1, 1, '暑假花了十九天做的 PFollow', '{"type":0, "images":[]}', 2);
insert into news_article_content(article_id, content) values(31,'<h1 class="heading" data-id="heading-0">PFollow</h1>\n<img align="center" height="100%" width="100%" class="lazyload" data-src="https://user-gold-cdn.xitu.io/2018/11/4/166da63947fe3906?imageView2/0/w/1280/h/960/ignore-error/1" data-width="800" data-height="600"/>\n<h2 class="heading" data-id="heading-1">简介</h2>\n<p>PFollow 为今年暑假新开的项目，期末考试完后和女票一同去了重庆青海西安十日游。在游玩的过程中，使用众多 app 协助旅行，在青海时，会经常到查看 iOS 自带的“指南针” app 看当前海拔。同时也因为在高原的天气变化多端，会非常注意第二天的天气等等这些习惯就被强制性的养成了。</p>\n<p>旅行结束后，躺在宿舍床上慢慢回想这旅行的这段时间，很多回忆都留在了一张张照片上，虽然照片会带上当时拍摄时的一些地点及其它信息，相册也会自动识别并对照片进行归类，甚至还能自动归档生成一段回忆视频。</p>\n<p>但是我总觉得还是不能很好的回忆起当时旅行中的一些美好的细节，因为往往会因为时间或者地点的因素被覆盖掉，却会在故地重游时再现。当时我脑海里就在想，如果我能够把游客此时所在地点配上文字和图片，形成一个个的“点”打在地图上，日后回想起这段旅程时，就可以顺着地图上的“点”，回忆起当初在这里发生的一些事情，这该是一件多么有趣的事情啊！</p>\n<p>遂开干！</p>\n<h2 class="heading" data-id="heading-2">调研</h2>\n<p>我明确知道这种需求是一定被玩烂了的，就开始去 app store 中搜了一遍旅行类、记录类的 app，甚至也把知乎上关于“旅行记录/打卡”的相关问题都过了一遍，发现确实已经有产品在解决这些问题，总结出了以下几点：</p>\n<ul>\n<li>体验不佳；</li>\n<li>太丑；</li>\n<li>广告太多；</li>\n<li>忘了初心（名义上是旅行打卡，实质则为其它，例如：推销旅游产品）</li>\n<li>过于复杂；</li>\n<li>旅行打卡不是主要业务，入口太深</li>\n</ul>\n<p>以上几点当然是都经过考虑的，有可能是因为单纯做“旅行打卡”工具类 app 难以存活；玩不出新花样；用户变现等等问题导致产品的方向发生了变化，都能理解。</p>\n<p>但是，既然各个开发商都不愿意做这赔本事情，那为了满足个人需要就自己开干。</p>\n<h2 class="heading" data-id="heading-3">设计</h2>\n<p>在设计阶段花的时间不多，大概只用了前前后后合计不到四五天的时间就搞定了 1.0 的设计，因为其实自己在大一的时候就萌生出了做类似的旅游产品，很多地方可以直接用之前的设计和逻辑。</p>\n<p>基本上把 app store 中“旅游”、“旅游打卡”、“旅行记录”等关键词下的 app 都使用并思考过了至少一遍，也结合了自己的使用习惯，使用 Sketch 设计出了一套符合个人习惯的 UI 。</p>\n<p>但是非常遗憾，辛辛苦苦在咖啡厅调了一天，然后重装了一次系统偏偏就是忘了备份它！！！导致代码写到后边出的成果有些地方比较“怪异”。</p>\n<h2 class="heading" data-id="heading-4">实施</h2>\n<p>梳理了一遍 PFollow 中需要用到的知识，如下所示：</p>\n<ul>\n<li>自定义地图（高德、百度、MapKit）</li>\n<li>GPS</li>\n<li>陀螺仪</li>\n<li>海拔</li>\n<li>UI Dynamic</li>\n<li>SpriteKit</li>\n<li>CloudKit</li>\n<li>CoreData</li>\n<li>数据库设计</li>\n<li>UIKit</li>\n<li>Tapic Engine</li>\n<li>读取相册</li>\n<li>相机</li>\n<li>其它</li>\n</ul>\n<p>在这个项目中我对“自定义地图”、“UI Dynamic”、“Core Data”没有十足的把握，衡量了一下，可以不用停下目前正在做的事情把精力全部投入进行学习，因为我有个习惯，如果发现准备要做的事情超出了自己目前的知识储备，就会 all in 到学习这个事情中去，弄懂后再开始。</p>\n<p>到最后我发现其实坑还是在 “Core Data” 这块，因为它跟我以往用过的、打着相同口号的 ORM 框架有很多不一样的地方，所以不光是思维的转换上需要斟酌斟酌，还有写法上也不太一样，需要熟悉一段时间。</p>\n<p>不过好在到现在已经对 “Core Data” 有了一定的了解，并且也把习得的知识用在了实习公司的产品中，替换了大部分数据缓存策略。</p>\n<h2 class="heading" data-id="heading-5">展示</h2>\n<p/><figure><img alt="IMG_0305.jpg" class="lazyload" data-src="https://user-gold-cdn.xitu.io/2018/11/4/166da63905ebebbe?imageView2/0/w/1280/h/960/ignore-error/1" data-width="800" data-height="600"/><figcaption/></figure><p/>\n<h3 class="heading" data-id="heading-6">地图</h3>\n<img align="center" height="100%" width="60%" class="lazyload" data-src="https://user-gold-cdn.xitu.io/2018/11/4/166da638da695380?imageView2/0/w/1280/h/960/ignore-error/1" data-width="800" data-height="600"/>\n<h3 class="heading" data-id="heading-7">缩放地图</h3>\n<img align="center" height="100%" width="60%" class="lazyload" data-src="https://user-gold-cdn.xitu.io/2018/11/4/166da639534bfda2?imageView2/0/w/1280/h/960/ignore-error/1" data-width="800" data-height="600"/>\n<h3 class="heading" data-id="heading-8">放大地图</h3>\n<img align="center" height="100%" width="60%" class="lazyload" data-src="https://user-gold-cdn.xitu.io/2018/11/4/166da638ebd3ae5f?imageView2/0/w/1280/h/960/ignore-error/1" data-width="800" data-height="600"/>\n<h3 class="heading" data-id="heading-9">聚点详情</h3>\n<img align="center" height="100%" width="60%" class="lazyload" data-src="https://user-gold-cdn.xitu.io/2018/11/4/166da638ec5c50eb?imageView2/0/w/1280/h/960/ignore-error/1" data-width="720" data-height="1280"/>\n<h3 class="heading" data-id="heading-10">聚点瓶</h3>\n<img align="center" height="100%" width="60%" class="lazyload" data-src="https://user-gold-cdn.xitu.io/2018/11/4/166da638f0bf494f?imageView2/0/w/1280/h/960/ignore-error/1" data-width="720" data-height="1280"/>\n<h2 class="heading" data-id="heading-11">上线计划</h2>\n<p>目前 PFollow 暂无上线计划，因为我在前段时间的一篇文章中了解到 Instagram 居然就是做“地点签到”起家的，后来因为各种原因而改变了产品方向，在当时我瞬间就明白了，Ins 一定是遇到了某些问题，这些问题会在 PFollow 上线后随着时间的流逝而暴露出来，我坚信！</p>\n<p>因此，PFollow 我将会以开源项目的方式进行下去。</p>\n<h2 class="heading" data-id="heading-12">思考</h2>\n<p>在开发 PFollow 的过程中带给我最多的思考还是如何把自己的想法转换成实际一行行的代码，这其中会有许多的妥协和坚持，我们最终坚持下来的东西很有可能就是我们当时内心深处最真实的想法，妥协掉一些累赘。</p>\n<p>当然 1.0 版本还有些许缺陷，很大一部分原因是因为开学了我要有其它的事情去做了，PFollow 算是在这个炎热的暑假中让我静心学习的好助手，让我重新调整了自己的状态迎接大学最后一年。</p>\n<h2 class="heading" data-id="heading-13">项目地址</h2>\n<p>GitHub：<a target="_blank" href="https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2Fwindstormeye%2FPFollow" rel="nofollow noopener noreferrer">github.com/windstormey…</a></p>');
insert into news_article_basic(article_id, user_id, channel_id, title, cover, status)values(32, 1, 1, '研究人员称HTML5可以被用来追踪网民', '{"type":0, "images":[]}', 2);
insert into news_article_content(article_id, content) values(32,'<p><img src="http://image.3001.net/images/20180118/15162592494661.jpg!small" alt="AAEAAQAAAAAAAAjfAAAAJDNiMzEzMzcxLWNmOGEtNGY2Mi1hNDY1LTkxN2U2ZjNhNmViYw.jpg" width="690" height="388"/></p>\n<p><b>HTML5可能是现在最流行的网页制作手段，但小心哦，由于它的新特性，追踪网民变得非常容易。</b></p>\n<p>普林斯顿计算机科学助理教授Arvind Narayanan本周在加利福尼亚的Usenix’s Enigma 2018大会上发表演讲，展示了如何利用HTML5的一些高级功能（如音频播放功能）来识别各种浏览器类型，从而了解用户的喜好。</p>\n<p>例如，不同的浏览器处理声音文件的方式略有不同，别有用心者就可以判断访客的浏览器、操作系统版本。将其与其他细节（如电池电量和WebRTC）结合起来，就可以为单个用户生成指纹。</p>\n<p><img src="http://image.3001.net/images/20180118/15162598033241.jpg!small" alt="audio.jpg" width="648" height="392"/></p>\n<p>不过大家知道，通常我们的浏览器在访问web网站时就会显示相关的操作系统信息。但是，如果使用了HTML5的跟踪方法，完全可以不依赖Javascript和cookie只依赖HTML5自带的特性就可以精准跟踪。</p>\n<blockquote><p>Narayanan解释说：“HTML5浏览器使用一个库来进行音频处理，但不同的软件栈结合上其他数据可以生成一个独特的指纹。同理，电池和WebRTC功能都存在这样的问题。“</p></blockquote>\n<p>Narayanan和他的团队多年来一直在监视广告追踪器的行为。 2014年，他们发现世界上访问量最大的十万个网站中有五千个使用了Canvas指纹识别技术来识别和跟踪访客，而访客全然不知。</p>\n<p>去年的进一步研究发现，广告网络正在使用会话重播脚本追踪用户，他把这种方法起名为“类固醇分析”。 Narayanan表示，他和他的团队在8000个网站上发现了以这种方式追踪访客信息的广告追踪器，其中包括美国药房连锁店Walgreens的网站上的代码，显然他们很有可能通过这种方式将保密病历记录交给了广告商。</p>\n<p>在事件曝光后，这种追踪技术遭到了大家的反对，广告跟踪提供商纷纷停止了服务。但是通过曝光能够起到的作用十分有限，广告追踪公司还是会追踪网络周围的人，并找出他们感兴趣的东西，以便为他们提供有针对性的广告和特别优惠。 Narayanan是Do Not Track浏览器功能的团队成员之一。</p>\n<p><img src="http://image.3001.net/images/20180118/15162597821994.jpg!small" alt="shutterstock_tinfoil_hat.jpg" width="442" height="293"/></p>\n<p>唯一的办法就是浏览器开发者从一开始就采取防护措施禁止广告商追踪用户，可是浏览器厂商往往不想参与。</p>\n<p>因为浏览器厂商往往会选择中立，让用户自己解决，但实际上对于用户来说这就类似于邮件提供商不屏蔽垃圾软件，说他们要保持中立。</p>\n<p>好消息是，Brave浏览器已经内建了反追踪功能，Firefox、Safari和Chrome也正在努力。</p>\n<p>不过最根本的是我们需要重新思考反追踪功能，不要让网站记录信息，并且要更普及这个概念，可以向https一样做一个专门的警告提示。</p>\n<p>隐私对于社会至关重要，如果我们无时无刻都能被追踪，被监视也就失去了隐私。</p>\n&#13;\n        <script language="javascript"> &#13;\nvar randomNum = Math.round(Math.random()*1);&#13;\nvar innerHTML=new Array(2);&#13;\ninnerHTML[0]="如果有人让你推荐前端技术书，请让他看这个列表 -&gt;《&lt;a target=\'_blank\' href=\'http://web.jobbole.com/86734/\'&gt;经典前端技术书籍&lt;/a&gt;》";&#13;\ninnerHTML[1]="如果有人让你推荐前端技术书，请让他看这个列表 -&gt;《&lt;a target=\'_blank\' href=\'http://web.jobbole.com/86734/\'&gt;经典前端技术书籍&lt;/a&gt;》";&#13;\nvar widgetHTML="&lt;div id=\'single-page-inner-widget\'&gt;"+innerHTML[randomNum]+"&lt;/div&gt;";&#13;\ndocument.write(widgetHTML);&#13;\n</script>&#13;\n        &#13;\n        \n     \n\n\n\n&#13;\n        <!-- BEGIN #author-bio -->&#13;\n&#13;\n&#13;\n<!-- END #author-bio -->&#13;');
insert into news_article_basic(article_id, user_id, channel_id, title, cover, status)values(33, 1, 1, 'Flutter系列：2.实现一个简单的登录界面', '{"type":0, "images":[]}', 2);
insert into news_article_content(article_id, content) values(33,'<h1 class="heading" data-id="heading-0">前言</h1>\n<p>上一篇文章<a target="_blank" href="https://link.juejin.im?target=https%3A%2F%2Fjuejin.im%2Fpost%2F5bd9ace3f265da396e672c65" rel="nofollow noopener noreferrer">Flutter系列：1.开发环境配置</a>已经配置好了基本的开发环境，那么这篇将直入主题，实现一个简单的登录页面，实现输入用户名密码点击登录后验证输入有效性，模拟调用api登录，最终弹窗提示登录成功。</p>\n<p/><figure><img class="lazyload" data-src="https://user-gold-cdn.xitu.io/2018/11/1/166cd67e424ceb25?imageslim" data-width="259" data-height="560"/><figcaption/></figure><p/>\n<h3 class="heading" data-id="heading-1">本示例代码在<a target="_blank" href="https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2Fdangercheng%2FFlutterDemos%2Ftree%2Fmaster%2Flogin_alert" rel="nofollow noopener noreferrer">这里Github</a>.</h3>\n<blockquote>\n<p>tips: 在开始前，你应该快速了解下dart的<a target="_blank" href="https://link.juejin.im?target=https%3A%2F%2Fwww.dartlang.org%2Fguides%2Flanguage%2Flanguage-tour" rel="nofollow noopener noreferrer">基本语法</a></p>\n</blockquote>\n<h1 class="heading" data-id="heading-2">布局</h1>\n<p>本示例算是一个比较常见的简单app页面，包括顶部的一个导航栏及其title, 然后一个白底的页面，从上到下依次是一个图片显示控件，用户名和密码的文本输入控件，以及一个提交的按钮。</p>\n<h2 class="heading" data-id="heading-3">布局方式</h2>\n<p>在开始Flutter布局前，心中应该始终记住一个概念，那就是在Flutter布局中显示的都是Widget，包括看得见页面、图片、输入框、按钮...其他看不见的列布局控件(\'Column\'), 容器布局控件(\'Container\')、(\'SizedBox\'),用户表单显示的控件(\'Form\') 甚至用作填充的控件(\'Padding\'), 居中的控件(\'Center\');</p>\n<ul>\n<li><strong>从main函数开始</strong></li>\n</ul>\n<pre><code class="hljs bash copyable" lang="bash">void <span class="hljs-function"><span class="hljs-title">main</span></span>() {\n  debugPaintSizeEnabled = <span class="hljs-literal">false</span>;\n  runApp(new LoginAlertDemoApp());\n}\n\nclass LoginAlertDemoApp extends StatelessWidget {\n  // This widget is the root of your application.\n  @override\n  Widget build(BuildContext context) {\n    <span class="hljs-built_in">return</span> new MaterialApp(\n        title: <span class="hljs-string">\'Login Alert\'</span>,\n        theme: new ThemeData(\n          primarySwatch: Colors.blue,\n        ),\n        home: Scaffold(\n          appBar: AppBar(\n            title: Text(<span class="hljs-string">\'Login Alert\'</span>),\n          ),\n          body: new LoginHomePage(),\n        ));\n  }\n}\n<span class="copy-code-btn">复制代码</span></code></pre><p>main函数顾名思义，就是app运行的入口，debugPaintSizeEnabled是用户调试显示的；然后是调用sdk的runApp方法，传入一个Widget对象并将它显示到屏幕上，所以此Widget便是APP显示的基础Widget，有点相当于iOS开发中的rootViewController来负责承载整个APP的显示。</p>\n<p>在此示例中传入runApp方法的这个Widget是LoginAlertDemoApp，继承自StatelessWidget；重写了其build方法创建了一个MaterialApp的Widget。也就是说主要负责显示的就是MaterialApp的对象，它是用于实现谷歌设计的一套material design设计风格的基础显示Widget，封装了一系列的常用组件和导航控制，比如主题控制。从代码可以看到其home属性是一个Scaffold对象，Scaffold也是material design的基础组件之一，实现基本页面布局结构，比如页面导航栏，同时也封装了一系列的基础控件，比如\'抽屉页\'，toast提示，底部sheet提示。基于material design风格的app基本上都是构建在这2个基础控件之上的。</p>\n<p>接下来就是我们自己实现的页面布局了，LoginHomePage继承自StatefulWidget，注意到Widget有StatefulWidget和StatelessWidget之分，简单的理解呢就是StatefulWidget是具有可变状态的Widget,\n它需要一个State来保存其生命周期中的一些状态数据，并在数据改变时通过setState通知到Widget及时更新。而StatelessWidget则是无状态的，不需要维护其状态，只是简单的显示。</p>\n<p>所以我们需要_LoginHomePageState来维护LoginHomePage生命周期中的一些状态变化数据，并通过build方法来实时构建LoginHomePage的显示Widget。</p>\n<h2 class="heading" data-id="heading-4">基本控件</h2>\n<ul>\n<li><strong>Form</strong></li>\n</ul>\n<p>页面分析这是一个简单的表单提交页面，可以使用\'Form\'来进行布局，同时也能很方便通过其State属性的validate()方法来实现输入验证和提示。\nvalidate()会调用TextFormField的validator来执行验证。</p>\n<ul>\n<li><strong>Image</strong></li>\n</ul>\n<p>用于显示图片的，支持网络图片和本地图片，本地图片需要添加到配置文件中</p>\n<pre><code class="hljs bash copyable" lang="bash"><span class="hljs-comment"># To add assets to your application, add an assets section, like this:</span>\n  <span class="hljs-comment"># assets:</span>\n  <span class="hljs-comment">#  - images/a_dot_burr.jpeg</span>\n  <span class="hljs-comment">#  - images/a_dot_ham.jpeg</span>\n  assets:\n    - images/lake.jpg\n<span class="copy-code-btn">复制代码</span></code></pre><ul>\n<li><strong>TextFormField</strong></li>\n</ul>\n<p>Form中对应的文本输入控件，validator用于验证输入的合法性，当验证不通过时返回一个字符串提示在输入框的底部。</p>\n<ul>\n<li><strong>RaisedButton</strong></li>\n</ul>\n<p>按钮，没什么好说的，onPressed指定点击回调</p>\n<ul>\n<li><strong>Column</strong></li>\n</ul>\n<p>列布局，此demo中各控件从上到下依次布局，Column再合适不过了。</p>\n<ul>\n<li><strong>弹窗</strong></li>\n</ul>\n<p>调用AlertDialog显示一个文本的Widget。</p>\n<h2 class="heading" data-id="heading-5">第三方组件</h2>\n<p>此demo中使用了一个第三方的加载提示组件<a target="_blank" href="https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2Fjogboms%2Fflutter_spinkit" rel="nofollow noopener noreferrer">flutter_spinkit</a></p>\n<p>main.dart顶部代码</p>\n<pre><code class="hljs bash copyable" lang="bash">import <span class="hljs-string">\'package:flutter_spinkit/flutter_spinkit.dart\'</span>;\n<span class="copy-code-btn">复制代码</span></code></pre><p>这是引入的一个第三方加载提示组件flutter_spinkit，使用第三方组件前需要先到pubspec.yaml文件添加依赖配置：</p>\n<pre><code class="hljs bash copyable" lang="bash">flutter_spinkit: <span class="hljs-string">"^2.1.0"</span>\n<span class="copy-code-btn">复制代码</span></code></pre><p>保存后VSCode会自动执行\'flutter packages get\'下载组件。</p>\n<p>使用代码：</p>\n<pre><code class="hljs bash copyable" lang="bash">final _loadingContainer = Container(\n    constraints: BoxConstraints.expand(),\n    color: Colors.black12,\n    child: Center(\n        child: Opacity(\n            opacity: 0.9,\n            child: SpinKitWave(\n              color: Colors.red,\n              size: 50.0,\n            ),\n        ),\n    )\n);\n<span class="copy-code-btn">复制代码</span></code></pre><h1 class="heading" data-id="heading-6">异步操作</h1>\n<p>点击按钮后执行的是以下代码：</p>\n<pre><code class="hljs bash copyable" lang="bash">  void <span class="hljs-function"><span class="hljs-title">_toggleSubmit</span></span>() {\n    <span class="hljs-keyword">if</span> (_formKey.currentState.validate()) {\n      <span class="hljs-built_in">set</span>State(() {\n        _showLoading = <span class="hljs-literal">true</span>;\n      });\n\n      _loginRequest().then((onValue) {\n        <span class="hljs-built_in">set</span>State(() {\n          _showLoading = <span class="hljs-literal">false</span>;\n        });\n        showDialog(\n            context: context,\n            builder: (context) {\n              String alertText = <span class="hljs-string">\'login success!\'</span> +\n                  <span class="hljs-string">\' \\nuserName:\'</span> +\n                  _userNameTextController.text +\n                  <span class="hljs-string">\'\\npassWord:\'</span> +\n                  _passwordTextController.text;\n              <span class="hljs-built_in">return</span> AlertDialog(\n                content: Text(alertText),\n              );\n            });\n      });\n    }\n  }\n<span class="copy-code-btn">复制代码</span></code></pre><ul>\n<li><strong>显示隐藏加载框</strong></li>\n</ul>\n<p>首先通过预先指定的GlobalKey的currentState来拿到对应的FormState, 然后调用validate()方法执行验证Form中的用户名和密码输入内容，通过返回true,否则返回false; 然后通过setState()方法来更新_showLoading属性为true或者false, 便会重新执行build方法，这样就可以动态的显示和隐藏加载框了。</p>\n<ul>\n<li><strong>异步操作</strong></li>\n</ul>\n<pre><code class="hljs bash copyable" lang="bash">Future _loginRequest() async {\n  <span class="hljs-built_in">return</span> Future.delayed(Duration(seconds: 3), () {\n    //<span class="hljs-keyword">do</span> nothing\n    <span class="hljs-built_in">print</span>(<span class="hljs-string">\'login success\'</span>);\n  });\n}\n<span class="copy-code-btn">复制代码</span></code></pre><p>_loginRequest函数返回的是一个Future, 用于dart支持异步操作的关键字，顾名思义这个函数调用后会在未来执行而不是立刻执行，更多细节推荐阅读<a target="_blank" href="https://link.juejin.im?target=https%3A%2F%2Fsegmentfault.com%2Fa%2F1190000014396421" rel="nofollow noopener noreferrer">flutter实战5：异步async、await和Future的使用技巧</a>。</p>\n<p>在_loginRequest函数中，这里只是简单的执行延迟3秒操作来模拟api调用耗时，点击submit按钮后调用此方法，此方法执行完成后调用then方法使用setState来隐藏加载框，同时弹出提示框显示获取到的用户名和密码。</p>\n<pre><code class="hljs bash copyable" lang="bash">_loginRequest().then((onValue) {\n      <span class="hljs-built_in">set</span>State(() {\n        _showLoading = <span class="hljs-literal">false</span>;\n      });\n      showDialog(\n          context: context,\n          builder: (context) {\n            String alertText = <span class="hljs-string">\'login success!\'</span> +\n                <span class="hljs-string">\' \\nuserName:\'</span> +\n                _userNameTextController.text +\n                <span class="hljs-string">\'\\npassWord:\'</span> +\n                _passwordTextController.text;\n            <span class="hljs-built_in">return</span> AlertDialog(\n              content: Text(alertText),\n            );\n          });\n    });\n    \n<span class="copy-code-btn">复制代码</span></code></pre><p>嗯，到此就差不多了，该准备下一个学习demo了，后续Demo持续更新...</p>\n<h1 class="heading" data-id="heading-7">参考</h1>\n<ul>\n<li><a target="_blank" href="https://link.juejin.im?target=https%3A%2F%2Fflutter.io%2Fwidgets%2F" rel="nofollow noopener noreferrer">Flutter官方文档</a></li>\n<li><a target="_blank" href="https://link.juejin.im?target=https%3A%2F%2Fsegmentfault.com%2Fa%2F1190000014396421" rel="nofollow noopener noreferrer">flutter实战5：异步async、await和Future的使用技巧</a></li>\n</ul>');
insert into news_article_basic(article_id, user_id, channel_id, title, cover, status)values(34, 1, 1, '中国能源行业两大领军企业携手唯链发布液化天然气区块链解决方案', '{"type":0, "images":[]}', 2);
insert into news_article_content(article_id, content) values(34,'<link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f76675cdea.css"/>\n\t\t\t\t\t\t<div class="htmledit_views">\n                \n    <div id="dvContent">\n\n\t\t\t\t\t\t\t\n\n\t\t\t\t\t\t\t<table border="0" cellspacing="10" cellpadding="5" align="right"><tbody><tr><td><img src="https://mma.prnewswire.com/media/738233/Vechain_Logo.jpg" border="0" alt="" title="logo" hspace="0" vspace="0" width="118"/></td> \n  </tr></tbody></table><p>中国杭州2018年11月1日电 /美通社/ --\xa0日前，在中国燃气协会主办的2018·中国国际燃气及热力技术与设备展览会上，中国能源行业两大领军企业 -- 新奥能源控股有限公司（以下简称“新奥能源”）与上海燃气（集团）有限公司（以下简称“上海燃气”）携手区块链领先企业唯链，三方正式联合发布全新的液化天然气（以下简称“LNG”）区块链解决方案。</p> \n<div id="prni_dvprnejpg49e9left" style="text-align:center;" dir="ltr"> \n <a href="https://mma.prnewswire.com/media/778045/delegates.jpg" rel="nofollow"><img id="prnejpg49e9left" title="上海燃气（集团）有限公司党委书记、董事长王者洪（左四），新奥能源贸易集团副总裁韩济深（左三），深圳燃气董事长李真（右三），唯链首席运营官冯艺凯（左一），以及来自港华燃气 ，重庆燃气，北京燃气的与会代表" border="0" alt="上海燃气（集团）有限公司党委书记、董事长王者洪（左四），新奥能源贸易集团副总裁韩济深（左三），深圳燃气董事长李真（右三），唯链首席运营官冯艺凯（左一），以及来自港华燃气 ，重庆燃气，北京燃气的与会代表" align="middle" src="https://mma.prnewswire.com/media/778045/Delegates.jpg"/></a> \n <br/><span>上海燃气（集团）有限公司党委书记、董事长王者洪（左四），新奥能源贸易集团副总裁韩济深（左三），深圳燃气董事长李真（右三），唯链首席运营官冯艺凯（左一），以及来自港华燃气 ，重庆燃气，北京燃气的与会代表</span> \n</div> \n<p/> \n<p>中国致力于成为全球清洁能源应用和碳减排领域的先行者和领导者。随着基于唯链雷神区块链技术的LNG管理解决方案的发布，我们向着这一目标又迈出了一大步。</p> \n<p>在此次合作中，新奥能源主要负责LNG相关商业场景的设计与系统建设，提供必要的车辆、设备。在方案的试运行期间，新奥能源将依托其现有业务，提供技术团队和测试场地等支持。同时，作为试运行及周边测试的延伸，新奥能源也将参与商业落地项目的运营。</p> \n<p>作为监督方，上海燃气负责该解决方案在全国LNG市场的推广工作，并已就该方案的推广与多家业内公司建立联系。上海燃气主要负责提供政策引导，保障政府授权及相关流程管理。在商业落地方面，上海燃气将为LNG相关业务的发展协调资源、提供支持，并促进该解决方案在全国范围内的推广。</p> \n<p>唯链主要负责开发和提供底层区块链基础设施技术及必要的软件服务。方案中，三方将使用新奥能源贸易旗下的好气网作为LNG线上交易平台。唯链负责为该网站提供底层区块链基础设施技术，根据网站现有流程，利用唯链雷神区块链对质量证书及SKU查验报告的进行存储。</p> \n<p>该解决方案可用于处理质量保证流程相关的事务，包括各类天然气的分类标准、称重及运输。所有信息均由第三方机构认证，并上传至唯链雷神区块链，按照政府规定建立可靠的行业标准。所有数据均将通过唯链雷神区块链跟踪、共享和交易，高效准确的进一步地规范和优化LNG市场。</p> \n<p>在大规模推广前，舟山LNG接收及加注站将成为首家试运行该解决方案的站点。该站拥有3个码头、2个全包液化气储罐、14个罐车装载筏，同时配备高压IFV气化设施、高压外部传输设施、冷能发电和其他技术和辅助设施，每年可以处理300万吨LNG。</p> \n<div id="prni_dvprnejpg3ad1left" style="text-align:center;" dir="ltr"> \n <a href="https://mma.prnewswire.com/media/778047/enn_energy_terminal.jpg" rel="nofollow"><img id="prnejpg3ad1left" title="新奧舟山LNG接收站" border="0" alt="新奧舟山LNG接收站" align="middle" src="https://mma.prnewswire.com/media/778047/ENN_Energy_Terminal.jpg"/></a> \n <br/><span>新奧舟山LNG接收站</span> \n</div>\n\n\t\t\t\t\t\t\n\n\t\t\t\t\t\t</div>\n              </div>');
